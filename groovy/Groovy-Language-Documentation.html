<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Groovy Language Documentation</title>
<link rel="stylesheet" href="Groovy-Language-Documentation_files/A.css">
<link rel="stylesheet" href="Groovy-Language-Documentation_files/font-awesome.css">
<link rel="stylesheet" href="Groovy-Language-Documentation_files/prettify.css">
<script src="Groovy-Language-Documentation_files/prettify.js"></script>
<script>document.addEventListener('DOMContentLoaded',prettyPrint)</script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Groovy Language Documentation</h1>
<div class="details">
<span id="revnumber">version 2.4.11</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel1">
<li><a href="#_groovy_language_specification">1. Groovy Language Specification</a>
<ul class="sectlevel2">
<li><a href="#_syntax">1.1. Syntax</a>
<ul class="sectlevel3">
<li><a href="#_comments">1.1.1. Comments</a>
<ul class="sectlevel4">
<li><a href="#_single_line_comment">Single line comment</a></li>
<li><a href="#_multiline_comment">Multiline comment</a></li>
<li><a href="#_groovydoc_comment">GroovyDoc comment</a></li>
<li><a href="#_shebang_line">Shebang line</a></li>
</ul>
</li>
<li><a href="#_keywords">1.1.2. Keywords</a></li>
<li><a href="#_identifiers">1.1.3. Identifiers</a>
<ul class="sectlevel4">
<li><a href="#_normal_identifiers">Normal identifiers</a></li>
<li><a href="#_quoted_identifiers">Quoted identifiers</a></li>
</ul>
</li>
<li><a href="#all-strings">1.1.4. Strings</a>
<ul class="sectlevel4">
<li><a href="#_single_quoted_string">Single quoted string</a></li>
<li><a href="#_string_concatenation">String concatenation</a></li>
<li><a href="#_triple_single_quoted_string">Triple single quoted string</a>
<ul class="sectlevel5">
<li><a href="#_escaping_special_characters">Escaping special characters</a></li>
<li><a href="#_unicode_escape_sequence">Unicode escape sequence</a></li>
</ul>
</li>
<li><a href="#_double_quoted_string">Double quoted string</a>
<ul class="sectlevel5">
<li><a href="#_string_interpolation">String interpolation</a></li>
<li><a href="#_special_case_of_interpolating_closure_expressions">Special case of interpolating closure expressions</a></li>
<li><a href="#_interoperability_with_java">Interoperability with Java</a></li>
<li><a href="#_gstring_and_string_hashcodes">GString and String hashCodes</a></li>
</ul>
</li>
<li><a href="#_triple_double_quoted_string">Triple double quoted string</a></li>
<li><a href="#_slashy_string">Slashy string</a></li>
<li><a href="#_dollar_slashy_string">Dollar slashy string</a></li>
<li><a href="#_string_summary_table">String summary table</a></li>
<li><a href="#_characters">Characters</a></li>
</ul>
</li>
<li><a href="#_numbers">1.1.5. Numbers</a>
<ul class="sectlevel4">
<li><a href="#_integral_literals">Integral literals</a>
<ul class="sectlevel5">
<li><a href="#_alternative_non_base_10_representations">Alternative non-base 10 representations</a>
<ul class="sectlevel6">
<li><a href="#_binary_literal">Binary literal</a></li>
<li><a href="#_octal_literal">Octal literal</a></li>
<li><a href="#_hexadecimal_literal">Hexadecimal literal</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_decimal_literals">Decimal literals</a></li>
<li><a href="#_underscore_in_literals">Underscore in literals</a></li>
<li><a href="#_number_type_suffixes">Number type suffixes</a></li>
<li><a href="#_math_operations">Math operations</a>
<ul class="sectlevel5">
<li><a href="#integer_division">The case of the division operator</a></li>
<li><a href="#power_operator">The case of the power operator</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_booleans">1.1.6. Booleans</a></li>
<li><a href="#_lists">1.1.7. Lists</a></li>
<li><a href="#_arrays">1.1.8. Arrays</a></li>
<li><a href="#_maps">1.1.9. Maps</a></li>
</ul>
</li>
<li><a href="#groovy-operators">1.2. Operators</a>
<ul class="sectlevel3">
<li><a href="#_arithmetic_operators">1.2.1. Arithmetic operators</a>
<ul class="sectlevel4">
<li><a href="#_normal_arithmetic_operators">Normal arithmetic operators</a></li>
<li><a href="#_unary_operators">Unary operators</a></li>
<li><a href="#_assignment_arithmetic_operators">Assignment arithmetic operators</a></li>
</ul>
</li>
<li><a href="#_relational_operators">1.2.2. Relational operators</a></li>
<li><a href="#_logical_operators">1.2.3. Logical operators</a>
<ul class="sectlevel4">
<li><a href="#_precedence">Precedence</a></li>
<li><a href="#_short_circuiting">Short-circuiting</a></li>
</ul>
</li>
<li><a href="#_bitwise_operators">1.2.4. Bitwise operators</a></li>
<li><a href="#_conditional_operators">1.2.5. Conditional operators</a>
<ul class="sectlevel4">
<li><a href="#_not_operator">Not operator</a></li>
<li><a href="#_ternary_operator">Ternary operator</a></li>
<li><a href="#_elvis_operator">Elvis operator</a></li>
</ul>
</li>
<li><a href="#_object_operators">1.2.6. Object operators</a>
<ul class="sectlevel4">
<li><a href="#_safe_navigation_operator">Safe navigation operator</a></li>
<li><a href="#_direct_field_access_operator">Direct field access operator</a></li>
<li><a href="#method-pointer-operator">Method pointer operator</a></li>
</ul>
</li>
<li><a href="#_regular_expression_operators">1.2.7. Regular expression operators</a>
<ul class="sectlevel4">
<li><a href="#_pattern_operator">Pattern operator</a></li>
<li><a href="#_find_operator">Find operator</a></li>
<li><a href="#_match_operator">Match operator</a></li>
</ul>
</li>
<li><a href="#_other_operators">1.2.8. Other operators</a>
<ul class="sectlevel4">
<li><a href="#_spread_operator">Spread operator</a>
<ul class="sectlevel5">
<li><a href="#_spreading_method_arguments">Spreading method arguments</a></li>
<li><a href="#_spread_list_elements">Spread list elements</a></li>
<li><a href="#_spread_map_elements">Spread map elements</a></li>
</ul>
</li>
<li><a href="#_range_operator">Range operator</a></li>
<li><a href="#_spaceship_operator">Spaceship operator</a></li>
<li><a href="#subscript-operator">Subscript operator</a></li>
<li><a href="#_membership_operator">Membership operator</a></li>
<li><a href="#_identity_operator">Identity operator</a></li>
<li><a href="#_coercion_operator">Coercion operator</a></li>
<li><a href="#_diamond_operator">Diamond operator</a></li>
<li><a href="#_call_operator">Call operator</a></li>
</ul>
</li>
<li><a href="#_operator_precedence">1.2.9. Operator precedence</a></li>
<li><a href="#Operator-Overloading">1.2.10. Operator overloading</a></li>
</ul>
</li>
<li><a href="#_program_structure">1.3. Program structure</a>
<ul class="sectlevel3">
<li><a href="#_package_names">1.3.1. Package names</a></li>
<li><a href="#_imports">1.3.2. Imports</a>
<ul class="sectlevel4">
<li><a href="#_default_imports">Default imports</a></li>
<li><a href="#_simple_import">Simple import</a></li>
<li><a href="#_star_import">Star import</a></li>
<li><a href="#_static_import">Static import</a></li>
<li><a href="#_static_import_aliasing">Static import aliasing</a></li>
<li><a href="#_static_star_import">Static star import</a></li>
<li><a href="#_import_aliasing">Import aliasing</a></li>
</ul>
</li>
<li><a href="#_scripts_versus_classes">1.3.3. Scripts versus classes</a>
<ul class="sectlevel4">
<li><a href="#_public_static_void_main_vs_script">public static void main vs script</a></li>
<li><a href="#_script_class">Script class</a></li>
<li><a href="#_methods">Methods</a></li>
<li><a href="#_variables">Variables</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_object_orientation">1.4. Object orientation</a>
<ul class="sectlevel3">
<li><a href="#_types">1.4.1. Types</a>
<ul class="sectlevel4">
<li><a href="#_primitive_types">Primitive types</a></li>
<li><a href="#_class">Class</a>
<ul class="sectlevel5">
<li><a href="#_normal_class">Normal class</a></li>
<li><a href="#_inner_class">Inner class</a>
<ul class="sectlevel6">
<li><a href="#_anonymous_inner_class">Anonymous inner class</a></li>
</ul>
</li>
<li><a href="#_abstract_class">Abstract class</a></li>
</ul>
</li>
<li><a href="#_interface">Interface</a></li>
<li><a href="#_constructors">Constructors</a>
<ul class="sectlevel5">
<li><a href="#_positional_argument_constructor">Positional argument constructor</a></li>
<li><a href="#_named_argument_constructor">Named argument constructor</a></li>
</ul>
</li>
<li><a href="#_methods_2">Methods</a>
<ul class="sectlevel5">
<li><a href="#_method_definition">Method definition</a></li>
<li><a href="#_named_arguments">Named arguments</a></li>
<li><a href="#_default_arguments">Default arguments</a></li>
<li><a href="#_varargs">Varargs</a></li>
<li><a href="#_method_selection_algorithm">Method selection algorithm</a></li>
<li><a href="#_exception_declaration">Exception declaration</a></li>
</ul>
</li>
<li><a href="#_fields_and_properties">Fields and properties</a>
<ul class="sectlevel5">
<li><a href="#fields">Fields</a></li>
<li><a href="#properties">Properties</a></li>
</ul>
</li>
<li><a href="#_annotation">Annotation</a>
<ul class="sectlevel5">
<li><a href="#ann-definition">Annotation definition</a></li>
<li><a href="#ann-placement">Annotation placement</a></li>
<li><a href="#_annotation_member_values">Annotation member values</a></li>
<li><a href="#_retention_policy">Retention policy</a></li>
<li><a href="#_closure_annotation_parameters">Closure annotation parameters</a></li>
<li><a href="#_meta_annotations">Meta-annotations</a>
<ul class="sectlevel6">
<li><a href="#_declaring_meta_annotations">Declaring meta-annotations</a></li>
<li><a href="#meta-ann-behavior">Behavior of meta-annotations</a></li>
<li><a href="#meta-ann-members">Meta-annotation parameters</a></li>
<li><a href="#meta-ann-processor">Custom annotation processors</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_inheritance">Inheritance</a></li>
<li><a href="#generics">Generics</a></li>
</ul>
</li>
<li><a href="#_traits">1.4.2. Traits</a>
<ul class="sectlevel4">
<li><a href="#_methods_3">Methods</a>
<ul class="sectlevel5">
<li><a href="#_public_methods">Public methods</a></li>
<li><a href="#_abstract_methods">Abstract methods</a></li>
<li><a href="#_private_methods">Private methods</a></li>
</ul>
</li>
<li><a href="#_the_meaning_of_this">The meaning of this</a></li>
<li><a href="#_interfaces">Interfaces</a></li>
<li><a href="#_properties">Properties</a></li>
<li><a href="#_fields">Fields</a>
<ul class="sectlevel5">
<li><a href="#_private_fields">Private fields</a></li>
<li><a href="#_public_fields">Public fields</a></li>
</ul>
</li>
<li><a href="#_composition_of_behaviors">Composition of behaviors</a></li>
<li><a href="#_overriding_default_methods">Overriding default methods</a></li>
<li><a href="#_extending_traits">Extending traits</a>
<ul class="sectlevel5">
<li><a href="#_simple_inheritance">Simple inheritance</a></li>
<li><a href="#_multiple_inheritance">Multiple inheritance</a></li>
</ul>
</li>
<li><a href="#_duck_typing_and_traits">Duck typing and traits</a>
<ul class="sectlevel5">
<li><a href="#_dynamic_code">Dynamic code</a></li>
<li><a href="#_dynamic_methods_in_a_trait">Dynamic methods in a trait</a></li>
</ul>
</li>
<li><a href="#_multiple_inheritance_conflicts">Multiple inheritance conflicts</a>
<ul class="sectlevel5">
<li><a href="#_default_conflict_resolution">Default conflict resolution</a></li>
<li><a href="#_user_conflict_resolution">User conflict resolution</a></li>
</ul>
</li>
<li><a href="#_runtime_implementation_of_traits">Runtime implementation of traits</a>
<ul class="sectlevel5">
<li><a href="#_implementing_a_trait_at_runtime">Implementing a trait at runtime</a></li>
<li><a href="#_implementing_multiple_traits_at_once">Implementing multiple traits at once</a></li>
</ul>
</li>
<li><a href="#_chaining_behavior">Chaining behavior</a>
<ul class="sectlevel5">
<li><a href="#_semantics_of_super_inside_a_trait">Semantics of super inside a trait</a></li>
</ul>
</li>
<li><a href="#_advanced_features">Advanced features</a>
<ul class="sectlevel5">
<li><a href="#_sam_type_coercion">SAM type coercion</a></li>
<li><a href="#_differences_with_java_8_default_methods">Differences with Java 8 default methods</a></li>
</ul>
</li>
<li><a href="#_differences_with_mixins">Differences with mixins</a></li>
<li><a href="#_static_methods_properties_and_fields">Static methods, properties and fields</a></li>
<li><a href="#_inheritance_of_state_gotchas">Inheritance of state gotchas</a></li>
<li><a href="#_self_types">Self types</a>
<ul class="sectlevel5">
<li><a href="#_type_constraints_on_traits">Type constraints on traits</a></li>
<li><a href="#_the_selftype_annotation">The @SelfType annotation</a></li>
</ul>
</li>
<li><a href="#_limitations">Limitations</a>
<ul class="sectlevel5">
<li><a href="#_compatibility_with_ast_transformations">Compatibility with AST transformations</a></li>
<li><a href="#_prefix_and_postfix_operations">Prefix and postfix operations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_closures">1.5. Closures</a>
<ul class="sectlevel3">
<li><a href="#_syntax_2">1.5.1. Syntax</a>
<ul class="sectlevel4">
<li><a href="#_defining_a_closure">Defining a closure</a></li>
<li><a href="#closure-as-object">Closures as an object</a></li>
<li><a href="#_calling_a_closure">Calling a closure</a></li>
</ul>
</li>
<li><a href="#_parameters">1.5.2. Parameters</a>
<ul class="sectlevel4">
<li><a href="#_normal_parameters">Normal parameters</a></li>
<li><a href="#implicit-it">Implicit parameter</a></li>
<li><a href="#_varargs_2">Varargs</a></li>
</ul>
</li>
<li><a href="#_delegation_strategy">1.5.3. Delegation strategy</a>
<ul class="sectlevel4">
<li><a href="#_groovy_closures_vs_lambda_expressions">Groovy closures vs lambda expressions</a></li>
<li><a href="#closure-owner">Owner, delegate and this</a>
<ul class="sectlevel5">
<li><a href="#closure-this">The meaning of this</a></li>
<li><a href="#_owner_of_a_closure">Owner of a closure</a></li>
<li><a href="#_delegate_of_a_closure">Delegate of a closure</a></li>
<li><a href="#_delegation_strategy_2">Delegation strategy</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_closures_in_gstrings">1.5.4. Closures in GStrings</a></li>
<li><a href="#_closure_coercion">1.5.5. Closure coercion</a></li>
<li><a href="#_functional_programming">1.5.6. Functional programming</a>
<ul class="sectlevel4">
<li><a href="#_currying">Currying</a>
<ul class="sectlevel5">
<li><a href="#_left_currying">Left currying</a></li>
<li><a href="#_right_currying">Right currying</a></li>
<li><a href="#_index_based_currying">Index based currying</a></li>
</ul>
</li>
<li><a href="#_memoization">Memoization</a></li>
<li><a href="#_composition">Composition</a></li>
<li><a href="#_trampoline">Trampoline</a></li>
<li><a href="#_method_pointers">Method pointers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_semantics">1.6. Semantics</a>
<ul class="sectlevel3">
<li><a href="#_statements">1.6.1. Statements</a>
<ul class="sectlevel4">
<li><a href="#_variable_definition">Variable definition</a></li>
<li><a href="#_variable_assignment">Variable assignment</a>
<ul class="sectlevel5">
<li><a href="#_multiple_assignment">Multiple assignment</a></li>
<li><a href="#_overflow_and_underflow">Overflow and Underflow</a></li>
<li><a href="#_object_destructuring_with_multiple_assignment">Object destructuring with multiple assignment</a></li>
</ul>
</li>
<li><a href="#_control_structures">Control structures</a>
<ul class="sectlevel5">
<li><a href="#_conditional_structures">Conditional structures</a>
<ul class="sectlevel6">
<li><a href="#_if_else">if / else</a></li>
<li><a href="#_switch_case">switch / case</a></li>
</ul>
</li>
<li><a href="#_looping_structures">Looping structures</a>
<ul class="sectlevel6">
<li><a href="#_classic_for_loop">Classic for loop</a></li>
<li><a href="#_for_in_loop">for in loop</a></li>
<li><a href="#_while_loop">while loop</a></li>
</ul>
</li>
<li><a href="#_exception_handling">Exception handling</a></li>
<li><a href="#_try_catch_finally">try / catch / finally</a></li>
<li><a href="#_multi_catch">Multi-catch</a></li>
</ul>
</li>
<li><a href="#_power_assertion">Power assertion</a></li>
<li><a href="#_labeled_statements">Labeled statements</a></li>
</ul>
</li>
<li><a href="#_expressions">1.6.2. Expressions</a>
<ul class="sectlevel4">
<li><a href="#gpath_expressions">GPath expressions</a>
<ul class="sectlevel5">
<li><a href="#_object_navigation">Object navigation</a></li>
<li><a href="#_expression_deconstruction">Expression Deconstruction</a></li>
<li><a href="#_gpath_for_xml_navigation">GPath for XML navigation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_promotion_and_coercion">1.6.3. Promotion and coercion</a>
<ul class="sectlevel4">
<li><a href="#_number_promotion">Number promotion</a></li>
<li><a href="#closure-coercion">Closure to type coercion</a>
<ul class="sectlevel5">
<li><a href="#_assigning_a_closure_to_a_sam_type">Assigning a closure to a SAM type</a></li>
<li><a href="#_calling_a_method_accepting_a_sam_type_with_a_closure">Calling a method accepting a SAM type with a closure</a></li>
<li><a href="#_closure_to_arbitrary_type_coercion">Closure to arbitrary type coercion</a></li>
</ul>
</li>
<li><a href="#_map_to_type_coercion">Map to type coercion</a></li>
<li><a href="#_string_to_enum_coercion">String to enum coercion</a></li>
<li><a href="#_custom_type_coercion">Custom type coercion</a></li>
<li><a href="#_class_literals_vs_variables_and_the_as_operator">Class literals vs variables and the as operator</a></li>
</ul>
</li>
<li><a href="#_optionality">1.6.4. Optionality</a>
<ul class="sectlevel4">
<li><a href="#_optional_parentheses">Optional parentheses</a></li>
<li><a href="#_optional_semicolons">Optional semicolons</a></li>
<li><a href="#_optional_return_keyword">Optional return keyword</a></li>
<li><a href="#_optional_public_keyword">Optional public keyword</a></li>
</ul>
</li>
<li><a href="#Groovy-Truth">1.6.5. The Groovy Truth</a>
<ul class="sectlevel4">
<li><a href="#_boolean_expressions">Boolean expressions</a></li>
<li><a href="#_collections_and_arrays">Collections and Arrays</a></li>
<li><a href="#_matchers">Matchers</a></li>
<li><a href="#_iterators_and_enumerations">Iterators and Enumerations</a></li>
<li><a href="#_maps_2">Maps</a></li>
<li><a href="#_strings">Strings</a></li>
<li><a href="#_numbers_2">Numbers</a></li>
<li><a href="#_object_references">Object References</a></li>
<li><a href="#_customizing_the_truth_with_asboolean_methods">Customizing the truth with asBoolean() methods</a></li>
</ul>
</li>
<li><a href="#_typing">1.6.6. Typing</a>
<ul class="sectlevel4">
<li><a href="#_optional_typing">Optional typing</a></li>
<li><a href="#static-type-checking">Static type checking</a>
<ul class="sectlevel5">
<li><a href="#_the_code_typechecked_code_annotation">The <code>@TypeChecked</code> annotation</a>
<ul class="sectlevel6">
<li><a href="#_activating_type_checking_at_compile_time">Activating type checking at compile time</a></li>
<li><a href="#_skipping_sections">Skipping sections</a></li>
</ul>
</li>
<li><a href="#_type_checking_assignments">Type checking assignments</a></li>
<li><a href="#_list_and_map_constructors">List and map constructors</a></li>
<li><a href="#_method_resolution">Method resolution</a></li>
<li><a href="#type-inference">Type inference</a>
<ul class="sectlevel6">
<li><a href="#_principles">Principles</a></li>
<li><a href="#_variables_vs_fields_in_type_inference">Variables vs fields in type inference</a></li>
<li><a href="#_collection_literal_type_inference">Collection literal type inference</a></li>
<li><a href="#section-lub">Least upper bound</a></li>
<li><a href="#_instanceof_inference">instanceof inference</a></li>
<li><a href="#section-flow-typing">Flow typing</a></li>
<li><a href="#_advanced_type_inference">Advanced type inference</a></li>
</ul>
</li>
<li><a href="#_closures_and_type_inference">Closures and type inference</a>
<ul class="sectlevel6">
<li><a href="#_return_type_inference">Return type inference</a></li>
<li><a href="#_parameter_type_inference">Parameter type inference</a>
<ul class="sectlevel7">
<li><a href="#_explicit_closure_parameters">Explicit closure parameters</a></li>
<li><a href="#_parameters_inferred_from_single_abstract_method_types">Parameters inferred from single-abstract method types</a></li>
<li><a href="#_the_code_closureparams_code_annotation">The <code>@ClosureParams</code> annotation</a></li>
</ul>
</li>
<li><a href="#__code_delegatesto_code"><code>@DelegatesTo</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_static_compilation">Static compilation</a>
<ul class="sectlevel5">
<li><a href="#_dynamic_vs_static">Dynamic vs static</a></li>
<li><a href="#compilestatic-annotation">The <code>@CompileStatic</code> annotation</a></li>
<li><a href="#_key_benefits">Key benefits</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_type_checking_extensions">1.6.7. Type checking extensions</a>
<ul class="sectlevel4">
<li><a href="#_writing_a_type_checking_extension">Writing a type checking extension</a>
<ul class="sectlevel5">
<li><a href="#_towards_a_smarter_type_checker">Towards a smarter type checker</a></li>
<li><a href="#Typecheckingextensions-Howdoesitwork">The extensions attribute</a></li>
<li><a href="#_a_dsl_for_type_checking">A DSL for type checking</a></li>
<li><a href="#Typecheckingextensions-TheAPI">Type checking extensions API</a>
<ul class="sectlevel6">
<li><a href="#Typecheckingextensions-AST">AST</a></li>
<li><a href="#Typecheckingextensions-Events">Events</a></li>
</ul>
</li>
<li><a href="#Typecheckingextensions-Workingwithextensions">Working with extensions</a>
<ul class="sectlevel6">
<li><a href="#Typecheckingextensions-Supportclasses">Support classes</a></li>
<li><a href="#Typecheckingextensions-Classnodes">Class nodes</a></li>
<li><a href="#Typecheckingextensions-Helpingthetypechecker">Helping the type checker</a></li>
<li><a href="#Typecheckingextensions-Throwinganerror">Throwing an error</a></li>
<li><a href="#Typecheckingextensions-isXXXExpression">isXXXExpression</a></li>
<li><a href="#Typecheckingextensions-Virtualmethods">Virtual methods</a></li>
<li><a href="#Typecheckingextensions-Scoping">Scoping</a></li>
<li><a href="#Typecheckingextensions-Otherusefulmethods">Other useful methods</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_advanced_type_checking_extensions">Advanced type checking extensions</a>
<ul class="sectlevel5">
<li><a href="#_precompiled_type_checking_extensions">Precompiled type checking extensions</a></li>
<li><a href="#_using_grab_in_a_type_checking_extension">Using @Grab in a type checking extension</a></li>
<li><a href="#_sharing_or_packaging_type_checking_extensions">Sharing or packaging type checking extensions</a></li>
<li><a href="#_global_type_checking_extensions">Global type checking extensions</a></li>
<li><a href="#_type_checking_extensions_and_compilestatic">Type checking extensions and @CompileStatic</a></li>
<li><a href="#mixed-mode">Mixed mode compilation</a></li>
<li><a href="#ast-xform-as-extension">Transforming the AST in an extension</a></li>
<li><a href="#_examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_tools">2. Tools</a>
<ul class="sectlevel2">
<li><a href="#_running_groovy_from_the_commandline">2.1. Running Groovy from the commandline</a>
<ul class="sectlevel3">
<li><a href="#section-groovy-commandline">2.1.1. groovy, the Groovy command</a></li>
</ul>
</li>
<li><a href="#_compiling_groovy">2.2. Compiling Groovy</a>
<ul class="sectlevel3">
<li><a href="#section-groovyc-compiler">2.2.1. groovyc, the Groovy compiler</a></li>
<li><a href="#_ant_task">2.2.2. Ant task</a>
<ul class="sectlevel4">
<li><a href="#ThegroovycAntTask-groovyc"><code>&lt;groovyc&gt;</code></a>
<ul class="sectlevel5">
<li><a href="#ThegroovycAntTask-Description">Description</a></li>
<li><a href="#ThegroovycAntTask-Requiredtaskdef">Required taskdef</a></li>
<li><a href="#ThegroovycAntTask-groovycAttributes">&lt;groovyc&gt; Attributes</a></li>
<li><a href="#ThegroovycAntTask-groovycNestedElements">&lt;groovyc&gt; Nested Elements</a></li>
<li><a href="#ThegroovycAntTask-JointCompilation">Joint Compilation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Gant">2.2.3. Gant</a></li>
<li><a href="#Gradle">2.2.4. Gradle</a></li>
<li><a href="#_maven_integration">2.2.5. Maven integration</a>
<ul class="sectlevel4">
<li><a href="#_gmaven_and_gmavenplus">GMaven and GMavenPlus</a>
<ul class="sectlevel5">
<li><a href="#section-gmaven">GMaven</a></li>
<li><a href="#section-gmavenplus">GMavenPlus</a></li>
<li><a href="#section-gmaven2">GMaven 2</a></li>
</ul>
</li>
<li><a href="#section-groovyeclipse">The Groovy Eclipse Maven plugin</a></li>
</ul>
</li>
<li><a href="#section-jointcompilation">2.2.6. Joint compilation</a></li>
<li><a href="#section-android">2.2.7. Android support</a></li>
</ul>
</li>
<li><a href="#_groovysh_the_groovy_shell">2.3. Groovysh, the Groovy shell</a>
<ul class="sectlevel3">
<li><a href="#_groovy_groovy_shell">2.3.1. Groovy : Groovy Shell</a>
<ul class="sectlevel4">
<li><a href="#GroovyShell-Features">Features</a></li>
<li><a href="#GroovyShell-Command-lineOptionsandArguments">Command-line Options and Arguments</a></li>
<li><a href="#GroovyShell-EvaluatingExpressions">Evaluating Expressions</a>
<ul class="sectlevel5">
<li><a href="#GroovyShell-SimpleExpressions">Simple Expressions</a></li>
<li><a href="#GroovyShell-EvaluationResult">Evaluation Result</a></li>
<li><a href="#GroovyShell-Multi-lineExpressions">Multi-line Expressions</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-DefineaClass">Define a Class</a></li>
<li><a href="#GroovyShell-UsetheClass">Use the Class</a></li>
</ul>
</li>
<li><a href="#GroovyShell-Variables">Variables</a></li>
<li><a href="#GroovyShell-Functions">Functions</a></li>
</ul>
</li>
<li><a href="#GroovyShell-Commands">Commands</a>
<ul class="sectlevel5">
<li><a href="#GroovyShell-RecognizedCommands">Recognized Commands</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-help"><code>help</code></a></li>
<li><a href="#GroovyShell-exit"><code>exit</code></a></li>
<li><a href="#GroovyShell-import"><code>import</code></a></li>
<li><a href="#GroovyShell-display"><code>display</code></a></li>
<li><a href="#GroovyShell-clear"><code>clear</code></a></li>
<li><a href="#GroovyShell-show"><code>show</code></a></li>
<li><a href="#GroovyShell-inspect"><code>inspect</code></a></li>
<li><a href="#GroovyShell-purge"><code>purge</code></a></li>
<li><a href="#GroovyShell-edit"><code>edit</code></a></li>
<li><a href="#GroovyShell-load"><code>load</code></a></li>
<li><a href="#GroovyShell-save"><code>save</code></a></li>
<li><a href="#GroovyShell-record"><code>record</code></a></li>
<li><a href="#GroovyShell-history"><code>history</code></a></li>
<li><a href="#GroovyShell-alias"><code>alias</code></a></li>
<li><a href="#GroovyShell-doc"><code>doc</code></a></li>
<li><a href="#GroovyShell-set"><code>set</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#GroovyShell-Preferences">Preferences</a>
<ul class="sectlevel5">
<li><a href="#GroovyShell-RecognizedPreferences">Recognized Preferences</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-InterpreterMode"><code>interpreterMode</code></a></li>
<li><a href="#GroovyShell-verbosity"><code>verbosity</code></a></li>
<li><a href="#__code_colors_code"><code>colors</code></a></li>
<li><a href="#GroovyShell-show-last-result"><code>show-last-result</code></a></li>
<li><a href="#GroovyShell-sanitize-stack-trace"><code>sanitize-stack-trace</code></a></li>
<li><a href="#GroovyShell-editor"><code>editor</code></a></li>
</ul>
</li>
<li><a href="#GroovyShell-SettingaPreference">Setting a Preference</a></li>
<li><a href="#GroovyShell-ListingPreferences">Listing Preferences</a></li>
<li><a href="#GroovyShell-ClearingPreferencesieResettingtoDefaults">Clearing Preferences (i.e. Resetting to Defaults)</a></li>
</ul>
</li>
<li><a href="#GroovyShell-UserProfileScriptsandState">User Profile Scripts and State</a>
<ul class="sectlevel5">
<li><a href="#GroovyShell-ProfileScripts">Profile Scripts</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-HOMEgroovygroovyshprofile"><code>$HOME/.groovy/groovysh.profile</code></a></li>
<li><a href="#GroovyShell-HOMEgroovygroovyshrc"><code>$HOME/.groovy/groovysh.rc</code></a></li>
</ul>
</li>
<li><a href="#GroovyShell-State">State</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-HOMEgroovygroovyshhistory"><code>$HOME/.groovy/groovysh.history</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#GroovyShell-register">Custom commands</a></li>
<li><a href="#GroovyShell-Troubleshooting">Troubleshooting</a>
<ul class="sectlevel5">
<li><a href="#GroovyShell-PlatformProblems">Platform Problems</a>
<ul class="sectlevel6">
<li><a href="#GroovyShell-ProblemsloadingtheJLineDLL">Problems loading the JLine DLL</a></li>
<li><a href="#GroovyShell-ProblemswithCygwinonWindows">Problems with Cygwin on Windows</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#GroovyShell-GMavenPlus">2.3.2. GMavenPlus Maven Plugin</a></li>
<li><a href="#GroovyShell-GradleGroovyshPlugin">2.3.3. Gradle Groovysh Plugin</a></li>
</ul>
</li>
<li><a href="#_groovyconsole_the_groovy_swing_console">2.4. groovyConsole, the Groovy swing console</a>
<ul class="sectlevel3">
<li><a href="#title-heading">2.4.1. Groovy : Groovy Console</a></li>
<li><a href="#GroovyConsole-Basics">2.4.2. Basics</a></li>
<li><a href="#GroovyConsole-Features">2.4.3. Features</a>
<ul class="sectlevel4">
<li><a href="#GroovyConsole-RunningScripts">Running Scripts</a></li>
<li><a href="#GroovyConsole-EditingFiles">Editing Files</a></li>
<li><a href="#GroovyConsole-Historyandresults">History and results</a></li>
<li><a href="#GroovyConsole-Interrupt">Interrupting a script</a></li>
<li><a href="#GroovyConsole-Andmore">And more</a></li>
</ul>
</li>
<li><a href="#GroovyConsole-EmbeddingtheConsole">2.4.4. Embedding the Console</a></li>
<li><a href="#GroovyConsole-Visualizingscriptoutputresults">2.4.5. Visualizing script output results</a></li>
<li><a href="#GroovyConsole-ASTbrowser">2.4.6. AST browser</a></li>
</ul>
</li>
<li><a href="#_groovydoc_the_groovy_java_documentation_generator">2.5. groovydoc, the Groovy &amp; Java documentation generator</a>
<ul class="sectlevel3">
<li><a href="#Groovydoc-CommandLine">2.5.1. The groovydoc command line tool</a></li>
<li><a href="#Groovydoc-Ant">2.5.2. The groovydoc Ant task</a>
<ul class="sectlevel4">
<li><a href="#ThegroovydocAnttask-Requiredtaskdef">Required taskdef</a></li>
<li><a href="#ThegroovydocAnttask-groovydocAttributes">&lt;groovydoc&gt; Attributes</a></li>
<li><a href="#ThegroovydocAnttask-groovydocNestedElements">&lt;groovydoc&gt; Nested Elements</a>
<ul class="sectlevel5">
<li><a href="#ThegroovydocAnttask-link">link</a></li>
<li><a href="#ThegroovydocAnttask-Example1-groovydocAnttask">Example #1 - &lt;groovydoc&gt; Ant task</a></li>
<li><a href="#ThegroovydocAnttask-Example2-ExecutinggroovydocfromGroovy">Example #2 - Executing &lt;groovydoc&gt; from Groovy</a></li>
</ul>
</li>
<li><a href="#_custom_templates">Custom templates</a>
<ul class="sectlevel5">
<li><a href="#_custom_groovydoc_class">Custom Groovydoc class</a></li>
<li><a href="#_using_the_custom_groovydoc_task">Using the custom groovydoc task</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Groovydoc-GMavenPlus">2.5.3. GMavenPlus Maven Plugin</a></li>
</ul>
</li>
<li><a href="#_ide_integration">2.6. IDE integration</a></li>
</ul>
</li>
<li><a href="#_user_guides">3. User Guides</a>
<ul class="sectlevel2">
<li><a href="#_getting_started">3.1. Getting started</a>
<ul class="sectlevel3">
<li><a href="#_download">3.1.1. Download</a>
<ul class="sectlevel4">
<li><a href="#_stable">Stable</a></li>
<li><a href="#_snapshots">Snapshots</a></li>
<li><a href="#_prerequisites">Prerequisites</a></li>
</ul>
</li>
<li><a href="#_maven_repository">3.1.2. Maven Repository</a>
<ul class="sectlevel4">
<li><a href="#_stable_release">Stable Release</a></li>
</ul>
</li>
<li><a href="#SDKMAN">3.1.3. SDKMAN! (The Software Development Kit Manager)</a></li>
<li><a href="#_other_ways_to_get_groovy">3.1.4. Other ways to get Groovy</a>
<ul class="sectlevel4">
<li><a href="#_installation_on_mac_os_x">Installation on Mac OS X</a>
<ul class="sectlevel5">
<li><a href="#_macports">MacPorts</a></li>
<li><a href="#_homebrew">Homebrew</a></li>
</ul>
</li>
<li><a href="#_installation_on_windows">Installation on Windows</a></li>
<li><a href="#_other_distributions">Other Distributions</a></li>
<li><a href="#_source_code">Source Code</a></li>
<li><a href="#_ide_plugin">IDE plugin</a></li>
</ul>
</li>
<li><a href="#_install_binary">3.1.5. Install Binary</a></li>
</ul>
</li>
<li><a href="#_differences_with_java">3.2. Differences with Java</a>
<ul class="sectlevel3">
<li><a href="#_default_imports_2">3.2.1. Default imports</a></li>
<li><a href="#_multi_methods">3.2.2. Multi-methods</a></li>
<li><a href="#_array_initializers">3.2.3. Array initializers</a></li>
<li><a href="#_package_scope_visibility">3.2.4. Package scope visibility</a></li>
<li><a href="#_arm_blocks">3.2.5. ARM blocks</a></li>
<li><a href="#_inner_classes">3.2.6. Inner classes</a>
<ul class="sectlevel4">
<li><a href="#_static_inner_classes">Static inner classes</a></li>
<li><a href="#_anonymous_inner_classes">Anonymous Inner Classes</a></li>
<li><a href="#_creating_instances_of_non_static_inner_classes">Creating Instances of Non-Static Inner Classes</a></li>
</ul>
</li>
<li><a href="#_lambdas">3.2.7. Lambdas</a></li>
<li><a href="#_gstrings">3.2.8. GStrings</a></li>
<li><a href="#_string_and_character_literals">3.2.9. String and Character literals</a></li>
<li><a href="#_primitives_and_wrappers">3.2.10. Primitives and wrappers</a></li>
<li><a href="#_behaviour_of_code_code">3.2.11. Behaviour of <code>==</code></a></li>
<li><a href="#_conversions">3.2.12. Conversions</a></li>
<li><a href="#_extra_keywords">3.2.13. Extra keywords</a></li>
</ul>
</li>
<li><a href="#_groovy_development_kit">3.3. Groovy Development Kit</a>
<ul class="sectlevel3">
<li><a href="#_working_with_io">3.3.1. Working with IO</a>
<ul class="sectlevel4">
<li><a href="#_reading_files">Reading files</a></li>
<li><a href="#_writing_files">Writing files</a></li>
<li><a href="#_traversing_file_trees">Traversing file trees</a></li>
<li><a href="#_data_and_objects">Data and objects</a></li>
<li><a href="#process-management">Executing External Processes</a></li>
</ul>
</li>
<li><a href="#_working_with_collections">3.3.2. Working with collections</a>
<ul class="sectlevel4">
<li><a href="#Collections-Lists">Lists</a>
<ul class="sectlevel5">
<li><a href="#_list_literals">List literals</a></li>
<li><a href="#_list_as_a_boolean_expression">List as a boolean expression</a></li>
<li><a href="#_iterating_on_a_list">Iterating on a list</a></li>
<li><a href="#_manipulating_lists">Manipulating lists</a>
<ul class="sectlevel6">
<li><a href="#List-Filtering">Filtering and searching</a></li>
<li><a href="#_adding_or_removing_elements">Adding or removing elements</a></li>
<li><a href="#_set_operations">Set operations</a></li>
<li><a href="#_sorting">Sorting</a></li>
<li><a href="#_duplicating_elements">Duplicating elements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Collections-Maps">Maps</a>
<ul class="sectlevel5">
<li><a href="#_map_literals">Map literals</a></li>
<li><a href="#_map_property_notation">Map property notation</a></li>
<li><a href="#_iterating_on_maps">Iterating on maps</a></li>
<li><a href="#_manipulating_maps">Manipulating maps</a>
<ul class="sectlevel6">
<li><a href="#_adding_or_removing_elements_2">Adding or removing elements</a></li>
<li><a href="#JN1035-Maps-Collectionviewsofamap">Keys, values and entries</a></li>
<li><a href="#_filtering_and_searching">Filtering and searching</a></li>
<li><a href="#Maps-Grouping">Grouping</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Collections-Ranges">Ranges</a></li>
<li><a href="#_syntax_enhancements_for_collections">Syntax enhancements for collections</a>
<ul class="sectlevel5">
<li><a href="#_gpath_support">GPath support</a></li>
<li><a href="#_spread_operator_2">Spread operator</a></li>
<li><a href="#Collections-Gettingefficientwiththestar-dotoperator">The star-dot `*.' operator</a></li>
<li><a href="#Collections-Slicingwiththesubscriptoperator">Slicing with the subscript operator</a></li>
</ul>
</li>
<li><a href="#Collections-EnhancedCollectionMethods">Enhanced Collection Methods</a></li>
</ul>
</li>
<li><a href="#_handy_utilities">3.3.3. Handy utilities</a>
<ul class="sectlevel4">
<li><a href="#_configslurper">ConfigSlurper</a></li>
<li><a href="#_expando">Expando</a></li>
<li><a href="#_observable_list_map_and_set">Observable list, map and set</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_metaprogramming">3.4. Metaprogramming</a>
<ul class="sectlevel3">
<li><a href="#_runtime_metaprogramming">3.4.1. Runtime metaprogramming</a>
<ul class="sectlevel4">
<li><a href="#_groovyobject_interface">GroovyObject interface</a>
<ul class="sectlevel5">
<li><a href="#_invokemethod">invokeMethod</a></li>
<li><a href="#_get_setproperty">get/setProperty</a></li>
<li><a href="#_get_setmetaclass">get/setMetaClass</a></li>
</ul>
</li>
<li><a href="#_get_setattribute">get/setAttribute</a></li>
<li><a href="#_methodmissing">methodMissing</a></li>
<li><a href="#_propertymissing">propertyMissing</a></li>
<li><a href="#_groovyinterceptable">GroovyInterceptable</a></li>
<li><a href="#categories">Categories</a></li>
<li><a href="#_metaclasses">Metaclasses</a>
<ul class="sectlevel5">
<li><a href="#_custom_metaclasses">Custom metaclasses</a>
<ul class="sectlevel6">
<li><a href="#_delegating_metaclass">Delegating metaclass</a></li>
<li><a href="#_magic_package_maksym_stavytskyi">Magic package (Maksym Stavytskyi)</a></li>
</ul>
</li>
<li><a href="#_per_instance_metaclass">Per instance metaclass</a></li>
<li><a href="#metaprogramming_emc">ExpandoMetaClass</a>
<ul class="sectlevel6">
<li><a href="#_methods_4">Methods</a></li>
<li><a href="#_properties_2">Properties</a></li>
<li><a href="#_constructors_2">Constructors</a></li>
<li><a href="#_static_methods">Static Methods</a></li>
<li><a href="#_borrowing_methods">Borrowing Methods</a></li>
<li><a href="#_dynamic_method_names">Dynamic Method Names</a></li>
<li><a href="#_runtime_discovery">Runtime Discovery</a></li>
<li><a href="#_groovyobject_methods">GroovyObject Methods</a></li>
<li><a href="#_overriding_static_invokemethod">Overriding Static invokeMethod</a></li>
<li><a href="#_extending_interfaces">Extending Interfaces</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_extension_modules">Extension modules</a>
<ul class="sectlevel5">
<li><a href="#_extending_existing_classes">Extending existing classes</a></li>
<li><a href="#_instance_methods">Instance methods</a></li>
<li><a href="#_static_methods_2">Static methods</a></li>
<li><a href="#module-descriptor">Module descriptor</a></li>
<li><a href="#_extension_modules_and_classpath">Extension modules and classpath</a></li>
<li><a href="#_compatibility_with_type_checking">Compatibility with type checking</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_compile_time_metaprogramming">3.4.2. Compile-time metaprogramming</a>
<ul class="sectlevel4">
<li><a href="#_available_ast_transformations">Available AST transformations</a>
<ul class="sectlevel5">
<li><a href="#_code_generation_transformations">Code generation transformations</a>
<ul class="sectlevel6">
<li><a href="#xform-ToString"><code>@groovy.transform.ToString</code></a></li>
<li><a href="#xform-EqualsAndHashCode"><code>@groovy.transform.EqualsAndHashCode</code></a></li>
<li><a href="#xform-TupleConstructor"><code>@groovy.transform.TupleConstructor</code></a></li>
<li><a href="#xform-Canonical"><code>@groovy.transform.Canonical</code></a></li>
<li><a href="#xform-InheritConstructors"><code>@groovy.transform.InheritConstructors</code></a></li>
<li><a href="#xform-Category"><code>@groovy.lang.Category</code></a></li>
<li><a href="#xform-IndexedProperty"><code>@groovy.transform.IndexedProperty</code></a></li>
<li><a href="#xform-Lazy"><code>@groovy.lang.Lazy</code></a></li>
<li><a href="#xform-Newify"><code>@groovy.lang.Newify</code></a></li>
<li><a href="#xform-Sortable"><code>@groovy.transform.Sortable</code></a></li>
<li><a href="#xform-Builder"><code>@groovy.transform.builder.Builder</code></a></li>
</ul>
</li>
<li><a href="#_class_design_annotations">Class design annotations</a>
<ul class="sectlevel6">
<li><a href="#xform-Delegate"><code>@groovy.lang.Delegate</code></a></li>
<li><a href="#xform-Immutable"><code>@groovy.transform.Immutable</code></a></li>
<li><a href="#xform-Memoized"><code>@groovy.transform.Memoized</code></a></li>
<li><a href="#xform-Singleton"><code>@groovy.lang.Singleton</code></a></li>
<li><a href="#xform-Mixin"><code>@groovy.transform.Mixin</code></a></li>
</ul>
</li>
<li><a href="#_logging_improvements">Logging improvements</a>
<ul class="sectlevel6">
<li><a href="#xform-Log"><code>@groovy.util.logging.Log</code></a></li>
<li><a href="#xform-Commons"><code>@groovy.util.logging.Commons</code></a></li>
<li><a href="#xform-Log4j"><code>@groovy.util.logging.Log4j</code></a></li>
<li><a href="#xform-Log4j2"><code>@groovy.util.logging.Log4j2</code></a></li>
<li><a href="#xform-Slf4j"><code>@groovy.util.logging.Slf4j</code></a></li>
</ul>
</li>
<li><a href="#_declarative_concurrency">Declarative concurrency</a>
<ul class="sectlevel6">
<li><a href="#xform-Synchronized"><code>@groovy.transform.Synchronized</code></a></li>
<li><a href="#xform-WithReadLock"><code>@groovy.transform.WithReadLock</code> and <code>@groovy.transform.WithWriteLock</code></a></li>
</ul>
</li>
<li><a href="#_easier_cloning_and_externalizing">Easier cloning and externalizing</a>
<ul class="sectlevel6">
<li><a href="#xform-AutoClone"><code>@groovy.transform.AutoClone</code></a></li>
<li><a href="#xform-AutoExternalize"><code>@groovy.transform.AutoExternalize</code></a></li>
</ul>
</li>
<li><a href="#_safer_scripting">Safer scripting</a>
<ul class="sectlevel6">
<li><a href="#xform-ThreadInterrupt"><code>@groovy.transform.ThreadInterrupt</code></a></li>
<li><a href="#xform-TimedInterrupt"><code>@groovy.transform.TimedInterrupt</code></a></li>
<li><a href="#xform-ConditionalInterrupt"><code>@groovy.transform.ConditionalInterrupt</code></a></li>
</ul>
</li>
<li><a href="#_compiler_directives">Compiler directives</a>
<ul class="sectlevel6">
<li><a href="#xform-Field"><code>@groovy.transform.Field</code></a></li>
<li><a href="#xform-PackageScope"><code>@groovy.transform.PackageScope</code></a></li>
<li><a href="#xform-AnnotationCollector"><code>@groovy.transform.AnnotationCollector</code></a></li>
<li><a href="#xform-TypeChecked"><code>@groovy.transform.TypeChecked</code></a></li>
<li><a href="#xform-CompileStatic"><code>@groovy.transform.CompileStatic</code></a></li>
<li><a href="#xform-CompileDynamic"><code>@groovy.transform.CompileDynamic</code></a></li>
<li><a href="#xform-DelegatesTo"><code>@groovy.lang.DelegatesTo</code></a></li>
</ul>
</li>
<li><a href="#_swing_patterns">Swing patterns</a>
<ul class="sectlevel6">
<li><a href="#xform-Bindable"><code>@groovy.beans.Bindable</code></a></li>
<li><a href="#xform-ListenerList"><code>@groovy.beans.ListenerList</code></a></li>
<li><a href="#xform-Vetoable"><code>@groovy.beans.Vetoable</code></a></li>
</ul>
</li>
<li><a href="#_test_assistance">Test assistance</a>
<ul class="sectlevel6">
<li><a href="#xform-NotYetImplemented"><code>@groovy.lang.NotYetImplemented</code></a></li>
<li><a href="#xform-ASTTest"><code>@groovy.transform.ASTTest</code></a></li>
</ul>
</li>
<li><a href="#_grape_handling">Grape handling</a>
<ul class="sectlevel6">
<li><a href="#xform-Grab"><code>@groovy.lang.Grab</code></a></li>
<li><a href="#xform-GrabConfig"><code>@groovy.lang.GrabConfig</code></a></li>
<li><a href="#xform-GrabExclude"><code>@groovy.lang.GrabExclude</code></a></li>
<li><a href="#xform-GrabResolver"><code>@groovy.lang.GrabResolver</code></a></li>
<li><a href="#xform-Grapes"><code>@groovy.lang.Grapes</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#developing-ast-xforms">Developing AST transformations</a>
<ul class="sectlevel5">
<li><a href="#_compilation_phases_guide">Compilation phases guide</a></li>
<li><a href="#transforms-local">Local transformations</a></li>
<li><a href="#transforms-global">Global transformations</a></li>
<li><a href="#_ast_api_guide">AST API guide</a>
<ul class="sectlevel6">
<li><a href="#_abstractasttransformation">AbstractASTTransformation</a></li>
<li><a href="#_classcodeexpressiontransformer">ClassCodeExpressionTransformer</a></li>
<li><a href="#_ast_nodes">AST Nodes</a></li>
</ul>
</li>
<li><a href="#_testing_ast_transformations">Testing AST transformations</a>
<ul class="sectlevel6">
<li><a href="#_separating_source_trees">Separating source trees</a></li>
<li><a href="#_debugging_ast_transformations">Debugging AST transformations</a></li>
<li><a href="#_asttest">ASTTest</a></li>
</ul>
</li>
<li><a href="#_external_references">External references</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#section-grape">3.5. Dependency management with Grape</a>
<ul class="sectlevel3">
<li><a href="#_quick_start">3.5.1. Quick start</a>
<ul class="sectlevel4">
<li><a href="#_add_a_dependency">Add a Dependency</a></li>
<li><a href="#Grape-SpecifyAdditionalRepositories">Specify Additional Repositories</a></li>
<li><a href="#Grape-MavenClassifiers">Maven Classifiers</a></li>
<li><a href="#Grape-ExcludingTransitiveDependencies">Excluding Transitive Dependencies</a></li>
<li><a href="#Grape-JDBCDrivers">JDBC Drivers</a></li>
<li><a href="#Grape-UsingGrapeFromtheGroovyShell">Using Grape From the Groovy Shell</a></li>
<li><a href="#Grape-Proxysettings">Proxy settings</a></li>
<li><a href="#Grape-Logging">Logging</a></li>
</ul>
</li>
<li><a href="#Grape-Detail">3.5.2. Detail</a></li>
<li><a href="#Grape-Usage">3.5.3. Usage</a>
<ul class="sectlevel4">
<li><a href="#Grape-Annotation">Annotation</a></li>
<li><a href="#Grape-MultipleGrapeAnnotations">Multiple Grape Annotations</a></li>
<li><a href="#Grape-Methodcall">Method call</a>
<ul class="sectlevel5">
<li><a href="#Grape-grabHashMapParameters">grab(HashMap) Parameters</a></li>
<li><a href="#Grape-ArgumentsMaparguments">Arguments Map arguments</a></li>
</ul>
</li>
<li><a href="#Grape-CommandLineTool">Command Line Tool</a></li>
<li><a href="#Grape-Advancedconfiguration">Advanced configuration</a>
<ul class="sectlevel5">
<li><a href="#Grape-RepositoryDirectory">Repository Directory</a></li>
<li><a href="#Grape-CustomizeIvysettings">Customize Ivy settings</a></li>
</ul>
</li>
<li><a href="#Grape-MoreExamples">More Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_testing_guide">3.6. Testing Guide</a>
<ul class="sectlevel3">
<li><a href="#_introduction_2">3.6.1. Introduction</a></li>
<li><a href="#_language_features">3.6.2. Language Features</a>
<ul class="sectlevel4">
<li><a href="#_power_assertions">Power Assertions</a></li>
<li><a href="#_mocking_and_stubbing">Mocking and Stubbing</a>
<ul class="sectlevel5">
<li><a href="#_map_coercion">Map Coercion</a></li>
<li><a href="#_closure_coercion_2">Closure Coercion</a></li>
<li><a href="#_mockfor_and_stubfor">MockFor and StubFor</a></li>
<li><a href="#testing_guide_emc">Expando Meta-Class (EMC)</a></li>
</ul>
</li>
<li><a href="#_gdk_methods">GDK Methods</a>
<ul class="sectlevel5">
<li><a href="#_iterable_combinations">Iterable#combinations</a></li>
<li><a href="#_iterable_eachcombination">Iterable#eachCombination</a></li>
</ul>
</li>
<li><a href="#_tool_support">Tool Support</a>
<ul class="sectlevel5">
<li><a href="#_test_code_coverage">Test Code Coverage</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_unit_tests_with_junit_3_and_4">3.6.3. Unit Tests with JUnit 3 and 4</a>
<ul class="sectlevel4">
<li><a href="#_junit_3">JUnit 3</a>
<ul class="sectlevel5">
<li><a href="#_assertion_methods">Assertion Methods</a></li>
<li><a href="#_shouldfail_methods">shouldFail Methods</a></li>
<li><a href="#_notyetimplemented_method">notYetImplemented Method</a></li>
</ul>
</li>
<li><a href="#_junit_4">JUnit 4</a></li>
</ul>
</li>
<li><a href="#_testing_with_spock">3.6.4. Testing with Spock</a>
<ul class="sectlevel4">
<li><a href="#_specifications">Specifications</a></li>
<li><a href="#_more_spock">More Spock</a></li>
</ul>
</li>
<li><a href="#_functional_tests_with_geb">3.6.5. Functional Tests with Geb</a>
<ul class="sectlevel4">
<li><a href="#_a_geb_script">A Geb Script</a></li>
<li><a href="#_more_geb">More Geb</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_processing_json">3.7. Processing JSON</a>
<ul class="sectlevel3">
<li><a href="#json_jsonslurper">3.7.1. JsonSlurper</a>
<ul class="sectlevel4">
<li><a href="#_parser_variants">Parser Variants</a></li>
</ul>
</li>
<li><a href="#_jsonoutput">3.7.2. JsonOutput</a></li>
</ul>
</li>
<li><a href="#_interacting_with_a_sql_database">3.8. Interacting with a SQL database</a>
<ul class="sectlevel3">
<li><a href="#_connecting_to_the_database">3.8.1. Connecting to the database</a>
<ul class="sectlevel4">
<li><a href="#_connecting_with_a_datasource">Connecting with a DataSource</a></li>
<li><a href="#_connecting_using_grab">Connecting using @Grab</a></li>
</ul>
</li>
<li><a href="#_executing_sql">3.8.2. Executing SQL</a>
<ul class="sectlevel4">
<li><a href="#_creating_tables">Creating tables</a></li>
</ul>
</li>
<li><a href="#_basic_crud_operations">3.8.3. Basic CRUD operations</a>
<ul class="sectlevel4">
<li><a href="#_creating_inserting_data">Creating/Inserting data</a></li>
<li><a href="#_reading_rows">Reading rows</a></li>
<li><a href="#_updating_rows">Updating rows</a></li>
<li><a href="#_deleting_rows">Deleting rows</a></li>
</ul>
</li>
<li><a href="#_advanced_sql_operations">3.8.4. Advanced SQL operations</a>
<ul class="sectlevel4">
<li><a href="#_working_with_transactions">Working with transactions</a></li>
<li><a href="#_using_batches">Using batches</a></li>
<li><a href="#_performing_pagination">Performing pagination</a></li>
<li><a href="#_fetching_metadata">Fetching metadata</a></li>
<li><a href="#_named_and_named_ordinal_parameters">Named and named-ordinal parameters</a></li>
<li><a href="#_stored_procedures">Stored procedures</a></li>
</ul>
</li>
<li><a href="#_using_datasets">3.8.5. Using DataSets</a></li>
</ul>
</li>
<li><a href="#_processing_xml">3.9. Processing XML</a>
<ul class="sectlevel3">
<li><a href="#_parsing_xml">3.9.1. Parsing XML</a>
<ul class="sectlevel4">
<li><a href="#_xmlparser_and_xmlslurper">XmlParser and XmlSlurper</a></li>
<li><a href="#_domcategory">DOMCategory</a></li>
</ul>
</li>
<li><a href="#_gpath">3.9.2. GPath</a>
<ul class="sectlevel4">
<li><a href="#_simply_traversing_the_tree">Simply traversing the tree</a></li>
<li><a href="#_flexible_navigation_with_children_depthfirst_and_breadthfirst">Flexible navigation with children (*), depthFirst (**) and breadthFirst</a></li>
</ul>
</li>
<li><a href="#_creating_xml">3.9.3. Creating XML</a>
<ul class="sectlevel4">
<li><a href="#_markupbuilder">MarkupBuilder</a></li>
<li><a href="#_streamingmarkupbuilder">StreamingMarkupBuilder</a></li>
<li><a href="#_markupbuilderhelper">MarkupBuilderHelper</a></li>
<li><a href="#_domtogroovy">DOMToGroovy</a></li>
</ul>
</li>
<li><a href="#_manipulating_xml">3.9.4. Manipulating XML</a>
<ul class="sectlevel4">
<li><a href="#_adding_nodes">Adding nodes</a></li>
<li><a href="#_modifying_removing_nodes">Modifying / Removing nodes</a></li>
<li><a href="#_printing_xml">Printing XML</a>
<ul class="sectlevel5">
<li><a href="#_xmlutil">XmlUtil</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_scripting_ant_tasks">3.10. Scripting Ant tasks</a></li>
<li><a href="#_the_groovy_ant_task">3.11. The &lt;groovy&gt; Ant Task</a>
<ul class="sectlevel3">
<li><a href="#_required_taskdef">3.11.1. Required taskdef</a></li>
<li><a href="#__groovy_attributes">3.11.2. &lt;groovy&gt; attributes</a></li>
<li><a href="#_parameters_specified_as_nested_elements">3.11.3. Parameters specified as nested elements</a>
<ul class="sectlevel4">
<li><a href="#__classpath">&lt;classpath&gt;</a></li>
<li><a href="#__arg">&lt;arg&gt;</a></li>
</ul>
</li>
<li><a href="#_available_bindings">3.11.4. Available bindings</a></li>
<li><a href="#_examples_2">3.11.5. Examples</a></li>
</ul>
</li>
<li><a href="#_template_engines">3.12. Template engines</a>
<ul class="sectlevel3">
<li><a href="#_introduction_3">3.12.1. Introduction</a></li>
<li><a href="#_template_framework">3.12.2. Template framework</a></li>
<li><a href="#_simpletemplateengine">3.12.3. SimpleTemplateEngine</a>
<ul class="sectlevel4">
<li><a href="#_advanced_usage_note">Advanced Usage Note</a></li>
</ul>
</li>
<li><a href="#_streamingtemplateengine">3.12.4. StreamingTemplateEngine</a></li>
<li><a href="#_gstringtemplateengine">3.12.5. GStringTemplateEngine</a></li>
<li><a href="#_xmltemplateengine">3.12.6. XmlTemplateEngine</a></li>
<li><a href="#_the_markuptemplateengine">3.12.7. The MarkupTemplateEngine</a>
<ul class="sectlevel4">
<li><a href="#_the_template_format">The template format</a>
<ul class="sectlevel5">
<li><a href="#_basics">Basics</a></li>
<li><a href="#_support_methods">Support methods</a></li>
<li><a href="#_includes">Includes</a></li>
<li><a href="#_fragments">Fragments</a></li>
<li><a href="#_layouts">Layouts</a></li>
</ul>
</li>
<li><a href="#_rendering_contents">Rendering contents</a>
<ul class="sectlevel5">
<li><a href="#_creation_of_a_template_engine">Creation of a template engine</a></li>
<li><a href="#markuptemplate-config">Configuration options</a></li>
<li><a href="#markuptemplate-autoformat">Automatic formatting</a></li>
<li><a href="#markuptemplate-autoescape">Automatic escaping</a></li>
<li><a href="#markuptemplate-gotchas">Common gotchas</a>
<ul class="sectlevel6">
<li><a href="#_strings_containing_markup">Strings containing markup</a></li>
</ul>
</li>
<li><a href="#markuptemplate-i18n">Internationalization</a></li>
<li><a href="#markuptemplate-basetemplate">Custom template classes</a></li>
</ul>
</li>
<li><a href="#_type_checked_templates">Type checked templates</a>
<ul class="sectlevel5">
<li><a href="#_optional_type_checking">Optional type checking</a></li>
<li><a href="#_alternative_declaration_of_types">Alternative declaration of types</a></li>
<li><a href="#_performance_of_type_checked_templates">Performance of type checked templates</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_other_solutions">3.12.8. Other solutions</a></li>
</ul>
</li>
<li><a href="#_servlet_support">3.13. Servlet support</a>
<ul class="sectlevel3">
<li><a href="#_implicit_variables">3.13.1. Implicit variables</a></li>
<li><a href="#_setting_up_groovylets">3.13.2. Setting up groovylets</a></li>
</ul>
</li>
<li><a href="#_integrating_groovy_in_a_java_application">3.14. Integrating Groovy in a Java application</a>
<ul class="sectlevel3">
<li><a href="#_groovy_integration_mechanisms">3.14.1. Groovy integration mechanisms</a>
<ul class="sectlevel4">
<li><a href="#integ-eval">Eval</a></li>
<li><a href="#integ-groovyshell">GroovyShell</a>
<ul class="sectlevel5">
<li><a href="#_multiple_sources">Multiple sources</a></li>
<li><a href="#_sharing_data_between_a_script_and_the_application">Sharing data between a script and the application</a></li>
<li><a href="#_custom_script_class">Custom script class</a></li>
</ul>
</li>
<li><a href="#groovyclassloader">GroovyClassLoader</a></li>
<li><a href="#_groovyscriptengine">GroovyScriptEngine</a></li>
<li><a href="#_compilationunit">CompilationUnit</a></li>
</ul>
</li>
<li><a href="#_bean_scripting_framework">3.14.2. Bean Scripting Framework</a>
<ul class="sectlevel4">
<li><a href="#_getting_started_2">Getting started</a></li>
<li><a href="#_passing_in_variables">Passing in variables</a></li>
<li><a href="#_other_calling_options">Other calling options</a></li>
<li><a href="#_access_to_the_scripting_engine">Access to the scripting engine</a></li>
</ul>
</li>
<li><a href="#jsr223">3.14.3. JSR 223 javax.script API</a></li>
</ul>
</li>
<li><a href="#_domain_specific_languages">3.15. Domain-Specific Languages</a>
<ul class="sectlevel3">
<li><a href="#_command_chains">3.15.1. Command chains</a></li>
<li><a href="#_operator_overloading">3.15.2. Operator overloading</a></li>
<li><a href="#_script_base_classes">3.15.3. Script base classes</a>
<ul class="sectlevel4">
<li><a href="#_the_script_class">The Script class</a></li>
<li><a href="#_the_basescript_annotation">The @BaseScript annotation</a></li>
<li><a href="#_alternate_abstract_method">Alternate abstract method</a></li>
</ul>
</li>
<li><a href="#_adding_properties_to_numbers">3.15.4. Adding properties to numbers</a></li>
<li><a href="#section-delegatesto">3.15.5. @DelegatesTo</a>
<ul class="sectlevel4">
<li><a href="#TheDelegatesToannotation-DSLsmadeeasy">Explaining delegation strategy at compile time</a></li>
<li><a href="#TheDelegatesToannotation-DelegatesTo">@DelegatesTo</a></li>
<li><a href="#TheDelegatesToannotation-DelegatesTomodes">DelegatesTo modes</a>
<ul class="sectlevel5">
<li><a href="#TheDelegatesToannotation-Simpledelegation">Simple delegation</a></li>
<li><a href="#TheDelegatesToannotation-Delegationstrategy">Delegation strategy</a></li>
<li><a href="#TheDelegatesToannotation-Delegatetoparameter">Delegate to parameter</a></li>
<li><a href="#TheDelegatesToannotation-Multipleclosures">Multiple closures</a></li>
<li><a href="#_delegating_to_a_generic_type">Delegating to a generic type</a></li>
<li><a href="#_delegating_to_an_arbitrary_type">Delegating to an arbitrary type</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#compilation-customizers">3.15.6. Compilation customizers</a>
<ul class="sectlevel4">
<li><a href="#_introduction_4">Introduction</a></li>
<li><a href="#_import_customizer">Import customizer</a></li>
<li><a href="#_ast_transformation_customizer">AST transformation customizer</a></li>
<li><a href="#_secure_ast_customizer">Secure AST customizer</a></li>
<li><a href="#_source_aware_customizer">Source aware customizer</a></li>
<li><a href="#_customizer_builder">Customizer builder</a>
<ul class="sectlevel5">
<li><a href="#_import_customizer_2">Import customizer</a></li>
<li><a href="#_ast_transformation_customizer_2">AST transformation customizer</a></li>
<li><a href="#_secure_ast_customizer_2">Secure AST customizer</a></li>
<li><a href="#_source_aware_customizer_2">Source aware customizer</a></li>
<li><a href="#_inlining_a_customizer">Inlining a customizer</a></li>
<li><a href="#_multiple_customizers">Multiple customizers</a></li>
</ul>
</li>
<li><a href="#_config_script_flag">Config script flag</a>
<ul class="sectlevel5">
<li><a href="#_static_compilation_by_default">Static compilation by default</a></li>
</ul>
</li>
<li><a href="#_ast_transformations">AST transformations</a></li>
</ul>
</li>
<li><a href="#_custom_type_checking_extensions">3.15.7. Custom type checking extensions</a></li>
<li><a href="#_builders">3.15.8. Builders</a>
<ul class="sectlevel4">
<li><a href="#_creating_a_builder">Creating a builder</a>
<ul class="sectlevel5">
<li><a href="#_buildersupport">BuilderSupport</a></li>
<li><a href="#_factorybuildersupport">FactoryBuilderSupport</a></li>
</ul>
</li>
<li><a href="#_existing_builders">Existing builders</a>
<ul class="sectlevel5">
<li><a href="#_markupbuilder_2">MarkupBuilder</a></li>
<li><a href="#_streamingmarkupbuilder_2">StreamingMarkupBuilder</a></li>
<li><a href="#_saxbuilder">SaxBuilder</a></li>
<li><a href="#_staxbuilder">StaxBuilder</a></li>
<li><a href="#_dombuilder">DOMBuilder</a></li>
<li><a href="#_nodebuilder">NodeBuilder</a></li>
<li><a href="#_jsonbuilder">JsonBuilder</a></li>
<li><a href="#_streamingjsonbuilder">StreamingJsonBuilder</a></li>
<li><a href="#swingbuilder">SwingBuilder</a></li>
<li><a href="#_antbuilder">AntBuilder</a></li>
<li><a href="#_clibuilder">CliBuilder</a></li>
<li><a href="#_objectgraphbuilder">ObjectGraphBuilder</a></li>
<li><a href="#_jmxbuilder">JmxBuilder</a></li>
<li><a href="#_filetreebuilder">FileTreeBuilder</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_working_with_jmx">3.16. Working with JMX</a>
<ul class="sectlevel3">
<li><a href="#_introduction_5">3.16.1. Introduction</a></li>
<li><a href="#_monitoring_the_jvm">3.16.2. Monitoring the JVM</a></li>
<li><a href="#_monitoring_tomcat">3.16.3. Monitoring Tomcat</a></li>
<li><a href="#_oc4j_example">3.16.4. OC4J Example</a></li>
<li><a href="#_weblogic_example">3.16.5. WebLogic Example</a></li>
<li><a href="#_spring_example">3.16.6. Spring Example</a></li>
<li><a href="#_troubleshooting">3.16.7. Troubleshooting</a>
<ul class="sectlevel4">
<li><a href="#_java_lang_securityexception">java.lang.SecurityException</a></li>
</ul>
</li>
<li><a href="#jmx_jmxbuilder">3.16.8. JmxBuilder</a>
<ul class="sectlevel4">
<li><a href="#_instantiating_jmxbuilder">Instantiating JmxBuilder</a></li>
<li><a href="#_jmx_connectors">JMX Connectors</a>
<ul class="sectlevel5">
<li><a href="#_connector_server">Connector Server</a></li>
<li><a href="#_connector_client">Connector Client</a></li>
</ul>
</li>
<li><a href="#_jmxbuilder_mbean_export">JmxBuilder MBean Export</a>
<ul class="sectlevel5">
<li><a href="#_implicit_vs_explicit_descriptors">Implicit vs Explicit Descriptors</a></li>
<li><a href="#_the_jmxbuilder_export_node">The JmxBuilder.export() Node</a></li>
<li><a href="#_jmxbuilder_export_syntax">JmxBuilder.export() Syntax</a></li>
<li><a href="#_integration_with_groovymbean_class">Integration with GroovyMBean Class</a></li>
<li><a href="#_mbean_registration_with_jmxbuilder_bean">MBean Registration with JmxBuilder.bean()</a>
<ul class="sectlevel6">
<li><a href="#_implicit_export">Implicit Export</a>
<ul class="sectlevel7">
<li><a href="#_jconsole_view_of_exported_bean">JConsole view of Exported Bean</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_jmxbuilder_bean_syntax">JmxBuilder.bean() Syntax</a></li>
<li><a href="#_bean_node_specifying_mbean_objectname">Bean() Node - Specifying MBean ObjectName</a></li>
</ul>
</li>
<li><a href="#_bean_node_attribute_export">Bean() Node - Attribute Export</a>
<ul class="sectlevel5">
<li><a href="#_export_all_attributes_with_wildcard">Export All Attributes with Wildcard "*"</a></li>
<li><a href="#_export_attribute_list">Export Attribute List</a></li>
<li><a href="#_export_attribute_with_explicit_descriptors">Export Attribute with Explicit Descriptors</a></li>
</ul>
</li>
<li><a href="#_bean_node_constructor_export">Bean() Node - Constructor Export</a>
<ul class="sectlevel5">
<li><a href="#_export_all_constructors_with">Export all Constructors with "*"</a></li>
<li><a href="#_export_constructors_using_parameter_descriptor">Export Constructors using Parameter Descriptor</a></li>
<li><a href="#_export_constructor_with_explicit_descriptors">Export Constructor with Explicit Descriptors</a></li>
</ul>
</li>
<li><a href="#_bean_node_operation_export">Bean() Node - Operation Export</a>
<ul class="sectlevel5">
<li><a href="#_export_all_operations_with">Export All Operations with "*"</a></li>
<li><a href="#_export_operation_list">Export Operation List</a></li>
<li><a href="#_export_operations_by_signature">Export Operations by Signature</a></li>
<li><a href="#_export_operations_with_explicit_descriptors">Export Operations with Explicit Descriptors</a></li>
</ul>
</li>
<li><a href="#_embedding_descriptor">Embedding Descriptor</a></li>
<li><a href="#_timer_export">Timer Export</a>
<ul class="sectlevel5">
<li><a href="#_timer_node_syntax">Timer Node Syntax</a></li>
<li><a href="#_exporting_a_timer">Exporting a Timer</a></li>
<li><a href="#_timer_period">Timer Period</a></li>
</ul>
</li>
<li><a href="#_jmxbuilder_and_events">JmxBuilder and Events</a>
<ul class="sectlevel5">
<li><a href="#_event_handling_closures">Event Handling Closures</a>
<ul class="sectlevel6">
<li><a href="#_parameterless">Parameterless</a></li>
<li><a href="#_with_event_parameter">With Event Parameter</a></li>
</ul>
</li>
<li><a href="#_handling_attribute_onchange_event">Handling Attribute onChange Event</a></li>
<li><a href="#_attribute_onchange_event_object">Attribute onChange Event Object</a></li>
<li><a href="#_handling_operation_oncall_event">Handling Operation onCall Event</a></li>
<li><a href="#_operation_oncall_event_object">Operation onCall Event Object</a></li>
</ul>
</li>
<li><a href="#_listener_mbean">Listener MBean</a>
<ul class="sectlevel5">
<li><a href="#_listening_to_jmx_events">Listening to JMX Events</a></li>
<li><a href="#_listener_node_syntax">Listener Node Syntax</a></li>
</ul>
</li>
<li><a href="#_emitting_jmx_events">Emitting JMX Events</a>
<ul class="sectlevel5">
<li><a href="#_emitter_syntax">Emitter Syntax</a></li>
<li><a href="#_declare_the_emitter">Declare the Emitter</a></li>
<li><a href="#_broadcast_event">Broadcast Event</a></li>
<li><a href="#_sending_event_objects">Sending Event Objects</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_further_jmx_information">3.16.9. Further JMX Information</a></li>
</ul>
</li>
<li><a href="#_creating_swing_uis">3.17. Creating Swing UIs</a></li>
<li><a href="#_security">3.18. Security</a></li>
<li><a href="#_design_patterns_in_groovy">3.19. Design patterns in Groovy</a>
<ul class="sectlevel3">
<li><a href="#_patterns">3.19.1. Patterns</a>
<ul class="sectlevel4">
<li><a href="#_abstract_factory_pattern">Abstract Factory Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example">Example</a></li>
</ul>
</li>
<li><a href="#_adapter_pattern">Adapter Pattern</a>
<ul class="sectlevel5">
<li><a href="#_delegation_example">Delegation Example</a></li>
<li><a href="#_inheritance_example">Inheritance Example</a></li>
<li><a href="#_adapting_using_closures">Adapting using Closures</a></li>
<li><a href="#_adapting_using_the_expandometaclass">Adapting using the ExpandoMetaClass</a></li>
</ul>
</li>
<li><a href="#_bouncer_pattern">Bouncer Pattern</a>
<ul class="sectlevel5">
<li><a href="#_null_checking_example">Null Checking Example</a></li>
<li><a href="#_validation_example">Validation Example</a></li>
</ul>
</li>
<li><a href="#_chain_of_responsibility_pattern">Chain of Responsibility Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_2">Example</a></li>
</ul>
</li>
<li><a href="#_composite_pattern">Composite Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_3">Example</a></li>
</ul>
</li>
<li><a href="#_decorator_pattern">Decorator Pattern</a>
<ul class="sectlevel5">
<li><a href="#_traditional_example">Traditional Example</a></li>
<li><a href="#_a_touch_of_dynamic_behaviour">A touch of dynamic behaviour</a></li>
<li><a href="#_runtime_behaviour_embellishment">Runtime behaviour embellishment</a></li>
<li><a href="#_more_dynamic_decorating">More dynamic decorating</a></li>
<li><a href="#_decorating_with_an_interceptor">Decorating with an Interceptor</a></li>
<li><a href="#_decorating_with_java_lang_reflect_proxy">Decorating with java.lang.reflect.Proxy</a></li>
<li><a href="#_decorating_with_spring">Decorating with Spring</a></li>
<li><a href="#_asynchronous_decorators_using_gpars">Asynchronous Decorators using GPars</a></li>
</ul>
</li>
<li><a href="#_delegation_pattern">Delegation Pattern</a>
<ul class="sectlevel5">
<li><a href="#_implement_delegation_pattern_using_expandometaclass">Implement Delegation Pattern using ExpandoMetaClass</a></li>
<li><a href="#_implement_delegation_pattern_using_delegate_annotation">Implement Delegation Pattern using @Delegate annotation</a></li>
</ul>
</li>
<li><a href="#_flyweight_pattern">Flyweight Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_4">Example</a></li>
</ul>
</li>
<li><a href="#_iterator_pattern">Iterator Pattern</a></li>
<li><a href="#_loan_my_resource_pattern">Loan my Resource Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_5">Example</a></li>
</ul>
</li>
<li><a href="#_null_object_pattern">Null Object Pattern</a>
<ul class="sectlevel5">
<li><a href="#_simple_example">Simple Example</a></li>
<li><a href="#_tree_example">Tree Example</a></li>
</ul>
</li>
<li><a href="#_pimp_my_library_pattern">Pimp my Library Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_6">Example</a></li>
</ul>
</li>
<li><a href="#_proxy_pattern">Proxy Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_7">Example</a></li>
</ul>
</li>
<li><a href="#_singleton_pattern">Singleton Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_the_classic_java_singleton">Example: The Classic Java Singleton</a></li>
<li><a href="#_example_singleton_via_metaprogramming">Example: Singleton via MetaProgramming</a></li>
<li><a href="#_guice_example">Guice Example</a></li>
<li><a href="#_spring_example_2">Spring Example</a></li>
<li><a href="#_further_information">Further information</a></li>
</ul>
</li>
<li><a href="#_state_pattern">State Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_8">Example</a></li>
<li><a href="#_variation_1_leveraging_interface_oriented_design">Variation 1: Leveraging Interface-Oriented Design</a></li>
<li><a href="#_variation_2_extract_state_pattern_logic">Variation 2: Extract State Pattern Logic</a></li>
<li><a href="#_variation_3_bring_on_the_dsl">Variation 3: Bring on the DSL</a></li>
</ul>
</li>
<li><a href="#_strategy_pattern">Strategy Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_9">Example</a></li>
</ul>
</li>
<li><a href="#_template_method_pattern">Template Method Pattern</a>
<ul class="sectlevel5">
<li><a href="#_example_10">Example</a></li>
</ul>
</li>
<li><a href="#_visitor_pattern">Visitor Pattern</a>
<ul class="sectlevel5">
<li><a href="#_simple_example_2">Simple Example</a></li>
<li><a href="#_advanced_example">Advanced Example</a>
<ul class="sectlevel6">
<li><a href="#_why_to_use_this">Why to use this</a></li>
<li><a href="#_what_happens_if_we_add_a_new_type">What happens if we add a new type?</a></li>
<li><a href="#_what_if_we_want_to_have_different_iteration_patterns">What if we want to have different iteration patterns?</a></li>
<li><a href="#_make_it_groovy">Make it Groovy</a></li>
<li><a href="#_summary">Summary</a></li>
</ul>
</li>
<li><a href="#_further_information_2">Further Information</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_references">3.19.2. References</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_acknowledgements">4. Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_contributors">4.1. Contributors</a></li>
<li><a href="#_license">4.2. License</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_introduction" class="sect0"><a class="anchor" href="#_introduction"></a>Introduction</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Groovy…​</p>
</div>
<div class="ulist">
<ul>
<li>
<p>is an agile and dynamic language for the Java Virtual Machine</p>
</li>
<li>
<p>builds upon the strengths of Java but has additional power features inspired by languages like Python, Ruby and Smalltalk</p>
</li>
<li>
<p>makes modern programming features available to Java developers with almost-zero learning curve</p>
</li>
<li>
<p>provides the ability to statically type check and statically compile your code for robustness and performance</p>
</li>
<li>
<p>supports Domain-Specific Languages and other compact syntax so your code becomes easy to read and maintain</p>
</li>
<li>
<p>makes writing shell and build scripts easy with its powerful processing primitives, OO abilities and an Ant DSL</p>
</li>
<li>
<p>increases developer productivity by reducing scaffolding code when developing web, GUI, database or console applications</p>
</li>
<li>
<p>simplifies testing by supporting unit testing and mocking out-of-the-box</p>
</li>
<li>
<p>seamlessly integrates with all existing Java classes and libraries</p>
</li>
<li>
<p>compiles straight to Java bytecode so you can use it anywhere you can use Java</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovy_language_specification"><a class="anchor" href="#_groovy_language_specification"></a>1. Groovy Language Specification</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_syntax"><a class="anchor" href="#_syntax"></a>1.1. Syntax</h3>
<div class="paragraph">
<p>This chapter covers the syntax of the Groovy programming language.
The grammar of the language derives from the Java grammar,
but enhances it with specific constructs for Groovy, and allows certain simplifications.</p>
</div>
<div class="sect3">
<h4 id="_comments"><a class="anchor" href="#_comments"></a>1.1.1. Comments</h4>
<div class="sect4">
<h5 id="_single_line_comment"><a class="anchor" href="#_single_line_comment"></a>Single line comment</h5>
<div class="paragraph">
<p>Single line comments start with <code>//</code> and can be found at any position in the line.
The characters following <code>//</code>, till the end of the line, are considered part of the comment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// a standalone single line comment</span><span class="pln">
println </span><span class="str">"hello"</span><span class="pln"> </span><span class="com">// a comment till the end of the line</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiline_comment"><a class="anchor" href="#_multiline_comment"></a>Multiline comment</h5>
<div class="paragraph">
<p>A multiline comment starts with <code>/*</code> and can be found at any position in the line.
The characters following <code>/*</code> will be considered part of the comment, including new line characters,
up to the first <code>*/</code> closing the comment.
Multiline comments can thus be put at the end of a statement, or even inside a statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">/* a standalone multiline comment
   spanning two lines */</span><span class="pln">
println </span><span class="str">"hello"</span><span class="pln"> </span><span class="com">/* a multiline comment starting
                   at the end of a statement */</span><span class="pln">
println </span><span class="lit">1</span><span class="pln"> </span><span class="com">/* one */</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="com">/* two */</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_groovydoc_comment"><a class="anchor" href="#_groovydoc_comment"></a>GroovyDoc comment</h5>
<div class="paragraph">
<p>Similarly to multiline comments, GroovyDoc comments are multiline, but start with <code>/**</code> and end with <code>*/</code>.
Lines following the first GroovyDoc comment line can optionally start with a star <code>*</code>.
Those comments are associated with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type definitions (classes, interfaces, enums, annotations),</p>
</li>
<li>
<p>fields and properties definitions</p>
</li>
<li>
<p>methods definitions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although the compiler will not complain about GroovyDoc comments not being associated with the above language elements,
you should prepend those constructs with the comment right before it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">/**
 * A Class description
 */</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">/** the name of the person */</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name

    </span><span class="com">/**
     * Creates a greeting method for a certain person.
     *
     * @param otherPerson the person to greet
     * @return a greeting message
     */</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> greet</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> otherPerson</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       </span><span class="str">"Hello ${otherPerson}"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>GroovyDoc follows the same conventions as Java’s own JavaDoc.
So you’ll be able to use the same tags as with JavaDoc.</p>
</div>
</div>
<div class="sect4">
<h5 id="_shebang_line"><a class="anchor" href="#_shebang_line"></a>Shebang line</h5>
<div class="paragraph">
<p>Beside the single line comment, there is a special line comment, often called the <em>shebang</em> line understood by UNIX systems
which allows scripts to be run directly from the command-line, provided you have installed the Groovy distribution
and the <code>groovy</code> command is available on the <code>PATH</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">#!/usr/bin/env groovy</span><span class="pln">
println </span><span class="str">"Hello from the shebang line"</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>#</code> character must be the first character of the file. Any indentation would yield a compilation error.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_keywords"><a class="anchor" href="#_keywords"></a>1.1.2. Keywords</h4>
<div class="paragraph">
<p>The following list represents all the keywords of the Groovy language:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Keywords</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">as</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">break</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">case</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">catch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">const</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">continue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">def</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">do</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">else</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">extends</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">finally</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">for</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">goto</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implements</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">import</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instanceof</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">new</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">super</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">switch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">this</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">throw</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">throws</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">try</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">while</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_identifiers"><a class="anchor" href="#_identifiers"></a>1.1.3. Identifiers</h4>
<div class="sect4">
<h5 id="_normal_identifiers"><a class="anchor" href="#_normal_identifiers"></a>Normal identifiers</h5>
<div class="paragraph">
<p>Identifiers start with a letter, a dollar or an underscore.
They cannot start with a number.</p>
</div>
<div class="paragraph">
<p>A letter can be in the following ranges:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'a' to 'z' (lowercase ascii letter)</p>
</li>
<li>
<p>'A' to 'Z' (uppercase ascii letter)</p>
</li>
<li>
<p>'\u00C0' to '\u00D6'</p>
</li>
<li>
<p>'\u00D8' to '\u00F6'</p>
</li>
<li>
<p>'\u00F8' to '\u00FF'</p>
</li>
<li>
<p>'\u0100' to '\uFFFE'</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then following characters can contain letters and numbers.</p>
</div>
<div class="paragraph">
<p>Here are a few examples of valid identifiers (here, variable names):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> name
</span><span class="kwd">def</span><span class="pln"> item3
</span><span class="kwd">def</span><span class="pln"> with_underscore
</span><span class="kwd">def</span><span class="pln"> $dollarStart</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But the following ones are invalid identifiers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="lit">3tier</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> a</span><span class="pun">+</span><span class="pln">b
</span><span class="kwd">def</span><span class="pln"> a</span><span class="com">#b</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All keywords are also valid identifiers when following a dot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">foo</span><span class="pun">.</span><span class="kwd">as</span><span class="pln">
foo</span><span class="pun">.</span><span class="kwd">assert</span><span class="pln">
foo</span><span class="pun">.</span><span class="kwd">break</span><span class="pln">
foo</span><span class="pun">.</span><span class="kwd">case</span><span class="pln">
foo</span><span class="pun">.</span><span class="kwd">catch</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_quoted_identifiers"><a class="anchor" href="#_quoted_identifiers"></a>Quoted identifiers</h5>
<div class="paragraph">
<p>Quoted identifiers appear after the dot of a dotted expression.
For instance, the <code>name</code> part of the <code>person.name</code> expression can be quoted with <code>person."name"</code> or <code>person.'name'</code>.
This is particularly interesting when certain identifiers contain 
illegal characters that are forbidden by the Java Language 
Specification,
but which are allowed by Groovy when quoted. For example, characters 
like a dash, a space, an exclamation mark, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span><span class="pln">

map</span><span class="pun">.</span><span class="str">"an identifier with a space and double quotes"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ALLOWED"</span><span class="pln">
map</span><span class="pun">.</span><span class="str">'with-dash-signs-and-single-quotes'</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ALLOWED"</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="str">"an identifier with a space and double quotes"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"ALLOWED"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="str">'with-dash-signs-and-single-quotes'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"ALLOWED"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we shall see in the <a href="#all-strings">following section on strings</a>, Groovy provides different string literals.
All kind of strings are actually allowed after the dot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">map</span><span class="pun">.</span><span class="str">'single quote'</span><span class="pln">
map</span><span class="pun">.</span><span class="str">"double quote"</span><span class="pln">
map</span><span class="pun">.</span><span class="str">'''triple single quote'''</span><span class="pln">
map</span><span class="pun">.</span><span class="str">"""triple double quote"""</span><span class="pln">
map</span><span class="pun">./</span><span class="pln">slashy </span><span class="kwd">string</span><span class="pun">/</span><span class="pln">
map</span><span class="pun">.</span><span class="pln">$</span><span class="pun">/</span><span class="pln">dollar slashy </span><span class="kwd">string</span><span class="pun">/</span><span class="pln">$</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There’s a difference between plain character strings and Groovy’s GStrings (interpolated strings),
as in that the latter case, the interpolated values are inserted in the final string for evaluating the whole identifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> firstname </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Homer"</span><span class="pln">
map</span><span class="pun">.</span><span class="str">"Simson-${firstname}"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Homer Simson"</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="str">'Simson-Homer'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Homer Simson"</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="all-strings"><a class="anchor" href="#all-strings"></a>1.1.4. Strings</h4>
<div class="paragraph">
<p>Text literals are represented in the form of chain of characters called strings.
Groovy lets you instantiate <code>java.lang.String</code> objects, as well as GStrings (<code>groovy.lang.GString</code>)
which are also called <em>interpolated strings</em> in other programming languages.</p>
</div>
<div class="sect4">
<h5 id="_single_quoted_string"><a class="anchor" href="#_single_quoted_string"></a>Single quoted string</h5>
<div class="paragraph">
<p>Single quoted strings are a series of characters surrounded by single quotes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="str">'a single quoted string'</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Single quoted strings are plain <code>java.lang.String</code> and don’t support interpolation.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_string_concatenation"><a class="anchor" href="#_string_concatenation"></a>String concatenation</h5>
<div class="paragraph">
<p>All the Groovy strings can be concatenated with the <code>+</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="str">'ab'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'a'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">'b'</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_triple_single_quoted_string"><a class="anchor" href="#_triple_single_quoted_string"></a>Triple single quoted string</h5>
<div class="paragraph">
<p>Triple single quoted strings are a series of characters surrounded by triplets of single quotes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="str">'''a triple single quoted string'''</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Triple single quoted strings are plain <code>java.lang.String</code> and don’t support interpolation.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Triple single quoted strings are multiline.
You can span the content of the string across line boundaries without 
the need to split the string in several pieces, without contatenation or
 newline escape characters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> aMultilineString </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''line one
line two
line three'''</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If your code is indented, for example in the body of the method of a 
class, your string will contain the whitespace of the indentation.
The Groovy Development Kit contains methods for stripping out the 
indentation with the <code>String#stripIndent()</code> method,
and with the <code>String#stripMargin()</code> method that takes a delimiter character to identify the text to remove from the beginning of a string.</p>
</div>
<div class="paragraph">
<p>When creating a string as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> startingAndEndingWithANewline </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''
line one
line two
line three
'''</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will notice that the resulting string contains a newline character as first character.
It is possible to strip that character by escaping the newline with a backslash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> strippedFirstNewline </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''\
line one
line two
line three
'''</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">strippedFirstNewline</span><span class="pun">.</span><span class="pln">startsWith</span><span class="pun">(</span><span class="str">'\n'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_escaping_special_characters"><a class="anchor" href="#_escaping_special_characters"></a>Escaping special characters</h6>
<div class="paragraph">
<p>You can escape single quotes with the the backslash character to avoid terminating the string literal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="str">'an escaped single quote: \' needs a backslash'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And you can escape the escape character itself with a double backslash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="str">'an escaped escape character: \\ needs a double backslash'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Some special characters also use the backslash as escape character:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Escape sequence</th>
<th class="tableblock halign-left valign-top">Character</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'\t'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tabulation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'\b'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">backspace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'\n'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">newline</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'\r'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">carriage return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'\f'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">formfeed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'\\'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">backslash</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'\''</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">single quote (for single quoted and triple single quoted strings)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'\"'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double quote (for double quoted and triple double quoted strings)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_unicode_escape_sequence"><a class="anchor" href="#_unicode_escape_sequence"></a>Unicode escape sequence</h6>
<div class="paragraph">
<p>For characters that are not present on your keyboard, you can use unicode escape sequences:
a backslash, followed by 'u', then 4 hexadecimal digits.</p>
</div>
<div class="paragraph">
<p>For example, the Euro currency symbol can be represented with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="str">'The Euro currency symbol: \u20AC'</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_double_quoted_string"><a class="anchor" href="#_double_quoted_string"></a>Double quoted string</h5>
<div class="paragraph">
<p>Double quoted strings are a series of characters surrounded by double quotes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="str">"a double quoted string"</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Double quoted strings are plain <code>java.lang.String</code> if there’s no interpolated expression,
but are <code>groovy.lang.GString</code> instances if interpolation is present.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To escape a double quote, you can use the backslash character: "A double quote: \"".
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="_string_interpolation"><a class="anchor" href="#_string_interpolation"></a>String interpolation</h6>
<div class="paragraph">
<p>Any Groovy expression can be interpolated in all string literals, apart from single and triple single quoted strings.
Interpolation is the act of replacing a placeholder in the string with its value upon evaluation of the string.
The placeholder expressions are surrounded by <code>${}</code> or prefixed with <code>$</code>
 for dotted expressions.
The expression value inside the placeholder is evaluated to its string 
representation when the GString is passed to a method taking a String as
 argument by calling <code>toString()</code> on that expression.</p>
</div>
<div class="paragraph">
<p>Here, we have a string with a placeholder referencing a local variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Guillaume'</span><span class="pln"> </span><span class="com">// a plain string</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> greeting </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Hello ${name}"</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> greeting</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello Guillaume'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But any Groovy expression is valid, as we can see in this example with an arithmetic expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> sum </span><span class="pun">=</span><span class="pln"> </span><span class="str">"The sum of 2 and 3 equals ${2 + 3}"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sum</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'The sum of 2 and 3 equals 5'</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Not only expressions are actually allowed in between the <code>${}</code> placeholder. Statements are also allowed, but a statement’s value is just <code>null</code>.
So if several statements are inserted in that placeholder, the last one 
should somehow return a meaningful value to be inserted.
For instance, "The sum of 1 and 2 is equal to ${def a = 1; def b = 2; a +
 b}" is supported and works as expected but a good practice is usually 
to stick to simple expressions inside GString placeholders.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In addition to <code>${}</code> placeholders, we can also use a lone <code>$</code> sign prefixing a dotted expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Guillaume'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">36</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"$person.name is $person.age years old"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Guillaume is 36 years old'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But only dotted expressions of the form <code>a.b</code>, <code>a.b.c</code>,
 etc, are valid, but expressions that would contain parentheses like 
method calls, curly braces for closures, or arithmetic operators would 
be invalid.
Given the following variable definition of a number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> number </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3.14</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following statement will throw a <code>groovy.lang.MissingPropertyException</code> because Groovy believes you’re trying to access the <code>toString</code> property of that number, which doesn’t exist:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">shouldFail</span><span class="pun">(</span><span class="typ">MissingPropertyException</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println </span><span class="str">"$number.toString()"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can think of <code>"$number.toString()"</code> as being interpreted by the parser as <code>"${number.toString}()"</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you need to escape the <code>$</code> or <code>${}</code> placeholders in a GString so they appear as is without interpolation,
you just need to use a <code>\</code> backslash character to escape the dollar sign:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="str">'${name}'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"\${name}"</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_special_case_of_interpolating_closure_expressions"><a class="anchor" href="#_special_case_of_interpolating_closure_expressions"></a>Special case of interpolating closure expressions</h6>
<div class="paragraph">
<p>So far, we’ve seen we could interpolate arbitrary expressions inside the <code>${}</code> placeholder, but there is a special case and notation for closure expressions. When the placeholder contains an arrow, <code>${→}</code>, the expression is actually a closure expression — you can think of it as a closure with a dollar prepended in front of it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> sParameterLessClosure </span><span class="pun">=</span><span class="pln"> </span><span class="str">"1 + 2 == ${-&gt; 3}"</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sParameterLessClosure </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1 + 2 == 3'</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> sOneParamClosure </span><span class="pun">=</span><span class="pln"> </span><span class="str">"1 + 2 == ${ w -&gt; w &lt;&lt; 3}"</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sOneParamClosure </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1 + 2 == 3'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The closure is a parameterless closure which doesn’t take arguments.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Here, the closure takes a single <code>java.io.StringWriter</code> argument, to which you can append content  with the <code>&lt;&lt;</code> leftShift operator.
In either case, both placeholders are embedded closures.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In appearance, it looks like a more verbose way of defining expressions to be interpolated,
but closures have an interesting advantage over mere expressions: lazy evaluation.</p>
</div>
<div class="paragraph">
<p>Let’s consider the following sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> number </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> eagerGString </span><span class="pun">=</span><span class="pln"> </span><span class="str">"value == ${number}"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> lazyGString </span><span class="pun">=</span><span class="pln"> </span><span class="str">"value == ${ -&gt; number }"</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> eagerGString </span><span class="pun">==</span><span class="pln"> </span><span class="str">"value == 1"</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> lazyGString </span><span class="pun">==</span><span class="pln">  </span><span class="str">"value == 1"</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

number </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> eagerGString </span><span class="pun">==</span><span class="pln"> </span><span class="str">"value == 1"</span><span class="pln"> </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> lazyGString </span><span class="pun">==</span><span class="pln">  </span><span class="str">"value == 2"</span><span class="pln"> </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define a <code>number</code> variable containing <code>1</code> that we then interpolate within two GStrings,
as an expression in <code>eagerGString</code> and as a closure in <code>lazyGString</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We expect the resulting string to contain the same string value of 1 for <code>eagerGString</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Similarly for <code>lazyGString</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Then we change the value of the variable to a new number</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>With a plain interpolated expression, the value was actually bound at the time of creation of the GString.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>But with a closure expression, the closure is called upon each coercion of the GString into String,
resulting in an updated string containing the new number value.</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An embedded closure expression taking more than one parameter will generate an exception at runtime.
Only closures with zero or one parameters are allowed.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_interoperability_with_java"><a class="anchor" href="#_interoperability_with_java"></a>Interoperability with Java</h6>
<div class="paragraph">
<p>When a method (whether implemented in Java or Groovy) expects a <code>java.lang.String</code>,
but we pass a <code>groovy.lang.GString</code> instance,
the <code>toString()</code> method of the GString is automatically and transparently called.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> takeString</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">         </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> message </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">String</span><span class="pln">        </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> message
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> message </span><span class="pun">=</span><span class="pln"> </span><span class="str">"The message is ${'hello'}"</span><span class="pln">   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> message </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">GString</span><span class="pln">           </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> takeString</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">            </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> result </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">String</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="str">'The message is hello'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We create a GString variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We double check it’s an instance of the GString</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We then pass that GString to a method taking a String as parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The signature of the <code>takeString()</code> method explicitly says its sole parameter is a String</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We also verify that the parameter is indeed a String and not a GString.</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_gstring_and_string_hashcodes"><a class="anchor" href="#_gstring_and_string_hashcodes"></a>GString and String hashCodes</h6>
<div class="paragraph">
<p>Although interpolated strings can be used in lieu of plain Java strings,
they differ with strings in a particular way: their hashCodes are different.
Plain Java strings are immutable, whereas the resulting String representation of a GString can vary,
depending on its interpolated values.
Even for the same resulting string, GStrings and Strings don’t have the same hashCode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="str">"one: ${1}"</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="str">"one: 1"</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>GString and Strings having different hashCode values, using GString as Map keys should be avoided,
especially if we try to retrieve an associated value with a String instead of a GString.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> key </span><span class="pun">=</span><span class="pln"> </span><span class="str">"a"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">"${key}"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"letter ${key}"</span><span class="pun">]</span><span class="pln">     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> m</span><span class="pun">[</span><span class="str">"a"</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">                   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The map is created with an initial pair whose key is a GString</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When we try to fetch the value with a String key, we will not find it, as Strings and GString have different hashCode values</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_triple_double_quoted_string"><a class="anchor" href="#_triple_double_quoted_string"></a>Triple double quoted string</h5>
<div class="paragraph">
<p>Triple double quoted strings behave like double quoted strings, with 
the addition that they are multiline, like the triple single quoted 
strings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Groovy'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">template</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"""
    Dear Mr ${name},

    You're the winner of the lottery!

    Yours sincerly,

    Dave
"""</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">template</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">().</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'Groovy'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Neither double quotes nor single quotes need be escaped in triple double quoted strings.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_slashy_string"><a class="anchor" href="#_slashy_string"></a>Slashy string</h5>
<div class="paragraph">
<p>Beyond the usual quoted strings, Groovy offers slashy strings, which use <code>/</code> as delimiters.
Slashy strings are particularly useful for defining regular expressions and patterns,
as there is no need to escape backslashes.</p>
</div>
<div class="paragraph">
<p>Example of a slashy string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> fooPattern </span><span class="pun">=</span><span class="pln"> </span><span class="str">/.*foo.*/</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> fooPattern </span><span class="pun">==</span><span class="pln"> </span><span class="str">'.*foo.*'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Only forward slashes need to be escaped with a backslash:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> escapeSlash </span><span class="pun">=</span><span class="pln"> </span><span class="str">/The character \/ is a forward slash/</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> escapeSlash </span><span class="pun">==</span><span class="pln"> </span><span class="str">'The character / is a forward slash'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Slashy strings are multiline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> multilineSlashy </span><span class="pun">=</span><span class="pln"> </span><span class="pun">/</span><span class="pln">one
    two
    three</span><span class="pun">/</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> multilineSlashy</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'\n'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Slashy strings can also be interpolated (ie. a GString):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> color </span><span class="pun">=</span><span class="pln"> </span><span class="str">'blue'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> interpolatedSlashy </span><span class="pun">=</span><span class="pln"> </span><span class="str">/a ${color} car/</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> interpolatedSlashy </span><span class="pun">==</span><span class="pln"> </span><span class="str">'a blue car'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a few gotchas to be aware of.</p>
</div>
<div class="paragraph">
<p>An empty slashy string cannot be represented with a double forward 
slash, as it’s understood by the Groovy parser as a line comment.
That’s why the following assert would actually not compile as it would 
look like a non-terminated statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="str">''</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="com">//</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As slashy strings were mostly designed to make regexp easier so a few things that are errors in GStrings like <code>$()</code> will work with slashy strings.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_dollar_slashy_string"><a class="anchor" href="#_dollar_slashy_string"></a>Dollar slashy string</h5>
<div class="paragraph">
<p>Dollar slashy strings are multiline GStrings delimited with an opening <code>$/</code> and and a closing <code>/$</code>.
The escaping character is the dollar sign, and it can escape another 
dollar, or a forward slash.
But both dollar and forward slashes don’t need to be escaped, except to 
escape the dollar of a string subsequence that would start like a 
GString placeholder sequence, or if you need to escape a sequence that 
would start like a closing dollar slashy string delimiter.</p>
</div>
<div class="paragraph">
<p>Here’s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Guillaume"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> date </span><span class="pun">=</span><span class="pln"> </span><span class="str">"April, 1st"</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> dollarSlashy </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">/</span><span class="pln">
    </span><span class="typ">Hello</span><span class="pln"> $name</span><span class="pun">,</span><span class="pln">
    today we</span><span class="str">'re ${date}.

    $ dollar sign
    $$ escaped dollar sign
    \ backslash
    / forward slash
    $/ escaped forward slash
    $/$ escaped dollar slashy string delimiter
/$

assert [
    '</span><span class="typ">Guillaume</span><span class="str">',
    '</span><span class="typ">April</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1st</span><span class="str">',
    '</span><span class="pln">$ dollar sign</span><span class="str">',
    '</span><span class="pln">$ escaped dollar sign</span><span class="str">',
    '</span><span class="pln">\\ backslash</span><span class="str">',
    '</span><span class="pun">/</span><span class="pln"> forward slash</span><span class="str">',
        '</span><span class="pln">$</span><span class="pun">/</span><span class="pln"> escaped forward slash</span><span class="str">',
        '</span><span class="pun">/</span><span class="pln">$ escaped dollar slashy </span><span class="kwd">string</span><span class="pln"> delimiter</span><span class="str">'

        ].each { dollarSlashy.contains(it) }</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_string_summary_table"><a class="anchor" href="#_string_summary_table"></a>String summary table</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interpolated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Escape character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Single quoted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'…​'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triple single quoted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'''…​'''</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double quoted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"…​"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check-empty"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triple double quoted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"""…​"""</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slashy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/…​/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>\</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dollar slashy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$/…​/$</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="icon"><i class="fa fa-check"></i></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_characters"><a class="anchor" href="#_characters"></a>Characters</h5>
<div class="paragraph">
<p>Unlike Java, Groovy doesn’t have an explicit character literal.
However, you can be explicit about making a Groovy string an actual character, by three different means:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">char</span><span class="pln"> c1 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'A'</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> c1 </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Character</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> c2 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'B'</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">char</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> c2 </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Character</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> c3 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">char</span><span class="pun">)</span><span class="str">'C'</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> c3 </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Character</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>by being explicit when declaring a variable holding the character by specifying the <code>char</code> type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>by using type coercion with the <code>as</code> operator</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>by using a cast to char operation</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The first option <em class="conum">1</em> is interesting when the character is held in a variable,
while the other two (<em class="conum">2</em> and <em class="conum">3</em>) are more interesting when a char value must be passed as argument of a method call.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_numbers"><a class="anchor" href="#_numbers"></a>1.1.5. Numbers</h4>
<div class="paragraph">
<p>Groovy supports different kinds of integral literals and decimal literals, backed by the usual <code>Number</code> types of Java.</p>
</div>
<div class="sect4">
<h5 id="_integral_literals"><a class="anchor" href="#_integral_literals"></a>Integral literals</h5>
<div class="paragraph">
<p>The integral literal types are the same as in Java:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>byte</code></p>
</li>
<li>
<p><code>char</code></p>
</li>
<li>
<p><code>short</code></p>
</li>
<li>
<p><code>int</code></p>
</li>
<li>
<p><code>long</code></p>
</li>
<li>
<p><code>java.lang.BigInteger</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can create integral numbers of those types with the following declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// primitive types</span><span class="pln">
</span><span class="kwd">byte</span><span class="pln">  b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">char</span><span class="pln">  c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">short</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">int</span><span class="pln">   i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="kwd">long</span><span class="pln">  l </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln">

</span><span class="com">// infinite precision</span><span class="pln">
</span><span class="typ">BigInteger</span><span class="pln"> bi </span><span class="pun">=</span><span class="pln">  </span><span class="lit">6</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use optional typing by using the <code>def</code> keyword, the type of the integral number will vary:
it’ll adapt to the capacity of the type that can hold that number.</p>
</div>
<div class="paragraph">
<p>For positive numbers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> a </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln">

</span><span class="com">// Integer.MAX_VALUE</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2147483647</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln">

</span><span class="com">// Integer.MAX_VALUE + 1</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2147483648</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> c </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Long</span><span class="pln">

</span><span class="com">// Long.MAX_VALUE</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9223372036854775807</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Long</span><span class="pln">

</span><span class="com">// Long.MAX_VALUE + 1</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> e </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9223372036854775808</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> e </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">BigInteger</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as for negative numbers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> na </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> na </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln">

</span><span class="com">// Integer.MIN_VALUE</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> nb </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">2147483648</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> nb </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln">

</span><span class="com">// Integer.MIN_VALUE - 1</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> nc </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">2147483649</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> nc </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Long</span><span class="pln">

</span><span class="com">// Long.MIN_VALUE</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> nd </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">9223372036854775808</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> nd </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Long</span><span class="pln">

</span><span class="com">// Long.MIN_VALUE - 1</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> ne </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">9223372036854775809</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> ne </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">BigInteger</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_alternative_non_base_10_representations"><a class="anchor" href="#_alternative_non_base_10_representations"></a>Alternative non-base 10 representations</h6>
<div class="paragraph">
<p>Numbers can also be represented in binary, octal, hexadecimal and decimal bases.</p>
</div>
<div class="sect6">
<h7 id="_binary_literal"><a class="anchor" href="#_binary_literal"></a>Binary literal</h7>
<div class="paragraph">
<p>Binary numbers start with a <code>0b</code> prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> xInt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0b10101111</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xInt </span><span class="pun">==</span><span class="pln"> </span><span class="lit">175</span><span class="pln">

</span><span class="kwd">short</span><span class="pln"> xShort </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0b11001001</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xShort </span><span class="pun">==</span><span class="pln"> </span><span class="lit">201</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">short</span><span class="pln">

</span><span class="kwd">byte</span><span class="pln"> xByte </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0b11</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xByte </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">byte</span><span class="pln">

</span><span class="kwd">long</span><span class="pln"> xLong </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0b101101101101</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xLong </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2925l</span><span class="pln">

</span><span class="typ">BigInteger</span><span class="pln"> xBigInteger </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0b111100100001</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xBigInteger </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3873g</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> xNegativeInt </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">0b10101111</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xNegativeInt </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">175</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_octal_literal"><a class="anchor" href="#_octal_literal"></a>Octal literal</h7>
<div class="paragraph">
<p>Octal numbers are specified in the typical format of <code>0</code> followed by octal digits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> xInt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">077</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xInt </span><span class="pun">==</span><span class="pln"> </span><span class="lit">63</span><span class="pln">

</span><span class="kwd">short</span><span class="pln"> xShort </span><span class="pun">=</span><span class="pln"> </span><span class="lit">011</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xShort </span><span class="pun">==</span><span class="pln"> </span><span class="lit">9</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">short</span><span class="pln">

</span><span class="kwd">byte</span><span class="pln"> xByte </span><span class="pun">=</span><span class="pln"> </span><span class="lit">032</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xByte </span><span class="pun">==</span><span class="pln"> </span><span class="lit">26</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">byte</span><span class="pln">

</span><span class="kwd">long</span><span class="pln"> xLong </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0246</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xLong </span><span class="pun">==</span><span class="pln"> </span><span class="lit">166l</span><span class="pln">

</span><span class="typ">BigInteger</span><span class="pln"> xBigInteger </span><span class="pun">=</span><span class="pln"> </span><span class="lit">01111</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xBigInteger </span><span class="pun">==</span><span class="pln"> </span><span class="lit">585g</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> xNegativeInt </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">077</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xNegativeInt </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">63</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_hexadecimal_literal"><a class="anchor" href="#_hexadecimal_literal"></a>Hexadecimal literal</h7>
<div class="paragraph">
<p>Hexadecimal numbers are specified in the typical format of <code>0x</code> followed by hex digits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> xInt </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0x77</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xInt </span><span class="pun">==</span><span class="pln"> </span><span class="lit">119</span><span class="pln">

</span><span class="kwd">short</span><span class="pln"> xShort </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xaa</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xShort </span><span class="pun">==</span><span class="pln"> </span><span class="lit">170</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">short</span><span class="pln">

</span><span class="kwd">byte</span><span class="pln"> xByte </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0x3a</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xByte </span><span class="pun">==</span><span class="pln"> </span><span class="lit">58</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">byte</span><span class="pln">

</span><span class="kwd">long</span><span class="pln"> xLong </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xffff</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xLong </span><span class="pun">==</span><span class="pln"> </span><span class="lit">65535l</span><span class="pln">

</span><span class="typ">BigInteger</span><span class="pln"> xBigInteger </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xaaaa</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xBigInteger </span><span class="pun">==</span><span class="pln"> </span><span class="lit">43690g</span><span class="pln">

</span><span class="typ">Double</span><span class="pln"> xDouble </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">(</span><span class="str">'0x1.0p0'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xDouble </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1.0d</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> xNegativeInt </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">0x77</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xNegativeInt </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">119</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_decimal_literals"><a class="anchor" href="#_decimal_literals"></a>Decimal literals</h5>
<div class="paragraph">
<p>The decimal literal types are the same as in Java:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>float</code></p>
</li>
<li>
<p><code>double</code></p>
</li>
<li>
<p><code>java.lang.BigDecimal</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can create decimal numbers of those types with the following declarations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// primitive types</span><span class="pln">
</span><span class="kwd">float</span><span class="pln">  f </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1.234</span><span class="pln">
</span><span class="kwd">double</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2.345</span><span class="pln">

</span><span class="com">// infinite precision</span><span class="pln">
</span><span class="typ">BigDecimal</span><span class="pln"> bd </span><span class="pun">=</span><span class="pln">  </span><span class="lit">3.456</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Decimals can use exponents, with the <code>e</code> or <code>E</code> exponent letter, followed by an optional sign,
and a integral number representing the exponent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="lit">1e3</span><span class="pln">  </span><span class="pun">==</span><span class="pln">  </span><span class="lit">1_000.0</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">2E4</span><span class="pln">  </span><span class="pun">==</span><span class="pln"> </span><span class="lit">20</span><span class="pln">_000</span><span class="pun">.</span><span class="lit">0</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">3e+1</span><span class="pln"> </span><span class="pun">==</span><span class="pln">     </span><span class="lit">30.0</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">4E-2</span><span class="pln"> </span><span class="pun">==</span><span class="pln">      </span><span class="lit">0.04</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">5e-1</span><span class="pln"> </span><span class="pun">==</span><span class="pln">      </span><span class="lit">0.5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Conveniently for exact decimal number calculations, Groovy choses <code>java.lang.BigDecimal</code> as its decimal number type.
In addition, both <code>float</code> and <code>double</code> are supported, but require an explicit type declaration, type coercion or suffix.
Even if <code>BigDecimal</code> is the default for decimal numbers, such literals are accepted in methods or closures taking <code>float</code> or <code>double</code> as parameter types.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Decimal numbers can’t be represented using a binary, octal or hexadecimal representation.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_underscore_in_literals"><a class="anchor" href="#_underscore_in_literals"></a>Underscore in literals</h5>
<div class="paragraph">
<p>When writing long literal numbers, it’s harder on the eye to figure 
out how some numbers are grouped together, for example with groups of 
thousands, of words, etc. By allowing you to place underscore in number 
literals, it’s easier to spot those groups:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">long</span><span class="pln"> creditCardNumber </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1234</span><span class="pln">_5678_9012_3456L
</span><span class="kwd">long</span><span class="pln"> socialSecurityNumbers </span><span class="pun">=</span><span class="pln"> </span><span class="lit">999</span><span class="pln">_99_9999L
</span><span class="kwd">double</span><span class="pln"> monetaryAmount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">12</span><span class="pln">_345_132</span><span class="pun">.</span><span class="lit">12</span><span class="pln">
</span><span class="kwd">long</span><span class="pln"> hexBytes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xFF</span><span class="pln">_EC_DE_5E
</span><span class="kwd">long</span><span class="pln"> hexWords </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xFFEC</span><span class="pln">_DE5E
</span><span class="kwd">long</span><span class="pln"> maxLong </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0x7fff</span><span class="pln">_ffff_ffff_ffffL
</span><span class="kwd">long</span><span class="pln"> alsoMaxLong </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9_223_372_036_854_775_807L</span><span class="pln">
</span><span class="kwd">long</span><span class="pln"> bytes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0b11010010</span><span class="pln">_01101001_10010100_10010010</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_number_type_suffixes"><a class="anchor" href="#_number_type_suffixes"></a>Number type suffixes</h5>
<div class="paragraph">
<p>We can force a number (including binary, octals and hexadecimals) to 
have a specific type by giving a suffix (see table below), either 
uppercase or lowercase.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Suffix</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>G</code> or <code>g</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>L</code> or <code>l</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>I</code> or <code>i</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>G</code> or <code>g</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D</code> or <code>d</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>F</code> or <code>f</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="lit">42I</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="str">'42'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">42i</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="str">'42'</span><span class="pun">)</span><span class="pln"> </span><span class="com">// lowercase i more readable</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">123L</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">(</span><span class="str">"123"</span><span class="pun">)</span><span class="pln"> </span><span class="com">// uppercase L more readable</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">2147483648</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Long</span><span class="pun">(</span><span class="str">'2147483648'</span><span class="pun">)</span><span class="pln"> </span><span class="com">// Long type used, value too large for an Integer</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">456G</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BigInteger</span><span class="pun">(</span><span class="str">'456'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">456g</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BigInteger</span><span class="pun">(</span><span class="str">'456'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">123.45</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pun">(</span><span class="str">'123.45'</span><span class="pun">)</span><span class="pln"> </span><span class="com">// default BigDecimal type used</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">1.200065D</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">(</span><span class="str">'1.200065'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">1.234F</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Float</span><span class="pun">(</span><span class="str">'1.234'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">1.23E23D</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Double</span><span class="pun">(</span><span class="str">'1.23E23'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">0b1111L</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Long</span><span class="pln"> </span><span class="com">// binary</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">0xFFi</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> </span><span class="com">// hexadecimal</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">034G</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">BigInteger</span><span class="pln"> </span><span class="com">// octal</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_math_operations"><a class="anchor" href="#_math_operations"></a>Math operations</h5>
<div class="paragraph">
<p>Although <a href="#_operators">operators</a> are covered later on, it’s important to discuss the behavior of math operations
and what their resulting types are.</p>
</div>
<div class="paragraph">
<p>Division and power binary operations aside (covered below),</p>
</div>
<div class="ulist">
<ul>
<li>
<p>binary operations between <code>byte</code>, <code>char</code>, <code>short</code> and <code>int</code> result in <code>int</code></p>
</li>
<li>
<p>binary operations involving <code>long</code> with <code>byte</code>, <code>char</code>, <code>short</code> and <code>int</code> result in <code>long</code></p>
</li>
<li>
<p>binary operations involving <code>BigInteger</code> and any other integral type result in <code>BigInteger</code></p>
</li>
<li>
<p>binary operations involving <code>BigDecimal</code> with <code>byte</code>, <code>char</code>, <code>short</code>, <code>int</code> and <code>BigInteger</code> result in <code>BigDecimal</code></p>
</li>
<li>
<p>binary operations between <code>float</code>, <code>double</code> and <code>BigDecimal</code> result in <code>double</code></p>
</li>
<li>
<p>binary operations between two <code>BigDecimal</code> result in <code>BigDecimal</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table summarizes those rules:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">byte</th>
<th class="tableblock halign-left valign-top">char</th>
<th class="tableblock halign-left valign-top">short</th>
<th class="tableblock halign-left valign-top">int</th>
<th class="tableblock halign-left valign-top">long</th>
<th class="tableblock halign-left valign-top">BigInteger</th>
<th class="tableblock halign-left valign-top">float</th>
<th class="tableblock halign-left valign-top">double</th>
<th class="tableblock halign-left valign-top">BigDecimal</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>byte</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>char</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>short</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>int</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>long</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BigInteger</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigInteger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>float</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>double</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BigDecimal</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BigDecimal</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Thanks to Groovy’s operator overloading, the usual arithmetic operators work as well with <code>BigInteger</code> and <code>BigDecimal</code>,
unlike in Java where you have to use explicit methods for operating on those numbers.
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="integer_division"><a class="anchor" href="#integer_division"></a>The case of the division operator</h6>
<div class="paragraph">
<p>The division operators <code>/</code> (and <code>/=</code> for division and assignment) produce a <code>double</code> result
if either operand is a <code>float</code> or <code>double</code>, and a <code>BigDecimal</code> result otherwise
(when both operands are any combination of an integral type <code>short</code>, <code>char</code>, <code>byte</code>, <code>int</code>, <code>long</code>,
<code>BigInteger</code> or <code>BigDecimal</code>).</p>
</div>
<div class="paragraph">
<p><code>BigDecimal</code> division is performed with the <code>divide()</code> method if the division is exact
(i.e. yielding a result that can be represented within the bounds of the same precision and scale),
or using a <code>MathContext</code> with a <a href="http://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html#precision%28%29">precision</a>
of the maximum of the two operands' precision plus an extra precision of 10,
and a <a href="http://docs.oracle.com/javase/7/docs/api/java/math/BigDecimal.html#scale%28%29">scale</a>
of the maximum of 10 and the maximum of the operands' scale.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For integer division like in Java, you should use the <code>intdiv()</code> method,
as Groovy doesn’t provide a dedicated integer division operator symbol.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="power_operator"><a class="anchor" href="#power_operator"></a>The case of the power operator</h6>
<div class="paragraph">
<p>The power operation is represented by the <code>**</code> operator, with two parameters: the base and the exponent.
The result of the power operation depends on its operands, and the result of the operation
(in particular if the result can be represented as an integral value).</p>
</div>
<div class="paragraph">
<p>The following rules are used by Groovy’s power operation to determine the resulting type:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the exponent is a decimal value</p>
<div class="ulist">
<ul>
<li>
<p>if the result can be represented as an <code>Integer</code>, then return an <code>Integer</code></p>
</li>
<li>
<p>else if the result can be represented as a <code>Long</code>, then return a <code>Long</code></p>
</li>
<li>
<p>otherwise return a <code>Double</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>If the exponent is an integral value</p>
<div class="ulist">
<ul>
<li>
<p>if the exponent is strictly negative, then return an <code>Integer</code>, <code>Long</code> or <code>Double</code> if the result value fits in that type</p>
</li>
<li>
<p>if the exponent is positive or zero</p>
<div class="ulist">
<ul>
<li>
<p>if the base is a <code>BigDecimal</code>, then return a <code>BigDecimal</code> result value</p>
</li>
<li>
<p>if the base is a <code>BigInteger</code>, then return a <code>BigInteger</code> result value</p>
</li>
<li>
<p>if the base is an <code>Integer</code>, then return an <code>Integer</code> if the result value fits in it, otherwise a <code>BigInteger</code></p>
</li>
<li>
<p>if the base is a <code>Long</code>, then return a <code>Long</code> if the result value fits in it, otherwise a <code>BigInteger</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can illustrate those rules with a few examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// base and exponent are ints and the result can be represented by an Integer</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">    </span><span class="lit">2</span><span class="pln">    </span><span class="pun">**</span><span class="pln">   </span><span class="lit">3</span><span class="pln">    </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln">    </span><span class="com">//  8</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">   </span><span class="lit">10</span><span class="pln">    </span><span class="pun">**</span><span class="pln">   </span><span class="lit">9</span><span class="pln">    </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln">    </span><span class="com">//  1_000_000_000</span><span class="pln">

</span><span class="com">// the base is a long, so fit the result in a Long</span><span class="pln">
</span><span class="com">// (although it could have fit in an Integer)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">    </span><span class="lit">5L</span><span class="pln">   </span><span class="pun">**</span><span class="pln">   </span><span class="lit">2</span><span class="pln">    </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Long</span><span class="pln">       </span><span class="com">//  25</span><span class="pln">

</span><span class="com">// the result can't be represented as an Integer or Long, so return a BigInteger</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">  </span><span class="lit">100</span><span class="pln">    </span><span class="pun">**</span><span class="pln">  </span><span class="lit">10</span><span class="pln">    </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">BigInteger</span><span class="pln"> </span><span class="com">//  10e20</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">1234</span><span class="pln">    </span><span class="pun">**</span><span class="pln"> </span><span class="lit">123</span><span class="pln">    </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">BigInteger</span><span class="pln"> </span><span class="com">//  170515806212727042875...</span><span class="pln">

</span><span class="com">// the base is a BigDecimal and the exponent a negative int</span><span class="pln">
</span><span class="com">// but the result can be represented as an Integer</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">    </span><span class="lit">0.5</span><span class="pln">  </span><span class="pun">**</span><span class="pln">  </span><span class="pun">-</span><span class="lit">2</span><span class="pln">    </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln">    </span><span class="com">//  4</span><span class="pln">

</span><span class="com">// the base is an int, and the exponent a negative float</span><span class="pln">
</span><span class="com">// but again, the result can be represented as an Integer</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">    </span><span class="lit">1</span><span class="pln">    </span><span class="pun">**</span><span class="pln">  </span><span class="pun">-</span><span class="lit">0.3f</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln">    </span><span class="com">//  1</span><span class="pln">

</span><span class="com">// the base is an int, and the exponent a negative int</span><span class="pln">
</span><span class="com">// but the result will be calculated as a Double</span><span class="pln">
</span><span class="com">// (both base and exponent are actually converted to doubles)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">   </span><span class="lit">10</span><span class="pln">    </span><span class="pun">**</span><span class="pln">  </span><span class="pun">-</span><span class="lit">1</span><span class="pln">    </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Double</span><span class="pln">     </span><span class="com">//  0.1</span><span class="pln">

</span><span class="com">// the base is a BigDecimal, and the exponent is an int, so return a BigDecimal</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">    </span><span class="lit">1.2</span><span class="pln">  </span><span class="pun">**</span><span class="pln">  </span><span class="lit">10</span><span class="pln">    </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln"> </span><span class="com">//  6.1917364224</span><span class="pln">

</span><span class="com">// the base is a float or double, and the exponent is an int</span><span class="pln">
</span><span class="com">// but the result can only be represented as a Double value</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">    </span><span class="lit">3.4f</span><span class="pln"> </span><span class="pun">**</span><span class="pln">   </span><span class="lit">5</span><span class="pln">    </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Double</span><span class="pln">     </span><span class="com">//  454.35430372146965</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">    </span><span class="lit">5.6d</span><span class="pln"> </span><span class="pun">**</span><span class="pln">   </span><span class="lit">2</span><span class="pln">    </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Double</span><span class="pln">     </span><span class="com">//  31.359999999999996</span><span class="pln">

</span><span class="com">// the exponent is a decimal value</span><span class="pln">
</span><span class="com">// and the result can only be represented as a Double value</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">    </span><span class="lit">7.8</span><span class="pln">  </span><span class="pun">**</span><span class="pln">   </span><span class="lit">1.9</span><span class="pln">  </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Double</span><span class="pln">     </span><span class="com">//  49.542708423868476</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">    </span><span class="lit">2</span><span class="pln">    </span><span class="pun">**</span><span class="pln">   </span><span class="lit">0.1f</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Double</span><span class="pln">     </span><span class="com">//  1.0717734636432956</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_booleans"><a class="anchor" href="#_booleans"></a>1.1.6. Booleans</h4>
<div class="paragraph">
<p>Boolean is a special data type that is used to represent truth values: <code>true</code> and <code>false</code>.
Use this data type for simple flags that track true/false <a href="#_conditional_operators">conditions</a>.</p>
</div>
<div class="paragraph">
<p>Boolean values can be stored in variables, assigned into fields, just like any other data type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> myBooleanVariable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="kwd">boolean</span><span class="pln"> untypedBooleanVar </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
booleanField </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>true</code> and <code>false</code> are the only two primitive boolean values.
But more complex boolean expressions can be represented using <a href="#_bitwise_and_logical_operators">logical operators</a>.</p>
</div>
<div class="paragraph">
<p>In addition, Groovy has <a href="#_the_groovy_truth">special rules</a> (often referred to as <em>Groovy Truth</em>)
for coercing non-boolean objects to a boolean value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_lists"><a class="anchor" href="#_lists"></a>1.1.7. Lists</h4>
<div class="paragraph">
<p>Groovy uses a comma-separated list of values, surrounded by square brackets, to denote lists.
Groovy lists are plain JDK <code>java.util.List</code>, as Groovy doesn’t define its own collection classes.
The concrete list implementation used when defining list literals are <code>java.util.ArrayList</code> by default,
unless you decide to specify otherwise, as we shall see later on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> numbers </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">List</span><span class="pln">  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> numbers</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define a list numbers delimited by commas and surrounded by square brackets, and we assign that list into a variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The list is an instance of Java’s <code>java.util.List</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The size of the list can be queried with the <code>size()</code> method, and shows our list contains 3 elements</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In the above example, we used a homogeneous list, but you can also create lists containing values of heterogeneous types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> heterogeneous </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">]</span><span class="pln">  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Our list here contains a number, a string and a boolean value</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>We mentioned that by default, list literals are actually instances of <code>java.util.ArrayList</code>,
but it is possible to use a different backing type for our lists,
thanks to using type coercion with the <code>as</code> operator, or with explicit type declaration for your variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> arrayList </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> arrayList </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">ArrayList</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> linkedList </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pln">    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> linkedList </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">LinkedList</span><span class="pln">

</span><span class="typ">LinkedList</span><span class="pln"> otherLinked </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> otherLinked </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">LinkedList</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We use coercion with the <code>as</code> operator to explicitly request a <code>java.util.LinkedList</code> implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We can say that the variable holding the list literal is of type <code>java.util.LinkedList</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can access elements of the list with the <code>[]</code> subscript operator (both for reading and setting values)
with positive indices or negative indices to access elements from the end of the list, as well as with ranges,
and use the <code>&lt;&lt;</code> leftShift operator to append elements to a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> letters </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> letters</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'a'</span><span class="pln">     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> letters</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'b'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> letters</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'d'</span><span class="pln">    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> letters</span><span class="pun">[-</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'c'</span><span class="pln">

letters</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'C'</span><span class="pln">             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> letters</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'C'</span><span class="pln">

letters </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'e'</span><span class="pln">               </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> letters</span><span class="pun">[</span><span class="pln"> </span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'e'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> letters</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'e'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> letters</span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">]</span><span class="pln">         </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> letters</span><span class="pun">[</span><span class="lit">2.</span><span class="pun">.</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'C'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'e'</span><span class="pun">]</span><span class="pln">    </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access the first element of the list (zero-based counting)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the last element of the list with a negative index: -1 is the first element from the end of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use an assignment to set a new value for the third element of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use the <code>&lt;&lt;</code> leftShift operator to append an element at the end of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Access two elements at once, returning a new list containing those two elements</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use a range to access a range of values from the list, from a start to an end element position</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As lists can be heterogeneous in nature, lists can also contain other lists to create multi-dimensional lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> multi </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]]</span><span class="pln">     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> multi</span><span class="pun">[</span><span class="lit">1</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define a list of list of numbers</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Access the second element of the top-most list, and the first element of the inner list</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_arrays"><a class="anchor" href="#_arrays"></a>1.1.8. Arrays</h4>
<div class="paragraph">
<p>Groovy reuses the list notation for arrays, but to make such literals arrays,
you need to explicitely define the type of the array through coercion or type declaration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pun">[]</span><span class="pln"> arrStr </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Ananas'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Banana'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Kiwi'</span><span class="pun">]</span><span class="pln">  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> arrStr </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln">    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!(</span><span class="pln">arrStr </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">List</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> numArr </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln">      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> numArr </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln">       </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> numArr</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define an array of strings using explicit variable type declaration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Assert that we created an array of strings</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an array of ints with the <code>as</code> operator</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Assert that we created an array of primitive ints</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can also create multi-dimensional arrays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> matrix3 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">[</span><span class="lit">3</span><span class="pun">][</span><span class="lit">3</span><span class="pun">]</span><span class="pln">         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> matrix3</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">

</span><span class="typ">Integer</span><span class="pun">[][]</span><span class="pln"> matrix2                     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
matrix2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">]]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> matrix2 </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">[][]</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can define the bounds of a new array</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Or declare an array without specifying its bounds</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Access to elements of an array follows the same notation as for lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pun">[]</span><span class="pln"> names </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Cédric'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Guillaume'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Jochen'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Paul'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> names</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Cédric'</span><span class="pln">     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

names</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Blackdrag'</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> names</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Blackdrag'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Retrieve the first element of the array</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the value of the third element of the array to a new value</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java’s array initializer notation is not supported by Groovy,
as the curly braces can be misinterpreted with the notation of Groovy closures.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_maps"><a class="anchor" href="#_maps"></a>1.1.9. Maps</h4>
<div class="paragraph">
<p>Sometimes called dictionaries or associative arrays in other languages, Groovy features maps.
Maps associate keys to values, separating keys and values with colons, and each key/value pairs with commas,
and the whole keys and values surrounded by square brackets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> colors </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">red</span><span class="pun">:</span><span class="pln"> </span><span class="str">'#FF0000'</span><span class="pun">,</span><span class="pln"> green</span><span class="pun">:</span><span class="pln"> </span><span class="str">'#00FF00'</span><span class="pun">,</span><span class="pln"> blue</span><span class="pun">:</span><span class="pln"> </span><span class="str">'#0000FF'</span><span class="pun">]</span><span class="pln">   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> colors</span><span class="pun">[</span><span class="str">'red'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'#FF0000'</span><span class="pln">    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> colors</span><span class="pun">.</span><span class="pln">green  </span><span class="pun">==</span><span class="pln"> </span><span class="str">'#00FF00'</span><span class="pln">    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

colors</span><span class="pun">[</span><span class="str">'pink'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'#FF00FF'</span><span class="pln">           </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
colors</span><span class="pun">.</span><span class="pln">yellow  </span><span class="pun">=</span><span class="pln"> </span><span class="str">'#FFFF00'</span><span class="pln">           </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> colors</span><span class="pun">.</span><span class="pln">pink </span><span class="pun">==</span><span class="pln"> </span><span class="str">'#FF00FF'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> colors</span><span class="pun">[</span><span class="str">'yellow'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'#FFFF00'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> colors </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">LinkedHashMap</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We define a map of string color names, associated with their hexadecimal-coded html colors</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use the subscript notation to check the content associated with the <code>red</code> key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We can also use the property notation to assert the color green’s hexadecimal representation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Similarly, we can use the subscript notation to add a new key/value pair</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Or the property notation, to add the <code>yellow</code> color</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using names for the keys, we actually define string keys in the map.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Groovy creates maps that are actually instances of <code>java.util.LinkedHashMap</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you try to access a key which is not present in the map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> colors</span><span class="pun">.</span><span class="pln">unknown </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will retrieve a <code>null</code> result.</p>
</div>
<div class="paragraph">
<p>In the examples above, we used string keys, but you can also use values of other types as keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="str">'one'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> </span><span class="str">'two'</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> numbers</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'one'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we used numbers as keys, as numbers can unambiguously be recognized as numbers,
so Groovy will not create a string key like in our previous examples.
But consider the case you want to pass a variable in lieu of the key, to have the value of that variable become the key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'name'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">key</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Guillaume'</span><span class="pun">]</span><span class="pln">      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">person</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="str">'name'</span><span class="pun">)</span><span class="pln">   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="str">'key'</span><span class="pun">)</span><span class="pln">     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>key</code> associated with the <code>'Guillaume'</code> name will actually be the <code>"key"</code> string, not the value associated with the <code>key</code> variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The map doesn’t contain the <code>'name'</code> key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Instead, the map contains a <code>'key'</code> key</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also pass quoted strings as well as keys: ["name": "Guillaume"].
This is mandatory if your key string isn’t a valid identifier,
for example if you wanted to create a string key containing a hash like in: ["street-name": "Main street"].
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When you need to pass variable values as keys in your map 
definitions, you must surround the variable or expression with 
parentheses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">person </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">key</span><span class="pun">):</span><span class="pln"> </span><span class="str">'Guillaume'</span><span class="pun">]</span><span class="pln">        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="str">'name'</span><span class="pun">)</span><span class="pln">    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">person</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="str">'key'</span><span class="pun">)</span><span class="pln">    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This time, we surround the <code>key</code> variable with parentheses, to instruct the parser we are passing a variable rather than defining a string key</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The map does contain the <code>name</code> key</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>But the map doesn’t contain the <code>key</code> key as before</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="groovy-operators"><a class="anchor" href="#groovy-operators"></a>1.2. Operators</h3>
<div class="paragraph">
<p>This chapter covers the operators of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_arithmetic_operators"><a class="anchor" href="#_arithmetic_operators"></a>1.2.1. Arithmetic operators</h4>
<div class="paragraph">
<p>Groovy supports the usual familiar arithmetic operators you find in mathematics and in other programming languages like Java.
All the Java arithmetic operators are supported. Let’s go through them in the following examples.</p>
</div>
<div class="sect4">
<h5 id="_normal_arithmetic_operators"><a class="anchor" href="#_normal_arithmetic_operators"></a>Normal arithmetic operators</h5>
<div class="paragraph">
<p>The following binary arithmetic operators are available in Groovy:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addition</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">subtraction</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">multiplication</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use <code>intdiv()</code> for integer division, and see the section about <a href="#integer_division">integer division</a> for more information on the return type of the division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">remainder</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>**</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">power</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See the section about <a href="#power_operator">the power operation</a> for more information on the return type of the operation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are a few examples of usage of those operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln">  </span><span class="lit">1</span><span class="pln">  </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">  </span><span class="lit">4</span><span class="pln">  </span><span class="pun">-</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">  </span><span class="lit">3</span><span class="pln">  </span><span class="pun">*</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">15</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">  </span><span class="lit">3</span><span class="pln">  </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1.5</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">10</span><span class="pln">  </span><span class="pun">%</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln">  </span><span class="lit">2</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">8</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_unary_operators"><a class="anchor" href="#_unary_operators"></a>Unary operators</h5>
<div class="paragraph">
<p>The <code>+</code> and <code>-</code> operators are also available as unary operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">+</span><span class="lit">3</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">-</span><span class="lit">4</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">4</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">-(-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note the usage of parentheses to surround an expression to apply the unary minus to that surrounded expression.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In terms of unary arithmetics operators, the <code>++</code> (increment) and <code>--</code> (decrement) operators are available,
both in prefix and postfix notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">++</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">3</span><span class="pln">             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> b </span><span class="pun">==</span><span class="pln"> </span><span class="lit">6</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">--</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln">             </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> c </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> d </span><span class="pun">==</span><span class="pln"> </span><span class="lit">6</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> e </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="pun">++</span><span class="pln">e </span><span class="pun">+</span><span class="pln"> </span><span class="lit">3</span><span class="pln">             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> e </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> f </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> g </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> h </span><span class="pun">=</span><span class="pln"> </span><span class="pun">--</span><span class="pln">g </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pln">             </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> g </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> h </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The postfix increment will increment <code>a</code> after the expression has been evaluated and assigned into <code>b</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The postfix decrement will decrement <code>c</code> after the expression has been evaluated and assigned into <code>d</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The prefix increment will increment <code>e</code> before the expression is evaluated and assigned into <code>f</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The prefix decrement will decrement <code>g</code> before the expression is evaluated and assigned into <code>h</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_assignment_arithmetic_operators"><a class="anchor" href="#_assignment_arithmetic_operators"></a>Assignment arithmetic operators</h5>
<div class="paragraph">
<p>The binary arithmetic operators we have seen above are also available in an assignment form:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>+=</code></p>
</li>
<li>
<p><code>-=</code></p>
</li>
<li>
<p><code>*=</code></p>
</li>
<li>
<p><code>/=</code></p>
</li>
<li>
<p><code>%=</code></p>
</li>
<li>
<p><code>**=</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s see them in action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
a </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln">
b </span><span class="pun">-=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> b </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln">
c </span><span class="pun">*=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> c </span><span class="pun">==</span><span class="pln"> </span><span class="lit">15</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pln">
d </span><span class="pun">/=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> d </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> e </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pln">
e </span><span class="pun">%=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> e </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
f </span><span class="pun">**=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> f </span><span class="pun">==</span><span class="pln"> </span><span class="lit">9</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_relational_operators"><a class="anchor" href="#_relational_operators"></a>1.2.2. Relational operators</h4>
<div class="paragraph">
<p>Relational operators allow comparisons between objects, to know if two objects are the same or different,
or if one is greater than, less than, or equal to the other.</p>
</div>
<div class="paragraph">
<p>The following operators are available:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>==</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">different</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less than or equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">greater than or equal</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here are some examples of simple number comparisons using these operators:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">4</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">-</span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">4</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_logical_operators"><a class="anchor" href="#_logical_operators"></a>1.2.3. Logical operators</h4>
<div class="paragraph">
<p>Groovy offers three logical operators for boolean expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&amp;&amp;</code>: logical "and"</p>
</li>
<li>
<p><code>||</code>: logical "or"</p>
</li>
<li>
<p><code>!</code>: logical "not"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s illustrate them with the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="kwd">false</span><span class="pln">           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>"not" false is true</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>true "and" true is true</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>true "or" false is true</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_precedence"><a class="anchor" href="#_precedence"></a>Precedence</h5>
<div class="paragraph">
<p>The logical "not" has a higher priority than the logical "and".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">false</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here, the assertion is true (as the expression in parentheses is 
false), because "not" has a higher precedence than "and", so it only 
applies to the first "false" term; otherwise, it would have applied to 
the result of the "and", turned it into true, and the assertion would 
have failed</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The logical "and" has a higher priority than the logical "or".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here, the assertion is true, because "and" has a higher precedence 
than "or", therefore the "or" is executed last and returns true, having 
one true argument; otherwise, the "and" would have executed last and 
returned false, having one false argument, and the assertion would have 
failed</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_short_circuiting"><a class="anchor" href="#_short_circuiting"></a>Short-circuiting</h5>
<div class="paragraph">
<p>The logical <code>||</code> operator supports short-circuiting: if 
the left operand is true, it knows that the result will be true in any 
case, so it won’t evaluate the right operand.
The right operand will be evaluated only if the left operand is false.</p>
</div>
<div class="paragraph">
<p>Likewise for the logical <code>&amp;&amp;</code> operator: if the 
left operand is false, it knows that the result will be false in any 
case, so it won’t evaluate the right operand.
The right operand will be evaluated only if the left operand is true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">boolean</span><span class="pln"> checkIfCalled</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    called </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

called </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="kwd">true</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> checkIfCalled</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">called              </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

called </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="kwd">false</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> checkIfCalled</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> called               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

called </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="kwd">false</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> checkIfCalled</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">called              </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">

called </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="kwd">true</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> checkIfCalled</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> called               </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We create a function that sets the <code>called</code> flag to true whenever it’s called</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In the first case, after resetting the called flag, we confirm that if the left operand to <code>||</code> is true, the function is not called, as <code>||</code> short-circuits the evaluation of the right operand</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In the second case, the left operand is false and so the function is called, as indicated by the fact our flag is now true</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Likewise for <code>&amp;&amp;</code>, we confirm that the function is not called with a false left operand</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>But the function is called with a true left operand</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bitwise_operators"><a class="anchor" href="#_bitwise_operators"></a>1.2.4. Bitwise operators</h4>
<div class="paragraph">
<p>Groovy offers 4 bitwise operators:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&amp;</code>: bitwise "and"</p>
</li>
<li>
<p><code>|</code>: bitwise "or"</p>
</li>
<li>
<p><code>^</code>: bitwise "xor" (exclusive "or")</p>
</li>
<li>
<p><code>~</code>: bitwise negation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Bitwise operators can be applied on a <code>byte</code> or an <code>int</code> and return an <code>int</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0b00101010</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> a</span><span class="pun">==</span><span class="lit">42</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0b00001000</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b</span><span class="pun">==</span><span class="lit">8</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">&amp;</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> a                     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">&amp;</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> b                     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">|</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> a                     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">|</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> a                     </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">int</span><span class="pln"> mask </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0b11111111</span><span class="pln">                   </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">((</span><span class="pln">a </span><span class="pun">^</span><span class="pln"> a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> mask</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0b00000000</span><span class="pln">   </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">((</span><span class="pln">a </span><span class="pun">^</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> mask</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0b00100010</span><span class="pln">   </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">((~</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln"> mask</span><span class="pun">)</span><span class="pln">    </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0b11010101</span><span class="pln">   </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>bitwise and</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>bitwise and returns common bits</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>bitwise or</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>bitwise or returns all '1' bits</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>setting a mask to check only the last 8 bits</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>bitwise exclusive or on self returns 0</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>bitwise exclusive or</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>bitwise negation</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It’s worth noting that the internal representation of primitive types follow the <a href="http://docs.oracle.com/javase/specs/jls/se8/html/jls-4.html">Java Language Specification</a>.
 In particular,
primitive types are signed, meaning that for a bitwise negation, it is 
always good to use a mask to retrieve only the necessary bits.</p>
</div>
<div class="paragraph">
<p>In Groovy, bitwise operators have the particularity of being <a href="#Operator-Overloading">overloadable</a>, meaning that you can define the behavior of those operators for any kind of object.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conditional_operators"><a class="anchor" href="#_conditional_operators"></a>1.2.5. Conditional operators</h4>
<div class="sect4">
<h5 id="_not_operator"><a class="anchor" href="#_not_operator"></a>Not operator</h5>
<div class="paragraph">
<p>The "not" operator is represented with an exclamation mark (<code>!</code>) and inverts the result of the underlying boolean expression. In
particular, it is possible to combine the <code>not</code> operator with the <a href="#Groovy-Truth">Groovy truth</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">    </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(!</span><span class="str">'foo'</span><span class="pun">)</span><span class="pln">   </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">                      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(!</span><span class="str">''</span><span class="pun">)</span><span class="pln">      </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">                       </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the negation of <code>true</code> is <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>'foo' is a non empty string, evaluating to <code>true</code>, so negation returns <code>false</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>'' is an empty string, evaluating to <code>false</code>, so negation returns <code>true</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_ternary_operator"><a class="anchor" href="#_ternary_operator"></a>Ternary operator</h5>
<div class="paragraph">
<p>The ternary operator is a shortcut expression that is equivalent to an if/else branch assigning some value to a variable.</p>
</div>
<div class="paragraph">
<p>Instead of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">string</span><span class="pun">!=</span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">.</span><span class="pln">length</span><span class="pun">()&gt;</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    result </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Found'</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    result </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Not found'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">string</span><span class="pun">!=</span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">.</span><span class="pln">length</span><span class="pun">()&gt;</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'Found'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'Not found'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ternary operator is also compatible with the <a href="#Groovy-Truth">Groovy truth</a>, so you can make it even simpler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">result </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">string</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'Found'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'Not found'</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_elvis_operator"><a class="anchor" href="#_elvis_operator"></a>Elvis operator</h5>
<div class="paragraph">
<p>The "Elvis operator" is a shortening of the ternary operator. One instance of where this is handy is for returning
a 'sensible default' value if an expression resolves to <code>false</code>-ish (as in
<a href="#Groovy-Truth">Groovy truth</a>). A simple example might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">displayName </span><span class="pun">=</span><span class="pln"> user</span><span class="pun">.</span><span class="pln">name </span><span class="pun">?</span><span class="pln"> user</span><span class="pun">.</span><span class="pln">name </span><span class="pun">:</span><span class="pln"> </span><span class="str">'Anonymous'</span><span class="pln">   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
displayName </span><span class="pun">=</span><span class="pln"> user</span><span class="pun">.</span><span class="pln">name </span><span class="pun">?:</span><span class="pln"> </span><span class="str">'Anonymous'</span><span class="pln">              </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>with the ternary operator, you have to repeat the value you want to assign</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>with the Elvis operator, the value, which is tested, is used if it is not <code>false</code>-ish</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Usage of the Elvis operator reduces the verbosity of your code and reduces the risks of errors in case of refactorings,
by removing the need to duplicate the expression which is tested in both the condition and the positive return value.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_object_operators"><a class="anchor" href="#_object_operators"></a>1.2.6. Object operators</h4>
<div class="sect4">
<h5 id="_safe_navigation_operator"><a class="anchor" href="#_safe_navigation_operator"></a>Safe navigation operator</h5>
<div class="paragraph">
<p>The Safe Navigation operator is used to avoid a <code>NullPointerException</code>. Typically when you have a reference to an object
you might need to verify that it is not <code>null</code> before accessing methods or properties of the object. To avoid this, the safe
navigation operator will simply return <code>null</code> instead of throwing an exception, like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">id </span><span class="pun">==</span><span class="pln"> </span><span class="lit">123</span><span class="pln"> </span><span class="pun">}</span><span class="pln">    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> person</span><span class="pun">?.</span><span class="pln">name                      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> name </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">                          </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>find</code> will return a <code>null</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>use of the null-safe operator prevents from a <code>NullPointerException</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>result is <code>null</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_direct_field_access_operator"><a class="anchor" href="#_direct_field_access_operator"></a>Direct field access operator</h5>
<div class="paragraph">
<p>Normally in Groovy, when you write code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name                 </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">User</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Name: $name"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> user </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="str">'Bob'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> user</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Name: Bob'</span><span class="pln">              </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>public field <code>name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a getter for <code>name</code> that returns a custom string</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calls the getter</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>user.name</code> call triggers a call to the property of the same name, that is to say, here, to the getter for <code>name</code>. If
you want to retrieve the field instead of calling the getter, you can use the direct field access operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> user</span><span class="pun">.</span><span class="lit">@name</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln">                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use of <code>.@</code> forces usage of the field instead of the getter</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="method-pointer-operator"><a class="anchor" href="#method-pointer-operator"></a>Method pointer operator</h5>
<div class="paragraph">
<p>The method pointer operator (<code>.&amp;</code>) call be used to store a reference to a method in a variable, in order to call it
later:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> str </span><span class="pun">=</span><span class="pln"> </span><span class="str">'example of method reference'</span><span class="pln">            </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> fun </span><span class="pun">=</span><span class="pln"> str</span><span class="pun">.&amp;</span><span class="pln">toUpperCase                         </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> upper </span><span class="pun">=</span><span class="pln"> fun</span><span class="pun">()</span><span class="pln">                                  </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> upper </span><span class="pun">==</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">                  </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>str</code> variable contains a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we store a reference to the <code>toUpperCase</code> method on the <code>str</code> instance inside a variable named <code>fun</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>fun</code> can be called like a regular method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>we can check that the result is the same as if we had called it directly on <code>str</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>There are multiple advantages in using method pointers. First of all, the type of such a method pointer is
a <code>groovy.lang.Closure</code>, so it can be used in any place a closure would be used. In particular, it is suitable to
convert an existing method for the needs of the strategy pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> transform</span><span class="pun">(</span><span class="typ">List</span><span class="pln"> elements</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> action</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
    elements</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln">
        result </span><span class="pun">&lt;&lt;</span><span class="pln"> action</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    result
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> describe</span><span class="pun">(</span><span class="typ">Person</span><span class="pln"> p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="str">"$p.name is $p.age"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> action </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.&amp;</span><span class="pln">describe                                       </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pun">,</span><span class="pln">   age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">42</span><span class="pun">),</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Julia'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">35</span><span class="pun">)]</span><span class="pln">                           </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> transform</span><span class="pun">(</span><span class="pln">list</span><span class="pun">,</span><span class="pln"> action</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Bob is 42'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Julia is 35'</span><span class="pun">]</span><span class="pln">    </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>transform</code> method takes each element of the list and calls the <code>action</code> closure on them, returning a new list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we define a function that takes a <code>Person</code> and returns a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we create a method pointer on that function</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>we create the list of elements we want to collect the descriptors</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the method pointer can be used where a <code>Closure</code> was expected</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Method pointers are bound by the receiver and a method name. Arguments are resolved at runtime, meaning that if you have
multiple methods with the same name, the syntax is not different, only resolution of the appropriate method to be called
will be done at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> str</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">2</span><span class="pun">*</span><span class="pln">x </span><span class="pun">}</span><span class="pln">                   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> reference </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.&amp;</span><span class="pln">doSomething                    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> reference</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'FOO'</span><span class="pln">                     </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> reference</span><span class="pun">(</span><span class="lit">123</span><span class="pun">)</span><span class="pln">   </span><span class="pun">==</span><span class="pln"> </span><span class="lit">246</span><span class="pln">                       </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define an overloaded <code>doSomething</code> method accepting a <code>String</code> as an argument</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>define an overloaded <code>doSomething</code> method accepting an <code>Integer</code> as an argument</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a single method pointer on <code>doSomething</code>, without specifying argument types</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>using the method pointer with a <code>String</code> calls the <code>String</code> version of <code>doSomething</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>using the method pointer with an <code>Integer</code> calls the <code>Integer</code> version of <code>doSomething</code></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_regular_expression_operators"><a class="anchor" href="#_regular_expression_operators"></a>1.2.7. Regular expression operators</h4>
<div class="sect4">
<h5 id="_pattern_operator"><a class="anchor" href="#_pattern_operator"></a>Pattern operator</h5>
<div class="paragraph">
<p>The pattern operator (<code>~</code>) provides a simple way to create a <code>java.util.regex.Pattern</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="pun">~</span><span class="str">/foo/</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Pattern</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>while in general, you find the pattern operator with an expression in a slashy-string, it can be used with any kind of
<code>String</code> in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">p </span><span class="pun">=</span><span class="pln"> </span><span class="pun">~</span><span class="str">'foo'</span><span class="pln">                                                        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
p </span><span class="pun">=</span><span class="pln"> </span><span class="pun">~</span><span class="str">"foo"</span><span class="pln">                                                        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
p </span><span class="pun">=</span><span class="pln"> </span><span class="pun">~</span><span class="pln">$</span><span class="pun">/</span><span class="pln">dollar</span><span class="pun">/</span><span class="pln">slashy $ </span><span class="kwd">string</span><span class="pun">/</span><span class="pln">$                                   </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
p </span><span class="pun">=</span><span class="pln"> </span><span class="pun">~</span><span class="str">"${pattern}"</span><span class="pln">                                                 </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>using single quote strings</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>using double quotes strings</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the dollar-slashy string lets you use slashes and the dollar sign without having to escape them</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>you can also use a GString!</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_find_operator"><a class="anchor" href="#_find_operator"></a>Find operator</h5>
<div class="paragraph">
<p>Alternatively to building a pattern, you can directly use the find operator <code>=~</code> to build a <code>java.util.regex.Matcher</code>
instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> text </span><span class="pun">=</span><span class="pln"> </span><span class="str">"some text to match"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> text </span><span class="pun">=~</span><span class="pln"> </span><span class="pun">/</span><span class="pln">match</span><span class="pun">/</span><span class="pln">                                           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> m </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Matcher</span><span class="pln">                                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                                         </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">(</span><span class="str">"Oops, text not found!"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>=~</code> creates a matcher against the <code>text</code> variable, using the pattern on the right hand side</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the return type of <code>=~</code> is a <code>Matcher</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>equivalent to calling <code>if (!m.find())</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Since a <code>Matcher</code> coerces to a <code>boolean</code> by calling its <code>find</code> method, the <code>=~</code> operator is consistent with the simple
use of Perl’s <code>=~</code> operator, when it appears as a predicate (in <code>if</code>, <code>while</code>, etc.).</p>
</div>
</div>
<div class="sect4">
<h5 id="_match_operator"><a class="anchor" href="#_match_operator"></a>Match operator</h5>
<div class="paragraph">
<p>The match operator (<code>==~</code>) is a slight variation of the find operator, that does not return a <code>Matcher</code> but a boolean
and requires a strict match of the input string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">m </span><span class="pun">=</span><span class="pln"> text </span><span class="pun">==~</span><span class="pln"> </span><span class="pun">/</span><span class="pln">match</span><span class="pun">/</span><span class="pln">                                              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> m </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pln">                                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                                          </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">(</span><span class="str">"Should not reach that point!"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>==~</code> matches the subject with the regular expression, but match must be strict</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the return type of <code>==~</code> is therefore a <code>boolean</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>equivalent to calling <code>if (text ==~ /match/)</code></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_operators"><a class="anchor" href="#_other_operators"></a>1.2.8. Other operators</h4>
<div class="sect4">
<h5 id="_spread_operator"><a class="anchor" href="#_spread_operator"></a>Spread operator</h5>
<div class="paragraph">
<p>The Spread Operator (<code>*.</code>) is used to invoke an action on all items of an aggregate object. It is equivalent to calling the action on each item
and collecting the result into a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Car</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> make
    </span><span class="typ">String</span><span class="pln"> model
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> cars </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
       </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln">make</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Peugeot'</span><span class="pun">,</span><span class="pln"> model</span><span class="pun">:</span><span class="pln"> </span><span class="str">'508'</span><span class="pun">),</span><span class="pln">
       </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln">make</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Renault'</span><span class="pun">,</span><span class="pln"> model</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Clio'</span><span class="pun">)]</span><span class="pln">       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> makes </span><span class="pun">=</span><span class="pln"> cars</span><span class="pun">*.</span><span class="pln">make                                </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> makes </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Peugeot'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Renault'</span><span class="pun">]</span><span class="pln">                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>build a list of <code>Car</code> items. The list is an aggregate of objects.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>call the spread operator on the list, accessing the <code>make</code> property of each item</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>returns a list of strings corresponding to the collection of <code>make</code> items</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The spread operator is null-safe, meaning that if an element of the 
collection is null, it will return null instead of throwing a <code>NullPointerException</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">cars </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
   </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln">make</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Peugeot'</span><span class="pun">,</span><span class="pln"> model</span><span class="pun">:</span><span class="pln"> </span><span class="str">'508'</span><span class="pun">),</span><span class="pln">
   </span><span class="kwd">null</span><span class="pun">,</span><span class="pln">                                              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
   </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln">make</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Renault'</span><span class="pun">,</span><span class="pln"> model</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Clio'</span><span class="pun">)]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> cars</span><span class="pun">*.</span><span class="pln">make </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Peugeot'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Renault'</span><span class="pun">]</span><span class="pln">     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">*.</span><span class="pln">make </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">                             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>build a list for which of of the elements is <code>null</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>using the spread operator will <strong>not</strong> throw a <code>NullPointerException</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the receiver might also be null, in which case the return value is <code>null</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The spread operator can be used on any class which implements the <code>Iterable</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Component</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Long</span><span class="pln"> id
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CompositeObject</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Iterable</span><span class="pun">&lt;</span><span class="typ">Component</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> components </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Component</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Foo'</span><span class="pun">),</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Component</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Bar'</span><span class="pun">)]</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="typ">Iterator</span><span class="pun">&lt;</span><span class="typ">Component</span><span class="pun">&gt;</span><span class="pln"> iterator</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        components</span><span class="pun">.</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> composite </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompositeObject</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> composite</span><span class="pun">*.</span><span class="pln">id </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> composite</span><span class="pun">*.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Foo'</span><span class="pun">,</span><span class="str">'Bar'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_spreading_method_arguments"><a class="anchor" href="#_spreading_method_arguments"></a>Spreading method arguments</h6>
<div class="paragraph">
<p>There may be situations when the arguments of a method call can be found in a list that you need to adapt to the method
arguments. In such situations, you can use the spread operator to call the method. For example, imagine you have the
following method signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> z</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x</span><span class="pun">*</span><span class="pln">y</span><span class="pun">+</span><span class="pln">z
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>then if you have the following list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> args </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">,</span><span class="lit">6</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>you can call the method without having to define intermediate variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(*</span><span class="pln">args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">26</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is even possible to mix normal arguments with spread ones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">args </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(*</span><span class="pln">args</span><span class="pun">,</span><span class="lit">5</span><span class="pun">,</span><span class="lit">6</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">26</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_spread_list_elements"><a class="anchor" href="#_spread_list_elements"></a>Spread list elements</h6>
<div class="paragraph">
<p>When used inside a list literal, the spread operator acts as if the spread element contents were inlined into the list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> items </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">]</span><span class="pln">                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,*</span><span class="pln">items</span><span class="pun">,</span><span class="lit">6</span><span class="pun">]</span><span class="pln">            </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">,</span><span class="lit">6</span><span class="pun">]</span><span class="pln">           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>items</code> is a list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we want to insert the contents of the <code>items</code> list directly into <code>list</code> without having to call <code>addAll</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the contents of <code>items</code> has been inlined into <code>list</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_spread_map_elements"><a class="anchor" href="#_spread_map_elements"></a>Spread map elements</h6>
<div class="paragraph">
<p>The spread map operator works in a similar manner as the spread list operator, but for maps. It allows you to inline
the contents of a map into another map literal, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> m1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">c</span><span class="pun">:</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">:</span><span class="lit">4</span><span class="pun">]</span><span class="pln">                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">a</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">:</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">*:</span><span class="pln">m1</span><span class="pun">]</span><span class="pln">            </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="pln">a</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">:</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">:</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">:</span><span class="lit">4</span><span class="pun">]</span><span class="pln">    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>m1</code> is the map that we want to inline</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we use the <code>*:m1</code> notation to spread the contents of <code>m1</code> into <code>map</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>map</code> contains all the elements of <code>m1</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The position of the spread map operator is relevant, like illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> m1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">c</span><span class="pun">:</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">:</span><span class="lit">4</span><span class="pun">]</span><span class="pln">                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">a</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">:</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">*:</span><span class="pln">m1</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">:</span><span class="pln"> </span><span class="lit">8</span><span class="pun">]</span><span class="pln">      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="pln">a</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">:</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">:</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> d</span><span class="pun">:</span><span class="lit">8</span><span class="pun">]</span><span class="pln">    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>m1</code> is the map that we want to inline</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we use the <code>*:m1</code> notation to spread the contents of <code>m1</code> into <code>map</code>, but redefine the key <code>d</code> <strong>after</strong> spreading</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>map</code> contains all the expected keys, but <code>d</code> was redefined</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_range_operator"><a class="anchor" href="#_range_operator"></a>Range operator</h5>
<div class="paragraph">
<p>Groovy supports the concept of ranges and provides a notation (<code>..</code>) to create ranges of objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> range </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="lit">5</span><span class="pln">                                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0.</span><span class="pun">.</span><span class="lit">5</span><span class="pun">).</span><span class="pln">collect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]</span><span class="pln">       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0.</span><span class="pun">.&lt;</span><span class="lit">5</span><span class="pun">).</span><span class="pln">collect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">]</span><span class="pln">         </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0.</span><span class="pun">.</span><span class="lit">5</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">List</span><span class="pln">                       </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0.</span><span class="pun">.</span><span class="lit">5</span><span class="pun">).</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">6</span><span class="pln">                           </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a simple range of integers, stored into a local variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>an <code>IntRange</code>, with inclusive bounds</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>an <code>IntRange</code>, with exclusive upper bound</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a <code>groovy.lang.Range</code> implements the <code>List</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>meaning that you can call the <code>size</code> method on it</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Ranges implementation is lightweight, meaning that only the lower and upper bounds are stored. You can create a range
from any <code>Comparable</code> object that has <code>next()</code> and <code>previous()</code> methods to determine the next / previous item in the range.
For example, you can create a range of characters this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="str">'a'</span><span class="pun">..</span><span class="str">'d'</span><span class="pun">).</span><span class="pln">collect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'d'</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_spaceship_operator"><a class="anchor" href="#_spaceship_operator"></a>Spaceship operator</h5>
<div class="paragraph">
<p>The spaceship operator (<code>&lt;=&gt;</code>) delegates to the <code>compareTo</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;=&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">&lt;=&gt;</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="lit">2</span><span class="pln"> </span><span class="pun">&lt;=&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="str">'a'</span><span class="pln"> </span><span class="pun">&lt;=&gt;</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="subscript-operator"><a class="anchor" href="#subscript-operator"></a>Subscript operator</h5>
<div class="paragraph">
<p>The subscript operator is a short hand notation for <code>getAt</code> or <code>putAt</code>, depending on whether you find it on
the left hand side or the right hand side of an assignment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">,</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">                         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
list</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pln">                                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">[</span><span class="lit">0.</span><span class="pun">.</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">,</span><span class="lit">1</span><span class="pun">,</span><span class="lit">4</span><span class="pun">]</span><span class="pln">                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
list</span><span class="pun">[</span><span class="lit">0.</span><span class="pun">.</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">6</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">6</span><span class="pun">]</span><span class="pln">                        </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">6</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">]</span><span class="pln">                  </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>[2]</code> can be used instead of <code>getAt(2)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if on left hand side of an assignment, will call <code>putAt</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>getAt</code> also supports ranges</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>so does <code>putAt</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the list is mutated</td>
</tr>
</tbody></table>
</div>
<div id="custom-subscript-operator" class="paragraph">
<p>The subscript operator, in combination with a custom implementation of <code>getAt</code>/<code>putAt</code> is a convenient way for destructuring
objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Long</span><span class="pln"> id
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">def</span><span class="pln"> getAt</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> id
            </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> name
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalArgumentException</span><span class="pun">(</span><span class="str">"No such element $i"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> putAt</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">return</span><span class="pln">
            </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">return</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalArgumentException</span><span class="pun">(</span><span class="str">"No such element $i"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> user </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Alex'</span><span class="pun">)</span><span class="pln">                           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> user</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">                                                </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> user</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Alex'</span><span class="pln">                                           </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
user</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln">                                                    </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> user</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln">                                          </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>User</code> class defines a custom <code>getAt</code> implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>User</code> class defines a custom <code>putAt</code> implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a sample user</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>using the subscript operator with index 0 allows retrieving the user id</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>using the subscript operator with index 1 allows retrieving the user name</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>we can use the subscript operator to write to a property thanks to the delegation to <code>putAt</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>and check that it’s really the property <code>name</code> which was changed</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_membership_operator"><a class="anchor" href="#_membership_operator"></a>Membership operator</h5>
<div class="paragraph">
<p>The membership operator (<code>in</code>) is equivalent to calling the <code>isCase</code> method. In the context of a <code>List</code>, it is equivalent
to calling <code>contains</code>, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Grace'</span><span class="pun">,</span><span class="str">'Rob'</span><span class="pun">,</span><span class="str">'Emmy'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="str">'Emmy'</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> list</span><span class="pun">)</span><span class="pln">                     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>equivalent to calling <code>list.contains('Emmy')</code> or <code>list.isCase('Emmy')</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_identity_operator"><a class="anchor" href="#_identity_operator"></a>Identity operator</h5>
<div class="paragraph">
<p>In Groovy, using <code>==</code> to test equality is different from using the same operator in Java. In Groovy, it is calling <code>equals</code>.
If you want to compare reference equality, you should use <code>is</code> like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Groovy 1.8'</span><span class="pun">,</span><span class="str">'Groovy 2.0'</span><span class="pun">,</span><span class="str">'Groovy 2.3'</span><span class="pun">]</span><span class="pln">        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> list2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Groovy 1.8'</span><span class="pun">,</span><span class="str">'Groovy 2.0'</span><span class="pun">,</span><span class="str">'Groovy 2.3'</span><span class="pun">]</span><span class="pln">        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list1 </span><span class="pun">==</span><span class="pln"> list2                                       </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">list1</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="pln">list2</span><span class="pun">)</span><span class="pln">                                     </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create a list of strings</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create another list of strings containing the same elements</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>using <code>==</code>, we test object equality</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but using <code>is</code>, we can check that references are distinct</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_coercion_operator"><a class="anchor" href="#_coercion_operator"></a>Coercion operator</h5>
<div class="paragraph">
<p>The coercion operator (<code>as</code>) is a variant of casting. Coercion converts object from one type to another <strong>without</strong> them
being compatible for assignment. Let’s take an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Integer</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">123</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> x                                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Integer</code> is not assignable to a <code>String</code>, so it will produce a <code>ClassCastException</code> at runtime</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This can be fixed by using <em>coercion</em> instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Integer</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">123</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> x </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">String</span><span class="pln">                                  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Integer</code> is not assignable to a <code>String</code>, but use of <code>as</code> will <em>coerce</em> it to a <code>String</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When an object is coerced into another, unless the target type is the same as the source type, coercion will return a
<strong>new</strong> object. The rules of coercion differ depending on the source and target types, and coercion may fail if no conversion
rules are found. Custom conversion rules may be implemented thanks to the <code>asType</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Identifiable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Long</span><span class="pln"> id
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">def</span><span class="pln"> asType</span><span class="pun">(</span><span class="typ">Class</span><span class="pln"> target</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">target</span><span class="pun">==</span><span class="typ">Identifiable</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Identifiable</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> name</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ClassCastException</span><span class="pun">(</span><span class="str">"User cannot be coerced into $target"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Xavier'</span><span class="pun">)</span><span class="pln">                                            </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> u </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Identifiable</span><span class="pln">                                                   </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Identifiable</span><span class="pln">                                            </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!(</span><span class="pln">p </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">User</span><span class="pun">)</span><span class="pln">                                                 </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>User</code> class defines a custom conversion rule from <code>User</code> to <code>Identifiable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we create an instance of <code>User</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we coerce the <code>User</code> instance into an <code>Identifiable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the target is an instance of <code>Identifiable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the target is not an instance of <code>User</code> anymore</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_diamond_operator"><a class="anchor" href="#_diamond_operator"></a>Diamond operator</h5>
<div class="paragraph">
<p>The diamond operator (<code>&lt;&gt;</code>) is a syntactic sugar only operator added to support compatibility with the operator of the
same name in Java 7. It is used to indicate that generic types should be inferred from the declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> strings </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">&lt;&gt;()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In dynamic Groovy, this is totally unused. In statically type checked Groovy, it is also optional since the Groovy
type checker performs type inference whether this operator is present or not.</p>
</div>
</div>
<div class="sect4">
<h5 id="_call_operator"><a class="anchor" href="#_call_operator"></a>Call operator</h5>
<div class="paragraph">
<p>The call operator <code>()</code> is used to call a method named <code>call</code> implicitly. For any object which defines a <code>call</code> method,
 you can omit the <code>.call</code> part and use the call operator instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyCallable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> call</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="lit">2</span><span class="pun">*</span><span class="pln">x
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> mc </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyCallable</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> mc</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> mc</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>MyCallable</code> defines a method named <code>call</code>. Note that it doesn’t need to implement <code>java.util.concurrent.Callable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can call the method using the classic method call syntax</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>or we can omit <code>.call</code> thanks to the call operator</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_operator_precedence"><a class="anchor" href="#_operator_precedence"></a>1.2.9. Operator precedence</h4>
<div class="paragraph">
<p>The table below lists all groovy operators in order of precedence.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Level</th>
<th class="tableblock halign-left valign-top">Operator(s)</th>
<th class="tableblock halign-left valign-top">Name(s)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>new</code> &nbsp; <code>()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object creation, explicit parentheses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>()</code> &nbsp; <code>{}</code> &nbsp; <code>[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">method call, closure, literal list/map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.</code> &nbsp; <code>.&amp;</code> &nbsp; <code>.@</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">member access, method closure, field/attribute access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>?.</code> &nbsp; <code>*</code> &nbsp; <code>*.</code> &nbsp; <code>*:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">safe dereferencing, spread, spread-dot, spread-map</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~</code> &nbsp; <code>!</code> &nbsp; <code>(type)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bitwise negate/pattern, not, typecast</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[]</code> &nbsp; <code>++</code> &nbsp; <code>--</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list/map/array index, post inc/decrement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>**</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">power</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>++</code> &nbsp; <code>--</code> &nbsp; <code>+</code> &nbsp; <code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pre inc/decrement, unary plus, unary minus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code> &nbsp; <code>/</code> &nbsp; <code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">multiply, div, remainder</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code> &nbsp; <code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">addition, subtraction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&lt;</code> &nbsp; <code>&gt;&gt;</code> &nbsp; <code>&gt;&gt;&gt;</code> &nbsp; <code>..</code> &nbsp; <code>..&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">left/right (unsigned) shift, inclusive/exclusive range</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code> &nbsp; <code>&lt;=</code> &nbsp; <code>&gt;</code> &nbsp; <code>&gt;=</code> &nbsp; <code>in</code> &nbsp; <code>instanceof</code> &nbsp; <code>as</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">less/greater than/or equal, in, instanceof, type coercion</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>==</code> &nbsp; <code>!=</code> &nbsp; <code>&lt;=&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">equals, not equals, compare to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=~</code> &nbsp; <code>==~</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">regex find, regex match</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">binary/bitwise and</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">binary/bitwise xor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">binary/bitwise or</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical and</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>||</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logical or</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>? :</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ternary conditional</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>?:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">elvis operator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code> &nbsp; <code>**=</code> &nbsp; <code>*=</code> &nbsp; <code>/=</code> &nbsp; <code>%=</code> &nbsp; <code>+=</code> &nbsp; <code>-=</code> &nbsp;<br>
<code>&lt;&lt;=</code> &nbsp; <code>&gt;&gt;=</code> &nbsp; <code>&gt;&gt;&gt;=</code> &nbsp; <code>&amp;=</code> &nbsp; <code>^=</code> &nbsp; <code>|=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">various assignments</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Operator-Overloading"><a class="anchor" href="#Operator-Overloading"></a>1.2.10. Operator overloading</h4>
<div class="paragraph">
<p>Groovy allows you to overload the various operators so that they can be used with your own classes. Consider this simple
class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bucket</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> size

    </span><span class="typ">Bucket</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> size</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">size </span><span class="pun">=</span><span class="pln"> size </span><span class="pun">}</span><span class="pln">

    </span><span class="typ">Bucket</span><span class="pln"> plus</span><span class="pun">(</span><span class="typ">Bucket</span><span class="pln"> other</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bucket</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">size </span><span class="pun">+</span><span class="pln"> other</span><span class="pun">.</span><span class="pln">size</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Bucket</code> implements a special method called <code>plus()</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Just by implementing the <code>plus()</code> method, the <code>Bucket</code> class can now be used with the <code>+</code> operator like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> b1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bucket</span><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> b2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bucket</span><span class="pun">(</span><span class="lit">11</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b1 </span><span class="pun">+</span><span class="pln"> b2</span><span class="pun">).</span><span class="pln">size </span><span class="pun">==</span><span class="pln"> </span><span class="lit">15</span><span class="pln">                         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The two <code>Bucket</code> objects can be added together with the <code>+</code> operator</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>All (non-comparator) Groovy operators have a corresponding method that you can implement in your own classes. The only
requirements are that your method is public, has the correct name, and has the correct number of arguments. The argument
types depend on what types you want to support on the right hand side of the operator. For example, you could support
the statement</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="pln">b1 </span><span class="pun">+</span><span class="pln"> </span><span class="lit">11</span><span class="pun">).</span><span class="pln">size </span><span class="pun">==</span><span class="pln"> </span><span class="lit">15</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>by implementing the <code>plus()</code> method with this signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Bucket</span><span class="pln"> plus</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> capacity</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bucket</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">size </span><span class="pun">+</span><span class="pln"> capacity</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a complete list of the operators and their corresponding methods:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.plus(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.getAt(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.minus(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b] = c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.putAt(b, c)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.multiply(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a in b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">b.isCase(a)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.div(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.leftShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.mod(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>**</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.power(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;&gt;&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShiftUnsigned(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.or(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>++</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.next()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.and(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.previous()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.xor(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.positive()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>as</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.asType(b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.negative()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.call()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.bitwiseNegate()</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_program_structure"><a class="anchor" href="#_program_structure"></a>1.3. Program structure</h3>
<div class="paragraph">
<p>This chapter covers the program structure of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_package_names"><a class="anchor" href="#_package_names"></a>1.3.1. Package names</h4>
<div class="paragraph">
<p>Package names play exactly the same role as in Java. They allows us 
to separate the code base without any conflicts. Groovy classes must 
specify their package before the class definition, else the default 
package is assumed.</p>
</div>
<div class="paragraph">
<p>Defining a package is very similar to Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// defining a package named com.yoursite</span><span class="pln">
</span><span class="kwd">package</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">yoursite</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To refer to some class <code>Foo</code> in the <code>com.yoursite.com</code> package you will need to use the fully qualified name <code>com.yoursite.com.Foo</code>, or else you can use an <code>import</code> statement as we’ll see below.</p>
</div>
</div>
<div class="sect3">
<h4 id="_imports"><a class="anchor" href="#_imports"></a>1.3.2. Imports</h4>
<div class="paragraph">
<p>In order to refer to any class you need a qualified reference to its package. Groovy follows Java’s notion of allowing <code>import</code> statement to resolve class references.</p>
</div>
<div class="paragraph">
<p>For example, Groovy provides several builder classes, such as <code>MarkupBuilder</code>. <code>MarkupBuilder</code> is inside the package <code>groovy.xml</code> so in order to use this class, you need to <code>import</code> it as shown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// importing the class MarkupBuilder</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="typ">MarkupBuilder</span><span class="pln">

</span><span class="com">// using the imported class to create an object</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> xml </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> xml </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_default_imports"><a class="anchor" href="#_default_imports"></a>Default imports</h5>
<div class="paragraph">
<p>Default imports are the imports that Groovy language provides by default. For example look at the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The same code in Java needs an import statement to <code>Date</code> class like this: import java.util.Date. Groovy by default imports these classes for you.</p>
</div>
<div class="paragraph">
<p>The below imports are added by groovy for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">net</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="typ">BigInteger</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">math</span><span class="pun">.</span><span class="typ">BigDecimal</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is done because the classes from these packages are most commonly used. By importing these boilerplate code is reduced.</p>
</div>
</div>
<div class="sect4">
<h5 id="_simple_import"><a class="anchor" href="#_simple_import"></a>Simple import</h5>
<div class="paragraph">
<p>A simple import is an import statement where you fully define the 
class name along with the package. For example the import statement 
import groovy.xml.MarkupBuilder in the code below is a simple import 
which directly refers to a class inside a package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// importing the class MarkupBuilder</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="typ">MarkupBuilder</span><span class="pln">

</span><span class="com">// using the imported class to create an object</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> xml </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> xml </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_star_import"><a class="anchor" href="#_star_import"></a>Star import</h5>
<div class="paragraph">
<p>Groovy, like Java, provides a special way to import all classes from a package using <code>*</code>, the so called star import. <code>MarkupBuilder</code> is a class which is in package <code>groovy.xml</code>, alongside another class called <code>StreamingMarkupBuilder</code>. In case you need to use both classes, you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="typ">MarkupBuilder</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="typ">StreamingMarkupBuilder</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> markupBuilder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> markupBuilder </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StreamingMarkupBuilder</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s perfectly valid code. But with a <code>*</code> import, we can achieve the same effect with just one line. The star imports all the classes under package <code>groovy.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.*</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> markupBuilder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> markupBuilder </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StreamingMarkupBuilder</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One problem with <code>*</code> imports is that they can clutter your
 local namespace. But with the kinds of aliasing provided by Groovy, 
this can be solved easily.</p>
</div>
</div>
<div class="sect4">
<h5 id="_static_import"><a class="anchor" href="#_static_import"></a>Static import</h5>
<div class="paragraph">
<p>Groovy’s static import capability allows you to reference imported classes as if they were static methods in your own class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Boolean</span><span class="pun">.</span><span class="pln">FALSE

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">FALSE </span><span class="com">//use directly, without Boolean prefix!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is similar to Java’s static import capability but is a more 
dynamic than Java in that it allows you to define methods with the same 
name as an imported method as long as you have different types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">String</span><span class="pun">.</span><span class="pln">format </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SomeClass</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> format</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        i</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> format</span><span class="pun">(</span><span class="str">'String'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'String'</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SomeClass</span><span class="pun">().</span><span class="pln">format</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="lit">1</span><span class="pun">))</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>static import of method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declaration of method with same name as method statically imported above, but with a different parameter type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>compile error in java, but is valid groovy code</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you have the same types, the imported class takes precedence.</p>
</div>
</div>
<div class="sect4">
<h5 id="_static_import_aliasing"><a class="anchor" href="#_static_import_aliasing"></a>Static import aliasing</h5>
<div class="paragraph">
<p>Static imports with the <code>as</code> keyword provide an elegant solution to namespace problems. Suppose you want to get a <code>Calendar</code> instance, using its <code>getInstance()</code> method. It’s a static method, so we can use a static import. But instead of calling <code>getInstance()</code>
 every time, which can be misleading when separated from its class name,
 we can import it with an alias, to increase code readability:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">getInstance </span><span class="kwd">as</span><span class="pln"> now

</span><span class="kwd">assert</span><span class="pln"> now</span><span class="pun">().</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">getInstance</span><span class="pun">().</span><span class="kwd">class</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, that’s clean!</p>
</div>
</div>
<div class="sect4">
<h5 id="_static_star_import"><a class="anchor" href="#_static_star_import"></a>Static star import</h5>
<div class="paragraph">
<p>A static star import is very similar to the regular star import. It will import all the static methods from the given class.</p>
</div>
<div class="paragraph">
<p>For example, lets say we need to calculate sines and cosines for our application.
The class <code>java.lang.Math</code> has static methods named <code>sin</code> and <code>cos</code> which fit our need. With the help of a static star import, we can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">Math</span><span class="pun">.*</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> sin</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0.0</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> cos</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, we were able to access the methods <code>sin</code> and <code>cos</code> directly, without the <code>Math.</code> prefix.</p>
</div>
</div>
<div class="sect4">
<h5 id="_import_aliasing"><a class="anchor" href="#_import_aliasing"></a>Import aliasing</h5>
<div class="paragraph">
<p>With type aliasing, we can refer to a fully qualified class name using a name of our choice. This can be done with the <code>as</code> keyword, as before.</p>
</div>
<div class="paragraph">
<p>For example we can import <code>java.sql.Date</code> as <code>SQLDate</code> and use it in the same file as <code>java.util.Date</code> without having to use the fully qualified name of either class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Date</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="typ">Date</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">SQLDate</span><span class="pln">

</span><span class="typ">Date</span><span class="pln"> utilDate </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">(</span><span class="lit">1000L</span><span class="pun">)</span><span class="pln">
</span><span class="typ">SQLDate</span><span class="pln"> sqlDate </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SQLDate</span><span class="pun">(</span><span class="lit">1000L</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> utilDate </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Date</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sqlDate </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="typ">Date</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_scripts_versus_classes"><a class="anchor" href="#_scripts_versus_classes"></a>1.3.3. Scripts versus classes</h4>
<div class="sect4">
<h5 id="_public_static_void_main_vs_script"><a class="anchor" href="#_public_static_void_main_vs_script"></a>public static void main vs script</h5>
<div class="paragraph">
<p>Groovy supports both scripts and classes. Take the following code for example:</p>
</div>
<div class="listingblock">
<div class="title">Main.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Main</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="typ">String</span><span class="pun">...</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        println </span><span class="str">'Groovy world!'</span><span class="pln">                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a <code>Main</code> class, the name is arbitrary</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>public static void main(String[])</code> method is usable as the main method of the class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the main body of the method</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This is typical code that you would find coming from Java, where code <strong>has</strong> to be embedded into a class to be executable.
Groovy makes it easier, the following code is equivalent:</p>
</div>
<div class="listingblock">
<div class="title">Main.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">println </span><span class="str">'Groovy world!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A script can be considered as a class without needing to declare it, with some differences.</p>
</div>
</div>
<div class="sect4">
<h5 id="_script_class"><a class="anchor" href="#_script_class"></a>Script class</h5>
<div class="paragraph">
<p>A <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/Script.html">script</a> is always compiled into a class. The Groovy compiler will compile the class for you,
with the body of the script copied into a <code>run</code> method. The previous example is therefore compiled as if it was the
following:</p>
</div>
<div class="listingblock">
<div class="title">Main.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">runtime</span><span class="pun">.</span><span class="typ">InvokerHelper</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Main</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Script</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        println </span><span class="str">'Groovy world!'</span><span class="pln">                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">           </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
        </span><span class="typ">InvokerHelper</span><span class="pun">.</span><span class="pln">runScript</span><span class="pun">(</span><span class="typ">Main</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln">     </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>Main</code> class extends the <code>groovy.lang.Script</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>groovy.lang.Script</code> requires a <code>run</code> method returning a value</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the script body goes into the <code>run</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <code>main</code> method is automatically generated</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>and delegates the execution of the script on the <code>run</code> method</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If the script is in a file, then the base name of the file is used to determine the name of the generated script class.
In this example, if the name of the file is <code>Main.groovy</code>, then the script class is going to be <code>Main</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_methods"><a class="anchor" href="#_methods"></a>Methods</h5>
<div class="paragraph">
<p>It is possible to define methods into a script, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> fib</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    n </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> fib</span><span class="pun">(</span><span class="lit">10</span><span class="pun">)==</span><span class="lit">89</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also mix methods and code. The generated script class will carry all methods into the script class, and
assemble all script bodies into the <code>run</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">println </span><span class="str">'Hello'</span><span class="pln">                                 </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">int</span><span class="pln"> power</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">2</span><span class="pun">**</span><span class="pln">n </span><span class="pun">}</span><span class="pln">                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

println </span><span class="str">"2^6==${power(6)}"</span><span class="pln">                      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>script begins</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a method is defined within the script body</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and script continues</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This code is internally converted into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">runtime</span><span class="pun">.</span><span class="typ">InvokerHelper</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Main</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Script</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> power</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">2</span><span class="pun">**</span><span class="pln"> n</span><span class="pun">}</span><span class="pln">                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">'Hello'</span><span class="pln">                         </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        println </span><span class="str">"2^6==${power(6)}"</span><span class="pln">              </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">InvokerHelper</span><span class="pun">.</span><span class="pln">runScript</span><span class="pun">(</span><span class="typ">Main</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>power</code> method is copied as is into the generated script class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>first statement is copied into the <code>run</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>second statement is copied into the <code>run</code> method</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Even if Groovy creates a class from your script, it is totally transparent for the user. In particular, scripts
are compiled to bytecode, and line numbers are preserved. This implies that if an exception is thrown in a script,
the stack trace will show line numbers corresponding to the original script, not the generated code that we have shown.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_variables"><a class="anchor" href="#_variables"></a>Variables</h5>
<div class="paragraph">
<p>Variables in a script do not require a type definition. This means that this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x</span><span class="pun">+</span><span class="pln">y </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>will behave the same as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x</span><span class="pun">+</span><span class="pln">y </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However there is a semantic difference between the two:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the variable is declared as in the first example, it is a <em>local variable</em>. It will be declared in the <code>run</code>
method that the compiler will generate and will <strong>not</strong> be visible outside of the script main body. In particular, such
a variable will <strong>not</strong> be visible in other methods of the script</p>
</li>
<li>
<p>if the variable is undeclared, it goes into the <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/Script.html#getBinding%28%29">script binding</a>. The binding is
visible from the methods, and is especially important if you use a script to interact with an application and need to
share data between the script and the application. Readers might refer to the
<a href="#_integrating_groovy_in_a_java_application">integration guide</a> for more information.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want a variable to become a field of the class without going into the <code>Binding</code>, you can use the
<a href="#xform-Field">@Field annotation</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_object_orientation"><a class="anchor" href="#_object_orientation"></a>1.4. Object orientation</h3>
<div class="paragraph">
<p>This chapter covers the object orientation of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_types"><a class="anchor" href="#_types"></a>1.4.1. Types</h4>
<div class="sect4">
<h5 id="_primitive_types"><a class="anchor" href="#_primitive_types"></a>Primitive types</h5>
<div class="paragraph">
<p>Groovy supports the same primitive types as those defined by the <a href="http://docs.oracle.com/javase/specs/jls/se8/html/">Java Language Specification</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>integral types: <code>byte</code> (8 bit), <code>short</code> (16 bit), <code>int</code> (32 bit) and <code>long</code> (64 bit)</p>
</li>
<li>
<p>floating-point types: <code>float</code> (32 bit) and <code>double</code> (64 bit)</p>
</li>
<li>
<p><code>boolean</code> type (exactly <code>true</code> or <code>false</code>)</p>
</li>
<li>
<p><code>char</code> type (16 bit, usable as a numeric type, representing an UTF-16 code)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While Groovy declares and stores primitive fields and variables as primitives, because it uses Objects for
everything, it autowraps references to primitives. Just like Java, the wrappers it uses are</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. primitive wrappers</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Primitive type</th>
<th class="tableblock halign-left valign-top">Wrapper class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">char</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Here’s an example using <code>int</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> i
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getDeclaredField</span><span class="pun">(</span><span class="str">'i'</span><span class="pun">).</span><span class="pln">type </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">.</span><span class="pln">i</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">.</span><span class="pln">i</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you may be concerned that this means every time you use a mathematical operator on a reference to a primitive
that you’ll incur the cost of unboxing and reboxing the primitive. But this is not the case, as Groovy will compile
your operators into their <a href="http://docs.groovy-lang.org/latest/html/documentation/core-operators.html#_operator-overloading">method equivalents</a> and uses those instead.
Additionally, Groovy will automatically unbox to a primitive when calling a Java method that takes a primitive
parameter and automatically box primitive method return values from Java. However, be aware there are some
<a href="http://docs.groovy-lang.org/latest/html/documentation/core-differences-java.html#_primitives_and_wrappers">differences</a> from Java’s method resolution.</p>
</div>
</div>
<div class="sect4">
<h5 id="_class"><a class="anchor" href="#_class"></a>Class</h5>
<div class="paragraph">
<p>Groovy classes are very similar to Java classes, being compatible to 
those ones at JVM level. They may have methods and fields/properties, 
which can have the same modifiers (public, protected, private, static, 
etc) as Java classes.</p>
</div>
<div class="paragraph">
<p>Here are key aspects of Groovy classes, that are different from their Java counterparts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Public fields are turned into properties automatically, which results in less verbose code,
without so many getter and setter methods. More on this aspect will be covered in the <a href="#fields">fields and properties section</a>.</p>
</li>
<li>
<p>Their declarations and any property or method without an access modifier are public.</p>
</li>
<li>
<p>Classes do not need to have the same name of the files where they are defined.</p>
</li>
<li>
<p>One file may contain one or more classes (but if a file contains no classes, it is considered a script).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following code presents an example class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

    </span><span class="typ">String</span><span class="pln"> name                      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">Integer</span><span class="pln"> age

    </span><span class="kwd">def</span><span class="pln"> increaseAge</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> years</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">age </span><span class="pun">+=</span><span class="pln"> years
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class beginning, with the name <code>Person</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>string field and property named <code>name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>method definition</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="_normal_class"><a class="anchor" href="#_normal_class"></a>Normal class</h6>
<div class="paragraph">
<p>Normal classes refer to classes which are top level and concrete. 
This means they can be instantiated without restrictions from any other 
classes or scripts. This way, they can only be public (even though the <code>public</code> keyword may be suppressed). Classes are instantiated by calling their constructors, using the <code>new</code> keyword, as in the following snippet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_inner_class"><a class="anchor" href="#_inner_class"></a>Inner class</h6>
<div class="paragraph">
<p>Inner classes are defined within another classes. The enclosing class
 can use the inner class as usual. On the other side, a inner class can 
access members of its enclosing class, even if they are private. Classes
 other than the enclosing class are not allowed to access inner classes.
 Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Outer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> privateStr

    </span><span class="kwd">def</span><span class="pln"> callInnerMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Inner</span><span class="pun">().</span><span class="pln">methodA</span><span class="pun">()</span><span class="pln">       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Inner</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> methodA</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            println </span><span class="str">"${privateStr}."</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the inner class is instantiated and its method gets called</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>inner class definition, inside its enclosing class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>even being private, a field of the enclosing class is accessed by the inner class</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>There are some reasons for using inner classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>They increase encapsulation by hiding the inner class from other 
classes, which do not need to know about it. This also leads to cleaner 
packages and workspaces.</p>
</li>
<li>
<p>They provide a good organization, by grouping classes that are used by only one class.</p>
</li>
<li>
<p>They lead to more maintainable codes, since inner classes are near the classes that use them.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In several cases, inner classes are implementation of interfaces 
whose methods are needed by the outer class. The code below illustrates 
this with the usage of threads, which are very common.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Outer2</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> privateStr </span><span class="pun">=</span><span class="pln"> </span><span class="str">'some string'</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> startThread</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Inner2</span><span class="pun">()).</span><span class="pln">start</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Inner2</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Runnable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            println </span><span class="str">"${privateStr}."</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the class <code>Inner2</code> is defined only to provide an implementation of the method <code>run</code> to class <code>Outer2</code>. Anonymous inner classes help to eliminate verbosity in this case.</p>
</div>
<div class="sect6">
<h7 id="_anonymous_inner_class"><a class="anchor" href="#_anonymous_inner_class"></a>Anonymous inner class</h7>
<div class="paragraph">
<p>The last example of inner class can be simplified with an anonymous 
inner class. The same functionality can be achieved with the following 
code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Outer3</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> privateStr </span><span class="pun">=</span><span class="pln"> </span><span class="str">'some string'</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> startThread</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Runnable</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
            </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                println </span><span class="str">"${privateStr}."</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}).</span><span class="pln">start</span><span class="pun">()</span><span class="pln">                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>comparing with the last example of previous section, the <code>new Inner2()</code> was replaced by <code>new Runnable()</code> along with all its implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the method <code>start</code> is invoked normally</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Thus, there was no need to define a new class to be used just once.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_abstract_class"><a class="anchor" href="#_abstract_class"></a>Abstract class</h6>
<div class="paragraph">
<p>Abstract classes represent generic concepts, thus, they cannot be 
instantiated, being created to be subclassed. Their members include 
fields/properties and abstract or concrete methods. Abstract methods do 
not have implementation, and must be implemented by concrete subclasses.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Abstract</span><span class="pln"> </span><span class="pun">{</span><span class="pln">         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name

    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> abstractMethod</span><span class="pun">()</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> concreteMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">'concrete'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>abstract classes must be declared with <code>abstract</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>abstract methods must also be declared with <code>abstract</code> keyword</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Abstract classes are commonly compared to interfaces. But there are 
at least two important differences of choosing one or another. First, 
while abstract classes may contain fields/properties and concrete 
methods, interfaces may contain only abstract methods (method 
signatures). Moreover, one class can implement several interfaces, 
whereas it can extend just one class, abstract or not.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_interface"><a class="anchor" href="#_interface"></a>Interface</h5>
<div class="paragraph">
<p>An interface defines a contract that a class needs to conform to. An interface only defines a list of methods that need
to be implemented, but does not define the methods implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln">                                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>an interface needs to be declared using the <code>interface</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>an interface only defines method signatures</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Methods of an interface are always <strong>public</strong>. It is an error to use <code>protected</code> or <code>private</code> methods in interfaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln">           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using <code>protected</code> is a compile-time error</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>A class <em>implements</em> an interface if it defines the interface in its <code>implements</code> list or if any of its superclasses
does:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SystemGreeter</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                               </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        println </span><span class="str">"Hello $name"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> greeter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SystemGreeter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> greeter </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln">                           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>SystemGreeter</code> declares the <code>Greeter</code> interface using the <code>implements</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Then implements the required <code>greet</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Any instance of <code>SystemGreeter</code> is also an instance of the <code>Greeter</code> interface</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>An interface can extend another interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">ExtendedGreeter</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                 </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> sayBye</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>ExtendedGreeter</code> interface extends the <code>Greeter</code> interface using the <code>extends</code> keyword</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is worth noting that for a class to be an instance of an interface, it has to be explicit. For example, the following
class defines the <code>greet</code> method as it is declared in the <code>Greeter</code> interface, but does not declare <code>Greeter</code> in its
interfaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">DefaultGreeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Hello"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

greeter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DefaultGreeter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!(</span><span class="pln">greeter </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In other words, Groovy does not define structural typing. It is however possible to make an instance of an object
implement an interface at runtime, using the <code>as</code> coercion operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">greeter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DefaultGreeter</span><span class="pun">()</span><span class="pln">                              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
coerced </span><span class="pun">=</span><span class="pln"> greeter </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln">                                </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> coerced </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln">                           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create an instance of <code>DefaultGreeter</code> that does not implement the interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>coerce the instance into a <code>Greeter</code> at runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the coerced instance implements the <code>Greeter</code> interface</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can see that there are two distinct objects: one is the source object, a <code>DefaultGreeter</code> instance, which does not
implement the interface. The other is an instance of <code>Greeter</code> that delegates to the coerced object.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Groovy interfaces do not support default implementation like Java 8 interfaces. If you are looking for something
similar (but not equal), <a href="#_traits">traits</a> are close to interfaces, but allow default implementation as well as other
important features described in this manual.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_constructors"><a class="anchor" href="#_constructors"></a>Constructors</h5>
<div class="paragraph">
<p>Constructors are special methods used to initialize an object with a 
specific state. As in normal methods, it is possible for a class to 
declare more than one constructor. In Groovy there are two ways to 
invoke constructors: with positional parameters or named parameters. The
 former one is like we invoke Java constructors, while the second way 
allows one to specify the parameter names when invoking the constructor.</p>
</div>
<div class="sect5">
<h6 id="_positional_argument_constructor"><a class="anchor" href="#_positional_argument_constructor"></a>Positional argument constructor</h6>
<div class="paragraph">
<p>To create an object by using positional argument constructors, the 
respective class needs to declare each of the constructors it allows 
being called. A side effect of this is that, once at least one 
constructor is declared, the class can only be instantiated by getting 
one of its constructors called. It is worth noting that, in this case, 
there is no way to create the class with named parameters.</p>
</div>
<div class="paragraph">
<p>There is three forms of using a declared constructor. The first one is the normal Java way, with the <code>new</code> keyword. The others rely on coercion of lists into the desired types. In this case, it is possible to coerce with the <code>as</code> keyword and by statically typing the variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonConstructor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="typ">Integer</span><span class="pln"> age

    </span><span class="typ">PersonConstructor</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">age </span><span class="pun">=</span><span class="pln"> age
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> person1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonConstructor</span><span class="pun">(</span><span class="str">'Marie'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> person2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Marie'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">PersonConstructor</span><span class="pln">  </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">PersonConstructor</span><span class="pln"> person3 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Marie'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">         </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Constructor declaration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Constructor invocation, classic Java way</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Constructor usage, using coercion with <code>as</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Constructor usage, using coercion in assignment</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_named_argument_constructor"><a class="anchor" href="#_named_argument_constructor"></a>Named argument constructor</h6>
<div class="paragraph">
<p>If no constructor is declared, it is possible to create objects by 
passing parameters in the form of a map (property/value pairs). This can
 be in handy in cases where one wants to allow several combinations of 
parameters. Otherwise, by using traditional positional parameters it 
would be necessary to declare all possible constructors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonWOConstructor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="typ">Integer</span><span class="pln"> age
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> person4 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonWOConstructor</span><span class="pun">()</span><span class="pln">                      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> person5 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonWOConstructor</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Marie'</span><span class="pun">)</span><span class="pln">         </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> person6 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonWOConstructor</span><span class="pun">(</span><span class="pln">age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">                </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> person7 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonWOConstructor</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Marie'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>No constructor declared</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>No parameters given in the instantiation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>name</code> parameter given in the instantiation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>age</code> parameter given in the instantiation</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>name</code> and <code>age</code> parameters given in the instantiation</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is important to highlight, however, that this approach gives more 
power to the constructor caller, while imposes a major responsibility to
 it. Thus, if a restriction is needed, one can just declare one or more 
constructors, and the instantiation by named parameters will no longer 
be available.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_methods_2"><a class="anchor" href="#_methods_2"></a>Methods</h5>
<div class="paragraph">
<p>Groovy methods are quite similar to other languages. Some peculiarities will be shown in the next subsections.</p>
</div>
<div class="sect5">
<h6 id="_method_definition"><a class="anchor" href="#_method_definition"></a>Method definition</h6>
<div class="paragraph">
<p>A method is defined with a return type or with the <code>def</code> 
keyword, to make the return type untyped. A method can also receive any 
number of arguments, which may not have their types explicitly declared.
 Java modifiers can be used normally, and if no visibility modifier is 
provided, the method is public.</p>
</div>
<div class="paragraph">
<p>Methods in Groovy always return some value. If no <code>return</code>
 statement is provided, the value evaluated in the last line executed 
will be returned. For instance, note that none of the following methods 
uses the <code>return</code> keyword.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> someMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'method called'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">String</span><span class="pln"> anotherMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'another method called'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">             </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> thirdMethod</span><span class="pun">(</span><span class="pln">param1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"$param1 passed"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                   </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">static</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> fourthMethod</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> param1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"$param1 passed"</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method with no return type declared and no parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Method with explicit return type and no parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Method with a parameter with no type defined</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Static method with a String parameter</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_named_arguments"><a class="anchor" href="#_named_arguments"></a>Named arguments</h6>
<div class="paragraph">
<p>Like constructors, normal methods can also be called with named 
arguments. They need to receive the parameters as a map. In the method 
body, the values can be accessed as in normal maps (<code>map.key</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> foo</span><span class="pun">(</span><span class="typ">Map</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"${args.name}: ${args.age}"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
foo</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Marie'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_default_arguments"><a class="anchor" href="#_default_arguments"></a>Default arguments</h6>
<div class="paragraph">
<p>Default arguments make parameters optional. If the argument is not supplied, the method assumes a default value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> foo</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> par1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> par2 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> par1</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> par2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">(</span><span class="str">'Marie'</span><span class="pun">).</span><span class="pln">age </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that no mandatory parameter can be defined after a default parameter is present, only other default parameters.</p>
</div>
</div>
<div class="sect5">
<h6 id="_varargs"><a class="anchor" href="#_varargs"></a>Varargs</h6>
<div class="paragraph">
<p>Groovy supports methods with a variable number of arguments. They are defined like this: <code>def foo(p1, …​, pn, T…​ args)</code>.
Here <code>foo</code> supports <code>n</code> arguments by default, but also an unspecified number of further arguments exceeding <code>n</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> foo</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">...</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> args</span><span class="pun">.</span><span class="pln">length </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example defines a method <code>foo</code>, that can take any number of arguments, including no arguments at all.
<code>args.length</code> will return the number of arguments given. Groovy allows <code>T[]</code> as a alternative notation to <code>T…​</code>.
That means any method with an array as last parameter is seen by Groovy 
as a method that can take a variable number of arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> foo</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> args</span><span class="pun">.</span><span class="pln">length </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If a method with varargs is called with <code>null</code> as the vararg parameter, then the argument will be <code>null</code> and not an array of length one with <code>null</code> as the only element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> foo</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">...</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> args </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If a varargs method is called with an array as an argument, then the 
argument will be that array instead of an array of length one containing
 the given array as the only element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> foo</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">...</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> args </span><span class="pun">}</span><span class="pln">
</span><span class="typ">Integer</span><span class="pun">[]</span><span class="pln"> ints </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">(</span><span class="pln">ints</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another important point are varargs in combination with method 
overloading. In case of method overloading Groovy will select the most 
specific method.
For example if a method <code>foo</code> takes a varargs argument of type <code>T</code> and another method <code>foo</code> also takes one argument of type <code>T</code>, the second method is preferred.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> foo</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">...</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> foo</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_method_selection_algorithm"><a class="anchor" href="#_method_selection_algorithm"></a>Method selection algorithm</h6>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
<div class="sect5">
<h6 id="_exception_declaration"><a class="anchor" href="#_exception_declaration"></a>Exception declaration</h6>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fields_and_properties"><a class="anchor" href="#_fields_and_properties"></a>Fields and properties</h5>
<div class="sect5">
<h6 id="fields"><a class="anchor" href="#fields"></a>Fields</h6>
<div class="paragraph">
<p>A field is a member of a class or a trait which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a mandatory <em>access modifier</em> (<code>public</code>, <code>protected</code>, or <code>private</code>)</p>
</li>
<li>
<p>one or more optional <em>modifiers</em> (<code>static</code>, <code>final</code>, <code>synchronized</code>)</p>
</li>
<li>
<p>an optional <em>type</em></p>
</li>
<li>
<p>a mandatory <em>name</em></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Data</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> id                                  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> description                    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> DEBUG </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">       </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a <code>private</code> field named <code>id</code>, of type <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a <code>protected</code> field named <code>description</code>, of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>a <code>public static final</code> field named <em>DEBUG</em> of type <code>boolean</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>A field may be initialized directly at declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Data</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="typ">IDGenerator</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the private field <code>id</code> is initialized with <code>IDGenerator.next()</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is possible to omit the type declaration of a field. This is however considered a bad practice and in general it
is a good idea to use strong typing for fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">BadPractice</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> mapping                         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GoodPractice</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> mapping      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the field <code>mapping</code> doesn’t declare a type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the field <code>mapping</code> has a strong type</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The difference between the two is important if you want to use optional type checking later. It is also important
for documentation. However in some cases like scripting or if you want to rely on duck typing it may be interesting
to omit the type.</p>
</div>
</div>
<div class="sect5">
<h6 id="properties"><a class="anchor" href="#properties"></a>Properties</h6>
<div class="paragraph">
<p>A property is a combination of a private field and getters/setters. You can define a property with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an <strong>absent</strong> access modifier (no <code>public</code>, <code>protected</code> or <code>final</code>)</p>
</li>
<li>
<p>one or more optional <em>modifiers</em> (<code>static</code>, <code>final</code>, <code>synchronized</code>)</p>
</li>
<li>
<p>an optional <em>type</em></p>
</li>
<li>
<p>a mandatory <em>name</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy will then generate the getters/setters appropriately. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name                             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> age                                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>creates a backing <code>private String name</code> field, a <code>getName</code> and a <code>setName</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>creates a backing <code>private int age</code> field, a <code>getAge</code> and a <code>setAge</code> method</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If a property is declared <code>final</code>, no setter is generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> age                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">Person</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> age</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> name                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">age </span><span class="pun">=</span><span class="pln"> age                  </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>defines a read-only property of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>defines a read-only property of type <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>assigns the <code>name</code> parameter to the <code>name</code> field</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>assigns the <code>age</code> parameter to the <code>age</code> field</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Properties are accessed by name and will call the getter or setter transparently, unless the code is in the class
which defines the property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">void</span><span class="pln"> name</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Wonder$name"</span><span class="pln">       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> wonder</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">name                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">
p</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Marge'</span><span class="pln">                        </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Marge'</span><span class="pln">                </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
p</span><span class="pun">.</span><span class="pln">name</span><span class="pun">(</span><span class="str">'Marge'</span><span class="pun">)</span><span class="pln">                         </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">wonder</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'WonderMarge'</span><span class="pln">      </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>this.name</code> will directly access the field because the property is accessed from within the class that defines it</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>similarily a read access is done directly on the <code>name</code> field</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>write access to the property is done outside of the <code>Person</code> class so it will implicitly call <code>setName</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>read access to the property is done outside of the <code>Person</code> class so it will implicitly call <code>getName</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>this will call the <code>name</code> method on <code>Person</code> which performs a direct access to the field</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>this will call the <code>wonder</code> method on <code>Person</code> which performs a direct read access to the field</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is worth noting that this behavior of accessing the backing field directly is done in order to prevent a stack
overflow when using the property access syntax within a class that defines the property.</p>
</div>
<div class="paragraph">
<p>It is possible to list the properties of a class thanks to the meta <code>properties</code> field of an instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">properties</span><span class="pun">.</span><span class="pln">keySet</span><span class="pun">().</span><span class="pln">containsAll</span><span class="pun">([</span><span class="str">'name'</span><span class="pun">,</span><span class="str">'age'</span><span class="pun">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By convention, Groovy will recognize properties even if there is no backing field, if there are getters or setters
that follow the Java Beans specification. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">PseudoProperties</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// a pseudo property "name"</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> setName</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

    </span><span class="com">// a pseudo read-only property "age"</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> getAge</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">42</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    </span><span class="com">// a pseudo write-only property "groovy"</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> setGroovy</span><span class="pun">(</span><span class="kwd">boolean</span><span class="pln"> groovy</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PseudoProperties</span><span class="pun">()</span><span class="pln">
p</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Foo'</span><span class="pln">                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">age </span><span class="pun">==</span><span class="pln"> </span><span class="lit">42</span><span class="pln">                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
p</span><span class="pun">.</span><span class="pln">groovy </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">                     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>reading <code>p.name</code> is allowed because there is a pseudo-property <code>name</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>reading <code>p.age</code> is allowed because there is a pseudo-readonly property <code>age</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>writing <code>p.groovy</code> is allowed because there is a pseudo-writeonly property <code>groovy</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This syntactic sugar is at the core of many DSLs written in Groovy.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_annotation"><a class="anchor" href="#_annotation"></a>Annotation</h5>
<div class="sect5">
<h6 id="ann-definition"><a class="anchor" href="#ann-definition"></a>Annotation definition</h6>
<div class="paragraph">
<p>An annotation is a kind of special interface dedicated at annotating elements of the code. An annotation is a type which
superinterface is the <a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/annotation/Annotation.html">Annotation</a> interface. Annotations are declared in a very
similar way to interfaces, using the <code>@interface</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@interface</span><span class="pln"> </span><span class="typ">SomeAnnotation</span><span class="pln"> </span><span class="pun">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An annotation may define members in the form of methods without bodies and an optional default value. The possible
member types are limited to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>primitive types</p>
</li>
<li>
<p><a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/String.html">Strings</a></p>
</li>
<li>
<p><a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/Class.html">Classes</a></p>
</li>
<li>
<p>an <a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/Enum.html">enumeration</a></p>
</li>
<li>
<p>another <a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/annotation/Annotation.html">annotation type</a></p>
</li>
<li>
<p>or any array of the above</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@interface</span><span class="pln"> </span><span class="typ">SomeAnnotation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> value</span><span class="pun">()</span><span class="pln">                          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">SomeAnnotation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> value</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="str">'something'</span><span class="pln">      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">SomeAnnotation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> step</span><span class="pun">()</span><span class="pln">                              </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">SomeAnnotation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Class</span><span class="pln"> appliesTo</span><span class="pun">()</span><span class="pln">                       </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">SomeAnnotation</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">SomeAnnotations</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">SomeAnnotation</span><span class="pun">[]</span><span class="pln"> value</span><span class="pun">()</span><span class="pln">                </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">enum</span><span class="pln"> </span><span class="typ">DayOfWeek</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> mon</span><span class="pun">,</span><span class="pln"> tue</span><span class="pun">,</span><span class="pln"> wed</span><span class="pun">,</span><span class="pln"> thu</span><span class="pun">,</span><span class="pln"> fri</span><span class="pun">,</span><span class="pln"> sat</span><span class="pun">,</span><span class="pln"> sun </span><span class="pun">}</span><span class="pln">
</span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">Scheduled</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">DayOfWeek</span><span class="pln"> dayOfWeek</span><span class="pun">()</span><span class="pln">                   </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>an annotation defining a <code>value</code> member of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>an annotation defining a <code>value</code> member of type <code>String</code> with a default value of <code>something</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>an annotation defining a <code>step</code> member of type the primitive type <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>an annotation defining a <code>appliesTo</code> member of type <code>Class</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>an annotation defining a <code>value</code> member which type is an array of another annotation type</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>an annotation defining a <code>dayOfWeek</code> member which type is the enumeration type <code>DayOfWeek</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Unlike in the Java language, in Groovy, an annotation can be used to alter the semantics of the language. It is especially
true of AST transformations which will generate code based on annotations.</p>
</div>
</div>
<div class="sect5">
<h6 id="ann-placement"><a class="anchor" href="#ann-placement"></a>Annotation placement</h6>
<div class="paragraph">
<p>An annotation can be applied on various elements of the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@SomeAnnotation</span><span class="pln">                 </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">void</span><span class="pln"> someMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@SomeAnnotation</span><span class="pln">                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SomeClass</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

</span><span class="lit">@SomeAnnotation</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">var</span><span class="pln">      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@SomeAnnotation</code> applies to the <code>someMethod</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@SomeAnnotation</code> applies to the <code>SomeClass</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@SomeAnnotation</code> applies to the <code>var</code> variable</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In order to limit the scope where an annotation can be applied, it is necessary to declare it on the annotation
definition, using the <a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/annotation/Target.html">Target</a> annotation. For example, here is how you would
declare that an annotation can be applied to a class or a method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">ElementType</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">Target</span><span class="pln">

</span><span class="lit">@Target</span><span class="pun">([</span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">METHOD</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">TYPE</span><span class="pun">])</span><span class="pln">     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">SomeAnnotation</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">                        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>@Target</code> annotation is meant to annotate an annotation with a scope.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@SomeAnnotation</code> will therefore only be allowed on <code>TYPE</code> or <code>METHOD</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The list of possible targets is available in the <a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/annotation/ElementType.html">ElementType enumeration</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Groovy does not support the <a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/annotation/ElementType.html#TYPE_PARAMETER">TYPE_PARAMETER</a> and
<a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/annotation/ElementType.html#TYPE_PARAMETER">TYPE_USE</a> element types which were introduced in Java 8.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_annotation_member_values"><a class="anchor" href="#_annotation_member_values"></a>Annotation member values</h6>
<div class="paragraph">
<p>When an annotation is used, it is required to set at least all members that do not have a default value. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@interface</span><span class="pln"> </span><span class="typ">Page</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> statusCode</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Page</span><span class="pun">(</span><span class="pln">statusCode</span><span class="pun">=</span><span class="lit">404</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> notFound</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However it is possible to omit <code>value=</code> in the declaration of the value of an annotation if the member <code>value</code> is the
only one being set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@interface</span><span class="pln"> </span><span class="typ">Page</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> value</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> statusCode</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">default</span><span class="pln"> </span><span class="lit">200</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Page</span><span class="pun">(</span><span class="pln">value</span><span class="pun">=</span><span class="str">'/home'</span><span class="pun">)</span><span class="pln">                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">void</span><span class="pln"> home</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Page</span><span class="pun">(</span><span class="str">'/users'</span><span class="pun">)</span><span class="pln">                         </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">void</span><span class="pln"> userList</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Page</span><span class="pun">(</span><span class="pln">value</span><span class="pun">=</span><span class="str">'error'</span><span class="pun">,</span><span class="pln">statusCode</span><span class="pun">=</span><span class="lit">404</span><span class="pun">)</span><span class="pln">     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">void</span><span class="pln"> notFound</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we can omit the <code>statusCode</code> because it has a default value, but <code>value</code> needs to be set</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>since <code>value</code> is the only mandatory member without a default, we can omit <code>value=</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>if both <code>value</code> and <code>statusCode</code> need to be set, it is required to use <code>value=</code> for the default <code>value</code> member</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_retention_policy"><a class="anchor" href="#_retention_policy"></a>Retention policy</h6>
<div class="paragraph">
<p>The visibility of an annotation depends on its retention policy. The retention policy of an annotation is set using
the <a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/annotation/Retention.html">Retention</a> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">Retention</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">RetentionPolicy</span><span class="pln">

</span><span class="lit">@Retention</span><span class="pun">(</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">SOURCE</span><span class="pun">)</span><span class="pln">                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">SomeAnnotation</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">                         </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>@Retention</code> annotation annotates the <code>@SomeAnnotation</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>so <code>@SomeAnnotation</code> will have a <code>SOURCE</code> retention</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The list of possible retention targets and description is available in the
<a href="http://docs.oracle.com/javase/8/docs/api/index.html?java/lang/annotation/RetentionPolicy.html">RetentionPolicy</a> enumeration. The
choice usually depends on whether you want an annotation to be visible at
compile time or runtime.</p>
</div>
</div>
<div class="sect5">
<h6 id="_closure_annotation_parameters"><a class="anchor" href="#_closure_annotation_parameters"></a>Closure annotation parameters</h6>
<div class="paragraph">
<p>An interesting feature of annotations in Groovy is that you can use a closure as an annotation value. Therefore
annotations may be used with a wide variety of expressions and still have IDE support. For example, imagine a
framework where you want to execute some methods based on environmental constraints like the JDK version or the OS.
One could write the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Tasks</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Set</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> alwaysExecuted</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        result </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="lit">@OnlyIf</span><span class="pun">({</span><span class="pln"> jdk</span><span class="pun">&gt;=</span><span class="lit">6</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> supportedOnlyInJDK6</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        result </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'JDK 6'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="lit">@OnlyIf</span><span class="pun">({</span><span class="pln"> jdk</span><span class="pun">&gt;=</span><span class="lit">7</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> windows </span><span class="pun">})</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> requiresJDK7AndWindows</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        result </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'JDK 7 Windows'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For the <code>@OnlyIf</code> annotation to accept a <code>Closure</code> as an argument, you only have to declare the <code>value</code> as a <code>Class</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Retention</span><span class="pun">(</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">OnlyIf</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Class</span><span class="pln"> value</span><span class="pun">()</span><span class="pln">                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To complete the example, let’s write a sample runner that would use that information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Runner</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> T run</span><span class="pun">(</span><span class="typ">Class</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> taskClass</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> tasks </span><span class="pun">=</span><span class="pln"> taskClass</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">()</span><span class="pln">                                         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">jdk</span><span class="pun">:</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> windows</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">]</span><span class="pln">                                        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        tasks</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">declaredMethods</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> m </span><span class="pun">-&gt;</span><span class="pln">                                     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Modifier</span><span class="pun">.</span><span class="pln">isPublic</span><span class="pun">(</span><span class="pln">m</span><span class="pun">.</span><span class="pln">modifiers</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> m</span><span class="pun">.</span><span class="pln">parameterTypes</span><span class="pun">.</span><span class="pln">length </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">   </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
                </span><span class="kwd">def</span><span class="pln"> onlyIf </span><span class="pun">=</span><span class="pln"> m</span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">(</span><span class="typ">OnlyIf</span><span class="pun">)</span><span class="pln">                                </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">onlyIf</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="typ">Closure</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> onlyIf</span><span class="pun">.</span><span class="pln">value</span><span class="pun">().</span><span class="pln">newInstance</span><span class="pun">(</span><span class="pln">tasks</span><span class="pun">,</span><span class="pln">tasks</span><span class="pun">)</span><span class="pln">            </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
                    cl</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">params</span><span class="pln">                                            </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
                    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cl</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                                     </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
                        m</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="pln">tasks</span><span class="pun">)</span><span class="pln">                                             </span><i class="conum" data-value="9"></i><b><span class="pun">(</span><span class="lit">9</span><span class="pun">)</span></b><span class="pln">
                    </span><span class="pun">}</span><span class="pln">
                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    m</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="pln">tasks</span><span class="pun">)</span><span class="pln">                                                 </span><i class="conum" data-value="10"></i><b><span class="pun">(</span><span class="lit">10</span><span class="pun">)</span></b><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        tasks                                                                       </span><i class="conum" data-value="11"></i><b><span class="pun">(</span><span class="lit">11</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new instance of the class passed as an argument (the task class)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>emulate an environment which is JDK 6 and not Windows</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>iterate on all declared methods of the task class</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>if the method is public and takes no-argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>try to find the <code>@OnlyIf</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>if it is found get the <code>value</code> and create a new <code>Closure</code> out of it</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>set the <code>delegate</code> of the closure to our environment variable</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>call the closure, which is the annotation closure. It will return a <code>boolean</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>if it is <code>true</code>, call the method</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>if the method is not annotated with <code>@OnlyIf</code>, execute the method anyway</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>after that, return the task object</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Then the runner can be used this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> tasks </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Runner</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="typ">Tasks</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> tasks</span><span class="pun">.</span><span class="pln">result </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'JDK 6'</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Set</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_meta_annotations"><a class="anchor" href="#_meta_annotations"></a>Meta-annotations</h6>
<div class="sect6">
<h7 id="_declaring_meta_annotations"><a class="anchor" href="#_declaring_meta_annotations"></a>Declaring meta-annotations</h7>
<div class="paragraph">
<p>Meta-annotations, also known as annotation aliases are annotations that
are replaced at compile time by other annotations (one meta-annotation
is an alias for one or more annotations). Meta-annotations can be used to
reduce the size of code involving multiple annotations.</p>
</div>
<div class="paragraph">
<p>Let’s start with a simple example. Imagine you have the&nbsp;<code>@Service</code>
and&nbsp;<code>@Transactional</code> annotations and that you want to annotate a class
with both:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Service</span><span class="pln">
</span><span class="lit">@Transactional</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyTransactionalService</span><span class="pln"> </span><span class="pun">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Given the multiplication of annotations that you could add to the same class, a meta-annotation
could help by reducing the two annotations with a single one having the very same semantics. For example,
we might want to write this instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@TransactionalService</span><span class="pln">                           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyTransactionalService</span><span class="pln"> </span><span class="pun">{}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@TransactionalService</code> is a meta-annotation</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>A meta-annotation is declared as a regular annotation but annotated with <code>@AnnotationCollector</code> and the
list of annotations it is collecting. In our case, the <code>@TransactionalService</code> annotation can be written:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">AnnotationCollector</span><span class="pln">

</span><span class="lit">@Service</span><span class="pln">                                        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="lit">@Transactional</span><span class="pln">                                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="lit">@AnnotationCollector</span><span class="pln">                            </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">TransactionalService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>annotate the meta-annotation with <code>@Service</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>annotate the meta-annotation with <code>@Transactional</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>annotate the meta-annotation with <code>@AnnotationCollector</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect6">
<h7 id="meta-ann-behavior"><a class="anchor" href="#meta-ann-behavior"></a>Behavior of meta-annotations</h7>
<div class="paragraph">
<p>Groovy supports both <em>precompiled</em> and <em>source form</em>
meta-annotations. This means that your meta-annotation&nbsp;<em>may</em> be
precompiled, or you can have it in the same source tree as the one you
are currently compiling.</p>
</div>
<div class="paragraph">
<p>INFO: Meta-annotations are a Groovy feature only. There is
no chance for you to annotate a Java class with a meta-annotation and
hope it will do the same as in Groovy. Likewise, you cannot write a
meta-annotation in Java: both the meta-annotation definition&nbsp;<strong>and</strong> usage
have to be Groovy code.</p>
</div>
<div class="paragraph">
<p>When the Groovy compiler encounters a class annotated with a
meta-annotation, it&nbsp;<strong>replaces</strong> it with the collected annotations. That
is, in our previous example, that it will
replace&nbsp;<code>@TransactionalService</code> with&nbsp;<code>@Transactional</code> and&nbsp;<code>@Service</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> annotations </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MyTransactionalService</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">*.</span><span class="pln">annotationType</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Service</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> annotations</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Transactional</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> annotations</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The conversion from a meta-annotation to the collected annotations is performed during the
<em>semantic analysis</em> compilation phase.&nbsp;</p>
</div>
<div class="paragraph">
<p>In addition to replacing the alias with the collected annotations, a meta-annotation is capable of
processing them, including arguments.</p>
</div>
</div>
<div class="sect6">
<h7 id="meta-ann-members"><a class="anchor" href="#meta-ann-members"></a>Meta-annotation parameters</h7>
<div class="paragraph">
<p>Meta-annotations can collect annotations which have parameters. To illustrate this, we will imagine two annotations,
each of them accepting one argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Timeout</span><span class="pun">(</span><span class="pln">after</span><span class="pun">=</span><span class="lit">3600</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Dangerous</span><span class="pun">(</span><span class="pln">type</span><span class="pun">=</span><span class="str">'explosive'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And that you want create a meta-annotation named&nbsp;<code>@Explosive</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Timeout</span><span class="pun">(</span><span class="pln">after</span><span class="pun">=</span><span class="lit">3600</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Dangerous</span><span class="pun">(</span><span class="pln">type</span><span class="pun">=</span><span class="str">'explosive'</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@AnnotationCollector</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">Explosive</span><span class="pln"> </span><span class="pun">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, when the annotations are replaced, they will get the
values <strong>as they were defined in the alias</strong>. More interesting, the meta-annotation
supports overriding specific values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Explosive</span><span class="pun">(</span><span class="pln">after</span><span class="pun">=</span><span class="lit">0</span><span class="pun">)</span><span class="pln">                 </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bomb</span><span class="pln"> </span><span class="pun">{}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>after</code> value provided as a parameter to&nbsp;<code>@Explosive</code> overrides the one defined in the <code>@Timeout</code> annotation</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If two annotations define the same parameter name, the
default processor will copy the annotation value to all annotations that
accept this parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Retention</span><span class="pun">(</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="typ">String</span><span class="pln"> value</span><span class="pun">()</span><span class="pln">                                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="lit">@Retention</span><span class="pun">(</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">Bar</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> value</span><span class="pun">()</span><span class="pln">                                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Foo</span><span class="pln">
</span><span class="lit">@Bar</span><span class="pln">
</span><span class="lit">@AnnotationCollector</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">FooBar</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">                         </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="lit">@Foo</span><span class="pun">(</span><span class="str">'a'</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Bar</span><span class="pun">(</span><span class="str">'b'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bob</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">                                        </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Bob</span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">(</span><span class="typ">Foo</span><span class="pun">).</span><span class="pln">value</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'a'</span><span class="pln">        </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
println </span><span class="typ">Bob</span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">(</span><span class="typ">Bar</span><span class="pun">).</span><span class="pln">value</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'b'</span><span class="pln">       </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">

</span><span class="lit">@FooBar</span><span class="pun">(</span><span class="str">'a'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Joe</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">                                        </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Joe</span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">(</span><span class="typ">Foo</span><span class="pun">).</span><span class="pln">value</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'a'</span><span class="pln">        </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
println </span><span class="typ">Joe</span><span class="pun">.</span><span class="pln">getAnnotation</span><span class="pun">(</span><span class="typ">Bar</span><span class="pun">).</span><span class="pln">value</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'a'</span><span class="pln">       </span><i class="conum" data-value="9"></i><b><span class="pun">(</span><span class="lit">9</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>@Foo</code> annotation defines the <code>value</code> member of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>@Bar</code> annotation also defines the <code>value</code> member of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>@FooBar</code> meta-annotation aggregates <code>@Foo</code> and <code>@Bar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>class <code>Bob</code> is annotated with <code>@Foo</code> and <code>@Bar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the value of the <code>@Foo</code> annotation on <code>Bob</code> is <code>a</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>while the value of the <code>@Bar</code> annotation on <code>Bob</code> is <code>b</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>class <code>Joe</code> is annotated with <code>@FooBar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>then the value of the <code>@Foo</code> annotation on <code>Joe</code> is <code>a</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>and the value of the <code>@Bar</code> annotation on <code>Joe</code> is also <code>a</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In the second case, the meta-annotation value was copied in
both <code>@Foo</code> and <code>@Bar</code> annotations.</p>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
It is a compile time error if the collected annotations define the same members
with incompatible types. For example if on the previous example <code>@Foo</code> defined a value of
type <code>String</code> but <code>@Bar</code> defined a value of type <code>int</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is however possible to customize the behavior of meta-annotations and describe how collected
annotations are expanded.</p>
</div>
</div>
<div class="sect6">
<h7 id="meta-ann-processor"><a class="anchor" href="#meta-ann-processor"></a>Custom annotation processors</h7>
<div class="paragraph">
<p>A custom annotation processor will let you choose how to expand a
meta-annotation into collected annotations. The behaviour of the meta-annotation is,
in this case, totally up to you. To do this, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a meta-annotation processor, extending <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/AnnotationCollectorTransform.html">AnnotationCollectorTransform</a></p>
</li>
<li>
<p>declare the processor to be used in the meta-annotation declaration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate this, we are going to explore how the meta-annotation <code>@CompileDynamic</code> is implemented.</p>
</div>
<div class="paragraph">
<p><code>@CompileDynamic</code> is a meta-annotation that expands itself
to&nbsp;<code>@CompileStatic(TypeCheckingMode.SKIP)</code>. The problem is that the
default meta annotation processor doesn’t support enums and the
annotation value <code>TypeCheckingMode.SKIP</code> is one.</p>
</div>
<div class="paragraph">
<p>The naive implementation here would not work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@CompileStatic</span><span class="pun">(</span><span class="typ">TypeCheckingMode</span><span class="pun">.</span><span class="pln">SKIP</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@AnnotationCollector</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">CompileDynamic</span><span class="pln"> </span><span class="pun">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, we will define it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@AnnotationCollector</span><span class="pun">(</span><span class="pln">processor </span><span class="pun">=</span><span class="pln"> </span><span class="str">"org.codehaus.groovy.transform.CompileDynamicProcessor"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">CompileDynamic</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first thing you may notice is that our interface is no longer
annotated with&nbsp;<code>@CompileStatic</code>. The reason for this is that we rely on
the <code>processor</code> parameter instead, that references a class which
will&nbsp;<strong>generate</strong> the annotation.</p>
</div>
<div class="paragraph">
<p>Here is how the custom processor is implemented:</p>
</div>
<div class="listingblock">
<div class="title">CompileDynamicProcessor.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@CompileStatic</span><span class="pln">                                                                  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CompileDynamicProcessor</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AnnotationCollectorTransform</span><span class="pln"> </span><span class="pun">{</span><span class="pln">            </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ClassNode</span><span class="pln"> CS_NODE </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ClassHelper</span><span class="pun">.</span><span class="pln">make</span><span class="pun">(</span><span class="typ">CompileStatic</span><span class="pun">)</span><span class="pln">    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ClassNode</span><span class="pln"> TC_NODE </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ClassHelper</span><span class="pun">.</span><span class="pln">make</span><span class="pun">(</span><span class="typ">TypeCheckingMode</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">

    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">AnnotationNode</span><span class="pun">&gt;</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">AnnotationNode</span><span class="pln"> collector</span><span class="pun">,</span><span class="pln">                        </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
                               </span><span class="typ">AnnotationNode</span><span class="pln"> aliasAnnotationUsage</span><span class="pun">,</span><span class="pln">             </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
                               </span><span class="typ">AnnotatedNode</span><span class="pln"> aliasAnnotated</span><span class="pun">,</span><span class="pln">                    </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
                               </span><span class="typ">SourceUnit</span><span class="pln"> source</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                             </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> node </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AnnotationNode</span><span class="pun">(</span><span class="pln">CS_NODE</span><span class="pun">)</span><span class="pln">                                  </span><i class="conum" data-value="9"></i><b><span class="pun">(</span><span class="lit">9</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> enumRef </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PropertyExpression</span><span class="pun">(</span><span class="pln">
            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ClassExpression</span><span class="pun">(</span><span class="pln">TC_NODE</span><span class="pun">),</span><span class="pln"> </span><span class="str">"SKIP"</span><span class="pun">)</span><span class="pln">                               </span><i class="conum" data-value="10"></i><b><span class="pun">(</span><span class="lit">10</span><span class="pun">)</span></b><span class="pln">
        node</span><span class="pun">.</span><span class="pln">addMember</span><span class="pun">(</span><span class="str">"value"</span><span class="pun">,</span><span class="pln"> enumRef</span><span class="pun">)</span><span class="pln">                                        </span><i class="conum" data-value="11"></i><b><span class="pun">(</span><span class="lit">11</span><span class="pun">)</span></b><span class="pln">
        </span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">singletonList</span><span class="pun">(</span><span class="pln">node</span><span class="pun">)</span><span class="pln">                                         </span><i class="conum" data-value="12"></i><b><span class="pun">(</span><span class="lit">12</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>our custom processor is written in Groovy, and for better compilation performance, we use static compilation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the custom processor has to extend <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/AnnotationCollectorTransform.html">AnnotationCollectorTransform</a></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a class node representing the <code>@CompileStatic</code> annotation type</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>create a class node representing the <code>TypeCheckingMode</code> enum type</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>collector</code> is the <code>@AnnotationCollector</code> node found in the meta-annotation. Usually unused.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>aliasAnnotationUsage</code> is the meta-annotation being expanded, here it is <code>@CompileDynamic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>aliasAnnotated</code> is the node being annotated with the meta-annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><code>sourceUnit</code> is the <code>SourceUnit</code> being compiled</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>we create a new annotation node for <code>@CompileStatic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>we create an expression equivalent to <code>TypeCheckingMode.SKIP</code></td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>we add that expression to the annotation node, which is now <code>@CompileStatic(TypeCheckingMode.SKIP)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>return the generated annotation</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In the example, the <code>visit</code> method is the only method which has to be overridden. It is meant to return a list of
annotation nodes that will be added to the node annotated with the meta-annotation. In this example, we return a
single one corresponding to <code>@CompileStatic(TypeCheckingMode.SKIP)</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_inheritance"><a class="anchor" href="#_inheritance"></a>Inheritance</h5>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
<div class="sect4">
<h5 id="generics"><a class="anchor" href="#generics"></a>Generics</h5>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_traits"><a class="anchor" href="#_traits"></a>1.4.2. Traits</h4>
<div class="paragraph">
<p>Traits are a structural construct of the language which allows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>composition of behaviors</p>
</li>
<li>
<p>runtime implementation of interfaces</p>
</li>
<li>
<p>behavior overriding</p>
</li>
<li>
<p>compatibility with static type checking/compilation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>They can be seen as <strong>interfaces</strong> carrying both <strong>default implementations</strong> and <strong>state</strong>. A trait is defined using the
<code>trait</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">FlyingAbility</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="typ">String</span><span class="pln"> fly</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"I'm flying!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declaration of a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declaration of a method inside a trait</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Then it can be used like a normal interface using the <code>implements</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bird</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">FlyingAbility</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bird</span><span class="pun">()</span><span class="pln">                              </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">fly</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"I'm flying!"</span><span class="pln">                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adds the trait <code>FlyingAbility</code> to the <code>Bird</code> class capabilities</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>instantiate a new <code>Bird</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>Bird</code> class automatically gets the behavior of the <code>FlyingAbility</code> trait</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Traits allow a wide range of capabilities, from simple composition to testing, which are described thoroughly in this section.</p>
</div>
<div class="sect4">
<h5 id="_methods_3"><a class="anchor" href="#_methods_3"></a>Methods</h5>
<div class="sect5">
<h6 id="_public_methods"><a class="anchor" href="#_public_methods"></a>Public methods</h6>
<div class="paragraph">
<p>Declaring a method in a trait can be done like any regular method in a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">FlyingAbility</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="typ">String</span><span class="pln"> fly</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"I'm flying!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declaration of a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declaration of a method inside a trait</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_abstract_methods"><a class="anchor" href="#_abstract_methods"></a>Abstract methods</h6>
<div class="paragraph">
<p>In addition, traits may declare <em>abstract</em> methods too, which therefore need to be implemented in the class implementing the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Greetable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">()</span><span class="pln">                              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> greeting</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Hello, ${name()}!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">           </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>implementing class will have to declare the <code>name</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>can be mixed with a concrete method</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Then the trait can be used like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Greetable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                             </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello, Bob!'</span><span class="pln">                    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>implement the trait <code>Greetable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>since <code>name</code> was abstract, it is required to implement it</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then <code>greeting</code> can be called</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_private_methods"><a class="anchor" href="#_private_methods"></a>Private methods</h6>
<div class="paragraph">
<p>Traits may also define private methods. Those methods will not appear in the trait contract interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> greetingMessage</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="str">'Hello from a private method!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> greetingMessage</span><span class="pun">()</span><span class="pln">                           </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        println m
        m
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GreetingMachine</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> g </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GreetingMachine</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> g</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Hello from a private method!"</span><span class="pln">          </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> g</span><span class="pun">.</span><span class="pln">greetingMessage</span><span class="pun">()</span><span class="pln">                              </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">MissingMethodException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println </span><span class="str">"greetingMessage is private in trait"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a private method <code>greetingMessage</code> in the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the public <code>greet</code> message calls <code>greetingMessage</code> by default</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create a class implementing the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>greet</code> can be called</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>but not <code>greetingMessage</code></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Traits only support <code>public</code> and <code>private</code> methods. Neither <code>protected</code> nor <code>package private</code> scopes are
supported.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_the_meaning_of_this"><a class="anchor" href="#_the_meaning_of_this"></a>The meaning of this</h5>
<div class="paragraph">
<p><code>this</code> represents the implementing instance. Think of a trait as a superclass. This means that when you write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Introspector</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> whoAmI</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Introspector</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> foo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>then calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">foo</span><span class="pun">.</span><span class="pln">whoAmI</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>will return the same instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> foo</span><span class="pun">.</span><span class="pln">whoAmI</span><span class="pun">().</span><span class="kwd">is</span><span class="pun">(</span><span class="pln">foo</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_interfaces"><a class="anchor" href="#_interfaces"></a>Interfaces</h5>
<div class="paragraph">
<p>Traits may implement interfaces, in which case the interfaces are declared using the <code>implements</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Named</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
trait </span><span class="typ">Greetable</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Named</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> greeting</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Hello, ${name()}!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Greetable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                             </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello, Bob!'</span><span class="pln">                    </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Named</span><span class="pln">                               </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Greetable</span><span class="pln">                           </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declaration of a normal interface</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>add <code>Named</code> to the list of implemented interfaces</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>declare a class that implements the <code>Greetable</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>implement the missing <code>name</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the <code>greeting</code> implementation comes from the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>make sure <code>Person</code> implements the <code>Named</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>make sure <code>Person</code> implements the <code>Greetable</code> trait</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_properties"><a class="anchor" href="#_properties"></a>Properties</h5>
<div class="paragraph">
<p>A trait may define properties, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Named</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name                             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Named</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">            </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pun">)</span><span class="pln">             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln">                      </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln">                 </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a property <code>name</code> inside a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare a class which implements the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the property is automatically made visible</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>it can be accessed using the regular property accessor</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>or using the regular getter syntax</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_fields"><a class="anchor" href="#_fields"></a>Fields</h5>
<div class="sect5">
<h6 id="_private_fields"><a class="anchor" href="#_private_fields"></a>Private fields</h6>
<div class="paragraph">
<p>Since traits allow the use of private methods, it can also be interesting to use private fields to store state. Traits
will let you do that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Counter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> count </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> count </span><span class="pun">}</span><span class="pln">       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Counter</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">                       </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">count</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a private field <code>count</code> inside a trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare a public method <code>count</code> that increments the counter and returns it</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>declare a class that implements the <code>Counter</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <code>count</code> method can use the private field to keep state</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a major difference with <a href="http://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html">Java 8 virtual extension methods</a>.
 While virtual extension methods
do not carry state, traits can. Moreover, traits in Groovy are supported
 starting with Java 6, because their implementation does not rely on 
virtual extension methods. This
means that even if a trait can be seen from a Java class as a regular 
interface, that interface will <strong>not</strong> have default methods, only abstract ones.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_public_fields"><a class="anchor" href="#_public_fields"></a>Public fields</h6>
<div class="paragraph">
<p>Public fields work the same way as private fields, but in order to avoid the <a href="http://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">diamond problem</a>,
field names are remapped in the implementing class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Named</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Named</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">            </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">                        </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
p</span><span class="pun">.</span><span class="typ">Named__name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln">                       </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a public <strong>field</strong> inside the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare a class implementing the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>create an instance of that class</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the public field is available, but renamed</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The name of the field depends on the fully qualified name of the trait. All dots (<code>.</code>) in package are replaced with an underscore (<code>_</code>), and the final name includes a double underscore.
So if the type of the field is <code>String</code>, the name of the package is <code>my.package</code>, the name of the trait is <code>Foo</code> and the name of the field is <code>bar</code>,
in the implementing class, the public field will appear as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> my_package_Foo__bar</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
While traits support public fields, it is not recommended to use them and considered as a bad practice.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_composition_of_behaviors"><a class="anchor" href="#_composition_of_behaviors"></a>Composition of behaviors</h5>
<div class="paragraph">
<p>Traits can be used to implement multiple inheritance in a controlled way. For example, we can have the following traits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">FlyingAbility</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="typ">String</span><span class="pln"> fly</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"I'm flying!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
trait </span><span class="typ">SpeakingAbility</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> speak</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"I'm speaking!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And a class implementing both traits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Duck</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">FlyingAbility</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SpeakingAbility</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Duck</span><span class="pun">()</span><span class="pln">                                      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">fly</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"I'm flying!"</span><span class="pln">                         </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">speak</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"I'm speaking!"</span><span class="pln">                     </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Duck</code> class implements both <code>FlyingAbility</code> and <code>SpeakingAbility</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>creates a new instance of <code>Duck</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we can call the method <code>fly</code> from <code>FlyingAbility</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but also the method <code>speak</code> from <code>SpeakingAbility</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Traits encourage the reuse of capabilities among objects, and the 
creation of new classes by the composition of existing behavior.</p>
</div>
</div>
<div class="sect4">
<h5 id="_overriding_default_methods"><a class="anchor" href="#_overriding_default_methods"></a>Overriding default methods</h5>
<div class="paragraph">
<p>Traits provide default implementations for methods, but it is 
possible to override them in the implementing class. For example, we
can slightly change the example above, by having a duck which quacks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Duck</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">FlyingAbility</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SpeakingAbility</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> quack</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Quack!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> speak</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> quack</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Duck</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">fly</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"I'm flying!"</span><span class="pln">                         </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">quack</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Quack!"</span><span class="pln">                            </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">speak</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Quack!"</span><span class="pln">                            </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a method specific to <code>Duck</code>, named <code>quack</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>override the default implementation of <code>speak</code> so that we use <code>quack</code> instead</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the duck is still flying, from the default implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>quack</code> comes from the <code>Duck</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>speak</code> no longer uses the default implementation from <code>SpeakingAbility</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_extending_traits"><a class="anchor" href="#_extending_traits"></a>Extending traits</h5>
<div class="sect5">
<h6 id="_simple_inheritance"><a class="anchor" href="#_simple_inheritance"></a>Simple inheritance</h6>
<div class="paragraph">
<p>Traits may extend another trait, in which case you must use the <code>extends</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Named</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name                                     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
trait </span><span class="typ">Polite</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Named</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> introduce</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Hello, I am $name"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Polite</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Alice'</span><span class="pun">)</span><span class="pln">                   </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">introduce</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello, I am Alice'</span><span class="pln">         </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Named</code> trait defines a single <code>name</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Polite</code> trait <strong>extends</strong> the <code>Named</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>Polite</code> adds a new method which has access to the <code>name</code> property of the super-trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <code>name</code> property is visible from the <code>Person</code> class implementing <code>Polite</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>as is the <code>introduce</code> method</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_multiple_inheritance"><a class="anchor" href="#_multiple_inheritance"></a>Multiple inheritance</h6>
<div class="paragraph">
<p>Alternatively, a trait may extend multiple traits. In that case, all super traits must be declared in the <code>implements</code>
clause:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">WithId</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">Long</span><span class="pln"> id
</span><span class="pun">}</span><span class="pln">
trait </span><span class="typ">WithName</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">
trait </span><span class="typ">Identified</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">WithId</span><span class="pun">,</span><span class="pln"> </span><span class="typ">WithName</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>WithId</code> trait defines the <code>id</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>WithName</code> trait defines the <code>name</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>Identified</code> is a trait which inherits both <code>WithId</code> and <code>WithName</code></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_duck_typing_and_traits"><a class="anchor" href="#_duck_typing_and_traits"></a>Duck typing and traits</h5>
<div class="sect5">
<h6 id="_dynamic_code"><a class="anchor" href="#_dynamic_code"></a>Dynamic code</h6>
<div class="paragraph">
<p>Traits can call any dynamic code, like a normal Groovy class. This means that you can, in the body of a method, call
methods which are supposed to exist in an implementing class, without having to explicitly declare them in an interface.
This means that traits are fully compatible with duck typing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">SpeakingDuck</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> speak</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> quack</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Duck</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">SpeakingDuck</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> methodMissing</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"${name.capitalize()}!"</span><span class="pln">                     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Duck</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">speak</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Quack!'</span><span class="pln">                        </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>SpeakingDuck</code> expects the <code>quack</code> method to be defined</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Duck</code> class does implement the method using <em>methodMissing</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calling the <code>speak</code> method triggers a call to <code>quack</code> which is handled by <code>methodMissing</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_dynamic_methods_in_a_trait"><a class="anchor" href="#_dynamic_methods_in_a_trait"></a>Dynamic methods in a trait</h6>
<div class="paragraph">
<p>It is also possible for a trait to implement MOP methods like <code>methodMissing</code> or <code>propertyMissing</code>, in which case implementing classes
will inherit the behavior from the trait, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">DynamicObject</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                               </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Map</span><span class="pln"> props </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> methodMissing</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        name</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> propertyMissing</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> prop</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        props</span><span class="pun">[</span><span class="pln">prop</span><span class="pun">]</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> setProperty</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> prop</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        props</span><span class="pun">[</span><span class="pln">prop</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Dynamic</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DynamicObject</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> existingProperty </span><span class="pun">=</span><span class="pln"> </span><span class="str">'ok'</span><span class="pln">                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> existingMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'ok'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Dynamic</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">existingProperty </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ok'</span><span class="pln">                   </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">foo </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">                                </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
d</span><span class="pun">.</span><span class="pln">foo </span><span class="pun">=</span><span class="pln"> </span><span class="str">'bar'</span><span class="pln">                                       </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">foo </span><span class="pun">==</span><span class="pln"> </span><span class="str">'bar'</span><span class="pln">                               </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">existingMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ok'</span><span class="pln">                   </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d</span><span class="pun">.</span><span class="pln">someMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'SOMEMETHOD'</span><span class="pln">               </span><i class="conum" data-value="9"></i><b><span class="pun">(</span><span class="lit">9</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a trait implementing several MOP methods</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Dynamic</code> class defines a property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>Dynamic</code> class defines a method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>calling an existing property will call the method from <code>Dynamic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>calling an non-existing property will call the method from the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>will call <code>setProperty</code> defined on the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>will call <code>getProperty</code> defined on the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>calling an existing method on <code>Dynamic</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>but calling a non existing method thanks to the trait <code>methodMissing</code></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multiple_inheritance_conflicts"><a class="anchor" href="#_multiple_inheritance_conflicts"></a>Multiple inheritance conflicts</h5>
<div class="sect5">
<h6 id="_default_conflict_resolution"><a class="anchor" href="#_default_conflict_resolution"></a>Default conflict resolution</h6>
<div class="paragraph">
<p>It is possible for a class to implement multiple traits. If some trait defines a method with the same signature as a
method in another trait, we have a conflict:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait A </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">exec</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'A'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">               </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
trait B </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">exec</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'B'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">               </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> C </span><span class="kwd">implements</span><span class="pln"> A</span><span class="pun">,</span><span class="pln">B </span><span class="pun">{}</span><span class="pln">               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>trait <code>A</code> defines a method named <code>exec</code> returning a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>trait <code>B</code> defines the very same method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>class <code>C</code> implements both traits</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In this case, the default behavior is that methods from the <strong>last declared trait</strong> wins. Here, <code>B</code> is declared after <code>A</code>
so the method from <code>B</code> will be picked up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> C</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> c</span><span class="pun">.</span><span class="kwd">exec</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'B'</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_user_conflict_resolution"><a class="anchor" href="#_user_conflict_resolution"></a>User conflict resolution</h6>
<div class="paragraph">
<p>In case this behavior is not the one you want, you can explicitly choose which method to call using the <code>Trait.super.foo</code> syntax.
In the example above, we can force to choose the method from trait A, by writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> C </span><span class="kwd">implements</span><span class="pln"> A</span><span class="pun">,</span><span class="pln">B </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">exec</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> A</span><span class="pun">.</span><span class="kwd">super</span><span class="pun">.</span><span class="kwd">exec</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> C</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> c</span><span class="pun">.</span><span class="kwd">exec</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'A'</span><span class="pln">                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>explicit call of <code>exec</code> from the trait <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>calls the version from <code>A</code> instead of using the default resolution, which would be the one from <code>B</code></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_runtime_implementation_of_traits"><a class="anchor" href="#_runtime_implementation_of_traits"></a>Runtime implementation of traits</h5>
<div class="sect5">
<h6 id="_implementing_a_trait_at_runtime"><a class="anchor" href="#_implementing_a_trait_at_runtime"></a>Implementing a trait at runtime</h6>
<div class="paragraph">
<p>Groovy also supports implementing traits dynamically at runtime. It allows you to "decorate" an existing object using a
trait. As an example, let’s start with this trait and the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Extra</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> extra</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"I'm an extra method"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">            </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Something</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> doSomething</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Something'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Extra</code> trait defines an <code>extra</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Something</code> class does <strong>not</strong> implement the <code>Extra</code> trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>Something</code> only defines a method <code>doSomething</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Then if we do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Something</span><span class="pun">()</span><span class="pln">
s</span><span class="pun">.</span><span class="pln">extra</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>the call to extra would fail because <code>Something</code> is not implementing <code>Extra</code>. It is possible to do it at runtime with
the following syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Something</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Extra</span><span class="pln">                        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
s</span><span class="pun">.</span><span class="pln">extra</span><span class="pun">()</span><span class="pln">                                               </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
s</span><span class="pun">.</span><span class="pln">doSomething</span><span class="pun">()</span><span class="pln">                                         </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use of the <strong>as</strong> keyword to coerce an object to a trait <strong>at runtime</strong></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then <code>extra</code> can be called on the object</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and <code>doSomething</code> is still callable</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When coercing an object to a trait, the result of the operation is not the same instance. It is guaranteed
that the coerced object will implement both the trait <strong>and</strong> the interfaces that the original object implements, but
the result will <strong>not</strong> be an instance of the original class.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_implementing_multiple_traits_at_once"><a class="anchor" href="#_implementing_multiple_traits_at_once"></a>Implementing multiple traits at once</h6>
<div class="paragraph">
<p>Should you need to implement several traits at once, you can use the <code>withTraits</code> method instead of the <code>as</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait A </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> methodFromA</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
trait B </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> methodFromB</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> C </span><span class="pun">{}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> C</span><span class="pun">()</span><span class="pln">
c</span><span class="pun">.</span><span class="pln">methodFromA</span><span class="pun">()</span><span class="pln">                     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
c</span><span class="pun">.</span><span class="pln">methodFromB</span><span class="pun">()</span><span class="pln">                     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">withTraits A</span><span class="pun">,</span><span class="pln"> B           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
d</span><span class="pun">.</span><span class="pln">methodFromA</span><span class="pun">()</span><span class="pln">                     </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
d</span><span class="pun">.</span><span class="pln">methodFromB</span><span class="pun">()</span><span class="pln">                     </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>call to <code>methodFromA</code> will fail because <code>C</code> doesn’t implement <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>call to <code>methodFromB</code> will fail because <code>C</code> doesn’t implement <code>B</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>withTrait</code> will wrap <code>c</code> into something which implements <code>A</code> and <code>B</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>methodFromA</code> will now pass because <code>d</code> implements <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>methodFromB</code> will now pass because <code>d</code> also implements <code>B</code></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When coercing an object to multiple traits, the result of the operation is not the same instance. It is guaranteed
that the coerced object will implement both the traits <strong>and</strong> the interfaces that the original object implements, but
the result will <strong>not</strong> be an instance of the original class.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_chaining_behavior"><a class="anchor" href="#_chaining_behavior"></a>Chaining behavior</h5>
<div class="paragraph">
<p>Groovy supports the concept of <em>stackable traits</em>. The idea is to delegate from one trait to the other if the current trait
is not capable of handling a message. To illustrate this, let’s imagine a message handler interface like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">MessageHandler</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> on</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Map</span><span class="pln"> payload</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can compose a message handler by applying small behaviors. For example, let’s define a default handler in the
form of a trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">DefaultHandler</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">MessageHandler</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> on</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Map</span><span class="pln"> payload</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"Received $message with payload $payload"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then any class can inherit the behavior of the default handler by implementing the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SimpleHandler</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DefaultHandler</span><span class="pln"> </span><span class="pun">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now what if you want to log all messages, in addition to the default handler? One option is to write this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SimpleHandlerWithLogging</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DefaultHandler</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> on</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Map</span><span class="pln"> payload</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        println </span><span class="str">"Seeing $message with payload $payload"</span><span class="pln">                     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="typ">DefaultHandler</span><span class="pun">.</span><span class="kwd">super</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> payload</span><span class="pun">)</span><span class="pln">                           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>explicitly implement the <code>on</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>perform logging</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>continue by delegating to the <code>DefaultHandler</code> trait</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This works but this approach has drawbacks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the logging logic is bound to a "concrete" handler</p>
</li>
<li>
<p>we have an explicit reference to <code>DefaultHandler</code> in the <code>on</code> method, meaning that if we happen to change the trait that our class implements, code will be broken</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As an alternative, we can write another trait which responsibility is limited to logging:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">LoggingHandler</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">MessageHandler</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                            </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> on</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Map</span><span class="pln"> payload</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"Seeing $message with payload $payload"</span><span class="pln">                     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> payload</span><span class="pun">)</span><span class="pln">                                          </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the logging handler is itself a handler</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>prints the message it receives</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then <code>super</code> makes it delegate the call to the next trait in the chain</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Then our class can be rewritten as this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">HandlerWithLogger</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DefaultHandler</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LoggingHandler</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> loggingHandler </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HandlerWithLogger</span><span class="pun">()</span><span class="pln">
loggingHandler</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'test logging'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[:])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which will print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Seeing test logging with payload [:]
Received test logging with payload [:]</pre>
</div>
</div>
<div class="paragraph">
<p>As the priority rules imply that <code>LoggerHandler</code> wins because it is declared last, then a call to <code>on</code> will use
the implementation from <code>LoggingHandler</code>. But the latter has a call to <code>super</code>, which means the next trait in the
chain. Here, the next trait is <code>DefaultHandler</code> so <strong>both</strong> will be called:</p>
</div>
<div class="paragraph">
<p>The interest of this approach becomes more evident if we add a third handler, which is responsible for handling messages
that start with <code>say</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">SayHandler</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">MessageHandler</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> on</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Map</span><span class="pln"> payload</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">message</span><span class="pun">.</span><span class="pln">startsWith</span><span class="pun">(</span><span class="str">"say"</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
            println </span><span class="str">"I say ${message - 'say'}!"</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="pln">message</span><span class="pun">,</span><span class="pln"> payload</span><span class="pun">)</span><span class="pln">                                      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a handler specific precondition</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if the precondition is not met, pass the message to the next handler in the chain</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Then our final handler looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Handler</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DefaultHandler</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SayHandler</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LoggingHandler</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> h </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Handler</span><span class="pun">()</span><span class="pln">
h</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[:])</span><span class="pln">
h</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'sayHello'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[:])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>messages will first go through the logging handler</p>
</li>
<li>
<p>the logging handler calls <code>super</code> which will delegate to the next handler, which is the <code>SayHandler</code></p>
</li>
<li>
<p>if the message starts with <code>say</code>, then the handler consumes the message</p>
</li>
<li>
<p>if not, the <code>say</code> handler delegates to the next handler in the chain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This approach is very powerful because it allows you to write handlers that do not know each other and yet let you
combine them in the order you want. For example, if we execute the code, it will print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Seeing foo with payload [:]
Received foo with payload [:]
Seeing sayHello with payload [:]
I say Hello!</pre>
</div>
</div>
<div class="paragraph">
<p>but if we move the logging handler to be the second one in the chain, the output is different:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">AlternateHandler</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">DefaultHandler</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LoggingHandler</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SayHandler</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
h </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AlternateHandler</span><span class="pun">()</span><span class="pln">
h</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[:])</span><span class="pln">
h</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'sayHello'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[:])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>prints:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Seeing foo with payload [:]
Received foo with payload [:]
I say Hello!</pre>
</div>
</div>
<div class="paragraph">
<p>The reason is that now, since the <code>SayHandler</code> consumes the message without calling <code>super</code>, the logging handler is
not called anymore.</p>
</div>
<div class="sect5">
<h6 id="_semantics_of_super_inside_a_trait"><a class="anchor" href="#_semantics_of_super_inside_a_trait"></a>Semantics of super inside a trait</h6>
<div class="paragraph">
<p>If a class implements multiple traits and a call to an unqualified <code>super</code> is found, then:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>if the class implements another trait, the call delegates to the next trait in the chain</p>
</li>
<li>
<p>if there isn’t any trait left in the chain, <code>super</code> refers to the super class of the implementing class (<em>this</em>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, it is possible to decorate final classes thanks to this behavior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Filtering</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">StringBuilder</span><span class="pln"> append</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> str</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> subst </span><span class="pun">=</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="str">'o'</span><span class="pun">,</span><span class="str">''</span><span class="pun">)</span><span class="pln">                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="pln">subst</span><span class="pun">)</span><span class="pln">                             </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">              </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> sb </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuilder</span><span class="pun">().</span><span class="pln">withTraits </span><span class="typ">Filtering</span><span class="pln">       </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
sb</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="str">'Groovy'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sb</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Grvy'</span><span class="pln">                          </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a trait named <code>Filtering</code>, supposed to be applied on a <code>StringBuilder</code> at runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>redefine the <code>append</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>remove all 'o’s from the string</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then delegate to <code>super</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>in case <code>toString</code> is called, delegate to <code>super.toString</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>runtime implementation of the <code>Filtering</code> trait on a <code>StringBuilder</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>the string which has been appended no longer contains the letter <code>o</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In this example, when <code>super.append</code> is encountered, there is no other trait implemented by the target object, so the
method which is called is the original <code>append</code> method, that is to say the one from <code>StringBuilder</code>. The same trick
is used for <code>toString</code>, so that the string representation of the proxy object which is generated delegates to the
<code>toString</code> of the <code>StringBuilder</code> instance.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_features"><a class="anchor" href="#_advanced_features"></a>Advanced features</h5>
<div class="sect5">
<h6 id="_sam_type_coercion"><a class="anchor" href="#_sam_type_coercion"></a>SAM type coercion</h6>
<div class="paragraph">
<p>If a trait defines a single abstract method, it is candidate for SAM (Single Abstract Method) type coercion. For example,
imagine the following trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Hello $name"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln">               </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>greet</code> method is not abstract and calls the abstract method <code>getName</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>getName</code> is an abstract method</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Since <code>getName</code> is the <em>single abstract method</em> in the <code>Greeter</code> trait, you can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Greeter</span><span class="pln"> greeter </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Alice'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">               </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the closure "becomes" the implementation of the <code>getName</code> single abstract method</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>or even:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">(</span><span class="typ">Greeter</span><span class="pln"> g</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println g</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
greet </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Alice'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                           </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the greet method accepts the SAM type Greeter as parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can call it directly with a closure</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_differences_with_java_8_default_methods"><a class="anchor" href="#_differences_with_java_8_default_methods"></a>Differences with Java 8 default methods</h6>
<div class="paragraph">
<p>In Java 8, interfaces can have default implementations of methods. If a class implements an interface and does not provide
an implementation for a default method, then the implementation from the interface is chosen. Traits behave the same but
with a major difference: the implementation from the trait is <strong>always</strong> used if the class declares the trait in its interface
list <strong>and</strong> that it doesn’t provide an implementation.</p>
</div>
<div class="paragraph">
<p>This feature can be used to compose behaviors in an very precise way, in case you want to override the behavior of an
already implemented method.</p>
</div>
<div class="paragraph">
<p>To illustrate the concept, let’s start with this simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">CompileStatic</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="typ">CompilerConfiguration</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="pln">customizers</span><span class="pun">.</span><span class="typ">ASTTransformationCustomizer</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="pln">customizers</span><span class="pun">.</span><span class="typ">ImportCustomizer</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SomeTest</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">GroovyTestCase</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> config
    </span><span class="kwd">def</span><span class="pln"> shell

    </span><span class="kwd">void</span><span class="pln"> setup</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
        shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">config</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> testSomething</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="str">'1+1'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> otherTest</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">/* ... */</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we create a simple test case which uses two properties (<em>config</em> and <em>shell</em>) and uses those in
multiple test methods. Now imagine that you want to test the same, but with another distinct compiler configuration.
One option is to create a subclass of <code>SomeTest</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">AnotherTest</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">SomeTest</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> setup</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
        config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">config</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It works, but what if you have actually multiple test classes, and that you want to test the new configuration for all
those test classes? Then you would have to create a distinct subclass for each test class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">YetAnotherTest</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">SomeTest</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> setup</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
        config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">config</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then what you see is that the <code>setup</code> method of both tests is the same. The idea, then, is to create a trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">MyTestSupport</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> setup</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
        config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="typ">CompileStatic</span><span class="pun">)</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
        shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">config</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then use it in the subclasses:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">AnotherTest</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">SomeTest</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">MyTestSupport</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">YetAnotherTest</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">SomeTest2</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">MyTestSupport</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It would allow us to dramatically reduce the boilerplate code, and reduces the risk of forgetting to change the setup
code in case we decide to change it. Even if <code>setup</code> is already implemented in the super class, since the test class declares
the trait in its interface list, the behavior will be borrowed from the trait implementation!</p>
</div>
<div class="paragraph">
<p>This feature is in particular useful when you don’t have access to the super class source code. It can be used to
mock methods or force a particular implementation of a method in a subclass. It lets you refactor your code to keep
the overridden logic in a single trait and inherit a new behavior just by implementing it. The alternative, of course,
is to override the method in <strong>every</strong> place you would have used the new code.</p>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It’s worth noting that if you use runtime traits, the methods from the trait are <strong>always</strong> preferred to those of the proxied
object:
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name                                         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
trait </span><span class="typ">Bob</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Alice'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Alice'</span><span class="pln">                                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> p </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Bob</span><span class="pln">                                       </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln">                                 </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Person</code> class defines a <code>name</code> property which results in a <code>getName</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Bob</code> is a trait which defines <code>getName</code> as returning <code>Bob</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the default object will return <em>Alice</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>p2</code> coerces <code>p</code> into <code>Bob</code> at runtime</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>getName</code> returns <em>Bob</em> because <code>getName</code> is taken from the <strong>trait</strong></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Again, don’t forget that dynamic trait coercion returns a distinct object which only implements the original
interfaces, as well as the traits.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_differences_with_mixins"><a class="anchor" href="#_differences_with_mixins"></a>Differences with mixins</h5>
<div class="paragraph">
<p>There are several conceptual differences with mixins, as they are available in Groovy. Note that we are talking about
runtime mixins, not the @Mixin annotation which is deprecated in favour of traits.</p>
</div>
<div class="paragraph">
<p>First of all, methods defined in a trait are visible in bytecode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>internally, the trait is represented as an interface (without default methods) and several helper classes</p>
</li>
<li>
<p>this means that an object implementing a trait effectively implements an <em>interface</em></p>
</li>
<li>
<p>those methods are visible from Java</p>
</li>
<li>
<p>they are compatible with type checking and static compilation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Methods added through a mixin are, on the contrary, only visible at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> A </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> methodFromA</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'A'</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">class</span><span class="pln"> B </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> methodFromB</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'B'</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
A</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">mixin B                             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> o </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> A</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">methodFromA</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'A'</span><span class="pln">                   </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">methodFromB</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'B'</span><span class="pln">                   </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> o </span><span class="kwd">instanceof</span><span class="pln"> A                           </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!(</span><span class="pln">o </span><span class="kwd">instanceof</span><span class="pln"> B</span><span class="pun">)</span><span class="pln">                        </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class <code>A</code> defines <code>methodFromA</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>class <code>B</code> defines <code>methodFromB</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>mixin B into A</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>we can call <code>methodFromA</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>we can also call <code>methodFromB</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the object is an instance of <code>A</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>but it’s <strong>not</strong> an instanceof <code>B</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The last point is actually a very important and illustrates a place where mixins have an advantage over traits: the instances
are <strong>not</strong> modified, so if you mixin some class into another, there isn’t a third class generated, and methods which respond to
A will continue responding to A even if mixed in.</p>
</div>
</div>
<div class="sect4">
<h5 id="_static_methods_properties_and_fields"><a class="anchor" href="#_static_methods_properties_and_fields"></a>Static methods, properties and fields</h5>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The following instructions are subject to caution. Static member support is work in progress and still experimental. The
information below is valid for 2.4.11 only.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is possible to define static methods in a trait, but it comes with numerous limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>traits with static methods cannot be compiled statically or type 
checked. All static methods/properties/field are accessed dynamically 
(it’s a limitation from the JVM).</p>
</li>
<li>
<p>the trait is interpreted as a <em>template</em> for the implementing class, which means that each implementing class will get its own static methods/properties/methods. So a
static member declared on a trait doesn’t belong to the <code>Trait</code>, but to it’s implementing class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s start with a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">TestHelper</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> CALLED </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> init</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        CALLED </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">                           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">TestHelper</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="typ">Foo</span><span class="pun">.</span><span class="pln">init</span><span class="pun">()</span><span class="pln">                                      </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">.</span><span class="typ">TestHelper__CALLED</span><span class="pln">                   </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the static field is declared in the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a static method is also declared in the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the static field is updated <em>within</em> the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a static method <em>init</em> is made available to the implementing class</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the static field is <em>remapped</em> to avoid the diamond issue</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As usual, it is not recommended to use public fields. Anyway, should 
you want this, you must understand that the following code would fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Foo</span><span class="pun">.</span><span class="pln">CALLED </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>because there is <em>no</em> static field <em>CALLED</em> defined on the trait itself. Likewise, if you have two distinct implementing classes, each one gets a distinct static field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bar</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">TestHelper</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Baz</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">TestHelper</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">              </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">Bar</span><span class="pun">.</span><span class="pln">init</span><span class="pun">()</span><span class="pln">                                      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">.</span><span class="typ">TestHelper__CALLED</span><span class="pln">                   </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="typ">Baz</span><span class="pun">.</span><span class="typ">TestHelper__CALLED</span><span class="pln">                  </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class <code>Bar</code> implements the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>class <code>Baz</code> also implements the trait</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>init</code> is only called on <code>Bar</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the static field <code>CALLED</code> on <code>Bar</code> is updated</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>but the static field <code>CALLED</code> on <code>Baz</code> is not, because it is <strong>distinct</strong></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_inheritance_of_state_gotchas"><a class="anchor" href="#_inheritance_of_state_gotchas"></a>Inheritance of state gotchas</h5>
<div class="paragraph">
<p>We have seen that traits are stateful. It is possible for a trait to 
define fields or properties, but when a class implements a trait, it 
gets those fields/properties on
a per-trait basis. So consider the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">IntCouple</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> x</span><span class="pun">+</span><span class="pln">y </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The trait defines two properties, <code>x</code> and <code>y</code>, as well as a <code>sum</code> method. Now let’s create a class which implements the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">BaseElem</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">IntCouple</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> f</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">base</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BaseElem</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">base</span><span class="pun">.</span><span class="pln">f</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of calling <code>f</code> is <code>3</code>, because <code>f</code> delegates to <code>sum</code> in the trait, which has state. But what if we write this instead?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Elem</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">IntCouple</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">                                       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pln">                                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> f</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> elem </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Elem</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Override property <code>x</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Override property <code>y</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call <code>sum</code> from trait</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you call <code>elem.f()</code>, what is the expected output? Actually it is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> elem</span><span class="pun">.</span><span class="pln">f</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason is that the <code>sum</code> method accesses the <em>fields</em> of the trait. So it is using the <code>x</code> and <code>y</code> values defined
in the trait. If you want to use the values from the implementing class, then you need to dereference fields by using
getters and setters, like in this last example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">IntCouple</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> getX</span><span class="pun">()+</span><span class="pln">getY</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Elem</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">IntCouple</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> f</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> elem </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Elem</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> elem</span><span class="pun">.</span><span class="pln">f</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_self_types"><a class="anchor" href="#_self_types"></a>Self types</h5>
<div class="sect5">
<h6 id="_type_constraints_on_traits"><a class="anchor" href="#_type_constraints_on_traits"></a>Type constraints on traits</h6>
<div class="paragraph">
<p>Sometimes you will want to write a trait that can only be applied to some type. For example, you may want to apply a
trait on a class that extends another class which is beyond your control, and still be able to call those methods.
To illustrate this, let’s start with this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">CommunicationService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sendMessage</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> </span><span class="kwd">from</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> to</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        println </span><span class="str">"$from sent [$message] to $to"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Device</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> id </span><span class="pun">}</span><span class="pln">                                                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

trait </span><span class="typ">Communicating</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> sendMessage</span><span class="pun">(</span><span class="typ">Device</span><span class="pln"> to</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">CommunicationService</span><span class="pun">.</span><span class="pln">sendMessage</span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> to</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> message</span><span class="pun">)</span><span class="pln">                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyDevice</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Device</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Communicating</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">                   </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> bob </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyDevice</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="str">'Bob'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> alice </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyDevice</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="str">'Alice'</span><span class="pun">)</span><span class="pln">
bob</span><span class="pun">.</span><span class="pln">sendMessage</span><span class="pun">(</span><span class="pln">alice</span><span class="pun">,</span><span class="str">'secret'</span><span class="pun">)</span><span class="pln">                                             </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A <code>Service</code> class, beyond your control (in a library, …​) defines a <code>sendMessage</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>Device</code> class, beyond your control (in a library, …​)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines a communicating trait for devices that can call the service</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Defines <code>MyDevice</code> as a communicating device</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The method from the trait is called, and <code>id</code> is resolved</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is clear, here, that the <code>Communicating</code> trait can only apply to <code>Device</code>. However, there’s no explicit
contract to tell that, because traits cannot extend classes. However, the code compiles and runs perfectly
fine, because <code>id</code> in the trait method will be resolved dynamically. The problem is that there is nothing that
prevents the trait from being applied to any class which is <strong>not</strong> a <code>Device</code>. Any class which has an <code>id</code> would
work, while any class that does not have an <code>id</code> property would cause a runtime error.</p>
</div>
<div class="paragraph">
<p>The problem is even more complex if you want to enable type checking or apply <code>@CompileStatic</code> on the trait: because
the trait knows nothing about itself being a <code>Device</code>, the type checker will complain saying that it does not find
the <code>id</code> property.</p>
</div>
<div class="paragraph">
<p>One possibility is to explicitly add a <code>getId</code> method in the trait, but it would not solve all issues. What if a method
requires <code>this</code> as a parameter, and actually requires it to be a <code>Device</code>?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SecurityService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> check</span><span class="pun">(</span><span class="typ">Device</span><span class="pln"> d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">d</span><span class="pun">.</span><span class="pln">id</span><span class="pun">==</span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SecurityException</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to be able to call this in the trait, then you will explicitly need to cast <code>this</code> into a <code>Device</code>. This can
quickly become unreadable with explicit casts to this everywhere.</p>
</div>
</div>
<div class="sect5">
<h6 id="_the_selftype_annotation"><a class="anchor" href="#_the_selftype_annotation"></a>The @SelfType annotation</h6>
<div class="paragraph">
<p>In order to make this contract explicit, and to make the type checker aware of the <em>type of itself</em>, Groovy provides
a <code>@SelfType</code> annotation that will:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>let you declare the types that a class that implements this trait must inherit or implement</p>
</li>
<li>
<p>throw a compile time error if those type constraints are not satisfied</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So in our previous example, we can fix the trait using the <code>@groovy.transform.SelfType</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@SelfType</span><span class="pun">(</span><span class="typ">Device</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@CompileStatic</span><span class="pln">
trait </span><span class="typ">Communicating</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> sendMessage</span><span class="pun">(</span><span class="typ">Device</span><span class="pln"> to</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">SecurityService</span><span class="pun">.</span><span class="pln">check</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
        </span><span class="typ">CommunicationService</span><span class="pun">.</span><span class="pln">sendMessage</span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> to</span><span class="pun">.</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> message</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if you try to implement this trait on a class that is <strong>not</strong> a device, a compile-time error will occur:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyDevice</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Communicating</span><span class="pln"> </span><span class="pun">{}</span><span class="pln"> </span><span class="com">// forgot to extend Device</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The error will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class 'MyDevice' implements trait 'Communicating' but does not extend self type class 'Device'</pre>
</div>
</div>
<div class="paragraph">
<p>In conclusion, self types are a powerful way of declaring constraints on traits without having to declare the contract
directly in the trait or having to use casts everywhere, maintaining separation of concerns as tight as it should be.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_limitations"><a class="anchor" href="#_limitations"></a>Limitations</h5>
<div class="sect5">
<h6 id="_compatibility_with_ast_transformations"><a class="anchor" href="#_compatibility_with_ast_transformations"></a>Compatibility with AST transformations</h6>
<div class="admonitionblock caution">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Traits are not officially compatible with AST transformations. Some of them, like <code>@CompileStatic</code> will be applied
on the trait itself (not on implementing classes), while others will apply on both the implementing class and the trait.
There is absolutely no guarantee that an AST transformation will run on a trait as it does on a regular class, so use it
at your own risk!
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_prefix_and_postfix_operations"><a class="anchor" href="#_prefix_and_postfix_operations"></a>Prefix and postfix operations</h6>
<div class="paragraph">
<p>Within traits, prefix and postfix operations are not allowed if they update a field of the trait:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">trait </span><span class="typ">Counting</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> x
    </span><span class="kwd">void</span><span class="pln"> inc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        x</span><span class="pun">++</span><span class="pln">                             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> dec</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="pun">--</span><span class="pln">x                             </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Counter</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Counting</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Counter</span><span class="pun">()</span><span class="pln">
c</span><span class="pun">.</span><span class="pln">inc</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>x</code> is defined within the trait, postfix increment is not allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>x</code> is defined within the trait, prefix decrement is not allowed</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>A workaround is to use the <code>+=</code> operator instead.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_closures"><a class="anchor" href="#_closures"></a>1.5. Closures</h3>
<div class="paragraph">
<p>This chapter covers Groovy Closures. A closure in Groovy is an open, anonymous, block of code that can take arguments,
return a value and be assigned to a variable. A closure may reference variables declared in its surrounding scope. In
opposition to the formal definition of a closure, <code>Closure</code> in the Groovy language can also contain free variables which
are defined outside of its surrounding scope. While breaking the formal concept of a closure, it offers a variety of
advantages which are described in this chapter.</p>
</div>
<div class="sect3">
<h4 id="_syntax_2"><a class="anchor" href="#_syntax_2"></a>1.5.1. Syntax</h4>
<div class="sect4">
<h5 id="_defining_a_closure"><a class="anchor" href="#_defining_a_closure"></a>Defining a closure</h5>
<div class="paragraph">
<p>A closure definition follows this syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pun">{</span><span class="pln"> </span><span class="pun">[</span><span class="pln">closureParameters </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">]</span><span class="pln"> statements </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>[closureParameters-&gt;]</code> is an optional comma-delimited list of
parameters, and statements are 0 or more Groovy statements. The parameters
look similar to a method parameter list, and these parameters may be
typed or untyped.</p>
</div>
<div class="paragraph">
<p>When a parameter list is specified, the <code>-&gt;</code> character
is required and serves to separate the arguments from the closure body.
The <em>statements</em> portion consists of 0, 1, or many Groovy statements.</p>
</div>
<div class="paragraph">
<p>Some examples of valid closure definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pun">{</span><span class="pln"> item</span><span class="pun">++</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                                          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="pun">{</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> item</span><span class="pun">++</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

</span><span class="pun">{</span><span class="pln"> println it </span><span class="pun">}</span><span class="pln">                                      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="pun">{</span><span class="pln"> it </span><span class="pun">-&gt;</span><span class="pln"> println it </span><span class="pun">}</span><span class="pln">                                </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">

</span><span class="pun">{</span><span class="pln"> name </span><span class="pun">-&gt;</span><span class="pln"> println name </span><span class="pun">}</span><span class="pln">                            </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">

</span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">-&gt;</span><span class="pln">                                </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
    println </span><span class="str">"hey ${x} the value is ${y}"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="pun">{</span><span class="pln"> reader </span><span class="pun">-&gt;</span><span class="pln">                                         </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> line </span><span class="pun">=</span><span class="pln"> reader</span><span class="pun">.</span><span class="pln">readLine</span><span class="pun">()</span><span class="pln">
    line</span><span class="pun">.</span><span class="pln">trim</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A closure referencing a variable named <code>item</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It is possible to explicitly separate closure parameters from code by adding an arrow (<code>-&gt;</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A closure using an implicit parameter (<code>it</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>An alternative version where <code>it</code> is an explicit parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>In that case it is often better to use an explicit name for the parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>A closure accepting two typed parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>A closure can contain multiple statements</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="closure-as-object"><a class="anchor" href="#closure-as-object"></a>Closures as an object</h5>
<div class="paragraph">
<p>A closure is an instance of the <code>groovy.lang.Closure</code> class, making it assignable to a variable or a field as any
other variable, despite being a block of code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> listener </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> e </span><span class="pun">-&gt;</span><span class="pln"> println </span><span class="str">"Clicked on $e.source"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> listener </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln">
</span><span class="typ">Closure</span><span class="pln"> callback </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'Done!'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">Closure</span><span class="pun">&lt;</span><span class="typ">Boolean</span><span class="pun">&gt;</span><span class="pln"> isTextFile </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">File</span><span class="pln"> it </span><span class="pun">-&gt;</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">endsWith</span><span class="pun">(</span><span class="str">'.txt'</span><span class="pun">)</span><span class="pln">                     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can assign a closure to a variable, and it is an instance of <code>groovy.lang.Closure</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If not using <code>def</code>, you can assign a closure to a variable of type <code>groovy.lang.Closure</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Optionally, you can specify the return type of the closure by using the generic type of <code>groovy.lang.Closure</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_calling_a_closure"><a class="anchor" href="#_calling_a_closure"></a>Calling a closure</h5>
<div class="paragraph">
<p>A closure, as an anonymous block of code, can be called like any other method. If you define a closure which takes
no argument like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> code </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">123</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the code inside the closure will only be executed when you <em>call</em> the closure, which can be done by using the
variable as if it was a regular method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> code</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">123</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can be explicit and use the <code>call</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> code</span><span class="pun">.</span><span class="pln">call</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">123</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The principle is the same if the closure accepts arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> isOdd </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">-&gt;</span><span class="pln"> i</span><span class="pun">%</span><span class="lit">2</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> isOdd</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">                                     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> isOdd</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">                               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> isEven </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">%</span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                                  </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> isEven</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">                                   </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> isEven</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">                               </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a closure which accepts an <code>int</code> as a parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it can be called directly</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>or using the <code>call</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>same goes for a closure with an implicit argument (<code>it</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>which can be called directly using <code>(arg)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>or using <code>call</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Unlike a method, a closure <strong>always</strong> returns a value when called. The next section discusses how to declare closure arguments, when to use them and what is the <a href="#implicit-it">implicit
"it" parameter</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_parameters"><a class="anchor" href="#_parameters"></a>1.5.2. Parameters</h4>
<div class="sect4">
<h5 id="_normal_parameters"><a class="anchor" href="#_normal_parameters"></a>Normal parameters</h5>
<div class="paragraph">
<p>Parameters of closures follow the same principle as parameters of regular methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an optional type</p>
</li>
<li>
<p>a name</p>
</li>
<li>
<p>an optional default value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Parameters are separated with commas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> closureWithOneArg </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> str </span><span class="pun">-&gt;</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> closureWithOneArg</span><span class="pun">(</span><span class="str">'groovy'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'GROOVY'</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> closureWithOneArgAndExplicitType </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> str </span><span class="pun">-&gt;</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> closureWithOneArgAndExplicitType</span><span class="pun">(</span><span class="str">'groovy'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'GROOVY'</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> closureWithTwoArgs </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln">b </span><span class="pun">-&gt;</span><span class="pln"> a</span><span class="pun">+</span><span class="pln">b </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> closureWithTwoArgs</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> closureWithTwoArgsAndExplicitTypes </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln"> a</span><span class="pun">+</span><span class="pln">b </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> closureWithTwoArgsAndExplicitTypes</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> closureWithTwoArgsAndOptionalTypes </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln"> a</span><span class="pun">+</span><span class="pln">b </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> closureWithTwoArgsAndOptionalTypes</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> closureWithTwoArgAndDefaultValue </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">=</span><span class="lit">2</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> a</span><span class="pun">+</span><span class="pln">b </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> closureWithTwoArgAndDefaultValue</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="implicit-it"><a class="anchor" href="#implicit-it"></a>Implicit parameter</h5>
<div class="paragraph">
<p>When a closure does not explicitly define a parameter list (using <code>-&gt;</code>), a closure <strong>always</strong> defines an implicit
parameter, named <code>it</code>. This means that this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> greeting </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Hello, $it!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> greeting</span><span class="pun">(</span><span class="str">'Patrick'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello, Patrick!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is stricly equivalent to this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> greeting </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="str">"Hello, $it!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> greeting</span><span class="pun">(</span><span class="str">'Patrick'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello, Patrick!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to declare a closure which accepts no argument and must be restricted to calls without arguments,
then you <strong>must</strong> declare it with an explicit empty argument list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> magicNumber </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="lit">42</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="com">// this call will fail because the closure doesn't accept any argument</span><span class="pln">
magicNumber</span><span class="pun">(</span><span class="lit">11</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_varargs_2"><a class="anchor" href="#_varargs_2"></a>Varargs</h5>
<div class="paragraph">
<p>It is possible for a closure to declare variable arguments like any other method. <em>Vargs</em> methods are methods that
can accept a variable number of arguments if the last parameter is of variable length (or an array) like in the next
examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> concat1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pun">...</span><span class="pln"> args </span><span class="pun">-&gt;</span><span class="pln"> args</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> concat1</span><span class="pun">(</span><span class="str">'abc'</span><span class="pun">,</span><span class="str">'def'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'abcdef'</span><span class="pln">                     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> concat2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> args </span><span class="pun">-&gt;</span><span class="pln"> args</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">            </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> concat2</span><span class="pun">(</span><span class="str">'abc'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'def'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'abcdef'</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> multiConcat </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">...</span><span class="pln"> args </span><span class="pun">-&gt;</span><span class="pln">                </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    args</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">''</span><span class="pun">)*</span><span class="pln">n
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> multiConcat</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="str">'abc'</span><span class="pun">,</span><span class="str">'def'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'abcdefabcdef'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A closure accepting a variable number of strings as first parameter</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It may be called using any number of arguments <strong>without</strong> having to explicitly wrap them into an array</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The same behavior is directly available if the <em>args</em> parameter is declared as an array</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>As long as the <strong>last</strong> parameter is an array or an explicit vargs type</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delegation_strategy"><a class="anchor" href="#_delegation_strategy"></a>1.5.3. Delegation strategy</h4>
<div class="sect4">
<h5 id="_groovy_closures_vs_lambda_expressions"><a class="anchor" href="#_groovy_closures_vs_lambda_expressions"></a>Groovy closures vs lambda expressions</h5>
<div class="paragraph">
<p>Groovy defines closures as <a href="#closure-as-object">instances of the Closure class</a>. It makes it very different from
<a href="http://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">lambda expressions in Java 8</a>. Delegation is a
key concept in Groovy closures which has no equivalent in lambdas. The ability to <em>change the delegate</em> or <em>change the
delegation strategy</em> of closures make it possible to design beautiful domain specific languages (DSLs) in Groovy.</p>
</div>
</div>
<div class="sect4">
<h5 id="closure-owner"><a class="anchor" href="#closure-owner"></a>Owner, delegate and this</h5>
<div class="paragraph">
<p>To understand the concept of delegate, we must first explain the meaning of <code>this</code> inside a closure. A closure actually
defines 3 distinct things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>this</code> corresponds to the <em>enclosing class</em> where the closure is defined</p>
</li>
<li>
<p><code>owner</code> corresponds to the <em>enclosing object</em> where the closure is defined, which may be either a class or a closure</p>
</li>
<li>
<p><code>delegate</code> corresponds to a third party object where methods calls or properties are resolved whenever the receiver of
the message is not defined</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="closure-this"><a class="anchor" href="#closure-this"></a>The meaning of this</h6>
<div class="paragraph">
<p>In a closure, calling <code>getThisObject</code> will return the enclosing class where the closure is defined. It is equivalent to
using an explicit <code>this</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Enclosing</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> whatIsThisObject </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> getThisObject</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> whatIsThisObject</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">                   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> whatIsThis </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> whatIsThis</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">                         </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">EnclosedInInnerClass</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Inner</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Closure</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                               </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> inner </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Inner</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> inner</span><span class="pun">.</span><span class="pln">cl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> inner                          </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NestedClosures</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> nestedClosures </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">def</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                               </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
            cl</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> nestedClosures</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">                     </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a closure is defined inside the <code>Enclosing</code> class, and returns <code>getThisObject</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>calling the closure will return the instance of <code>Enclosing</code> where the the closure is defined</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>in general, you will just want to use the shortcut <code>this</code> notation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and it returns <strong>exactly</strong> the same object</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>if the closure is defined in a inner class</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>this</code> in the closure <strong>will</strong> return the inner class, not the top-level one</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>in case of nested closures, like here <code>cl</code> being defined inside the scope of <code>nestedClosures</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>then <code>this</code> corresponds to the closest outer class, not the enclosing closure!</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is of course possible to call methods from the enclosing class this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">int</span><span class="pln"> age
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"$name is $age years old"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">dump</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">String</span><span class="pln"> msg </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">               </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
            println msg
            msg
        </span><span class="pun">}</span><span class="pln">
        cl</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Janice'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="lit">74</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="kwd">dump</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Janice is 74 years old'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the closure calls <code>toString</code> on <code>this</code>, which will actually call the <code>toString</code> method on the enclosing object,
that is to say the <code>Person</code> instance</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_owner_of_a_closure"><a class="anchor" href="#_owner_of_a_closure"></a>Owner of a closure</h6>
<div class="paragraph">
<p>The owner of a closure is very similar to the definition of <a href="#closure-this">this in a closure</a> with a subtle difference:
it will return the direct enclosing object, be it a closure or a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Enclosing</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> whatIsOwnerMethod </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> getOwner</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">               </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> whatIsOwnerMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">                   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> whatIsOwner </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> owner </span><span class="pun">}</span><span class="pln">                          </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> whatIsOwner</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">                         </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">EnclosedInInnerClass</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Inner</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Closure</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> owner </span><span class="pun">}</span><span class="pln">                               </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> inner </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Inner</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> inner</span><span class="pun">.</span><span class="pln">cl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> inner                           </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NestedClosures</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> nestedClosures </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">def</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> owner </span><span class="pun">}</span><span class="pln">                               </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
            cl</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> nestedClosures</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> nestedClosures            </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a closure is defined inside the <code>Enclosing</code> class, and returns <code>getOwner</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>calling the closure will return the instance of <code>Enclosing</code> where the the closure is defined</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>in general, you will just want to use the shortcut <code>owner</code> notation</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and it returns <strong>exactly</strong> the same object</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>if the closure is defined in a inner class</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>owner</code> in the closure <strong>will</strong> return the inner class, not the top-level one</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>but in case of nested closures, like here <code>cl</code> being defined inside the scope of <code>nestedClosures</code></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>then <code>owner</code> corresponds to the enclosing closure, hence a different object from <code>this</code>!</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_delegate_of_a_closure"><a class="anchor" href="#_delegate_of_a_closure"></a>Delegate of a closure</h6>
<div class="paragraph">
<p>The delegate of a closure can be accessed by using the <code>delegate</code> property or calling the <code>getDelegate</code> method. It is a
powerful concept for building domain specific languages in Groovy. While <a href="#this">closure-this</a> and <a href="#owner">closure-owner</a>
refer to the lexical scope of a closure, the delegate is a user defined object that a closure will use. By default, the
delegate is set to <code>owner</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Enclosing</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> getDelegate</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> cl2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                              </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> cl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> cl2</span><span class="pun">()</span><span class="pln">                                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> cl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">                                 </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> enclosed </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="pun">{</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">}.</span><span class="pln">call</span><span class="pun">()</span><span class="pln">                          </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> enclosed</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> enclosed                       </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>you can get the delegate of a closure calling the <code>getDelegate</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>or using the <code>delegate</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>both return the same object</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>which is the enclosing class or closure</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>in particular in case of nested closures</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>delegate</code> will correspond to the <code>owner</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The delegate of a closure can be changed to <strong>any object</strong>. Let’s illustrate this by creating two classes which are not
subclasses of each other but both define a property called <code>name</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Thing</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Norman'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Thing</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Teapot'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then let’s define a closure which fetches the <code>name</code> property on the delegate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> upperCasedName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then by changing the delegate of the closure, you can see that the target object will change:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">upperCasedName</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> p
</span><span class="kwd">assert</span><span class="pln"> upperCasedName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'NORMAN'</span><span class="pln">
upperCasedName</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> t
</span><span class="kwd">assert</span><span class="pln"> upperCasedName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'TEAPOT'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point, the behavior is not different from having a <code>target</code> variable defined in the lexical scope of the closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> target </span><span class="pun">=</span><span class="pln"> p
</span><span class="kwd">def</span><span class="pln"> upperCasedNameUsingVar </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> target</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> upperCasedNameUsingVar</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'NORMAN'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, there are major differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in the last example, <em>target</em> is a local variable referenced from within the closure</p>
</li>
<li>
<p>the delegate can be used transparently, that is to say without prefixing method calls with <code>delegate.</code> as explained
in the next paragraph.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_delegation_strategy_2"><a class="anchor" href="#_delegation_strategy_2"></a>Delegation strategy</h6>
<div class="paragraph">
<p>Whenever, in a closure, a property is accessed without explicitly setting a receiver object, then a delegation strategy
is involved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Igor'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> name</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                 </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
cl</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> p                                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> cl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'IGOR'</span><span class="pln">                           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>name</code> is not referencing a variable in the lexical scope of the closure</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can change the delegate of the closure to be an instance of <code>Person</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and the method call will succeed</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The reason this code works is that the <code>name</code> property will be resolved transparently on the <code>delegate</code> object! This is
a very powerful way to resolve properties or method calls inside closures. There’s no need to set an explicit <code>delegate.</code>
receiver: the call will be made because the default delegation strategy of the closure makes it so. A closure actually
defines multiple resolution strategies that you can choose:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Closure.OWNER_FIRST</code> is the <strong>default strategy</strong>. If a property/method exists on the <strong>owner</strong>, then it will be called on
the owner. If not, then the <strong>delegate</strong> is used.</p>
</li>
<li>
<p><code>Closure.DELEGATE_FIRST</code> reverses the logic: the <strong>delegate</strong> is used first, then the <strong>owner</strong></p>
</li>
<li>
<p><code>Closure.OWNER_ONLY</code> will only resolve the property/method lookup on the owner: the delegate will be ignored.</p>
</li>
<li>
<p><code>Closure.DELEGATE_ONLY</code> will only resolve the property/method lookup on the delegate: the owner will be ignored.</p>
</li>
<li>
<p><code>Closure.TO_SELF</code> can be used by developers who need advanced meta-programming techniques and wish to implement a
custom resolution strategy: the resolution will not be made on the owner or the delegate but only on the closure class
itself. It makes only sense to use this if you implement your own subclass of <code>Closure</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s illustrate the default "owner first" strategy with this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">def</span><span class="pln"> pretty </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"My name is $name"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        pretty</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Thing</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name                                     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Sarah'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Thing</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Teapot'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'My name is Sarah'</span><span class="pln">           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
p</span><span class="pun">.</span><span class="pln">pretty</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> t                               </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'My name is Sarah'</span><span class="pln">           </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>for the illustration, we define a closure member which references "name"</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>both the <code>Person</code> and the <code>Thing</code> class define a <code>name</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Using the default strategy, the <code>name</code> property is resolved on the owner first</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>so if we change the <code>delegate</code> to <code>t</code> which is an instance of <code>Thing</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>there is no change in the result: <code>name</code> is first resolved on the <code>owner</code> of the closure</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>However, it is possible to change the resolution strategy of the closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">p</span><span class="pun">.</span><span class="pln">pretty</span><span class="pun">.</span><span class="pln">resolveStrategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_FIRST
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'My name is Teapot'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By changing the <code>resolveStrategy</code>, we are modifying the way Groovy will resolve the "implicit this" references: in this
case, <code>name</code> will first be looked in the delegate, then if not found, on the owner. Since <code>name</code> is defined in the
delegate, an instance of <code>Thing</code>, then this value is used.</p>
</div>
<div class="paragraph">
<p>The difference between "delegate first" and "delegate only" or "owner first" and "owner only" can be illustrated if one
of the delegate (resp. owner) does <strong>not</strong> have such a method or property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">int</span><span class="pln"> age
    </span><span class="kwd">def</span><span class="pln"> fetchAge </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> age </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Thing</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Jessica'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="lit">42</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Thing</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Printer'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">fetchAge
cl</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> p
</span><span class="kwd">assert</span><span class="pln"> cl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">42</span><span class="pln">
cl</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> t
</span><span class="kwd">assert</span><span class="pln"> cl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">42</span><span class="pln">
cl</span><span class="pun">.</span><span class="pln">resolveStrategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_ONLY
cl</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> p
</span><span class="kwd">assert</span><span class="pln"> cl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">42</span><span class="pln">
cl</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> t
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    cl</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">MissingPropertyException</span><span class="pln"> ex</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// "age" is not defined on the delegate</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we define two classes which both have a <code>name</code> property but only the <code>Person</code> class declares an <code>age</code>.
The <code>Person</code> class also declares a closure which references <code>age</code>. We can change the default resolution strategy from
"owner first" to "delegate only". Since the owner of the closure is the <code>Person</code> class, then we can check that if the
delegate is an instance of <code>Person</code>, calling the closure is successful, but if we call it with a delegate being an
instance of <code>Thing</code>, it fails with a <code>groovy.lang.MissingPropertyException</code>. Despite the closure being defined inside
the <code>Person</code> class, the owner is not used.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A comprehensive explanation about how to use this feature to develop DSLs can be found in a
<a href="http://docs.groovy-lang.org/latest/html/documentation/core-domain-specific-languages.html">dedicated section of the manual</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_closures_in_gstrings"><a class="anchor" href="#_closures_in_gstrings"></a>1.5.4. Closures in GStrings</h4>
<div class="paragraph">
<p>Take the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> gs </span><span class="pun">=</span><span class="pln"> </span><span class="str">"x = ${x}"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> gs </span><span class="pun">==</span><span class="pln"> </span><span class="str">'x = 1'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code behaves as you would expect, but what happens if you add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> gs </span><span class="pun">==</span><span class="pln"> </span><span class="str">'x = 2'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see that the assert fails! There are two reasons for this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a GString only evaluates lazily the <code>toString</code> representation of values</p>
</li>
<li>
<p>the syntax <code>${x}</code> in a GString does <strong>not</strong> represent a closure but an <strong>expression</strong> to <code>$x</code>, evaluated when the GString
is created.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our example, the <code>GString</code> is created with an expression referencing <code>x</code>. When the <code>GString</code> is created, the <strong>value</strong>
of <code>x</code> is 1, so the <code>GString</code> is created with a value of 1. When the assert is triggered, the <code>GString</code> is evaluated
and 1 is converted to a <code>String</code> using <code>toString</code>. When we change <code>x</code> to 2, we did change the value of <code>x</code>, but it is
a different object, and the <code>GString</code> still references the old one.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A <code>GString</code> will only change its <code>toString</code> representation if the values it references are mutating. If the references
change, nothing will happen.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you need a real closure in a GString and for example enforce lazy evaluation of variables, you need to use the
alternate syntax <code>${→ x}</code> like in the fixed example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> gs </span><span class="pun">=</span><span class="pln"> </span><span class="str">"x = ${-&gt; x}"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> gs </span><span class="pun">==</span><span class="pln"> </span><span class="str">'x = 1'</span><span class="pln">

x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> gs </span><span class="pun">==</span><span class="pln"> </span><span class="str">'x = 2'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And let’s illustrate how it differs from mutation with this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> name </span><span class="pun">}</span><span class="pln">          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> sam </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Sam'</span><span class="pun">)</span><span class="pln">        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> lucy </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Lucy'</span><span class="pun">)</span><span class="pln">      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> sam                             </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> gs </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Name: ${p}"</span><span class="pln">                   </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> gs </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Name: Sam'</span><span class="pln">                </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
p </span><span class="pun">=</span><span class="pln"> lucy                                </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> gs </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Name: Sam'</span><span class="pln">                </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
sam</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Lucy'</span><span class="pln">                       </span><i class="conum" data-value="9"></i><b><span class="pun">(</span><span class="lit">9</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> gs </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Name: Lucy'</span><span class="pln">               </span><i class="conum" data-value="10"></i><b><span class="pun">(</span><span class="lit">10</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Person</code> class has a <code>toString</code> method returning the <code>name</code> property</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we create a first <code>Person</code> named <em>Sam</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we create another <code>Person</code> named <em>Lucy</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <code>p</code> variable is set to <code>Sam</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>and a closure is created, referencing the value of <code>p</code>, that is to say <em>Sam</em></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>so when we evaluate the string, it returns <em>Sam</em></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>if we change <code>p</code> to <em>Lucy</em></td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>the string still evaluates to <em>Sam</em> because it was the <strong>value</strong> of <code>p</code> when the <code>GString</code> was created</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>so if we mutate <em>Sam</em> to change his name to <em>Lucy</em></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>this time the <code>GString</code> is correctly mutated</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>So if you don’t want to rely on mutating objects or wrapping objects, you <strong>must</strong> use closures in <code>GString</code> by explicitly
declaring an empty argument list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> name </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> sam </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Sam'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> lucy </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Lucy'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> sam
</span><span class="com">// Create a GString with lazy evaluation of "p"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> gs </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Name: ${-&gt; p}"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> gs </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Name: Sam'</span><span class="pln">
p </span><span class="pun">=</span><span class="pln"> lucy
</span><span class="kwd">assert</span><span class="pln"> gs </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Name: Lucy'</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_closure_coercion"><a class="anchor" href="#_closure_coercion"></a>1.5.5. Closure coercion</h4>
<div class="paragraph">
<p>Closures can be converted into interfaces or single-abstract method types. Please refer to
<a href="http://docs.groovy-lang.org/latest/html/documentation/core-semantics.html#closure-coercion">this section of the manual</a> for a complete description.</p>
</div>
</div>
<div class="sect3">
<h4 id="_functional_programming"><a class="anchor" href="#_functional_programming"></a>1.5.6. Functional programming</h4>
<div class="paragraph">
<p>Closures, like <a href="http://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">lambda expressions in Java 8</a> are at the core of the functional programming paradigm in Groovy. Some functional programming
operations on functions are available directly on the <code>Closure</code> class, like illustrated in this section.</p>
</div>
<div class="sect4">
<h5 id="_currying"><a class="anchor" href="#_currying"></a>Currying</h5>
<div class="paragraph">
<p>In Groovy, currying refers to the concept of partial application. It does <strong>not</strong> correspond to the real concept of currying
in functional programming because of the different scoping rules that Groovy applies on closures. Currying in Groovy will
let you set the value of one parameter of a closure, and it will return a new closure accepting one less argument.</p>
</div>
<div class="sect5">
<h6 id="_left_currying"><a class="anchor" href="#_left_currying"></a>Left currying</h6>
<div class="paragraph">
<p>Left currying is the fact of setting the left-most parameter of a closure, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> nCopies </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> str </span><span class="pun">-&gt;</span><span class="pln"> str</span><span class="pun">*</span><span class="pln">n </span><span class="pun">}</span><span class="pln">    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> twice </span><span class="pun">=</span><span class="pln"> nCopies</span><span class="pun">.</span><span class="pln">curry</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln">                    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> twice</span><span class="pun">(</span><span class="str">'bla'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'blabla'</span><span class="pln">                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> twice</span><span class="pun">(</span><span class="str">'bla'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> nCopies</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="str">'bla'</span><span class="pun">)</span><span class="pln">        </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>nCopies</code> closure defines two parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>curry</code> will set the first parameter to <code>2</code>, creating a new closure (function) which accepts a single <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>so the new function call be called with only a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and it is equivalent to calling <code>nCopies</code> with two parameters</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_right_currying"><a class="anchor" href="#_right_currying"></a>Right currying</h6>
<div class="paragraph">
<p>Similarily to left currying, it is possible to set the right-most parameter of a closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> nCopies </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> str </span><span class="pun">-&gt;</span><span class="pln"> str</span><span class="pun">*</span><span class="pln">n </span><span class="pun">}</span><span class="pln">    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> blah </span><span class="pun">=</span><span class="pln"> nCopies</span><span class="pun">.</span><span class="pln">rcurry</span><span class="pun">(</span><span class="str">'bla'</span><span class="pun">)</span><span class="pln">                </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> blah</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'blabla'</span><span class="pln">                      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> blah</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> nCopies</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="str">'bla'</span><span class="pun">)</span><span class="pln">             </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>nCopies</code> closure defines two parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>rcurry</code> will set the last parameter to <code>bla</code>, creating a new closure (function) which accepts a single <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>so the new function call be called with only an <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and it is equivalent to calling <code>nCopies</code> with two parameters</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_index_based_currying"><a class="anchor" href="#_index_based_currying"></a>Index based currying</h6>
<div class="paragraph">
<p>In case a closure accepts more than 2 parameters, it is possible to set an arbitrary parameter using <code>ncurry</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> volume </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> l</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> w</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">double</span><span class="pln"> h </span><span class="pun">-&gt;</span><span class="pln"> l</span><span class="pun">*</span><span class="pln">w</span><span class="pun">*</span><span class="pln">h </span><span class="pun">}</span><span class="pln">      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> fixedWidthVolume </span><span class="pun">=</span><span class="pln"> volume</span><span class="pun">.</span><span class="pln">ncurry</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2d</span><span class="pun">)</span><span class="pln">                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> volume</span><span class="pun">(</span><span class="lit">3d</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2d</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> fixedWidthVolume</span><span class="pun">(</span><span class="lit">3d</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4d</span><span class="pun">)</span><span class="pln">       </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> fixedWidthAndHeight </span><span class="pun">=</span><span class="pln"> volume</span><span class="pun">.</span><span class="pln">ncurry</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2d</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4d</span><span class="pun">)</span><span class="pln">          </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> volume</span><span class="pun">(</span><span class="lit">3d</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2d</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> fixedWidthAndHeight</span><span class="pun">(</span><span class="lit">3d</span><span class="pun">)</span><span class="pln">        </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>volume</code> function defines 3 parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>ncurry</code> will set the second parameter (index = 1) to <code>2d</code>, creating a new volume function which accepts length and height</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>that function is equivalent to calling <code>volume</code> omitting the width</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>it is also possible to set multiple parameters, starting from the specified index</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the resulting function accepts as many parameters as the initial one minus the number of parameters set by <code>ncurry</code></td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_memoization"><a class="anchor" href="#_memoization"></a>Memoization</h5>
<div class="paragraph">
<p>Memoization allows the result of the call of a closure to be cached. It is interesting if the computation done by a
function (closure) is slow, but you know that this function is going to be called often with the same arguments. A
typical example is the Fibonacci suite. A naive implementation may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> fib
fib </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> n </span><span class="pun">-&gt;</span><span class="pln"> n</span><span class="pun">&lt;</span><span class="lit">2</span><span class="pun">?</span><span class="pln">n</span><span class="pun">:</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)+</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> fib</span><span class="pun">(</span><span class="lit">15</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">610</span><span class="pln"> </span><span class="com">// slow!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is a naive implementation because 'fib' is often called recursively with the same arguments, leading to an exponential
algorithm:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>computing <code>fib(15)</code> requires the result of <code>fib(14)</code> and <code>fib(13)</code></p>
</li>
<li>
<p>computing <code>fib(14)</code> requires the result of <code>fib(13)</code> and <code>fib(12)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since calls are recursive, you can already see that we will compute the same values again and again, although they could
be cached. This naive implementation can be "fixed" by caching the result of calls using <code>memoize</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">fib </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> n </span><span class="pun">-&gt;</span><span class="pln"> n</span><span class="pun">&lt;</span><span class="lit">2</span><span class="pun">?</span><span class="pln">n</span><span class="pun">:</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)+</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}.</span><span class="pln">memoize</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> fib</span><span class="pun">(</span><span class="lit">25</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">75025</span><span class="pln"> </span><span class="com">// fast!</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The cache works <strong>using the actual values of the arguments</strong>. This means that you should be very careful if you use
memoization with something else than primitive or boxed primitive types.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The behavior of the cache can be tweaked using alternate methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>memoizeAtMost</code> will generate a new closure which caches <strong>at most</strong> <em>n</em> values</p>
</li>
<li>
<p><code>memoizeAtLeast</code> will generate a new closure which caches <strong>at least</strong> <em>n</em> values</p>
</li>
<li>
<p><code>memoizeBetween</code> will generate a new closure which caches <strong>at least</strong> <em>n</em> values and <strong>at most</strong> <em>n</em> values</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The cache used in all memoize variants is a LRU cache.</p>
</div>
</div>
<div class="sect4">
<h5 id="_composition"><a class="anchor" href="#_composition"></a>Composition</h5>
<div class="paragraph">
<p>Closure composition corresponds to the concept of function composition, that is to say creating a new function by
composing two or more functions (chaining calls), as illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> plus2  </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> times3 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">*</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> times3plus2 </span><span class="pun">=</span><span class="pln"> plus2 </span><span class="pun">&lt;&lt;</span><span class="pln"> times3
</span><span class="kwd">assert</span><span class="pln"> times3plus2</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">11</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> times3plus2</span><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> plus2</span><span class="pun">(</span><span class="pln">times3</span><span class="pun">(</span><span class="lit">4</span><span class="pun">))</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> plus2times3 </span><span class="pun">=</span><span class="pln"> times3 </span><span class="pun">&lt;&lt;</span><span class="pln"> plus2
</span><span class="kwd">assert</span><span class="pln"> plus2times3</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">15</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> plus2times3</span><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> times3</span><span class="pun">(</span><span class="pln">plus2</span><span class="pun">(</span><span class="lit">5</span><span class="pun">))</span><span class="pln">

</span><span class="com">// reverse composition</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> times3plus2</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">(</span><span class="pln">times3 </span><span class="pun">&gt;&gt;</span><span class="pln"> plus2</span><span class="pun">)(</span><span class="lit">3</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_trampoline"><a class="anchor" href="#_trampoline"></a>Trampoline</h5>
<div class="paragraph">
<p>Recursive algorithms are often restricted by a physical limit: the maximum stack height. For example, if you call a method
that recursively calls itself too deep, you will eventually receive a <code>StackOverflowException</code>.</p>
</div>
<div class="paragraph">
<p>An approach that helps in those situations is by using <code>Closure</code> and its trampoline capability.</p>
</div>
<div class="paragraph">
<p>Closures are wrapped in a <code>TrampolineClosure</code>. Upon calling, a trampolined <code>Closure</code> will call the original <code>Closure</code> waiting
for its result. If the outcome of the call is another instance of a <code>TrampolineClosure</code>, created perhaps as a result
to a call to the <code>trampoline()</code> method, the <code>Closure</code> will again be invoked. This repetitive invocation of returned
trampolined Closures instances will continue until a value other than a trampolined <code>Closure</code> is returned. That value
will become the final result of the trampoline. That way, calls are made serially, rather than filling the stack.</p>
</div>
<div class="paragraph">
<p>Here’s an example of the use of <code>trampoline()</code> to implement the factorial function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> factorial
factorial </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> accu </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1G</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> accu
    factorial</span><span class="pun">.</span><span class="pln">trampoline</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> n </span><span class="pun">*</span><span class="pln"> accu</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
factorial </span><span class="pun">=</span><span class="pln"> factorial</span><span class="pun">.</span><span class="pln">trampoline</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> factorial</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">    </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> factorial</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln">    </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> factorial</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">)</span><span class="pln"> </span><span class="com">// == 402387260.. plus another 2560 digits</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_method_pointers"><a class="anchor" href="#_method_pointers"></a>Method pointers</h5>
<div class="paragraph">
<p>It is often practical to be able to use a regular method as a closure. For example, you might want to use the currying
abilities of a closure, but those are not available to normal methods. In Groovy, you can obtain a closure from any
method with the <a href="http://docs.groovy-lang.org/latest/html/documentation/core-operators.html#method-pointer-operator">method pointer operator</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_semantics"><a class="anchor" href="#_semantics"></a>1.6. Semantics</h3>
<div class="paragraph">
<p>This chapter covers the semantics of the Groovy programming language.</p>
</div>
<div class="sect3">
<h4 id="_statements"><a class="anchor" href="#_statements"></a>1.6.1. Statements</h4>
<div class="sect4">
<h5 id="_variable_definition"><a class="anchor" href="#_variable_definition"></a>Variable definition</h5>
<div class="paragraph">
<p>Variables can be defined using either their type (like <code>String</code>) or by using the keyword <code>def</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> x
</span><span class="kwd">def</span><span class="pln"> o</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>def</code> is a replacement for a type name. In variable 
definitions it is used to indicate that you don’t care about the type. 
In variable definitions it is mandatory to either provide a type name 
explicitly or to use "def" in replacement. This is needed to make 
variable definitions detectable for the Groovy parser.</p>
</div>
<div class="paragraph">
<p>You can think of <code>def</code> as an alias of <code>Object</code> and you will understand it in an instant.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Variable definition types can be refined by using generics, like in <code>List&lt;String&gt; names</code>.
To learn more about the generics support, please read the <a href="#generics">generics section</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_variable_assignment"><a class="anchor" href="#_variable_assignment"></a>Variable assignment</h5>
<div class="paragraph">
<p>You can assign values to variables for later use. Try the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
println x

x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Date</span><span class="pun">()</span><span class="pln">
println x

x </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">3.1499392</span><span class="pln">
println x

x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
println x

x </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Hi"</span><span class="pln">
println x</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_multiple_assignment"><a class="anchor" href="#_multiple_assignment"></a>Multiple assignment</h6>
<div class="paragraph">
<p>Groovy supports multiple assignment, i.e. where multiple variables can be assigned at once, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span class="pun">,</span><span class="pln"> </span><span class="str">'foo'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> b </span><span class="pun">==</span><span class="pln"> </span><span class="lit">20</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> c </span><span class="pun">==</span><span class="pln"> </span><span class="str">'foo'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can provide types as part of the declaration if you wish:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> j</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="str">'foo'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> i </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> j </span><span class="pun">==</span><span class="pln"> </span><span class="str">'foo'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as used when declaring variables it also applies to existing variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> nums </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">,</span><span class="pln"> c
</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> nums
</span><span class="kwd">assert</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> b </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> c </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax works for arrays as well as lists, as well as methods that return either of these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="pun">(</span><span class="pln">_</span><span class="pun">,</span><span class="pln"> month</span><span class="pun">,</span><span class="pln"> year</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"18th June 2009"</span><span class="pun">.</span><span class="pln">split</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"In $month of $year"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'In June of 2009'</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_overflow_and_underflow"><a class="anchor" href="#_overflow_and_underflow"></a>Overflow and Underflow</h6>
<div class="paragraph">
<p>If the left hand side has too many variables, excess ones are filled with null’s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> b </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> c </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the right hand side has too many variables, the extra ones are ignored:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> b </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_object_destructuring_with_multiple_assignment"><a class="anchor" href="#_object_destructuring_with_multiple_assignment"></a>Object destructuring with multiple assignment</h6>
<div class="paragraph">
<p>In the section describing the various <a href="#groovy-operators">Groovy operators</a>,
the case of the <a href="#subscript-operator">subscript operator</a> has been covered,
explaining how you can override the <code>getAt()</code>/<code>putAt()</code> method.</p>
</div>
<div class="paragraph">
<p>With this technique, we can combine multiple assignments and the subscript operator methods to implement <em>object destructuring</em>.</p>
</div>
<div class="paragraph">
<p>Consider the following immutable <code>Coordinates</code> class, containing a pair of longitude and latitude doubles,
and notice our implementation of the <code>getAt()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Immutable</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Coordinates</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">double</span><span class="pln"> latitude
    </span><span class="kwd">double</span><span class="pln"> longitude

    </span><span class="kwd">double</span><span class="pln"> getAt</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> idx</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">idx </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> latitude
        </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">idx </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> longitude
        </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Exception</span><span class="pun">(</span><span class="str">"Wrong coordinate index, use 0 or 1"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let’s instantiate this class and destructure its longitude and latitude:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> coordinates </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Coordinates</span><span class="pun">(</span><span class="pln">latitude</span><span class="pun">:</span><span class="pln"> </span><span class="lit">43.23</span><span class="pun">,</span><span class="pln"> longitude</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3.67</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> </span><span class="pun">(</span><span class="pln">la</span><span class="pun">,</span><span class="pln"> lo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> coordinates                                          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> la </span><span class="pun">==</span><span class="pln"> </span><span class="lit">43.23</span><span class="pln">                                                  </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> lo </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3.67</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we create an instance of the <code>Coordinates</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then, we use a multiple assignment to get the individual longitude and latitude values</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and we can finally assert their values.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_control_structures"><a class="anchor" href="#_control_structures"></a>Control structures</h5>
<div class="sect5">
<h6 id="_conditional_structures"><a class="anchor" href="#_conditional_structures"></a>Conditional structures</h6>
<div class="sect6">
<h7 id="_if_else"><a class="anchor" href="#_if_else"></a>if / else</h7>
<div class="paragraph">
<p>Groovy supports the usual if - else syntax from Java</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">

</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">!</span><span class="pln">x </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">

</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> x </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    y </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> y</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy also supports the normal Java "nested" if then else if syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(...)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_switch_case"><a class="anchor" href="#_switch_case"></a>switch / case</h7>
<div class="paragraph">
<p>The switch statement in Groovy is backwards compatible with Java 
code; so you can fall through cases sharing the same code for multiple 
matches.</p>
</div>
<div class="paragraph">
<p>One difference though is that the Groovy switch statement can handle 
any kind of switch value and different kinds of matching can be 
performed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1.23</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="str">""</span><span class="pln">

</span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> x </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">case</span><span class="pln"> </span><span class="str">"foo"</span><span class="pun">:</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"found foo"</span><span class="pln">
        </span><span class="com">// lets fall through</span><span class="pln">

    </span><span class="kwd">case</span><span class="pln"> </span><span class="str">"bar"</span><span class="pun">:</span><span class="pln">
        result </span><span class="pun">+=</span><span class="pln"> </span><span class="str">"bar"</span><span class="pln">

    </span><span class="kwd">case</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="str">'inList'</span><span class="pun">]:</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"list"</span><span class="pln">
        </span><span class="kwd">break</span><span class="pln">

    </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">12.</span><span class="pun">.</span><span class="lit">30</span><span class="pun">:</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"range"</span><span class="pln">
        </span><span class="kwd">break</span><span class="pln">

    </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">:</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"integer"</span><span class="pln">
        </span><span class="kwd">break</span><span class="pln">

    </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">Number</span><span class="pun">:</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"number"</span><span class="pln">
        </span><span class="kwd">break</span><span class="pln">

    </span><span class="kwd">case</span><span class="pln"> </span><span class="pun">~</span><span class="str">/fo*/</span><span class="pun">:</span><span class="pln"> </span><span class="com">// toString() representation of x matches the pattern?</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"foo regex"</span><span class="pln">
        </span><span class="kwd">break</span><span class="pln">

    </span><span class="kwd">case</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}:</span><span class="pln"> </span><span class="com">// or { x &lt; 0 }</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"negative"</span><span class="pln">
        </span><span class="kwd">break</span><span class="pln">

    </span><span class="kwd">default</span><span class="pun">:</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"default"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="str">"number"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Switch supports the following kinds of comparisons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Class case values match if the switch value is an instance of the class</p>
</li>
<li>
<p>Regular expression case values match if the <code>toString()</code> representation of the switch value matches the regex</p>
</li>
<li>
<p>Collection case values match if the switch value is contained in the 
collection. This also includes ranges (since they are Lists)</p>
</li>
<li>
<p>Closure case values match if the calling the closure returns a result which is true according to the <a href="#Groovy-Truth">Groovy truth</a></p>
</li>
<li>
<p>If none of the above are used then the case value matches if the case value equals the switch value</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using a closure case value, the default <code>it</code> parameter is actually the switch value (in our example, variable <code>x</code>).
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_looping_structures"><a class="anchor" href="#_looping_structures"></a>Looping structures</h6>
<div class="sect6">
<h7 id="_classic_for_loop"><a class="anchor" href="#_classic_for_loop"></a>Classic for loop</h7>
<div class="paragraph">
<p>Groovy supports the standard Java / C for loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> message </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">5</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    message </span><span class="pun">+=</span><span class="pln"> </span><span class="str">'Hi '</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> message </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hi Hi Hi Hi Hi '</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_for_in_loop"><a class="anchor" href="#_for_in_loop"></a>for in loop</h7>
<div class="paragraph">
<p>The for loop in Groovy is much simpler and works with any kind of array, collection, Map, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// iterate over a range</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="lit">9</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">+=</span><span class="pln"> i
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="lit">45</span><span class="pln">

</span><span class="com">// iterate over a list</span><span class="pln">
x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">+=</span><span class="pln"> i
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span><span class="pln">

</span><span class="com">// iterate over an array</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> array </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0.</span><span class="pun">.</span><span class="lit">4</span><span class="pun">).</span><span class="pln">toArray</span><span class="pun">()</span><span class="pln">
x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> i </span><span class="kwd">in</span><span class="pln"> array </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">+=</span><span class="pln"> i
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span><span class="pln">

</span><span class="com">// iterate over a map</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'abc'</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'def'</span><span class="pun">:</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="str">'xyz'</span><span class="pun">:</span><span class="lit">3</span><span class="pun">]</span><span class="pln">
x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> e </span><span class="kwd">in</span><span class="pln"> map </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">+=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">value
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="lit">6</span><span class="pln">

</span><span class="com">// iterate over values in a map</span><span class="pln">
x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> v </span><span class="kwd">in</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">values</span><span class="pun">()</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x </span><span class="pun">+=</span><span class="pln"> v
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="lit">6</span><span class="pln">

</span><span class="com">// iterate over the characters in a string</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> text </span><span class="pun">=</span><span class="pln"> </span><span class="str">"abc"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">c </span><span class="kwd">in</span><span class="pln"> text</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    list</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">c</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">"a"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"b"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Groovy also supports the Java colon variation with colons: <code>for (char c : text) {}</code>,
where the type of the variable is mandatory.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect6">
<h7 id="_while_loop"><a class="anchor" href="#_while_loop"></a>while loop</h7>
<div class="paragraph">
<p>Groovy supports the usual while {…​} loops like Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln">

</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> y</span><span class="pun">--</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x</span><span class="pun">++</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_exception_handling"><a class="anchor" href="#_exception_handling"></a>Exception handling</h6>
<div class="paragraph">
<p>Exception handling is the same as Java.</p>
</div>
</div>
<div class="sect5">
<h6 id="_try_catch_finally"><a class="anchor" href="#_try_catch_finally"></a>try / catch / finally</h6>
<div class="paragraph">
<p>You can specify a complete <code>try-catch-finally</code>, a <code>try-catch</code>, or a <code>try-finally</code> set of blocks.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Braces are required around each block’s body.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">'moo'</span><span class="pun">.</span><span class="pln">toLong</span><span class="pun">()</span><span class="pln">   </span><span class="com">// this will generate an exception</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">     </span><span class="com">// asserting that this point should never be reached</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> e </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> e </span><span class="kwd">in</span><span class="pln"> </span><span class="typ">NumberFormatException</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can put code within a 'finally' clause following a matching 'try' 
clause, so that regardless of whether the code in the 'try' clause 
throws an exception, the code in the finally clause will always execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> z
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">/</span><span class="pln"> j
        </span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">        </span><span class="com">//never reached due to Exception in previous line</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        z </span><span class="pun">=</span><span class="pln"> </span><span class="str">'reached here'</span><span class="pln">  </span><span class="com">//always executed even if Exception thrown</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> e </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> e </span><span class="kwd">in</span><span class="pln"> </span><span class="typ">ArithmeticException</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> z </span><span class="pun">==</span><span class="pln"> </span><span class="str">'reached here'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_multi_catch"><a class="anchor" href="#_multi_catch"></a>Multi-catch</h6>
<div class="paragraph">
<p>With the multi catch block (since Groovy 2.0), we’re able to define 
several exceptions to be catch and treated by the same catch block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">/* ... */</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">NullPointerException</span><span class="pln"> e </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">/* one block to handle 2 exceptions */</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_power_assertion"><a class="anchor" href="#_power_assertion"></a>Power assertion</h5>
<div class="paragraph">
<p>Unlike Java with which Groovy shares the <code>assert</code> keyword, the latter in Groovy behaves very differently. First of all,
an assertion in Groovy is always executed, independently of the <code>-ea</code> flag of the JVM. It makes this a first class choice
for unit tests. The notion of "power asserts" is directly related to how the Groovy <code>assert</code> behaves.</p>
</div>
<div class="paragraph">
<p>A power assertion is decomposed into 3 parts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>assert [left expression] == [right expression] : (optional message)</pre>
</div>
</div>
<div class="paragraph">
<p>The result of the assertion is very different from what you would get in Java. If the assertion is true, then nothing
happens. If the assertion is false, then it provides a visual representation of the value of each sub-expressions of the
expression being asserted. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="lit">1</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Will yield:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Caught: Assertion failed:

assert 1+1 == 3
        |  |
        2  false</pre>
</div>
</div>
<div class="paragraph">
<p>Power asserts become very interesting when the expressions are more complex, like in the next example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> calc </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln">b </span><span class="pun">-&gt;</span><span class="pln"> a</span><span class="pun">*</span><span class="pln">b</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="pln">x</span><span class="pun">,</span><span class="pln">z</span><span class="pun">].</span><span class="pln">sum</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will print the value for each sub-expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="pln">x</span><span class="pun">,</span><span class="pln">z</span><span class="pun">].</span><span class="pln">sum</span><span class="pun">()</span><span class="pln">
       </span><span class="pun">|</span><span class="pln">    </span><span class="pun">|</span><span class="pln"> </span><span class="pun">|</span><span class="pln">  </span><span class="pun">|</span><span class="pln">   </span><span class="pun">|</span><span class="pln"> </span><span class="pun">|</span><span class="pln">  </span><span class="pun">|</span><span class="pln">
       </span><span class="lit">15</span><span class="pln">   </span><span class="lit">2</span><span class="pln"> </span><span class="lit">7</span><span class="pln">  </span><span class="pun">|</span><span class="pln">   </span><span class="lit">2</span><span class="pln"> </span><span class="lit">5</span><span class="pln">  </span><span class="lit">7</span><span class="pln">
                 </span><span class="kwd">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you don’t want a pretty printed error message like above, you can fallback to a custom error message by
changing the optional message part of the assertion, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> calc </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln">b </span><span class="pun">-&gt;</span><span class="pln"> a</span><span class="pun">*</span><span class="pln">b</span><span class="pun">+</span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln">y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> z</span><span class="pun">*</span><span class="pln">z </span><span class="pun">:</span><span class="pln"> </span><span class="str">'Incorrect computation result'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will print the following error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Incorrect</span><span class="pln"> computation result</span><span class="pun">.</span><span class="pln"> </span><span class="typ">Expression</span><span class="pun">:</span><span class="pln"> </span><span class="pun">(</span><span class="pln">calc</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">(</span><span class="pln">z </span><span class="pun">*</span><span class="pln"> z</span><span class="pun">)).</span><span class="pln"> </span><span class="typ">Values</span><span class="pun">:</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_labeled_statements"><a class="anchor" href="#_labeled_statements"></a>Labeled statements</h5>
<div class="paragraph">
<p>Any statement can be associated with a label. Labels do not impact the semantics of the code and can be used to make
the code easier to read like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">given</span><span class="pun">:</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">when</span><span class="pun">:</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">+</span><span class="pln">y
</span><span class="kwd">then</span><span class="pun">:</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> z </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Despite not changing the semantics of the the labelled statement, it is possible to use labels in the <code>break</code> instruction
as a target for jump, as in the next example. However, even if this is allowed, this coding style is in general considered
a bad practice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">i</span><span class="pun">&lt;</span><span class="lit">10</span><span class="pun">;</span><span class="pln">i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln">j</span><span class="pun">&lt;</span><span class="pln">i</span><span class="pun">;</span><span class="pln">j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"j=$j"</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">break</span><span class="pln"> </span><span class="kwd">exit</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">exit</span><span class="pun">:</span><span class="pln"> println </span><span class="str">"i=$i"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to understand that by default labels have no impact 
on the semantics of the code, however they belong to the abstract
syntax tree (AST) so it is possible for an AST transformation to use 
that information to perform transformations over
the code, hence leading to different semantics. This is in particular 
what the <a href="http://spockframework.github.io/spock/docs/current/index.html">Spock Framework</a>
does to make testing easier.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expressions"><a class="anchor" href="#_expressions"></a>1.6.2. Expressions</h4>
<div class="paragraph">
<p>(TBD)</p>
</div>
<div class="sect4">
<h5 id="gpath_expressions"><a class="anchor" href="#gpath_expressions"></a>GPath expressions</h5>
<div class="paragraph">
<p><code>GPath</code> is a path expression language integrated into 
Groovy which allows parts of nested structured data to be identified. In
 this
sense, it has similar aims and scope as XPath does for XML.  GPath is 
often used in the context of processing XML, but it really applies
to any object graph.  Where XPath uses a filesystem-like path notation, a
 tree hierarchy with parts separated by a slash <code>/</code>, GPath <strong>use a
dot-object notation</strong> to perform object navigation.</p>
</div>
<div class="paragraph">
<p>As an example, you can specify a path to an object or element of interest:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>a.b.c</code> → for XML, yields all the <code>c</code> elements inside <code>b</code> inside <code>a</code></p>
</li>
<li>
<p><code>a.b.c</code> → for POJOs, yields the <code>c</code> properties for all the <code>b</code> properties of <code>a</code> (sort of like <code>a.getB().getC()</code> in JavaBeans)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In both cases, the GPath expression can be viewed as a query on an 
object graph.  For POJOs, the object graph is most often built by the
program being written through object instantiation and composition; for 
XML processing, the object graph is the result of <code>parsing</code>
the XML text, most often with classes like XmlParser or XmlSlurper. See 
&lt;&lt;..\..\../subprojects/groovy-xml/src/spec/doc/xml-userguide.adoc#Processing
 XML,Processing XML&gt;&gt;
for more in-depth details on consuming XML in Groovy.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When querying the object graph generated from XmlParser or 
XmlSlurper, a GPath expression can refer to attributes defined on 
elements with
the <code>@</code> notation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>a["@href"]</code> → map-like notation : the href attribute of all the a elements</p>
</li>
<li>
<p><code>a.'@href'</code>  → property notation : an alternative way of expressing this</p>
</li>
<li>
<p><code>a.@href</code>    → direct notation : yet another alternative way of expressing this</p>
</li>
</ul>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="sect5">
<h6 id="_object_navigation"><a class="anchor" href="#_object_navigation"></a>Object navigation</h6>
<div class="paragraph">
<p>Let’s see an example of a GPath expression on a simple <em>object graph</em>, the one obtained using java reflection.  Suppose you are in a non-static method of a
class having another method named <code>aMethodFoo</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> aMethodFoo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"This is aMethodFoo."</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><i class="conum" data-value="0"></i><b><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="paragraph">
<p>the following GPath expression will get the name of that method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'aMethodFoo'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">methods</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">grep</span><span class="pun">(~</span><span class="str">/.*Foo/</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>More precisely</em>, the above GPath expression produces a list of String, each being the name of an existing method on <code>this</code> where that name ends with <code>Foo</code>.</p>
</div>
<div class="paragraph">
<p>Now, given the following methods also defined in that class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> aMethodBar</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"This is aMethodBar."</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">void</span><span class="pln"> anotherFooMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"This is anotherFooMethod."</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">void</span><span class="pln"> aSecondMethodBar</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"This is aSecondMethodBar."</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="paragraph">
<p>then the following GPath expression will get the names of <strong>(1)</strong> and <strong>(3)</strong>, but not <strong>(2)</strong> or <strong>(0)</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'aMethodBar'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'aSecondMethodBar'</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Set</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">methods</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">grep</span><span class="pun">(~</span><span class="str">/.*Bar/</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Set</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_expression_deconstruction"><a class="anchor" href="#_expression_deconstruction"></a>Expression Deconstruction</h6>
<div class="paragraph">
<p>We can decompose the expression <code>this.class.methods.name.grep(~/.*Bar/)</code> to get an idea of how a GPath is evaluated:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>this.class</code></dt>
<dd>
<p>property accessor, equivalent to <code>this.getClass()</code> in Java, yields a <code>Class</code> object.</p>
</dd>
<dt class="hdlist1"><code>this.class.methods</code></dt>
<dd>
<p>property accessor, equivalent to <code>this.getClass().getMethods()</code>, yields an array of <code>Method</code> objects.</p>
</dd>
<dt class="hdlist1"><code>this.class.methods.name</code></dt>
<dd>
<p>apply a property accessor on each element of an array and produce a list of the results.</p>
</dd>
<dt class="hdlist1"><code>this.class.methods.name.grep(…​)</code></dt>
<dd>
<p>call method <code>grep</code> on each element of the list yielded by <code>this.class.methods.name</code> and produce a list of the results.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
A sub-expression like <code>this.class.methods</code> yields an array because this is what calling <code>this.getClass().getMethods()</code> in Java
would produce. <code>GPath</code> expressions do not have a convention where a <code>s</code> means a list or anything like that.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>One powerful feature of GPath expression is that property access on a collection is converted to a <em>property access on each element of the collection</em> with
the results collected into a collection. Therefore, the expression <code>this.class.methods.name</code> could be expressed as follows in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> methodNames </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;();</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Method</span><span class="pln"> method </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">().</span><span class="pln">getMethods</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   methodNames</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">method</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">return</span><span class="pln"> methodNames</span><span class="pun">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Array access notation can also be used in a GPath expression where a collection is present :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="str">'aSecondMethodBar'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">methods</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">grep</span><span class="pun">(~</span><span class="str">/.*Bar/</span><span class="pun">).</span><span class="pln">sort</span><span class="pun">()[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
array access are zero-based in GPath expressions
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_gpath_for_xml_navigation"><a class="anchor" href="#_gpath_for_xml_navigation"></a>GPath for XML navigation</h6>
<div class="paragraph">
<p>Here is an example with a XML document and various form of GPath expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xmlText </span><span class="pun">=</span><span class="pln"> </span><span class="str">"""
              | &lt;root&gt;
              |   &lt;level&gt;
              |      &lt;sublevel id='1'&gt;
              |        &lt;keyVal&gt;
              |          &lt;key&gt;mykey&lt;/key&gt;
              |          &lt;value&gt;value 123&lt;/value&gt;
              |        &lt;/keyVal&gt;
              |      &lt;/sublevel&gt;
              |      &lt;sublevel id='2'&gt;
              |        &lt;keyVal&gt;
              |          &lt;key&gt;anotherKey&lt;/key&gt;
              |          &lt;value&gt;42&lt;/value&gt;
              |        &lt;/keyVal&gt;
              |        &lt;keyVal&gt;
              |          &lt;key&gt;mykey&lt;/key&gt;
              |          &lt;value&gt;fizzbuzz&lt;/value&gt;
              |        &lt;/keyVal&gt;
              |      &lt;/sublevel&gt;
              |   &lt;/level&gt;
              | &lt;/root&gt;
              """</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xmlText</span><span class="pun">.</span><span class="pln">stripMargin</span><span class="pun">())</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> root</span><span class="pun">.</span><span class="pln">level</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> root</span><span class="pun">.</span><span class="pln">level</span><span class="pun">.</span><span class="pln">sublevel</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> root</span><span class="pun">.</span><span class="pln">level</span><span class="pun">.</span><span class="pln">sublevel</span><span class="pun">.</span><span class="pln">findAll </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="lit">@id</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> root</span><span class="pun">.</span><span class="pln">level</span><span class="pun">.</span><span class="pln">sublevel</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="pln">keyVal</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">key</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'anotherKey'</span><span class="pln"> </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>There is one <code>level</code> node under <code>root</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>There are two <code>sublevel</code> nodes under <code>root/level</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>There is one element <code>sublevel</code> having an attribute <code>id</code> with value <code>1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Text value of <code>key</code> element of first <code>keyVal</code> element of second <code>sublevel</code> element under <code>root/level</code> is 'anotherKey'</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_promotion_and_coercion"><a class="anchor" href="#_promotion_and_coercion"></a>1.6.3. Promotion and coercion</h4>
<div class="sect4">
<h5 id="_number_promotion"><a class="anchor" href="#_number_promotion"></a>Number promotion</h5>
<div class="paragraph">
<p>The rules of number promotion are specified in the section on <a href="#_math_operations">math operations</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="closure-coercion"><a class="anchor" href="#closure-coercion"></a>Closure to type coercion</h5>
<div class="sect5">
<h6 id="_assigning_a_closure_to_a_sam_type"><a class="anchor" href="#_assigning_a_closure_to_a_sam_type"></a>Assigning a closure to a SAM type</h6>
<div class="paragraph">
<p>A SAM type is a type which defines a single abstract method. This includes:</p>
</div>
<div class="listingblock">
<div class="title">Functional interfaces</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Predicate</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">boolean</span><span class="pln"> accept</span><span class="pun">(</span><span class="pln">T obj</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Abstract classes with single abstract method</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getName</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"Hello, $name"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Any closure can be converted into a SAM type using the <code>as</code> operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Predicate</span><span class="pln"> filter </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">contains </span><span class="str">'G'</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Predicate</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> filter</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">(</span><span class="str">'Groovy'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">

</span><span class="typ">Greeter</span><span class="pln"> greeter </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Groovy'</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln">
greeter</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the <code>as Type</code> expression is optional since Groovy 2.2.0. You can omit it and simply write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Predicate</span><span class="pln"> filter </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">contains </span><span class="str">'G'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> filter</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">(</span><span class="str">'Groovy'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">

</span><span class="typ">Greeter</span><span class="pln"> greeter </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Groovy'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
greeter</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which means you are also allowed to use method pointers, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">boolean</span><span class="pln"> doFilter</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> s</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'G'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="typ">Predicate</span><span class="pln"> filter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.&amp;</span><span class="pln">doFilter
</span><span class="kwd">assert</span><span class="pln"> filter</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">(</span><span class="str">'Groovy'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">

</span><span class="typ">Greeter</span><span class="pln"> greeter </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GroovySystem</span><span class="pun">.&amp;</span><span class="pln">getVersion
greeter</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_calling_a_method_accepting_a_sam_type_with_a_closure"><a class="anchor" href="#_calling_a_method_accepting_a_sam_type_with_a_closure"></a>Calling a method accepting a SAM type with a closure</h6>
<div class="paragraph">
<p>The second and probably more important use case for closure to SAM type coercion is calling a method which accepts
a SAM type. Imagine the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> filter</span><span class="pun">(</span><span class="typ">List</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> source</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Predicate</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> predicate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    source</span><span class="pun">.</span><span class="pln">findAll </span><span class="pun">{</span><span class="pln"> predicate</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can call it with a closure, without having to create an explicit implementation of the interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> filter</span><span class="pun">([</span><span class="str">'Java'</span><span class="pun">,</span><span class="str">'Groovy'</span><span class="pun">],</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">contains </span><span class="str">'G'</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Predicate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Groovy'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But since Groovy 2.2.0, you are also able to omit the explicit coercion and call the method as if it used a closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> filter</span><span class="pun">([</span><span class="str">'Java'</span><span class="pun">,</span><span class="str">'Groovy'</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">contains </span><span class="str">'G'</span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Groovy'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this has the advantage of letting you use the closure syntax for method calls, that is to say put the
closure outside of the parenthesis, improving the readability of your code.</p>
</div>
</div>
<div class="sect5">
<h6 id="_closure_to_arbitrary_type_coercion"><a class="anchor" href="#_closure_to_arbitrary_type_coercion"></a>Closure to arbitrary type coercion</h6>
<div class="paragraph">
<p>In addition to SAM types, a closure can be coerced to any type and in particular interfaces. Let’s define the
following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">FooBar</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> foo</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> bar</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can coerce a closure into the interface using the <code>as</code> keyword:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> impl </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'ok'</span><span class="pun">;</span><span class="pln"> </span><span class="lit">123</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">FooBar</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces a class for which all methods are implemented using the closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> impl</span><span class="pun">.</span><span class="pln">foo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">123</span><span class="pln">
impl</span><span class="pun">.</span><span class="pln">bar</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But it is also possible to coerce a closure to any class. For example, we can replace the <code>interface</code> that we defined
with <code>class</code> without changing the assertions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">FooBar</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> foo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> bar</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'bar'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> impl </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'ok'</span><span class="pun">;</span><span class="pln"> </span><span class="lit">123</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">FooBar</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> impl</span><span class="pun">.</span><span class="pln">foo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">123</span><span class="pln">
impl</span><span class="pun">.</span><span class="pln">bar</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_map_to_type_coercion"><a class="anchor" href="#_map_to_type_coercion"></a>Map to type coercion</h5>
<div class="paragraph">
<p>Usually using a single closure to implement an interface or a class with multiple methods is not the way to go. As an
alternative, Groovy allows you to coerce a map into an interface or a class. In that case, keys of the map are
interpreted as method names, while the values are the method implementation. The following example illustrates the
coercion of a map into an <code>Iterator</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map
map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
  i</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln">
  hasNext</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">},</span><span class="pln">
  </span><span class="kwd">next</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">i</span><span class="pun">--</span><span class="pln"> </span><span class="pun">},</span><span class="pln">
</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> iter </span><span class="pun">=</span><span class="pln"> map </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Iterator</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course this is a rather contrived example, but illustrates the concept. You only need to implement those methods
that are actually called, but if a method is called that doesn’t exist in the map a <code>MissingMethodException</code> or an
<code>UnsupportedOperationException</code> is thrown, depending on the arguments passed to the call,
as in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> X </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> f</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> g</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> h</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> s</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

x </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> f</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">println </span><span class="str">"f called"</span><span class="pun">}</span><span class="pln"> </span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> X
x</span><span class="pun">.</span><span class="pln">f</span><span class="pun">()</span><span class="pln"> </span><span class="com">// method exists</span><span class="pln">
x</span><span class="pun">.</span><span class="pln">g</span><span class="pun">()</span><span class="pln"> </span><span class="com">// MissingMethodException here</span><span class="pln">
x</span><span class="pun">.</span><span class="pln">g</span><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span><span class="pln"> </span><span class="com">// UnsupportedOperationException here</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The type of the exception depends on the call itself:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MissingMethodException</code> if the arguments of the call do not match those from the interface/class</p>
</li>
<li>
<p><code>UnsupportedOperationException</code> if the arguments of the call match one of the overloaded methods of the interface/class</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_string_to_enum_coercion"><a class="anchor" href="#_string_to_enum_coercion"></a>String to enum coercion</h5>
<div class="paragraph">
<p>Groovy allows transparent <code>String</code> (or <code>GString</code>) to enum values coercion. Imagine you define the following enum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">enum</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    up</span><span class="pun">,</span><span class="pln">
    down
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>then you can assign a string to the enum without having to use an explicit <code>as</code> coercion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">State</span><span class="pln"> st </span><span class="pun">=</span><span class="pln"> </span><span class="str">'up'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> st </span><span class="pun">==</span><span class="pln"> </span><span class="typ">State</span><span class="pun">.</span><span class="pln">up</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to use a <code>GString</code> as the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> val </span><span class="pun">=</span><span class="pln"> </span><span class="str">"up"</span><span class="pln">
</span><span class="typ">State</span><span class="pln"> st </span><span class="pun">=</span><span class="pln"> </span><span class="str">"${val}"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> st </span><span class="pun">==</span><span class="pln"> </span><span class="typ">State</span><span class="pun">.</span><span class="pln">up</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this would throw a runtime error (<code>IllegalArgumentException</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">State</span><span class="pln"> st </span><span class="pun">=</span><span class="pln"> </span><span class="str">'not an enum value'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that it is also possible to use implicit coercion in switch statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">State</span><span class="pln"> switchState</span><span class="pun">(</span><span class="typ">State</span><span class="pln"> st</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">st</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'up'</span><span class="pun">:</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">State</span><span class="pun">.</span><span class="pln">down </span><span class="com">// explicit constant</span><span class="pln">
        </span><span class="kwd">case</span><span class="pln"> </span><span class="str">'down'</span><span class="pun">:</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'up'</span><span class="pln"> </span><span class="com">// implicit coercion for return types</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>in particular, see how the <code>case</code> use string constants. But if you call a method that uses an enum with a <code>String</code>
argument, you still have to use an explicit <code>as</code> coercion:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> switchState</span><span class="pun">(</span><span class="str">'up'</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">State</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">State</span><span class="pun">.</span><span class="pln">down
</span><span class="kwd">assert</span><span class="pln"> switchState</span><span class="pun">(</span><span class="typ">State</span><span class="pun">.</span><span class="pln">down</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">State</span><span class="pun">.</span><span class="pln">up</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_type_coercion"><a class="anchor" href="#_custom_type_coercion"></a>Custom type coercion</h5>
<div class="paragraph">
<p>It is possible for a class to define custom coercion strategies by implementing the <code>asType</code> method. Custom coercion
is invoked using the <code>as</code> operator and is never implicit. As an example,
imagine you defined two classes, <code>Polar</code> and <code>Cartesian</code>, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Polar</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">double</span><span class="pln"> r
    </span><span class="kwd">double</span><span class="pln"> phi
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Cartesian</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">double</span><span class="pln"> x
   </span><span class="kwd">double</span><span class="pln"> y
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And that you want to convert from polar coordinates to cartesian coordinates. One way of doing this is to define
the <code>asType</code> method in the <code>Polar</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> asType</span><span class="pun">(</span><span class="typ">Class</span><span class="pln"> target</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Cartesian</span><span class="pun">==</span><span class="pln">target</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Cartesian</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> r</span><span class="pun">*</span><span class="pln">cos</span><span class="pun">(</span><span class="pln">phi</span><span class="pun">),</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> r</span><span class="pun">*</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">phi</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which allows you to use the <code>as</code> coercion operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> sigma </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1E-16</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> polar </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Polar</span><span class="pun">(</span><span class="pln">r</span><span class="pun">:</span><span class="lit">1.0</span><span class="pun">,</span><span class="pln">phi</span><span class="pun">:</span><span class="pln">PI</span><span class="pun">/</span><span class="lit">2</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> cartesian </span><span class="pun">=</span><span class="pln"> polar </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Cartesian</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> abs</span><span class="pun">(</span><span class="pln">cartesian</span><span class="pun">.</span><span class="pln">x</span><span class="pun">-</span><span class="pln">sigma</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> sigma</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Putting it all together, the <code>Polar</code> class looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Polar</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">double</span><span class="pln"> r
    </span><span class="kwd">double</span><span class="pln"> phi
    </span><span class="kwd">def</span><span class="pln"> asType</span><span class="pun">(</span><span class="typ">Class</span><span class="pln"> target</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Cartesian</span><span class="pun">==</span><span class="pln">target</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Cartesian</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> r</span><span class="pun">*</span><span class="pln">cos</span><span class="pun">(</span><span class="pln">phi</span><span class="pun">),</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> r</span><span class="pun">*</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">phi</span><span class="pun">))</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>but it is also possible to define <code>asType</code> outside of the <code>Polar</code> class, which can be practical if you want to define
custom coercion strategies for "closed" classes or classes for which you don’t own the source code, for example using
a metaclass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Polar</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">asType </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Class</span><span class="pln"> target </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Cartesian</span><span class="pun">==</span><span class="pln">target</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Cartesian</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln"> r</span><span class="pun">*</span><span class="pln">cos</span><span class="pun">(</span><span class="pln">phi</span><span class="pun">),</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> r</span><span class="pun">*</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">phi</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_class_literals_vs_variables_and_the_as_operator"><a class="anchor" href="#_class_literals_vs_variables_and_the_as_operator"></a>Class literals vs variables and the as operator</h5>
<div class="paragraph">
<p>Using the <code>as</code> keyword is only possible if you have a static reference to a class, like in the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> greeter </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'Hello, Groovy!'</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="com">// Greeter is known statically</span><span class="pln">
greeter</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But what if you get the class by reflection, for example by calling <code>Class.forName</code>?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Class</span><span class="pln"> clazz </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">'Greeter'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Trying to use the reference to the class with the <code>as</code> keyword would fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">greeter </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'Hello, Groovy!'</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> clazz
</span><span class="com">// throws:</span><span class="pln">
</span><span class="com">// unable to resolve class clazz</span><span class="pln">
</span><span class="com">// @ line 9, column 40.</span><span class="pln">
</span><span class="com">//   greeter = { println 'Hello, Groovy!' } as clazz</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is failing because the <code>as</code> keyword only works with class literals. Instead, you need to call the <code>asType</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">greeter </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'Hello, Groovy!'</span><span class="pln"> </span><span class="pun">}.</span><span class="pln">asType</span><span class="pun">(</span><span class="pln">clazz</span><span class="pun">)</span><span class="pln">
greeter</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_optionality"><a class="anchor" href="#_optionality"></a>1.6.4. Optionality</h4>
<div class="sect4">
<h5 id="_optional_parentheses"><a class="anchor" href="#_optional_parentheses"></a>Optional parentheses</h5>
<div class="paragraph">
<p>Method calls can omit the parentheses if there is at least one parameter and there is no ambiguity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">println </span><span class="str">'Hello World'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> maximum </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">max </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Parentheses are required for method calls without parameters or ambiguous method calls:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">println</span><span class="pun">()</span><span class="pln">
println</span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">))</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optional_semicolons"><a class="anchor" href="#_optional_semicolons"></a>Optional semicolons</h5>
<div class="paragraph">
<p>In Groovy semicolons at the end of the line can be omitted, if the line contains only a single statement.</p>
</div>
<div class="paragraph">
<p>This means that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>can be more idiomatically written as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple statements in a line require semicolons to separate them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">boolean</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">assert</span><span class="pln"> a</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optional_return_keyword"><a class="anchor" href="#_optional_return_keyword"></a>Optional return keyword</h5>
<div class="paragraph">
<p>In Groovy, the last expression evaluated in the body of a method or a closure is returned. This means that the <code>return</code> keyword is optional.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> add</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">+</span><span class="pln">b
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> add</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be shortened to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> add</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">+</span><span class="pln">b
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> add</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_optional_public_keyword"><a class="anchor" href="#_optional_public_keyword"></a>Optional public keyword</h5>
<div class="paragraph">
<p>By default, Groovy classes and methods are <code>public</code>. Therefore this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Server</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"a server"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is identical to this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Server</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"a server"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Groovy-Truth"><a class="anchor" href="#Groovy-Truth"></a>1.6.5. The Groovy Truth</h4>
<div class="paragraph">
<p>Groovy decides whether a expression is true or false by applying the rules given below.</p>
</div>
<div class="sect4">
<h5 id="_boolean_expressions"><a class="anchor" href="#_boolean_expressions"></a>Boolean expressions</h5>
<div class="paragraph">
<p>True if the corresponding Boolean value is <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="kwd">false</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_collections_and_arrays"><a class="anchor" href="#_collections_and_arrays"></a>Collections and Arrays</h5>
<div class="paragraph">
<p>Non-empty Collections and arrays are true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">![]</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_matchers"><a class="anchor" href="#_matchers"></a>Matchers</h5>
<div class="paragraph">
<p>True if the Matcher has at least one match.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="str">'a'</span><span class="pln"> </span><span class="pun">=~</span><span class="pln"> </span><span class="pun">/</span><span class="pln">a</span><span class="pun">/)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!(</span><span class="str">'a'</span><span class="pln"> </span><span class="pun">=~</span><span class="pln"> </span><span class="pun">/</span><span class="pln">b</span><span class="pun">/)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_iterators_and_enumerations"><a class="anchor" href="#_iterators_and_enumerations"></a>Iterators and Enumerations</h5>
<div class="paragraph">
<p>Iterators and Enumerations with further elements are coerced to true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">![].</span><span class="pln">iterator</span><span class="pun">()</span><span class="pln">
</span><span class="typ">Vector</span><span class="pln"> v </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Vector</span><span class="pln">
</span><span class="typ">Enumeration</span><span class="pln"> enumeration </span><span class="pun">=</span><span class="pln"> v</span><span class="pun">.</span><span class="pln">elements</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> enumeration
enumeration</span><span class="pun">.</span><span class="pln">nextElement</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">enumeration</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_maps_2"><a class="anchor" href="#_maps_2"></a>Maps</h5>
<div class="paragraph">
<p>Non-empty Maps are evaluated to true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'one'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">![:]</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_strings"><a class="anchor" href="#_strings"></a>Strings</h5>
<div class="paragraph">
<p>Non-empty Strings, GStrings and CharSequences are coerced to true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="str">'a'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="str">''</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> nonEmpty </span><span class="pun">=</span><span class="pln"> </span><span class="str">'a'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"$nonEmpty"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> empty </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="str">"$empty"</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_numbers_2"><a class="anchor" href="#_numbers_2"></a>Numbers</h5>
<div class="paragraph">
<p>Non-zero numbers are true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">3.5</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="lit">0</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_object_references"><a class="anchor" href="#_object_references"></a>Object References</h5>
<div class="paragraph">
<p>Non-null object references are coerced to true.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="kwd">null</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_customizing_the_truth_with_asboolean_methods"><a class="anchor" href="#_customizing_the_truth_with_asboolean_methods"></a>Customizing the truth with asBoolean() methods</h5>
<div class="paragraph">
<p>In order to customize whether groovy evaluates your object to <code>true</code> or <code>false</code> implement the <code>asBoolean()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Color</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name

    </span><span class="kwd">boolean</span><span class="pln"> asBoolean</span><span class="pun">(){</span><span class="pln">
        name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'green'</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy will call this method to coerce your object to a boolean value, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Color</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'green'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Color</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'red'</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_typing"><a class="anchor" href="#_typing"></a>1.6.6. Typing</h4>
<div class="sect4">
<h5 id="_optional_typing"><a class="anchor" href="#_optional_typing"></a>Optional typing</h5>
<div class="paragraph">
<p>Optional typing is the idea that a program can work even if you don’t put an explicit type on a variable. Being a dynamic
language, Groovy naturally implements that feature, for example when you declare a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> aString </span><span class="pun">=</span><span class="pln"> </span><span class="str">'foo'</span><span class="pln">                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> aString</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">                </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>foo</code> is declared using an explicit type, <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can call the <code>toUpperCase</code> method on a <code>String</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Groovy will let you write this instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> aString </span><span class="pun">=</span><span class="pln"> </span><span class="str">'foo'</span><span class="pln">                         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> aString</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">                </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>foo</code> is declared using <code>def</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can still call the <code>toUpperCase</code> method, because the type of <code>aString</code> is resolved at runtime</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>So it doesn’t matter that you use an explicit type here. It is in particular interesting when you combine this feature
with <a href="#static-type-checking">static type checking</a>, because the type checker performs type inference.</p>
</div>
<div class="paragraph">
<p>Likewise, Groovy doesn’t make it mandatory to declare the types of a parameter in a method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> concat</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    a</span><span class="pun">+</span><span class="pln">b
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> concat</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">,</span><span class="str">'bar'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'foobar'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>can be rewritten using <code>def</code> as both return type and parameter types, in order to take advantage of duck typing, as
illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> concat</span><span class="pun">(</span><span class="kwd">def</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    a</span><span class="pun">+</span><span class="pln">b
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> concat</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">,</span><span class="str">'bar'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'foobar'</span><span class="pln">                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> concat</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">                                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>both the return type and the parameter types use <code>def</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it makes it possible to use the method with <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but also with <code>int</code> since the <code>plus</code> method is defined</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using the <code>def</code> keyword here is recommended to describe the intent of a method which is supposed to work on any
type, but technically, we could use <code>Object</code> instead and the result would be the same: <code>def</code> is, in Groovy, strictly
equivalent to using <code>Object</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Eventually, the type can be removed altogether from both the return type and the descriptor. But if you want to remove
it from the return type, you then need to add an explicit modifier for the method, so that the compiler can make a difference
between a method declaration and a method call, like illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">private</span><span class="pln"> concat</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    a</span><span class="pun">+</span><span class="pln">b
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> concat</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">,</span><span class="str">'bar'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'foobar'</span><span class="pln">                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> concat</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">                                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if we want to omit the return type, an explicit modifier has to be set.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it is still possible to use the method with <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and also with <code>int</code></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Omitting types is in general considered a bad practice in method parameters or method return types for public APIs.
While using <code>def</code> in a local variable is not really a problem because the visibility of the variable is limited to the
method itself, while set on a method parameter, <code>def</code> will be converted to <code>Object</code> in the method signature, making it
difficult for users to know which is the expected type of the arguments. This means that you should limit this to cases
where you are explicitly relying on duck typing.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="static-type-checking"><a class="anchor" href="#static-type-checking"></a>Static type checking</h5>
<div class="paragraph">
<p>By default, Groovy performs minimal type checking at compile time. Since it is primarily a dynamic language,
most checks that a static compiler would normally do aren’t possible at compile time. A method added via runtime
metaprogramming might alter a class or object’s runtime behavior. Let’s illustrate why in the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                                          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Raymond'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Devos'</span><span class="pun">)</span><span class="pln">             </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">formattedName </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Raymond Devos'</span><span class="pln">                               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Person</code> class only defines two properties, <code>firstName</code> and <code>lastName</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we can create an instance of Person</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and call a method named <code>formattedName</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is quite common in dynamic languages for code such as the above example not to throw any error. How can this be?
In Java, this would typically fail at compile time. However, in Groovy, it will not fail at compile time, and if coded
correctly, will also not fail at runtime. In fact, to make this work at runtime, <strong>one</strong> possibility is to rely on
runtime metaprogramming. So just adding this line after the declaration of the <code>Person</code> class is enough:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Person</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">getFormattedName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"$delegate.firstName $delegate.lastName"</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that in general, in Groovy, you can’t make any assumption about the type of an object beyond its declaration
type, and even if you know it, you can’t determine at compile time what method will be called, or which property will
be retrieved. It has a lot of interest, going from writing DSLs to testing, which is discussed in other sections of this
manual.</p>
</div>
<div class="paragraph">
<p>However, if your program doesn’t rely on dynamic features and that you come from the static world (in particular, from
a Java mindset), not catching such "errors" at compile time can be surprising. As we have seen in the previous example,
the compiler cannot be sure this is an error. To make it aware that it is, you have to explicitly instruct the compiler
that you are switching to a type checked mode. This can be done by annotating a class or a method with <code>@groovy.lang.TypeChecked</code>.</p>
</div>
<div class="paragraph">
<p>When type checking is activated, the compiler performs much more work:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type inference is activated, meaning that even if you use <code>def</code> on a local variable for example, the type checker will be
able to infer the type of the variable from the assignments</p>
</li>
<li>
<p>method calls are resolved at compile time, meaning that if a method is not declared on a class, the compiler will throw an error</p>
</li>
<li>
<p>in general, all the compile time errors that you are used to find in a
 static language will appear: method not found, property not found,
incompatible types for method calls, number precision errors, …​</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this section, we will describe the behavior of the type checker in various situations and explain the limits of using
<code>@TypeChecked</code> on your code.</p>
</div>
<div class="sect5">
<h6 id="_the_code_typechecked_code_annotation"><a class="anchor" href="#_the_code_typechecked_code_annotation"></a>The <code>@TypeChecked</code> annotation</h6>
<div class="sect6">
<h7 id="_activating_type_checking_at_compile_time"><a class="anchor" href="#_activating_type_checking_at_compile_time"></a>Activating type checking at compile time</h7>
<div class="paragraph">
<p>The <code>groovy.lang.TypeChecked</code> annotation enabled type checking. It can be placed on a class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> sum</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> x</span><span class="pun">+</span><span class="pln">y </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or on a method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> sum</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> x</span><span class="pun">+</span><span class="pln">y </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the first case, all methods, properties, fields, inner classes, …​ of the annotated class will be type checked, whereas
in the second case, only the method and potential closures or anonymous inner classes that it contains will be type checked.</p>
</div>
</div>
<div class="sect6">
<h7 id="_skipping_sections"><a class="anchor" href="#_skipping_sections"></a>Skipping sections</h7>
<div class="paragraph">
<p>The scope of type checking can be restricted. For example, if a class is type checked, you can instruct the type checker
to skip a method by annotating it with <code>@TypeChecked(TypeCheckingMode.SKIP)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeCheckingMode</span><span class="pln">

</span><span class="lit">@TypeChecked</span><span class="pln">                                        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GreetingService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> greeting</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                             </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        doGreet</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@TypeChecked</span><span class="pun">(</span><span class="typ">TypeCheckingMode</span><span class="pun">.</span><span class="pln">SKIP</span><span class="pun">)</span><span class="pln">             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> doGreet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SentenceBuilder</span><span class="pun">()</span><span class="pln">
        b</span><span class="pun">.</span><span class="typ">Hello</span><span class="pun">.</span><span class="kwd">my</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">.</span><span class="typ">John</span><span class="pln">                     </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
        b
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GreetingService</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello my name is John'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>GreetingService</code> class is marked as type checked</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>so the <code>greeting</code> method is automatically type checked</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but <code>doGreet</code> is marked with <code>SKIP</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the type checker doesn’t complain about missing properties here</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In the previous example, <code>SentenceBuilder</code> relies on dynamic code. There’s no real <code>Hello</code> method or property, so the
type checker would normally complain and compilation would fail. Since the method that uses the builder is marked with
<code>TypeCheckingMode.SKIP</code>, type checking is <em>skipped</em> for this method, so the code will compile, even if the rest of the
class is type checked.</p>
</div>
<div class="paragraph">
<p>The following sections describe the semantics of type checking in Groovy.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_type_checking_assignments"><a class="anchor" href="#_type_checking_assignments"></a>Type checking assignments</h6>
<div class="paragraph">
<p>An object <code>o</code> of type <code>A</code> can be assigned to a variable of type <code>T</code> if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>T</code> equals <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Date</span><span class="pln"> now </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is one of <code>String</code>, <code>boolean</code>, <code>Boolean</code> or <code>Class</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln"> </span><span class="com">// implicit call to toString</span><span class="pln">
</span><span class="typ">Boolean</span><span class="pln"> boxed </span><span class="pun">=</span><span class="pln"> </span><span class="str">'some string'</span><span class="pln">       </span><span class="com">// Groovy truth</span><span class="pln">
</span><span class="kwd">boolean</span><span class="pln"> prim </span><span class="pun">=</span><span class="pln"> </span><span class="str">'some string'</span><span class="pln">        </span><span class="com">// Groovy truth</span><span class="pln">
</span><span class="typ">Class</span><span class="pln"> clazz </span><span class="pun">=</span><span class="pln"> </span><span class="str">'java.lang.String'</span><span class="pln">    </span><span class="com">// class coercion</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>o</code> is null and <code>T</code> is not a primitive type</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">         </span><span class="com">// passes</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">            </span><span class="com">// fails</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an array and <code>A</code> is an array and the component type of <code>A</code> is assignable to the component type of <code>T</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln">        </span><span class="com">// passes</span><span class="pln">
</span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[</span><span class="lit">4</span><span class="pun">]</span><span class="pln">     </span><span class="com">// fails</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an array and <code>A</code> is a list and the component type of <code>A</code> is assignable to the component type of <code>T</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">]</span><span class="pln">               </span><span class="com">// passes</span><span class="pln">
</span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()]</span><span class="pln">     </span><span class="com">// fails</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is a superclass of <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">AbstractList</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">()</span><span class="pln">     </span><span class="com">// passes</span><span class="pln">
</span><span class="typ">LinkedList</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">()</span><span class="pln">       </span><span class="com">// fails</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an interface implemented by <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">List</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">()</span><span class="pln">             </span><span class="com">// passes</span><span class="pln">
</span><span class="typ">RandomAccess</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">()</span><span class="pln">    </span><span class="com">// fails</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> or <code>A</code> are a primitive type and their boxed types are assignable</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="typ">Integer</span><span class="pln"> bi </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">123</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">double</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Float</span><span class="pun">(</span><span class="lit">5f</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> extends <code>groovy.lang.Closure</code> and <code>A</code> is a SAM-type (single abstract method type)</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Runnable</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'Hello'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">SAMType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> doSomething</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">SAMType</span><span class="pln"> sam </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">123</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sam</span><span class="pun">.</span><span class="pln">doSomething</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">123</span><span class="pln">
</span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">AbstractSAM</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> calc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">2</span><span class="pun">*</span><span class="pln"> value</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">AbstractSAM</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">123</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">calc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">246</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> and <code>A</code> derive from <code>java.lang.Number</code> and conform to the following table</p>
</li>
</ul>
</div>
<table id="number-assignment" class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Number types (java.lang.XXX)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">T</th>
<th class="tableblock halign-left valign-top">A</th>
<th class="tableblock halign-left valign-top">Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any but BigDecimal or BigInteger</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Double</span><span class="pln"> d1 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4d</span><span class="pln">
</span><span class="typ">Double</span><span class="pln"> d2 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4f</span><span class="pln">
</span><span class="typ">Double</span><span class="pln"> d3 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4l</span><span class="pln">
</span><span class="typ">Double</span><span class="pln"> d4 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4i</span><span class="pln">
</span><span class="typ">Double</span><span class="pln"> d5 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">short</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="typ">Double</span><span class="pln"> d6 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">byte</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger or Double</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Float</span><span class="pln"> f1 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4f</span><span class="pln">
</span><span class="typ">Float</span><span class="pln"> f2 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4l</span><span class="pln">
</span><span class="typ">Float</span><span class="pln"> f3 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4i</span><span class="pln">
</span><span class="typ">Float</span><span class="pln"> f4 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">short</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="typ">Float</span><span class="pln"> f5 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">byte</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger, Double or Float</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Long</span><span class="pln"> l1 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4l</span><span class="pln">
</span><span class="typ">Long</span><span class="pln"> l2 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4i</span><span class="pln">
</span><span class="typ">Long</span><span class="pln"> l3 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">short</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="typ">Long</span><span class="pln"> l4 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">byte</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger, Double, Float or Long</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Integer</span><span class="pln"> i1 </span><span class="pun">=</span><span class="pln"> </span><span class="lit">4i</span><span class="pln">
</span><span class="typ">Integer</span><span class="pln"> i2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">short</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="typ">Integer</span><span class="pln"> i3 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">byte</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any type but BigDecimal, BigInteger, Double, Float, Long or Integer</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Short</span><span class="pln"> s1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">short</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="typ">Short</span><span class="pln"> s2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">byte</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Byte</span><span class="pln"> b1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">byte</span><span class="pun">)</span><span class="pln"> </span><span class="lit">4</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_list_and_map_constructors"><a class="anchor" href="#_list_and_map_constructors"></a>List and map constructors</h6>
<div class="paragraph">
<p>In addition to the assignment rules above, if an assignment is deemed invalid, in type checked mode, a <em>list</em> literal or a <em>map</em> literal <code>A</code> can be assigned
to a variable of type <code>T</code> if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the assignment is a variable declaration and <code>A</code> is a list literal and <code>T</code> has a constructor whose parameters match the types of the elements in the list literal</p>
</li>
<li>
<p>the assignment is a variable declaration and <code>A</code> is a map literal and <code>T</code> has a no-arg constructor and a property for each of the map keys</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, instead of writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> classic </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Ada'</span><span class="pun">,</span><span class="str">'Lovelace'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a "list constructor":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Person</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Ada'</span><span class="pun">,</span><span class="str">'Lovelace'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or a "map constructor":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Person</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">firstName</span><span class="pun">:</span><span class="str">'Ada'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="str">'Lovelace'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use a map constructor, additional checks are done on the keys of the map to check if a property of the same name
is defined. For example, the following will fail at compile time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">Person</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">firstName</span><span class="pun">:</span><span class="str">'Ada'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="str">'Lovelace'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">24</span><span class="pun">]</span><span class="pln">     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The type checker will throw an error <code>No such property: age for class: Person</code> at compile time</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_method_resolution"><a class="anchor" href="#_method_resolution"></a>Method resolution</h6>
<div class="paragraph">
<p>In type checked mode, methods are resolved at compile time. Resolution works by name and arguments. The return type is
irrelevant to method selection. Types of arguments are matched against the types of the parameters following those rules:</p>
</div>
<div class="paragraph">
<p>An argument <code>o</code> of type <code>A</code> can be used for a parameter of type <code>T</code> if and only if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>T</code> equals <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> sum</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x</span><span class="pun">+</span><span class="pln">y
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sum</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is a <code>String</code> and <code>A</code> is a <code>GString</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> format</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> str</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">"Result: $str"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> format</span><span class="pun">(</span><span class="str">"${3+4}"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Result: 7"</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>o</code> is null and <code>T</code> is not a primitive type</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> format</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">"Result: $value"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> format</span><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Result: 7"</span><span class="pln">
format</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">)</span><span class="pln">           </span><span class="com">// fails</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an array and <code>A</code> is an array and the component type of <code>A</code> is assignable to the component type of <code>T</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> format</span><span class="pun">(</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> values</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">"Result: ${values.join(' ')}"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> format</span><span class="pun">([</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[])</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Result: a b"</span><span class="pln">
format</span><span class="pun">([</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[])</span><span class="pln">              </span><span class="com">// fails</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is a superclass of <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> format</span><span class="pun">(</span><span class="typ">AbstractList</span><span class="pln"> list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    list</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">','</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
format</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">())</span><span class="pln">              </span><span class="com">// passes</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> format</span><span class="pun">(</span><span class="typ">LinkedList</span><span class="pln"> list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    list</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">','</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
format</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">())</span><span class="pln">              </span><span class="com">// fails</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> is an interface implemented by <code>A</code></p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> format</span><span class="pun">(</span><span class="typ">List</span><span class="pln"> list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    list</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">','</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
format</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">())</span><span class="pln">                  </span><span class="com">// passes</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> format</span><span class="pun">(</span><span class="typ">RandomAccess</span><span class="pln"> list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">'foo'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
format</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">())</span><span class="pln">                 </span><span class="com">// fails</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> or <code>A</code> are a primitive type and their boxed types are assignable</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> sum</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    x</span><span class="pun">+</span><span class="pln">y
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sum</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">4</span><span class="pun">))</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sum</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">3</span><span class="pun">),</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sum</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">3</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">4</span><span class="pun">))</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sum</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">3</span><span class="pun">),</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> extends <code>groovy.lang.Closure</code> and <code>A</code> is a SAM-type (single abstract method type)</p>
<div class="exampleblock result">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">SAMType</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> doSomething</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> twice</span><span class="pun">(</span><span class="typ">SAMType</span><span class="pln"> sam</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">2</span><span class="pun">*</span><span class="pln">sam</span><span class="pun">.</span><span class="pln">doSomething</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> twice </span><span class="pun">{</span><span class="pln"> </span><span class="lit">123</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">246</span><span class="pln">
</span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">AbstractSAM</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> calc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">2</span><span class="pun">*</span><span class="pln"> value</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> eightTimes</span><span class="pun">(</span><span class="typ">AbstractSAM</span><span class="pln"> sam</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">4</span><span class="pun">*</span><span class="pln">sam</span><span class="pun">.</span><span class="pln">calc</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> eightTimes </span><span class="pun">{</span><span class="pln"> </span><span class="lit">123</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">984</span></code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><em>or</em> <code>T</code> and <code>A</code> derive from <code>java.lang.Number</code> and conform to the same rules as <a href="#number-assignment">assignment of numbers</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a method with the appropriate name and arguments is not found at 
compile time, an error is thrown. The difference with "normal" Groovy is
illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        printLine </span><span class="str">'Do something'</span><span class="pln">            </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>printLine</code> is an error, but since we’re in a dynamic mode, the error is not caught at compile time</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The example above shows a class that Groovy will be able to compile. However, if you try to create an instance of <code>MyService</code> and call the
<code>doSomething</code> method, then it will fail <strong>at runtime</strong>, because <code>printLine</code> doesn’t exist. Of course, we already showed how Groovy could make
this a perfectly valid call, for example by catching <code>MethodMissingException</code> or implementing a custom meta-class, but if you know you’re
not in such a case, <code>@TypeChecked</code> comes handy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        printLine </span><span class="str">'Do something'</span><span class="pln">            </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>printLine</code> is this time a compile-time error</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Just adding <code>@TypeChecked</code> will trigger compile time method resolution. The type checker will try to find a method <code>printLine</code> accepting
a <code>String</code> on the <code>MyService</code> class, but cannot find one. It will fail compilation with the following message:</p>
</div>
<div class="paragraph">
<p><code>Cannot find matching method MyService#printLine(java.lang.String)</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock important">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is important to understand the logic behind the type checker: it is a compile-time check, so by definition, the type checker
is not aware of any kind of <strong>runtime</strong> metaprogramming that you do. This means that code which is perfectly valid without <code>@TypeChecked</code> will
<strong>not</strong> compile anymore if you activate type checking. This is in particular true if you think of duck typing:<br>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Duck</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> quack</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        println </span><span class="str">'Quack!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">QuackingBird</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> quack</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">              </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        println </span><span class="str">'Quack!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> accept</span><span class="pun">(</span><span class="pln">quacker</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    quacker</span><span class="pun">.</span><span class="pln">quack</span><span class="pun">()</span><span class="pln">             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
accept</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Duck</span><span class="pun">())</span><span class="pln">              </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we define a <code>Duck</code> class which defines a <code>quack</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we define another <code>QuackingBird</code> class which also defines a <code>quack</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>quacker</code> is loosely typed, so since the method is <code>@TypeChecked</code>, we will obtain a compile-time error</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>even if in non type-checked Groovy, this would have passed</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>There are possible workarounds, like introducing an interface, but 
basically, by activating type checking, you gain type safety
but you loose some features of the language. Hopefully, Groovy 
introduces some features like flow typing to reduce the gap between
type-checked and non type-checked Groovy.</p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="type-inference"><a class="anchor" href="#type-inference"></a>Type inference</h6>
<div class="sect6">
<h7 id="_principles"><a class="anchor" href="#_principles"></a>Principles</h7>
<div class="paragraph">
<p>When code is annotated with <code>@TypeChecked</code>, the compiler 
performs type inference. It doesn’t simply rely on static types, but 
also uses various
techniques to infer the types of variables, return types, literals, …​ 
so that the code remains as clean as possible even if you activate the
type checker.</p>
</div>
<div class="paragraph">
<p>The simplest example is inferring the type of a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> message </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Welcome to Groovy!'</span><span class="pln">              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
println message</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">                   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
println message</span><span class="pun">.</span><span class="pln">upper</span><span class="pun">()</span><span class="pln"> </span><span class="com">// compile time error   </span><i class="conum" data-value="3"></i><b><span class="com">(3)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a variable is declared using the <code>def</code> keyword</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>calling <code>toUpperCase</code> is allowed by the type checker</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calling <code>upper</code> will fail at compile time</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The reason the call to <code>toUpperCase</code> works is because the type of <code>message</code> was <em>inferred</em> as being a <code>String</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_variables_vs_fields_in_type_inference"><a class="anchor" href="#_variables_vs_fields_in_type_inference"></a>Variables vs fields in type inference</h7>
<div class="paragraph">
<p>It is worth noting that although the compiler performs type inference on local variables, it does <strong>not</strong> perform any kind
of type inference on fields, always falling back to the <strong>declared type</strong> of a field. To illustrate this, let’s take a
look at this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SomeClass</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> someUntypedField                                                                </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">String</span><span class="pln"> someTypedField                                                               </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> someMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        someUntypedField </span><span class="pun">=</span><span class="pln"> </span><span class="str">'123'</span><span class="pln">                                                        </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        someUntypedField </span><span class="pun">=</span><span class="pln"> someUntypedField</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">  </span><span class="com">// compile-time error        </span><i class="conum" data-value="4"></i><b><span class="com">(4)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> someSafeMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        someTypedField </span><span class="pun">=</span><span class="pln"> </span><span class="str">'123'</span><span class="pln">                                                          </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
        someTypedField </span><span class="pun">=</span><span class="pln"> someTypedField</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">                                   </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> someMethodUsingLocalVariable</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> localVariable </span><span class="pun">=</span><span class="pln"> </span><span class="str">'123'</span><span class="pln">                                                       </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
        someUntypedField </span><span class="pun">=</span><span class="pln"> localVariable</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">                                  </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>someUntypedField</code> uses <code>def</code> as a declaration type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>someTypedField</code> uses <code>String</code> as a declaration type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we can assign <strong>anything</strong> to <code>someUntypedField</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>yet calling <code>toUpperCase</code> fails at compile time because the field is not typed properly</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>we can assign a <code>String</code> to a field of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>and this time <code>toUpperCase</code> is allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>if we assign a <code>String</code> to a local variable</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>then calling <code>toUpperCase</code> is allowed on the local variable</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Why such a difference? The reason is <em>thread safety</em>. At compile time, we can’t make <strong>any</strong> guarantee about the type of
a field. Any thread can access any field at any time and between the moment a field is assigned a variable of some
type in a method and the time is is used the line after, another thread may have changed the contents of the field. This
is not the case for local variables: we know if they "escape" or not, so we can make sure that the type of a variable is
constant (or not) over time. Note that even if a field is final, the JVM makes no guarantee about it, so the type checker
doesn’t behave differently if a field is final or not.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is one of the reasons why we recommend to use <strong>typed</strong> fields. While using <code>def</code> for local variables is perfectly
fine thanks to type inference, this is not the case for fields, which also belong to the public API of a class, hence the
type is important.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect6">
<h7 id="_collection_literal_type_inference"><a class="anchor" href="#_collection_literal_type_inference"></a>Collection literal type inference</h7>
<div class="paragraph">
<p>Groovy provides a syntax for various type literals. There are three native collection literals in Groovy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>lists, using the <code>[]</code> literal</p>
</li>
<li>
<p>maps, using the <code>[:]</code> literal</p>
</li>
<li>
<p>ranges, using the <code>(..,..)</code> literal</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The inferred type of a literal depends on the elements of the literal, as illustrated in the following table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Literal</th>
<th class="tableblock halign-left valign-top">Inferred type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.List</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'foo'</span><span class="pun">,</span><span class="str">'bar'</span><span class="pun">]</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.List&lt;String&gt;</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">"${foo}"</span><span class="pun">,</span><span class="str">"${bar}"</span><span class="pun">]</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.List&lt;GString&gt;</code> be careful, a <code>GString</code> is <strong>not</strong> a <code>String</code>!</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.LinkedHashMap</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">someKey</span><span class="pun">:</span><span class="pln"> </span><span class="str">'someValue'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> map2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'someKey'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'someValue'</span><span class="pun">]</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.LinkedHashMap&lt;String,String&gt;</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">"${someKey}"</span><span class="pun">:</span><span class="pln"> </span><span class="str">'someValue'</span><span class="pun">]</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>java.util.LinkedHashMap&lt;GString,String&gt;</code> be careful, the key is a <code>GString</code>!</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> intRange </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">0.</span><span class="pun">.</span><span class="lit">10</span><span class="pun">)</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>groovy.lang.IntRange</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> charRange </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="str">'a'</span><span class="pun">..</span><span class="str">'z'</span><span class="pun">)</span></code></pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>groovy.lang.Range&lt;String&gt;</code> : uses the type of the bounds to infer the component type of the range</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As you can see, with the noticeable exception of the <code>IntRange</code>, the inferred type makes use of generics types to describe
the contents of a collection. In case the collection contains elements of different types, the type checker still performs
type inference of the components, but uses the notion of <a href="#section-lub">least upper bound</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="section-lub"><a class="anchor" href="#section-lub"></a>Least upper bound</h7>
<div class="paragraph">
<p>In Groovy, the <em>least upper bound</em> of two types <code>A</code> and <code>B</code> is defined as a type which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>superclass corresponds to the common super class of <code>A</code> and <code>B</code></p>
</li>
<li>
<p>interfaces correspond to the interfaces implemented by both <code>A</code> and <code>B</code></p>
</li>
<li>
<p>if <code>A</code> or <code>B</code> is a primitive type and that <code>A</code> isn’t equal to <code>B</code>, the least upper bound of <code>A</code> and <code>B</code> is the least
upper bound of their wrapper types</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>A</code> and <code>B</code> only have one (1) interface in common and that their common superclass is <code>Object</code>, then the LUB of both
is the common interface.</p>
</div>
<div class="paragraph">
<p>The least upper bound represents the minimal type to which both <code>A</code> and <code>B</code> can be assigned. So for example, if <code>A</code> and <code>B</code>
are both <code>String</code>, then the LUB (least upper bound) of both is also <code>String</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Top</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bottom1</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Top</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bottom2</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Top</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> leastUpperBound</span><span class="pun">(</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">String</span><span class="pln">                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> leastUpperBound</span><span class="pun">(</span><span class="typ">ArrayList</span><span class="pun">,</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">AbstractList</span><span class="pln">       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> leastUpperBound</span><span class="pun">(</span><span class="typ">ArrayList</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">List</span><span class="pln">                     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> leastUpperBound</span><span class="pun">(</span><span class="typ">List</span><span class="pun">,</span><span class="pln"> </span><span class="typ">List</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">List</span><span class="pln">                          </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> leastUpperBound</span><span class="pun">(</span><span class="typ">Bottom1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Bottom2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Top</span><span class="pln">                     </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> leastUpperBound</span><span class="pun">(</span><span class="typ">List</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Object</span><span class="pln">                </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the LUB of <code>String</code> and <code>String</code> is <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the LUB of <code>ArrayList</code> and <code>LinkedList</code> is their common super type, <code>AbstractList</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the LUB of <code>ArrayList</code> and <code>List</code> is their only common interface, <code>List</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the LUB of two identical interfaces is the interface itself</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the LUB of <code>Bottom1</code> and <code>Bottom2</code> is their superclass <code>Top</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the LUB of two types which have nothing in common is <code>Object</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In those examples, the LUB is always representable as a normal, JVM supported, type. But Groovy internally represents the LUB
as a type which can be more complex, and that you wouldn’t be able to use to define a variable for example. To illustrate this,
let’s continue with this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Top</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bottom</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Top</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SerializableFooImpl</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What is the least upper bound of <code>Bottom</code> and <code>SerializableFooImpl</code>? They don’t have a common super class (apart from <code>Object</code>),
but they do share 2 interfaces (<code>Serializable</code> and <code>Foo</code>), so their least upper bound is a type which represents the union of
two interfaces (<code>Serializable</code> and <code>Foo</code>). This type cannot be defined in the source code, yet Groovy knows about it.</p>
</div>
<div class="paragraph">
<p>In the context of collection type inference (and generic type inference in general), this becomes handy, because the type of the
components is inferred as the least upper bound. We can illustrate why this is important in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Salute</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> salute</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">class</span><span class="pln"> A </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Salute</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Hello, I'm A!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> salute</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Bye from A!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> B </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Salute</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Hello, I'm B!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> salute</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Bye from B!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> </span><span class="kwd">exit</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'No way!'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">               </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">new</span><span class="pln"> A</span><span class="pun">(),</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> B</span><span class="pun">()]</span><span class="pln">                       </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
list</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln">
    it</span><span class="pun">.</span><span class="pln">greet</span><span class="pun">()</span><span class="pln">                                      </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
    it</span><span class="pun">.</span><span class="pln">salute</span><span class="pun">()</span><span class="pln">                                     </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
    it</span><span class="pun">.</span><span class="kwd">exit</span><span class="pun">()</span><span class="pln">                                       </span><i class="conum" data-value="9"></i><b><span class="pun">(</span><span class="lit">9</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>Greeter</code> interface defines a single method, <code>greet</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>Salute</code>  interface defines a single method, <code>salute</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>class <code>A</code> implements both <code>Greeter</code> and <code>Salute</code> but there’s no explicit interface extending both</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>same for <code>B</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>but <code>B</code> defines an additional <code>exit</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the type of <code>list</code> is inferred as "list of the LUB of <code>A</code> and `B`"</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>so it is possible to call <code>greet</code> which is defined on both <code>A</code> and <code>B</code> through the <code>Greeter</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>and it is possible to call <code>salute</code> which is defined on both <code>A</code> and <code>B</code> through the <code>Salute</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>yet calling <code>exit</code> is a compile time error because it doesn’t belong to the LUB of <code>A</code> and <code>B</code> (only defined in <code>B</code>)</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The error message will look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Static type checking] - Cannot find matching method Greeter or Salute#exit()</pre>
</div>
</div>
<div class="paragraph">
<p>which indicates that the <code>exit</code> method is neither defines on <code>Greeter</code> nor <code>Salute</code>, which are the two interfaces defined
in the least upper bound of <code>A</code> and <code>B</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_instanceof_inference"><a class="anchor" href="#_instanceof_inference"></a>instanceof inference</h7>
<div class="paragraph">
<p>In normal, non type checked, Groovy, you can write things like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> greeting</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Hello'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="kwd">def</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">o </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        println o</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">()</span><span class="pln">        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

doSomething</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pun">())</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>guard the method call with an <code>instanceof</code> check</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>make the call</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The method call works because of dynamic dispatch (the method is selected at runtime). The equivalent code in Java would
require to cast <code>o</code> to a <code>Greeter</code> before calling the <code>greeting</code> method, because methods are selected at compile time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">o </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(((</span><span class="typ">Greeter</span><span class="pun">)</span><span class="pln">o</span><span class="pun">).</span><span class="pln">greeting</span><span class="pun">());</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, in Groovy, even if you add <code>@TypeChecked</code> (and thus activate type checking) on the <code>doSomething</code> method, the
cast is <strong>not</strong> necessary. The compiler embeds <em>instanceof</em> inference that makes the cast optional.</p>
</div>
</div>
<div class="sect6">
<h7 id="section-flow-typing"><a class="anchor" href="#section-flow-typing"></a>Flow typing</h7>
<div class="paragraph">
<p>Flow typing is an important concept of Groovy in type checked mode and an extension of type inference. The idea is that
the compiler is capable of inferring the type of variables in the flow of the code, not just at initialization:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> flowTyping</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> o </span><span class="pun">=</span><span class="pln"> </span><span class="str">'foo'</span><span class="pln">                       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    o </span><span class="pun">=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    o </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9d</span><span class="pln">                              </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    o </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sqrt</span><span class="pun">(</span><span class="pln">o</span><span class="pun">)</span><span class="pln">                    </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>first, <code>o</code> is declared using <code>def</code> and assigned a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the compiler inferred that <code>o</code> is a <code>String</code>, so calling <code>toUpperCase</code> is allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>o</code> is reassigned with a <code>double</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>calling <code>Math.sqrt</code> passes compilation because the compiler knows that at this point, <code>o</code> is a <code>double</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>So the type checker is <em>aware</em> of the fact that the concrete type of a variable is different over time. In particular,
if you replace the last assignment with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">o </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9d</span><span class="pln">
o </span><span class="pun">=</span><span class="pln"> o</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The type checker will now fail at compile time, because it knows that <code>o</code> is a <code>double</code> when <code>toUpperCase</code> is called,
so it’s a type error.</p>
</div>
<div class="paragraph">
<p>It is important to understand that it is not the fact of declaring a variable with <code>def</code> that triggers type inference.
Flow typing works for <strong>any</strong> variable of any type. Declaring a variable with an explicit type only constraints what you
can assign to a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> flowTypingWithExplicitType</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">List</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">]</span><span class="pln">           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    list </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">*.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    list </span><span class="pun">=</span><span class="pln"> </span><span class="str">'foo'</span><span class="pln">                        </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>list</code> is declared as an unchecked <code>List</code> and assigned a list literal of `String`s</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>this line passes compilation because of flow typing: the type checker knows that <code>list</code> is at this point a <code>List&lt;String&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>but you can’t assign a <code>String</code> to a <code>List</code> so this is a type checking error</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can also note that even if the variable is declared <strong>without</strong> generics information, the type checker knows what is
the component type. Therefore, such code would fail compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> flowTypingWithExplicitType</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">List</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">]</span><span class="pln">           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    list</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">                         </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>list</code> is inferred as <code>List&lt;String&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>so adding an <code>int</code> to a <code>List&lt;String&gt;</code> is a compile-time error</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Fixing this requires adding an explicit generic type to the declaration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> flowTypingWithExplicitType</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">List</span><span class="pun">&lt;?</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Serializable</span><span class="pun">&gt;</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    list</span><span class="pun">.</span><span class="pln">addAll</span><span class="pun">([</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">])</span><span class="pln">                                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    list</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">                                                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>list</code> declared as <code>List&lt;? extends Serializable&gt;</code> and initialized with an empty list</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>elements added to the list conform to the declaration type of the list</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>so adding an <code>int</code> to a <code>List&lt;? extends Serializable&gt;</code> is allowed</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Flow typing has been introduced to reduce the difference in semantics between classic and static Groovy. In particular,
consider the behavior of this code in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> compute</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> str</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> compute</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"Nope"</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="com">// ...</span><span class="pln">
</span><span class="typ">Object</span><span class="pln"> string </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Some string"</span><span class="pun">;</span><span class="pln">          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">Object</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> compute</span><span class="pun">(</span><span class="pln">string</span><span class="pun">);</span><span class="pln">        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">System</span><span class="pun">.</span><span class="pln">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">result</span><span class="pun">);</span><span class="pln">             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>o</code> is declared as an <code>Object</code> and assigned a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we call the <code>compute</code> method with <code>o</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and print the result</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In Java, this code will output <code>Nope</code>, because method selection is done at compile time and based on the <strong>declared</strong> types.
So even if <code>o</code> is a <code>String</code> at runtime, it is still the <code>Object</code> version which is called, because <code>o</code> has been declared
as an <code>Object</code>. To be short, in Java, declared types are most important, be it variable types, parameter types or return
types.</p>
</div>
<div class="paragraph">
<p>In Groovy, we could write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> compute</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">string</span><span class="pun">.</span><span class="pln">length</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> compute</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Nope"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="typ">Object</span><span class="pln"> o </span><span class="pun">=</span><span class="pln"> </span><span class="str">'string'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> compute</span><span class="pun">(</span><span class="pln">o</span><span class="pun">)</span><span class="pln">
println result</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But this time, it will return <code>6</code>, because the method which is chosen is chosen <strong>at runtime</strong>, based on the <em>actual</em>
argument types. So at runtime, <code>o</code> is a <code>String</code> so the <code>String</code> variant is used. Note that this behavior has nothing
to do with type checking, it’s the way Groovy works in general: dynamic dispatch.</p>
</div>
<div class="paragraph">
<p>In type checked Groovy, we want to make sure the type checker selects the same method <strong>at compile time</strong>, that the runtime
would choose. It is not possible in general, due to the semantics of the language, but we can make things better with flow
typing. With flow typing, <code>o</code> is <em>inferred</em> as a <code>String</code> when the <code>compute</code> method is called, so the version which takes
a <code>String</code> and returns an <code>int</code> is chosen. This means that we can infer the return type of the method to be an <code>int</code>, and
not a <code>String</code>. This is important for subsequent calls and type safety.</p>
</div>
<div class="paragraph">
<p>So in type checked Groovy, flow typing is a very important concept, which also implies that if <code>@TypeChecked</code> is applied,
methods are selected based on the <em>inferred types</em> of the arguments, not on the declared types. This doesn’t ensure 100%
type safety, because the type checker <em>may</em> select a wrong method, but it ensures the closest semantics to dynamic Groovy.</p>
</div>
</div>
<div class="sect6">
<h7 id="_advanced_type_inference"><a class="anchor" href="#_advanced_type_inference"></a>Advanced type inference</h7>
<div class="paragraph">
<p>A combination of <a href="#section-flow-typing">flow typing</a> and <a href="#section-lub">least upper bound inference</a> is used to perform
advanced type inference and ensure type safety in multiple situations. In particular, program control structures are
likely to alter the inferred type of a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Top</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">void</span><span class="pln"> methodFromTop</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bottom</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Top</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">void</span><span class="pln"> methodFromBottom</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> o
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">someCondition</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    o </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Top</span><span class="pun">()</span><span class="pln">                               </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    o </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bottom</span><span class="pun">()</span><span class="pln">                            </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
o</span><span class="pun">.</span><span class="pln">methodFromTop</span><span class="pun">()</span><span class="pln">                               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
o</span><span class="pun">.</span><span class="pln">methodFromBottom</span><span class="pun">()</span><span class="pln">  </span><span class="com">// compilation error      </span><i class="conum" data-value="4"></i><b><span class="com">(4)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if <code>someCondition</code> is true, <code>o</code> is assigned a <code>Top</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if <code>someCondition</code> is false, <code>o</code> is assigned a <code>Bottom</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calling <code>methodFromTop</code> is safe</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but calling <code>methodFromBottom</code> is not, so it’s a compile time error</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>When the type checker visits an <code>if/else</code> control structure, it checks all variables which are assigned in <code>if/else</code> branches
and computes the <a href="#section-lub">least upper bound</a> of all assignments. This type is the type of the inferred variable
after the <code>if/else</code> block, so in this example, <code>o</code> is assigned a <code>Top</code> in the <code>if</code> branch and a <code>Bottom</code> in the <code>else</code>
branch. The <a href="#section-lub">LUB</a> of those is a <code>Top</code>, so after the conditional branches, the compiler infers <code>o</code> as being
a <code>Top</code>. Calling <code>methodFromTop</code> will therefore be allowed, but not <code>methodFromBottom</code>.</p>
</div>
<div class="paragraph">
<p>The same reasoning exists with closures and in particular closure shared variables. A closure shared variable is a variable
which is defined outside of a closure, but used inside a closure, as in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> text </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Hello, world!'</span><span class="pln">                          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> closure </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println text                                    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a variable named <code>text</code> is declared</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>text</code> is used from inside a closure. It is a <em>closure shared variable</em>.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Groovy allows developers to use those variables without requiring them to be final. This means that a closure shared
variable can be reassigned inside a closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> result
doSomething </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> it </span><span class="pun">-&gt;</span><span class="pln">
    result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Result: $it"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
result </span><span class="pun">=</span><span class="pln"> result</span><span class="pun">?.</span><span class="pln">toUpperCase</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The problem is that a closure is an independent block of code that can be executed (or not) at <strong>any</strong> time. In particular,
<code>doSomething</code> may be asynchronous, for example. This means that the body of a closure doesn’t belong to the main control
flow. For that reason, the type checker also computes, for each closure shared variable, the <a href="#section-lub">LUB</a> of all
assignments of the variable, and will use that <code>LUB</code> as the inferred type outside of the scope of the closure, like in
this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Top</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">void</span><span class="pln"> methodFromTop</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bottom</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Top</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">void</span><span class="pln"> methodFromBottom</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> o </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Top</span><span class="pun">()</span><span class="pln">                               </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln">
    o </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bottom</span><span class="pun">()</span><span class="pln">                            </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">
o</span><span class="pun">.</span><span class="pln">methodFromTop</span><span class="pun">()</span><span class="pln">                               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
o</span><span class="pun">.</span><span class="pln">methodFromBottom</span><span class="pun">()</span><span class="pln">  </span><span class="com">// compilation error      </span><i class="conum" data-value="4"></i><b><span class="com">(4)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a closure-shared variable is first assigned a <code>Top</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>inside the closure, it is assigned a <code>Bottom</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>methodFromTop</code> is allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>methodFromBottom</code> is a compilation error</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Here, it is clear that when <code>methodFromBottom</code> is called, there’s no guarantee, at compile-time or runtime that the
type of <code>o</code> will <em>effectively</em> be a <code>Bottom</code>. There are chances that it will be, but we can’t make sure, because it’s
asynchronous. So the type checker will only allow calls on the <a href="#section-lub">least upper bound</a>, which is here a <code>Top</code>.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_closures_and_type_inference"><a class="anchor" href="#_closures_and_type_inference"></a>Closures and type inference</h6>
<div class="paragraph">
<p>The type checker performs special inference on closures, resulting on additional checks on one side and improved fluency
on the other side.</p>
</div>
<div class="sect6">
<h7 id="_return_type_inference"><a class="anchor" href="#_return_type_inference"></a>Return type inference</h7>
<div class="paragraph">
<p>The first thing that the type checker is capable of doing is inferring the <em>return type</em> of a closure. This is simply
 illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> testClosureReturnTypeInference</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> arg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Arg: $arg"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                                </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> val </span><span class="pun">=</span><span class="pln"> cl</span><span class="pun">()</span><span class="pln">                                          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

    val</span><span class="pun">.</span><span class="pln">length</span><span class="pun">()</span><span class="pln">                                            </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a closure is defined, and it returns a string (more precisely a <code>GString</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we call the closure and assign the result to a variable</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the type checker inferred that the closure would return a string, so calling <code>length()</code> is allowed</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As you can see, unlike a method which declares its return type explicitly, there’s no need to declare the return type
of a closure: its type is inferred from the body of the closure.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Closures vs methods</div>
<div class="paragraph">
<p>It’s worth noting that return type inference is only applicable to closures. While the type checker could do the
same on a method, it is in practice not desirable: <em>in general</em>, methods can be overridden and it is not statically
possible to make sure that the method which is called is not an overridden version. So flow typing would actually
think that a method returns something, while in reality, it could return something else, like illustrated in the
following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@TypeChecked</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> A </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> compute</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'some string'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> computeFully</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        compute</span><span class="pun">().</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="lit">@TypeChecked</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> B </span><span class="kwd">extends</span><span class="pln"> A </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> compute</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">123</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                       </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>class <code>A</code> defines a method <code>compute</code> which effectively returns a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>this will fail compilation because the return type of <code>compute</code> is <code>def</code>(aka <code>Object</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>class <code>B</code> extends <code>A</code> and redefines <code>compute</code>, this type returning an <code>int</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As you can see, if the type checker relied on the inferred return type of a method, with <a href="#section-flow-typing">flow typing</a>,
the type checker could determine that it is ok to call <code>toUpperCase</code>. It is in fact an <strong>error</strong>, because a subclass can
override <code>compute</code> and return a different object. Here, <code>B#compute</code> returns an <code>int</code>, so someone calling <code>computeFully</code>
on an instance of <code>B</code> would see a runtime error. The compiler prevents this from happening by using the declared return
type of methods instead of the inferred return type.</p>
</div>
<div class="paragraph">
<p>For consistency, this behavior is the same for <strong>every</strong> method, even if they are static or final.</p>
</div>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_parameter_type_inference"><a class="anchor" href="#_parameter_type_inference"></a>Parameter type inference</h7>
<div class="paragraph">
<p>In addition to the return type, it is possible for a closure to infer its parameter types from the context. There are
two ways for the compiler to infer the parameter types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>through <em>implicit SAM type coercion</em></p>
</li>
<li>
<p>through API metadata</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To illustrate this, lets start with an example that will fail compilation due to the inability for the type checker
to infer the parameter types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> inviteIf</span><span class="pun">(</span><span class="typ">Person</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">&lt;</span><span class="typ">Boolean</span><span class="pun">&gt;</span><span class="pln"> predicate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">predicate</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">p</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// send invite</span><span class="pln">
        </span><span class="com">// ...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> failCompilation</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Gerard'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">55</span><span class="pun">)</span><span class="pln">
    inviteIf</span><span class="pun">(</span><span class="pln">p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                               </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        it</span><span class="pun">.</span><span class="pln">age </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">18</span><span class="pln"> </span><span class="com">// No such property: age                   </span><i class="conum" data-value="3"></i><b><span class="com">(3)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>inviteIf</code> method accepts a <code>Person</code> and a <code>Closure</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we call it with a <code>Person</code> and a <code>Closure</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>yet <code>it</code> is not statically known as being a <code>Person</code> and compilation fails</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In this example, the closure body contains <code>it.age</code>. With dynamic, not type checked code, this would work, because the
type of <code>it</code> would be a <code>Person</code> at runtime. Unfortunately, at compile-time, there’s no way to know what is the type
of <code>it</code>, just by reading the signature of <code>inviteIf</code>.</p>
</div>
<div class="sect7">
<h8 id="_explicit_closure_parameters"><a class="anchor" href="#_explicit_closure_parameters"></a>Explicit closure parameters</h8>
<div class="paragraph">
<p>To be short, the type checker doesn’t have enough contextual information on the <code>inviteIf</code> method to determine statically
the type of <code>it</code>. This means that the method call needs to be rewritten like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">inviteIf</span><span class="pun">(</span><span class="pln">p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> it </span><span class="pun">-&gt;</span><span class="pln">                                  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    it</span><span class="pun">.</span><span class="pln">age </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">18</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the type of <code>it</code> needs to be declared explicitly</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>By explicitly declaring the type of the <code>it</code> variable, you can workaround the problem and make this code statically
checked.</p>
</div>
</div>
<div class="sect7">
<h8 id="_parameters_inferred_from_single_abstract_method_types"><a class="anchor" href="#_parameters_inferred_from_single_abstract_method_types"></a>Parameters inferred from single-abstract method types</h8>
<div class="paragraph">
<p>For an API or framework designer, there are two ways to make this more elegant for users, so that they don’t have to
declare an explicit type for the closure parameters. The first one, and easiest, is to replace the closure with a
SAM type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Predicate</span><span class="pun">&lt;</span><span class="typ">On</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> apply</span><span class="pun">(</span><span class="typ">On</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                 </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">void</span><span class="pln"> inviteIf</span><span class="pun">(</span><span class="typ">Person</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Predicate</span><span class="pun">&lt;</span><span class="typ">Person</span><span class="pun">&gt;</span><span class="pln"> predicate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">predicate</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="pln">p</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// send invite</span><span class="pln">
        </span><span class="com">// ...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> passesCompilation</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Gerard'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">55</span><span class="pun">)</span><span class="pln">

    inviteIf</span><span class="pun">(</span><span class="pln">p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        it</span><span class="pun">.</span><span class="pln">age </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">18</span><span class="pln">                                            </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declare a <code>SAM</code> interface with an <code>apply</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>inviteIf</code> now uses a <code>Predicate&lt;Person&gt;</code> instead of a <code>Closure&lt;Boolean&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>there’s no need to declare the type of the <code>it</code> variable anymore</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>it.age</code> compiles properly, the type of <code>it</code> is inferred from the <code>Predicate#apply</code> method signature</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By using this technique, we leverage the <em>automatic coercion of closures to SAM types</em> feature of Groovy. The
question whether you should use a <em>SAM type</em> or a <em>Closure</em> really depends on what you need to do. In a lot of cases,
using a SAM interface is enough, especially if you consider functional interfaces as they are found in Java 8. However,
closures provide features that are not accessible to functional interfaces. In particular, closures can have a delegate,
and owner and can be manipulated as objects (for example, cloned, serialized, curried, …​) before being called. They can
also support multiple signatures (polymorphism). So if you need that kind of manipulation, it is preferable to switch to
the most advanced type inference annotations which are described below.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The original issue that needs to be solved when it comes to closure parameter type inference, that is to say, statically
determining the types of the arguments of a closure <em>without</em> having to have them explicitly declared, is that the Groovy
type system inherits the Java type system, which is insufficient to describe the types of the arguments.</p>
</div>
</div>
<div class="sect7">
<h8 id="_the_code_closureparams_code_annotation"><a class="anchor" href="#_the_code_closureparams_code_annotation"></a>The <code>@ClosureParams</code> annotation</h8>
<div class="paragraph">
<p>Groovy provides an annotation, <code>@ClosureParams</code> which is aimed at completing type information. This annotation is primarily
aimed at framework and API developers who want to extend the capabilities of the type checker by providing type inference
metadata. This is important if your library makes use of closures and that you want the maximum level of tooling support
too.</p>
</div>
<div class="paragraph">
<p>Let’s illustrate this by fixing the original example, introducing the <code>@ClosureParams</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">ClosureParams</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">FirstParam</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> inviteIf</span><span class="pun">(</span><span class="typ">Person</span><span class="pln"> p</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="typ">FirstParam</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">&lt;</span><span class="typ">Boolean</span><span class="pun">&gt;</span><span class="pln"> predicate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">predicate</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">p</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// send invite</span><span class="pln">
        </span><span class="com">// ...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
inviteIf</span><span class="pun">(</span><span class="pln">p</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                                                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    it</span><span class="pun">.</span><span class="pln">age </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">18</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the closure parameter is annotated with <code>@ClosureParams</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it’s not necessary to use an explicit type for <code>it</code>, which is inferred</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>@ClosureParams</code> annotation minimally accepts one argument, which is named a <em>type hint</em>. A type hint is a class which
is responsible for completing type information at compile time for the closure. In this example, the type hint being used
is <code>groovy.transform.stc.FirstParam</code> which indicated to the type checker that the closure will accept one parameter
whose type is the type of the first parameter of the method. In this case, the first parameter of the method is <code>Person</code>,
so it indicates to the type checker that the first parameter of the closure is in fact a <code>Person</code>.</p>
</div>
<div class="paragraph">
<p>The second argument is optional and named <em>options</em>. It’s semantics depends on the <em>type hint</em> class. Groovy comes with
various bundled type hints, illustrated in the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Predefined type hints</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 66%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type hint</th>
<th class="tableblock halign-left valign-top">Polymorphic?</th>
<th class="tableblock halign-left valign-top">Description and examples</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>FirstParam</code><br>
<code>SecondParam</code><br>
<code>ThirdParam</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The first (resp. second, third) parameter type of the method<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">FirstParam</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> str</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="typ">FirstParam</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    c</span><span class="pun">(</span><span class="pln">str</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
doSomething</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println it</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">SecondParam</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> withHash</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> str</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> seed</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="typ">SecondParam</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    c</span><span class="pun">(</span><span class="lit">31</span><span class="pun">*</span><span class="pln">str</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()+</span><span class="pln">seed</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
withHash</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="typ">System</span><span class="pun">.</span><span class="pln">currentTimeMillis</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> mod </span><span class="pun">=</span><span class="pln"> it</span><span class="pun">%</span><span class="lit">2</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">ThirdParam</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> format</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> prefix</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> postfix</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> o</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="typ">ThirdParam</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">"$prefix${c(o)}$postfix"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> format</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'bar'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'baz'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    it</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'fooBAZbar'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>FirstParam.FirstGenericType</code><br>
<code>SecondParam.FirstGenericType</code><br>
<code>ThirdParam.FirstGenericType</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The first generic type of the first (resp. second, third) parameter of the method<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">FirstParam</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="typ">List</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> strings</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="typ">FirstParam</span><span class="pun">.</span><span class="typ">FirstGenericType</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    strings</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln">
        c</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
doSomething</span><span class="pun">([</span><span class="str">'foo'</span><span class="pun">,</span><span class="str">'bar'</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println it</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
doSomething</span><span class="pun">([</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println</span><span class="pun">(</span><span class="lit">2</span><span class="pun">*</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Variants for <code>SecondGenericType</code> and <code>ThirdGenericType</code> exist for all <code>FirstParam</code>, <code>SecondParam</code> and <code>ThirdParam</code>
type hints.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>SimpleType</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A type hint for which the type of closure parameters comes from the options string.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">SimpleType</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="pln">value</span><span class="pun">=</span><span class="typ">SimpleType</span><span class="pun">,</span><span class="pln">options</span><span class="pun">=[</span><span class="str">'java.lang.String'</span><span class="pun">,</span><span class="str">'int'</span><span class="pun">])</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    c</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">,</span><span class="lit">3</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
doSomething </span><span class="pun">{</span><span class="pln"> str</span><span class="pun">,</span><span class="pln"> len </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> len
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This type hint supports a <strong>single</strong> signature and each of the parameter is specified as a value of the <em>options</em> array
using a fully-qualified type name or a primitive type.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>MapEntryOrKeyValue</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A dedicated type hint for closures that either work on a <code>Map.Entry</code> single parameter, or two parameters corresponding
to the key and the value.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">MapEntryOrKeyValue</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="typ">Map</span><span class="pun">&lt;</span><span class="pln">K</span><span class="pun">,</span><span class="pln">V</span><span class="pun">&gt;</span><span class="pln"> map</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="typ">MapEntryOrKeyValue</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
doSomething</span><span class="pun">([</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="str">'A'</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> k</span><span class="pun">,</span><span class="pln">v </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> k</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> v</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
doSomething</span><span class="pun">([</span><span class="pln">abc</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> e </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">key</span><span class="pun">.</span><span class="pln">length</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">value
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This type hint <strong>requires</strong> that the first argument is a <code>Map</code> type, and infers the closure parameter types from the map
actual key/value types.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>FromAbstractTypeMethods</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Infers closure parameter types from the abstract method of some type. A signature is inferred for <strong>each</strong> abstract method.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">FromAbstractTypeMethods</span><span class="pln">
</span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> firstSignature</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> secondSignature</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> str</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="pln">value</span><span class="pun">=</span><span class="typ">FromAbstractTypeMethods</span><span class="pun">,</span><span class="pln"> options</span><span class="pun">=[</span><span class="str">"Foo"</span><span class="pun">])</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
doSomething </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln"> a</span><span class="pun">+</span><span class="pln">b </span><span class="pun">}</span><span class="pln">
doSomething </span><span class="pun">{</span><span class="pln"> s </span><span class="pun">-&gt;</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If there are multiple signatures like in the example above, the type checker will <strong>only</strong> be able to infer the types of
the arguments if the arity of each method is different. In the example above, <code>firstSignature</code> takes 2 arguments and
<code>secondSignature</code> takes 1 argument, so the type checker can infer the argument types based on the number of arguments.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>FromString</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Infers the closure parameter types from the <code>options</code> argument. The <code>options</code> argument consists of an array of comma-separated
non-primitive types. Each element of the array corresponds to a single signature, and each comma in an element separate
parameters of the signature. In short, this is the most generic type hint, and each string of the <code>options</code> map is <strong>parsed</strong>
as if it was a signature literal. While being very powerful, this type hint must be avoided if you can because it increases
the compilation times due to the necessity of parsing the type signatures.</p>
</div>
<div class="paragraph">
<p>A single signature for a closure accepting a <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">FromString</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="pln">value</span><span class="pun">=</span><span class="typ">FromString</span><span class="pun">,</span><span class="pln"> options</span><span class="pun">=[</span><span class="str">"String"</span><span class="pun">,</span><span class="str">"String,Integer"</span><span class="pun">])</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
doSomething </span><span class="pun">{</span><span class="pln"> s </span><span class="pun">-&gt;</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
doSomething </span><span class="pun">{</span><span class="pln"> s</span><span class="pun">,</span><span class="pln">i </span><span class="pun">-&gt;</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()*</span><span class="pln">i </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A polymorphic closure, accepting either a <code>String</code> or a <code>String, Integer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">FromString</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="pln">value</span><span class="pun">=</span><span class="typ">FromString</span><span class="pun">,</span><span class="pln"> options</span><span class="pun">=[</span><span class="str">"String"</span><span class="pun">,</span><span class="str">"String,Integer"</span><span class="pun">])</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
doSomething </span><span class="pun">{</span><span class="pln"> s </span><span class="pun">-&gt;</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
doSomething </span><span class="pun">{</span><span class="pln"> s</span><span class="pun">,</span><span class="pln">i </span><span class="pun">-&gt;</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()*</span><span class="pln">i </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A polymorphic closure, accepting either a <code>T</code> or a pair <code>T,T</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">FromString</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">(</span><span class="pln">T e</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@ClosureParams</span><span class="pun">(</span><span class="pln">value</span><span class="pun">=</span><span class="typ">FromString</span><span class="pun">,</span><span class="pln"> options</span><span class="pun">=[</span><span class="str">"T"</span><span class="pun">,</span><span class="str">"T,T"</span><span class="pun">])</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
doSomething</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> s </span><span class="pun">-&gt;</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
doSomething</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> s1</span><span class="pun">,</span><span class="pln">s2 </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">assert</span><span class="pln"> s1</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> s2</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Even though you use <code>FirstParam</code>, <code>SecondParam</code> or <code>ThirdParam</code> as a type hint, it doesn’t strictly mean that the
argument which will be passed to the closure <strong>will</strong> be the first (resp. second, third) argument of the method call. It
only means that the <strong>type</strong> of the parameter of the closure will be the <strong>same</strong> as the type of the first (resp.  second,
 third) argument of the method call.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In short, the lack of the <code>@ClosureParams</code> annotation on a method accepting a <code>Closure</code> will <strong>not</strong> fail compilation. If
 present (and it can be present in Java sources as well as Groovy sources), then the type checker has <strong>more</strong> information
 and can perform additional type inference. This makes this feature particularly interesting for framework developers.</p>
</div>
</div>
</div>
<div class="sect6">
<h7 id="__code_delegatesto_code"><a class="anchor" href="#__code_delegatesto_code"></a><code>@DelegatesTo</code></h7>
<div class="paragraph">
<p>The <code>@DelegatesTo</code> annotation is used by the type checker to infer the type of the delegate. It allows the API designer
to instruct the compiler what is the type of the delegate and the delegation strategy. The <code>@DelegatesTo</code> annotation is
discussed in a <a href="http://docs.groovy-lang.org/latest/html/documentation/core-domain-specific-languages.html#section-delegatesto">specific section</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_static_compilation"><a class="anchor" href="#_static_compilation"></a>Static compilation</h5>
<div class="sect5">
<h6 id="_dynamic_vs_static"><a class="anchor" href="#_dynamic_vs_static"></a>Dynamic vs static</h6>
<div class="paragraph">
<p>In the <a href="#static-type-checking">type checking section</a>, we have seen that Groovy provides optional type checking thanks to the
<code>@TypeChecked</code> annotation. The type checker runs at compile time and performs a static analysis of dynamic code. The
program will behave exactly the same whether type checking has been enabled or not. This means that the <code>@TypeChecked</code>
annotation is neutral with regards to the semantics of a program. Even though it may be necessary to add type information
in the sources so that the program is considered type safe, in the end, the semantics of the program are the same.</p>
</div>
<div class="paragraph">
<p>While this may sound fine, there is actually one issue with this: type checking of dynamic code, done at compile time, is
by definition only correct if no runtime specific behavior occurs. For example, the following program passes type checking:</p>
</div>
<div id="typechecked-defeated" class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Computer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> compute</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> str</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> compute</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">String</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> test</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> computer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Computer</span><span class="pun">()</span><span class="pln">
    computer</span><span class="pun">.</span><span class="kwd">with</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> compute</span><span class="pun">(</span><span class="pln">compute</span><span class="pun">(</span><span class="str">'foobar'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">==</span><span class="str">'6'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two <code>compute</code> methods. One accepts a <code>String</code> and returns an <code>int</code>, the other accepts an <code>int</code> and returns
a <code>String</code>. If you compile this, it is considered type safe: the inner <code>compute('foobar')</code> call will return an <code>int</code>,
and calling <code>compute</code> on this <code>int</code> will in turn return a <code>String</code>.</p>
</div>
<div class="paragraph">
<p>Now, before calling <code>test()</code>, consider adding the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Computer</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">compute </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> str </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using runtime metaprogramming, we’re actually modifying the behavior of the <code>compute(String)</code> method, so that instead of
returning the length of the provided argument, it will return a <code>Date</code>. If you execute the program, it will fail at
runtime. Since this line can be added from anywhere, in any thread, there’s absolutely no way for the type checker to
statically make sure that no such thing happens. In short, the type checker is vulnerable to monkey patching. This is
just one example, but this illustrates the concept that doing static analysis of a dynamic program is inherently wrong.</p>
</div>
<div class="paragraph">
<p>The Groovy language provides an alternative annotation to <code>@TypeChecked</code> which will actually make sure that the methods
which are inferred as being called <strong>will</strong> effectively be called at runtime. This annotation turns the Groovy compiler
into a <strong>static compiler</strong>, where all method calls are resolved at compile time <strong>and</strong> the generated bytecode makes sure
that this happens: the annotation is <code>@groovy.transform.CompileStatic</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="compilestatic-annotation"><a class="anchor" href="#compilestatic-annotation"></a>The <code>@CompileStatic</code> annotation</h6>
<div class="paragraph">
<p>The <code>@CompileStatic</code> annotation can be added anywhere the <code>@TypeChecked</code> annotation can be used, that is to say on
a class or a method. It is not necessary to add both <code>@TypeChecked</code> and <code>@CompileStatic</code>, as <code>@CompileStatic</code> performs
everything <code>@TypeChecked</code> does, but in addition triggers static compilation.</p>
</div>
<div class="paragraph">
<p>Let’s take the <a href="#typechecked-defeated">example which failed</a>, but this time let’s replace the <code>@TypeChecked</code> annotation
with <code>@CompileStatic</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Computer</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> compute</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> str</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        str</span><span class="pun">.</span><span class="pln">length</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> compute</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">String</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">CompileStatic</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> test</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> computer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Computer</span><span class="pun">()</span><span class="pln">
    computer</span><span class="pun">.</span><span class="kwd">with</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> compute</span><span class="pun">(</span><span class="pln">compute</span><span class="pun">(</span><span class="str">'foobar'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">==</span><span class="str">'6'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">Computer</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">compute </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> str </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
test</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the <strong>only</strong> difference. If we execute this program, this time, there is no runtime error. The <code>test</code> method
became immune to monkey patching, because the <code>compute</code> methods which are called in its body are linked at compile
time, so even if the metaclass of <code>Computer</code> changes, the program still behaves <strong>as expected by the type checker</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_key_benefits"><a class="anchor" href="#_key_benefits"></a>Key benefits</h6>
<div class="paragraph">
<p>There are several benefits of using <code>@CompileStatic</code> on your code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>type safety</p>
</li>
<li>
<p>immunity to <a href="#compilestatic-annotation">monkey patching</a></p>
</li>
<li>
<p>performance improvements</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The performance improvements depend on the kind of program you are executing. If it is I/O bound, the difference between
statically compiled code and dynamic code is barely noticeable. On highly CPU intensive code, since the bytecode which
is generated is very close, if not equal, to the one that Java would produce for an equivalent program, the performance
is greatly improved.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Using the <em>invokedynamic</em> version of Groovy, which is accessible to people using JDK 7 and above, the performance
of the dynamic code should be very close to the performance of statically compiled code. Sometimes, it can even be faster!
There is only one way to determine which version you should choose: measuring. The reason is that depending on your program
<strong>and</strong> the JVM that you use, the performance can be significantly different. In particular, the <em>invokedynamic</em> version of
Groovy is very sensitive to the JVM version in use.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_type_checking_extensions"><a class="anchor" href="#_type_checking_extensions"></a>1.6.7. Type checking extensions</h4>
<div class="sect4">
<h5 id="_writing_a_type_checking_extension"><a class="anchor" href="#_writing_a_type_checking_extension"></a>Writing a type checking extension</h5>
<div class="sect5">
<h6 id="_towards_a_smarter_type_checker"><a class="anchor" href="#_towards_a_smarter_type_checker"></a>Towards a smarter type checker</h6>
<div class="paragraph">
<p>Despite being a dynamic language, Groovy can be used with a static type
checker at compile time, enabled using the <a href="#static-type-checking">@TypeChecked</a>
annotation. In this mode, the compiler becomes
more verbose and throws errors for, example, typos, non-existent
methods,… This comes with a few limitations though, most of them coming
from the fact that Groovy remains inherently a dynamic language. For
example, you wouldn’t be able to use type checking on code that uses the markup builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">(</span><span class="kwd">out</span><span class="pun">)</span><span class="pln">
builder</span><span class="pun">.</span><span class="pln">html </span><span class="pun">{</span><span class="pln">
    head </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// ...</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    body </span><span class="pun">{</span><span class="pln">
        p </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous example, none of the <code>html</code>, <code>head</code>, <code>body</code> or <code>p</code> methods
exist. However if you execute the code, it works because Groovy uses dynamic dispatch
and converts those method calls at runtime. In this builder, there’s no limitation about
the number of tags that you can use, nor the attributes, which means there is no chance
for a type checker to know about all the possible methods (tags) at compile time, unless
you create a builder dedicated to HTML for example.</p>
</div>
<div class="paragraph">
<p>Groovy is a platform of choice when it comes to implement internal DSLs. The flexible syntax,
combined with runtime and compile-time metaprogramming capabilities make Groovy an interesting
choice because it allows the programmer to focus on the DSL rather than
on tooling or implementation. Since Groovy DSLs are Groovy code, it’s
easy to have IDE support without having to write a dedicated plugin for
example.</p>
</div>
<div class="paragraph">
<p>In a lot of cases, DSL engines are written in Groovy (or Java) then user
code is executed as scripts, meaning that you have some kind of wrapper
on top of user logic. The wrapper may consist, for example, in a
<code>GroovyShell</code> or <code>GroovyScriptEngine</code> that performs some tasks transparently
before running the script (adding imports, applying AST transforms,
extending a base script,…). Often, user written scripts come to
production without testing because the DSL logic comes to a point
where&nbsp;<strong>any</strong> user may write code using the DSL syntax. In the end, a user
may just ignore that what he writes is actually&nbsp;<strong>code</strong>. This adds some
challenges for the DSL implementer, such as securing execution of user
code or, in this case, early reporting of errors.</p>
</div>
<div class="paragraph">
<p>For example, imagine a DSL which goal is to drive a rover on Mars
remotely. Sending a message to the rover takes around 15 minutes. If the
rover executes the script and fails with an error (say a typo), you have
two problems:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first, feedback comes only after 30 minutes (the time needed for the
rover to get the script and the time needed to receive the error)</p>
</li>
<li>
<p>second, some portion of the script has been executed and you may have
to change the fixed script significantly (implying that you need to know
the current state of the rover…)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Type checking extensions is a mechanism that will
allow the developer of a DSL engine to make those scripts safer by
applying the same kind of checks that static type checking allows on
regular groovy classes.</p>
</div>
<div class="paragraph">
<p>The principle, here, is to fail early, that is
to say fail compilation of scripts as soon as possible, and if possible
provide feedback to the user (including nice error messages).</p>
</div>
<div class="paragraph">
<p>In short, the idea behind type checking extensions is to make the compiler
aware of all the runtime metaprogramming tricks that the DSL uses, so that
scripts can benefit the same level of compile-time checks as a verbose statically
compiled code would have. We will see that you can go even further by performing
checks that a normal type checker wouldn’t do, delivering powerful compile-time
checks for your users.</p>
</div>
</div>
<div class="sect5">
<h6 id="Typecheckingextensions-Howdoesitwork"><a class="anchor" href="#Typecheckingextensions-Howdoesitwork"></a>The extensions attribute</h6>
<div class="paragraph">
<p>The&nbsp;<code>@TypeChecked</code> annotation supports an attribute
named&nbsp;<code>extensions</code>. This parameter takes an array of strings
corresponding to a list of <em>type checking extensions scripts</em>. Those
scripts are found at&nbsp;<strong>compile time</strong> on classpath. For example, you would
write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@TypeChecked</span><span class="pun">(</span><span class="pln">extensions</span><span class="pun">=</span><span class="str">'/path/to/myextension.groovy'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> foo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In that case, the&nbsp;<em>foo</em> methods would be type checked with the rules of
the normal type checker completed by those found in
the&nbsp;<em>myextension.groovy</em> script. Note that while internally the type
checker supports multiple mechanisms to implement type checking
extensions (including plain old java code), the recommended way is to
use those type checking extension scripts.</p>
</div>
</div>
<div class="sect5">
<h6 id="_a_dsl_for_type_checking"><a class="anchor" href="#_a_dsl_for_type_checking"></a>A DSL for type checking</h6>
<div class="paragraph">
<p>The idea behind type checking extensions is to use a DSL to extend the
type checker capabilities. This DSL allows you to hook into the
compilation process, more specifically the type checking phase, using an
"event-driven" API. For example, when the type checker enters a method
body, it throws a&nbsp;<em>beforeVisitMethod</em> event that the extension can react to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">beforeVisitMethod </span><span class="pun">{</span><span class="pln"> methodNode </span><span class="pun">-&gt;</span><span class="pln">
 println </span><span class="str">"Entering ${methodNode.name}"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Imagine that you have this rover DSL at hand. A user would write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">robot</span><span class="pun">.</span><span class="pln">move </span><span class="lit">100</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have a class defined as such:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Robot</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Robot</span><span class="pln"> move</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> qt</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The script can be type checked before being executed using the following
script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="typ">TypeChecked</span><span class="pun">)</span><span class="pln">            </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">config</span><span class="pun">)</span><span class="pln">                         </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> robot </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Robot</span><span class="pun">()</span><span class="pln">
shell</span><span class="pun">.</span><span class="pln">setVariable</span><span class="pun">(</span><span class="str">'robot'</span><span class="pun">,</span><span class="pln"> robot</span><span class="pun">)</span><span class="pln">
shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="pln">script</span><span class="pun">)</span><span class="pln">                                      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a compiler configuration adds the <code>@TypeChecked</code> annotation to all classes</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>use the configuration in a <code>GroovyShell</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>so that scripts compiled using the shell are compiled with <code>@TypeChecked</code> without the user having to add it explicitly</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Using the compiler configuration above, we can apply&nbsp;<em>@TypeChecked</em>
transparently to the script. In that case, it will fail at compile
time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Static type checking] - The variable [robot] is undeclared.</pre>
</div>
</div>
<div class="paragraph">
<p>Now, we will slightly update the configuration to include the
``extensions'' parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">TypeChecked</span><span class="pun">,</span><span class="pln">
        extensions</span><span class="pun">:[</span><span class="str">'robotextension.groovy'</span><span class="pun">])</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add the following to your classpath:</p>
</div>
<div class="listingblock">
<div class="title">robotextension.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">unresolvedVariable </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">var</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="str">'robot'</span><span class="pun">==</span><span class="kwd">var</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        storeType</span><span class="pun">(</span><span class="kwd">var</span><span class="pun">,</span><span class="pln"> classNodeFor</span><span class="pun">(</span><span class="typ">Robot</span><span class="pun">))</span><span class="pln">
        handled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we’re telling the compiler that if an <em>unresolved variable</em> is found
and that the name of the variable is&nbsp;<em>robot</em>, then we can make sure that the type of this
variable is <code>Robot</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="Typecheckingextensions-TheAPI"><a class="anchor" href="#Typecheckingextensions-TheAPI"></a>Type checking extensions API</h6>
<div class="sect6">
<h7 id="Typecheckingextensions-AST"><a class="anchor" href="#Typecheckingextensions-AST"></a>AST</h7>
<div class="paragraph">
<p>The type checking API is a low level API, dealing with the Abstract
Syntax Tree. You will have to know your AST well to develop extensions,
even if the DSL makes it much easier than just dealing with AST code
from plain Java or Groovy.</p>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Events"><a class="anchor" href="#Typecheckingextensions-Events"></a>Events</h7>
<div class="paragraph">
<p>The type checker sends the following events, to which an extension
script can react:</p>
</div>
<table id="event-setup" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>setup</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called after the type checker finished initialization</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>none</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">setup </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// this is called before anything else</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be used to perform setup of your extension</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-finish" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>finish</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called after the type checker completed type checking</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>none</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">finish </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// this is after completion</span><span class="pln">
    </span><span class="com">// of all type checking</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be used to perform additional checks after the type checker has finished its job.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-unresolvedVariable" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>unresolvedVariable</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called when the type checker finds an
  unresolved variable</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>VariableExpression var</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">unresolvedVariable </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">var</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="str">'people'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">var</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        storeType</span><span class="pun">(</span><span class="kwd">var</span><span class="pun">,</span><span class="pln"> classNodeFor</span><span class="pun">(</span><span class="typ">List</span><span class="pun">))</span><span class="pln">
        handled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Allows the developer to help the type checker with user-injected variables.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-unresolvedProperty" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>unresolvedProperty</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called when the type checker cannot find
  a property on the receiver</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>PropertyExpression pexp</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">unresolvedProperty </span><span class="pun">{</span><span class="pln"> pexp </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="str">'longueur'</span><span class="pun">==</span><span class="pln">pexp</span><span class="pun">.</span><span class="pln">propertyAsString </span><span class="pun">&amp;&amp;</span><span class="pln">
        getType</span><span class="pun">(</span><span class="pln">pexp</span><span class="pun">.</span><span class="pln">objectExpression</span><span class="pun">)==</span><span class="pln">classNodeFor</span><span class="pun">(</span><span class="typ">String</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        storeType</span><span class="pun">(</span><span class="pln">pexp</span><span class="pun">,</span><span class="pln">classNodeFor</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">))</span><span class="pln">
        handled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Allows the developer to handle "dynamic" properties</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-unresolvedAttribute" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>unresolvedAttribute</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called when the type checker cannot
  find an attribute on the receiver</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>AttributeExpression aex</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">unresolvedAttribute </span><span class="pun">{</span><span class="pln"> aex </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">getType</span><span class="pun">(</span><span class="pln">aex</span><span class="pun">.</span><span class="pln">objectExpression</span><span class="pun">)==</span><span class="pln">classNodeFor</span><span class="pun">(</span><span class="typ">String</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        storeType</span><span class="pun">(</span><span class="pln">aex</span><span class="pun">,</span><span class="pln">classNodeFor</span><span class="pun">(</span><span class="typ">String</span><span class="pun">))</span><span class="pln">
        handled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Allows the developer to handle missing attributes</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-beforeMethodCall" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>beforeMethodCall</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called before the type checker starts type
  checking a method call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>MethodCall call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">beforeMethodCall </span><span class="pun">{</span><span class="pln"> call </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isMethodCallExpression</span><span class="pun">(</span><span class="pln">call</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">&amp;&amp;</span><span class="pln"> call</span><span class="pun">.</span><span class="pln">methodAsString</span><span class="pun">==</span><span class="str">'toUpperCase'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        addStaticTypeError</span><span class="pun">(</span><span class="str">'Not allowed'</span><span class="pun">,</span><span class="pln">call</span><span class="pun">)</span><span class="pln">
        handled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Allows you to intercept method calls before the
type checker performs its own checks. This is useful if you want to
replace the default type checking with a custom one for a limited scope.
In that case, you must set the handled flag to true, so that the type
checker skips its own checks.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-afterMethodCall" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>afterMethodCall</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called once the type checker has finished
  type checking a method call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>MethodCall call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">afterMethodCall </span><span class="pun">{</span><span class="pln"> call </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">getTargetMethod</span><span class="pun">(</span><span class="pln">call</span><span class="pun">).</span><span class="pln">name</span><span class="pun">==</span><span class="str">'toUpperCase'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        addStaticTypeError</span><span class="pun">(</span><span class="str">'Not allowed'</span><span class="pun">,</span><span class="pln">call</span><span class="pun">)</span><span class="pln">
        handled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Allow you to perform additional checks after the type
checker has done its own checks. This is in particular useful if you
want to perform the standard type checking tests but also want to ensure
additional type safety, for example checking the arguments against each
other.Note that <code>afterMethodCall</code> is called even if you did
<code>beforeMethodCall</code> and set the handled flag to true.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-onMethodSelection" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>onMethodSelection</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called by the type checker when it finds
  a method appropriate for a method call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Expression expr, MethodNode node</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">onMethodSelection </span><span class="pun">{</span><span class="pln"> expr</span><span class="pun">,</span><span class="pln"> node </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">node</span><span class="pun">.</span><span class="pln">declaringClass</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'java.lang.String'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// calling a method on 'String'</span><span class="pln">
        </span><span class="com">// let’s perform additional checks!</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(++</span><span class="pln">count</span><span class="pun">&gt;</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            addStaticTypeError</span><span class="pun">(</span><span class="str">"You can use only 2 calls on String in your source code"</span><span class="pun">,</span><span class="pln">expr</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The type checker works by inferring
argument types of a method call, then chooses a target method. If it
finds one that corresponds, then it triggers this event. It is for
example interesting if you want to react on a specific method call, such
as entering the scope of a method that takes a closure as argument (as
in builders).Please note that this event may be thrown for various types
of expressions, not only method calls (binary expressions for example).</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-methodNotFound" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>methodNotFound</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called by the type checker when it fails to
  find an appropriate method for a method call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ClassNode receiver, String name, ArgumentListExpression argList, ClassNode[] argTypes,MethodCall call</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">methodNotFound </span><span class="pun">{</span><span class="pln"> receiver</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> argList</span><span class="pun">,</span><span class="pln"> argTypes</span><span class="pun">,</span><span class="pln"> call </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="com">// receiver is the inferred type of the receiver</span><span class="pln">
    </span><span class="com">// name is the name of the called method</span><span class="pln">
    </span><span class="com">// argList is the list of arguments the method was called with</span><span class="pln">
    </span><span class="com">// argTypes is the array of inferred types for each argument</span><span class="pln">
    </span><span class="com">// call is the method call for which we couldn’t find a target method</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">receiver</span><span class="pun">==</span><span class="pln">classNodeFor</span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">&amp;&amp;</span><span class="pln"> name</span><span class="pun">==</span><span class="str">'longueur'</span><span class="pln">
            </span><span class="pun">&amp;&amp;</span><span class="pln"> argList</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()==</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        handled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> newMethod</span><span class="pun">(</span><span class="str">'longueur'</span><span class="pun">,</span><span class="pln"> classNodeFor</span><span class="pun">(</span><span class="typ">String</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Unlike <code>onMethodSelection</code>, this event is
sent when the type checker cannot find a target method for a method call
(instance or static). It gives you the chance to intercept the error
before it is sent to the user, but also set the target method.For this,
you need to return a list of <code>MethodNode</code>. In most situations, you would
either return: an empty list, meaning that you didn’t find a
corresponding method, a list with exactly one element, saying that there’s
no doubt about the target methodIf you return more than one MethodNode,
then the compiler would throw an error to the user stating that the
method call is ambiguous, listing the possible methods.For convenience,
if you want to return only one method, you are allowed to return it
directly instead of wrapping it into a list.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-beforeVisitMethod" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>beforeVisitMethod</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called by the type checker before type
  checking a method body</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>MethodNode node</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">beforeVisitMethod </span><span class="pun">{</span><span class="pln"> methodNode </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="com">// tell the type checker we will handle the body by ourselves</span><span class="pln">
    handled </span><span class="pun">=</span><span class="pln"> methodNode</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">startsWith</span><span class="pun">(</span><span class="str">'skip'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The type checker will call this method before
starting to type check a method body. If you want, for example, to
perform type checking by yourself instead of letting the type checker do
it, you have to set the handled flag to true.This event can also be used
to help defining the scope of your extension (for example, applying it
only if you are inside method foo).</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-afterVisitMethod" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>afterVisitMethod</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called by the type checker after type
  checking a method body</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>MethodNode node</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">afterVisitMethod </span><span class="pun">{</span><span class="pln"> methodNode </span><span class="pun">-&gt;</span><span class="pln">
    scopeExit </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">methods</span><span class="pun">&gt;</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            addStaticTypeError</span><span class="pun">(</span><span class="str">"Method ${methodNode.name} contains more than 2 method calls"</span><span class="pun">,</span><span class="pln"> methodNode</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives you the opportunity to perform additional
checks after a method body is visited by the type checker. This is
useful if you collect information, for example, and want to perform
additional checks once everything has been collected.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-beforeVisitClass" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>beforeVisitClass</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called by the type checker before type checking a class</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ClassNode node</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">beforeVisitClass </span><span class="pun">{</span><span class="pln"> </span><span class="typ">ClassNode</span><span class="pln"> classNode </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> classNode</span><span class="pun">.</span><span class="pln">nameWithoutPackage
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">name</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="str">'A'</span><span class="pun">..</span><span class="str">'Z'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        addStaticTypeError</span><span class="pun">(</span><span class="str">"Class '${name}' doesn't start with an uppercase letter"</span><span class="pun">,</span><span class="pln">classNode</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If a class is type checked, then
before visiting the class, this event will be sent. It is also the case
for inner classes defined inside a class annotated with <code>@TypeChecked</code>. It
can help you define the scope of your extension, or you can even totally
replace the visit of the type checker with a custom type checking
implementation. For that, you would have to set the <code>handled</code> flag to
<code>true</code>.&nbsp;</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-afterVisitClass" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>afterVisitClass</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called by the type checker after having finished the visit of a type checked class</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ClassNode node</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">afterVisitClass </span><span class="pun">{</span><span class="pln"> </span><span class="typ">ClassNode</span><span class="pln"> classNode </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> classNode</span><span class="pun">.</span><span class="pln">nameWithoutPackage
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">name</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="str">'A'</span><span class="pun">..</span><span class="str">'Z'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        addStaticTypeError</span><span class="pun">(</span><span class="str">"Class '${name}' doesn't start with an uppercase letter"</span><span class="pun">,</span><span class="pln">classNode</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Called
for every class being type checked after the type checker finished its
work. This includes classes annotated with <code>@TypeChecked</code> and any
inner/anonymous class defined in the same class with is not skipped.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-incompatibleAssignment" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>incompatibleAssignment</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called when the type checker thinks
    that an assignment is incorrect, meaning that the right hand side of an
    assignment is incompatible with the left hand side</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ClassNode lhsType, ClassNode rhsType,&nbsp; Expression assignment</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">incompatibleAssignment </span><span class="pun">{</span><span class="pln"> lhsType</span><span class="pun">,</span><span class="pln"> rhsType</span><span class="pun">,</span><span class="pln"> expr </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isBinaryExpression</span><span class="pun">(</span><span class="pln">expr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> isAssignment</span><span class="pun">(</span><span class="pln">expr</span><span class="pun">.</span><span class="pln">operation</span><span class="pun">.</span><span class="pln">type</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lhsType</span><span class="pun">==</span><span class="pln">classNodeFor</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> rhsType</span><span class="pun">==</span><span class="pln">classNodeFor</span><span class="pun">(</span><span class="typ">Closure</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            handled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives the
developer the ability to handle incorrect assignments. This is for
example useful if a class overrides <code>setProperty</code>, because in that case it
is possible that assigning a variable of one type to a property of
another type is handled through that runtime mechanism. In that case, you
can help the type checker just by telling it that the assignment is
valid (using <code>handled</code> set to <code>true</code>).</p>
</div></div></td>
</tr>
</tbody>
</table>
<table id="event-ambiguousMethods" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Event name</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>ambiguousMethods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Called When</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Called when the type checker cannot choose between several candidate methods</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Arguments</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>List&lt;MethodNode&gt; methods,&nbsp; Expression origin</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Usage</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">ambiguousMethods </span><span class="pun">{</span><span class="pln"> methods</span><span class="pun">,</span><span class="pln"> origin </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="com">// choose the method which has an Integer as parameter type</span><span class="pln">
    methods</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">parameters</span><span class="pun">.</span><span class="pln">any </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">type </span><span class="pun">==</span><span class="pln"> classNodeFor</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Gives the
developer the ability to handle incorrect assignments. This is for
example useful if a class overrides <code>setProperty</code>, because in that case it
is possible that assigning a variable of one type to a property of
another type is handled through that runtime mechanism. In that case, you
can help the type checker just by telling it that the assignment is
valid (using <code>handled</code> set to <code>true</code>).</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Of course, an extension script may consist of several blocks, and you
can have multiple blocks responding to the same event. This makes the
DSL look nicer and easier to write. However, reacting to events is far
from sufficient. If you know you can react to events, you also need to
deal with the errors, which implies several <em>helper</em> methods that will
make things easier.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="Typecheckingextensions-Workingwithextensions"><a class="anchor" href="#Typecheckingextensions-Workingwithextensions"></a>Working with extensions</h6>
<div class="sect6">
<h7 id="Typecheckingextensions-Supportclasses"><a class="anchor" href="#Typecheckingextensions-Supportclasses"></a>Support classes</h7>
<div class="paragraph">
<p>The DSL relies on a support class
called&nbsp;<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/stc/GroovyTypeCheckingExtensionSupport.html">org.codehaus.groovy.transform.stc.GroovyTypeCheckingExtensionSupport</a> .
This class itself
extends&nbsp;<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/stc/TypeCheckingExtension.html">org.codehaus.groovy.transform.stc.TypeCheckingExtension</a> . Those
two classes define a number of <em>helper</em> methods that will make working
with the AST easier, especially regarding type checking. One interesting
thing to know is that you&nbsp;<strong>have access to the type checker</strong>. This means
that you can programmatically call methods of the type checker,
including those that allow you to <strong>throw compilation errors</strong>.</p>
</div>
<div class="paragraph">
<p>The extension script delegates to
the&nbsp;<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/stc/GroovyTypeCheckingExtensionSupport.html">org.codehaus.groovy.transform.stc.GroovyTypeCheckingExtensionSupport</a> class, meaning that you have
direct access to the following variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>context</em>: the type checker context, of type&nbsp;<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/stc/TypeCheckingContext.html">org.codehaus.groovy.transform.stc.TypeCheckingContext</a></p>
</li>
<li>
<p><em>typeCheckingVisitor</em>: the type checker itself, a&nbsp;<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/stc/StaticTypeCheckingVisitor.html">org.codehaus.groovy.transform.stc.StaticTypeCheckingVisitor</a> instance</p>
</li>
<li>
<p><em>generatedMethods</em>: a list of "generated methods", which is in fact the list of "dummy" methods that you can create
inside a type checking extension using the&nbsp;<code>newMethod</code> calls</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The type checking context contains a lot of information that is useful
in context for the type checker. For example, the current stack of
enclosing method calls, binary expressions, closures, … This information
is in particular important if you have to know <em>where</em> you are when an
error occurs and that you want to handle it.</p>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Classnodes"><a class="anchor" href="#Typecheckingextensions-Classnodes"></a>Class nodes</h7>
<div class="paragraph">
<p>Handling class nodes is something that needs particular attention when
you work with a type checking extension. Compilation works with an
abstract syntax tree (AST) and the tree may not be complete when you are
type checking a class. This also means that when you refer to types, you
must not use class literals such as&nbsp;<code>String</code> or&nbsp;<code>HashSet</code>, but to class
nodes representing those types. This requires a certain level of
abstraction and understanding how Groovy deals with class nodes. To make
things easier, Groovy supplies several helper methods to deal with class
nodes. For example, if you want to say "the type for&nbsp;String", you can
write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> classNodeFor</span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ClassNode</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You would also note that there is a variant of&nbsp;<em>classNodeFor</em> that takes
a&nbsp;<code>String</code> as an argument, instead of a&nbsp;<code>Class</code>. In general, you
should&nbsp;<strong>not</strong> use that one, because it would create a class node for
which the name is <code>String</code>, but without any method, any property, …
defined on it. The first version returns a class node that is&nbsp;<em>resolved</em>
but the second one returns one that is&nbsp;<em>not</em>. So the latter should be
reserved for very special cases.</p>
</div>
<div class="paragraph">
<p>The second problem that you might encounter is referencing a type which
is not yet compiled. This may happen more often than you think. For
example, when you compile a set of files together. In that case, if you
want to say "that variable is of type Foo" but <code>Foo</code> is not yet
compiled, you can still refer to the <code>Foo</code> class node
using&nbsp;<code>lookupClassNodeFor</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> lookupClassNodeFor</span><span class="pun">(</span><span class="str">'Foo'</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ClassNode</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Helpingthetypechecker"><a class="anchor" href="#Typecheckingextensions-Helpingthetypechecker"></a>Helping the type checker</h7>
<div class="paragraph">
<p>Say that you know that variable&nbsp;<code>foo</code> is of type&nbsp;<code>Foo</code> and you want to
tell the type checker about it. Then you can use the&nbsp;<code>storeType</code> method,
which takes two arguments: the first one is the node for which you want
to store the type and the second one is the type of the node. If you
look at the implementation of&nbsp;<code>storeType</code>, you would see that it
delegates to the type checker equivalent method, which itself does a lot
of work to store node metadata. You would also see that storing the type
is not limited to variables: you can set the type of any expression.</p>
</div>
<div class="paragraph">
<p>Likewise, getting the type of an AST node is just a matter of
calling&nbsp;<code>getType</code> on that node. This would in general be what you want,
but there’s something that you must understand:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getType</code> returns the&nbsp;<strong>inferred type</strong> of an expression. This means
that it will not return, for a variable declared of type&nbsp;<code>Object</code> the
class node for&nbsp;<code>Object</code>, but the inferred type of this variable&nbsp;<strong>at this
point of the code</strong> (flow typing)</p>
</li>
<li>
<p>if you want to access the origin type of a variable (or
field/parameter), then you must call the appropriate method on the AST
node</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Throwinganerror"><a class="anchor" href="#Typecheckingextensions-Throwinganerror"></a>Throwing an error</h7>
<div class="paragraph">
<p>To throw a type checking error, you only have to call the
<code>addStaticTypeError</code> method which takes two arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a&nbsp;<em>message</em> which is a string that will be displayed to the end user</p>
</li>
<li>
<p>an <em>AST node</em> responsible for the error. It’s better to provide the best
suiting AST node because it will be used to retrieve the line and column
numbers</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-isXXXExpression"><a class="anchor" href="#Typecheckingextensions-isXXXExpression"></a>isXXXExpression</h7>
<div class="paragraph">
<p>It is often required to know the type of an AST node. For readability,
the DSL provides a special isXXXExpression method that will delegate to
<code>x instance of XXXExpression</code>. For example, instead of writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">node </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">BinaryExpression</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which requires you to import the <code>BinaryExpression</code> class, you can just
write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isBinaryExpression</span><span class="pun">(</span><span class="pln">node</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Virtualmethods"><a class="anchor" href="#Typecheckingextensions-Virtualmethods"></a>Virtual methods</h7>
<div class="paragraph">
<p>When you perform type checking of dynamic code, you may often face the
case when you know that a method call is valid but there is no "real"
method behind it. As an example, take the Grails dynamic finders. You
can have a method call consisting of a method named&nbsp;<em>findByName(…)</em>. As
there’s no&nbsp;<em>findByName</em> method defined in the bean, the type checker
would complain. Yet, you would know that this method wouldn’t fail at
runtime, and you can even tell what is the return type of this method.
For this case, the DSL supports two special constructs that consist of
<em>phantom methods</em>. This means that you will return a method node that
doesn’t really exist but is defined in the context of type checking.
Three methods exist:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>newMethod(String name, Class returnType)</code></p>
</li>
<li>
<p><code>newMethod(String name, ClassNode returnType)</code></p>
</li>
<li>
<p><code>newMethod(String name, Callable&lt;ClassNode&gt; return Type)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All three variants do the same: they create a new method node which name
is the supplied name and define the return type of this method.
Moreover, the type checker would add those methods in
the&nbsp;<code>generatedMethods</code> list (see&nbsp;<code>isGenerated</code> below). The reason why we
only set a name and a return type is that it is only what you need in
90% of the cases. For example, in the&nbsp;<code>findByName</code> example upper, the
only thing you need to know is that&nbsp;<code>findByName</code> wouldn’t fail at
runtime, and that it returns a domain class. The&nbsp;<code>Callable</code> version of
return type is interesting because it defers the computation of the
return type when the type checker actually needs it. This is interesting
because in some circumstances, you may not know the actual return type
when the type checker demands it, so you can use a closure that will be
called each time&nbsp;<code>getReturnType</code> is called by the type checker on this
method node. If you combine this with deferred checks, you can achieve
pretty complex type checking including handling of forward references.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">newMethod</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// each time getReturnType on this method node will be called, this closure will be called!</span><span class="pln">
    println </span><span class="str">'Type checker called me!'</span><span class="pln">
    lookupClassNodeFor</span><span class="pun">(</span><span class="typ">Foo</span><span class="pun">)</span><span class="pln"> </span><span class="com">// return type</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Should you need more than the name and return type, you can always
create a new&nbsp;<code>MethodNode</code> by yourself.</p>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Scoping"><a class="anchor" href="#Typecheckingextensions-Scoping"></a>Scoping</h7>
<div class="paragraph">
<p>Scoping is very important in DSL type checking and is one of the reasons
why we couldn’t use a&nbsp;<em>pointcut</em> based approach to DSL type checking.
Basically, you must be able to define very precisely when your extension
applies and when it does not. Moreover, you must be able to handle
situations that a regular type checker would not be able to handle, such
as forward references:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">point a</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
line a</span><span class="pun">,</span><span class="pln">b </span><span class="com">// b is referenced afterwards!</span><span class="pln">
point b</span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="lit">2</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Say for example that you want to handle a builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">builder</span><span class="pun">.</span><span class="pln">foo </span><span class="pun">{</span><span class="pln">
   bar
   baz</span><span class="pun">(</span><span class="pln">bar</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Your extension, then, should only be active once you’ve entered
the&nbsp;<code>foo</code> method, and inactive outside of this scope. But you could have
complex situations like multiple builders in the same file or embedded
builders (builders in builders). While you should not try to fix all
this from start (you must accept limitations to type checking), the type
checker does offer a nice mechanism to handle this: a scoping stack,
using the&nbsp;<code>newScope</code> and&nbsp;<code>scopeExit</code> methods.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>newScope</code> creates a new scope and puts it on top of the stack</p>
</li>
<li>
<p><code>scopeExits</code> pops a scope from the stack</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A scope consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a parent scope</p>
</li>
<li>
<p>a map of custom data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to look at the implementation, it’s simply a <code>LinkedHashMap</code>
(<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/stc/GroovyTypeCheckingExtensionSupport/TypeCheckingScope.html">org.codehaus.groovy.transform.stc.GroovyTypeCheckingExtensionSupport.TypeCheckingScope</a>),
but it’s quite powerful. For example, you can use such a scope to store
a list of closures to be executed when you exit the scope. This is how
you would handle forward references:&nbsp;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> scope </span><span class="pun">=</span><span class="pln"> newScope</span><span class="pun">()</span><span class="pln">
scope</span><span class="pun">.</span><span class="pln">secondPassChecks </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="com">//...</span><span class="pln">
scope</span><span class="pun">.</span><span class="pln">secondPassChecks </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'executed later'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="com">// ...</span><span class="pln">
scopeExit </span><span class="pun">{</span><span class="pln">
    secondPassChecks</span><span class="pun">*.</span><span class="pln">run</span><span class="pun">()</span><span class="pln"> </span><span class="com">// execute deferred checks</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is to say, that if at some point you are not able to determine the
type of an expression, or that you are not able to check at this point
that an assignment is valid or not, you can still make the check later…
This is a very powerful feature. Now,&nbsp;<code>newScope</code> and&nbsp;<code>scopeExit</code>
provide some interesting syntactic sugar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">newScope </span><span class="pun">{</span><span class="pln">
    secondPassChecks </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>At anytime in the DSL, you can access the current scope
using&nbsp;<code>getCurrentScope()</code> or more simply&nbsp;<code>currentScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">//...</span><span class="pln">
currentScope</span><span class="pun">.</span><span class="pln">secondPassChecks </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'executed later'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="com">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The general schema would then be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>determine a <em>pointcut</em> where you push a new scope on stack and
initialize custom variables within this scope</p>
</li>
<li>
<p>using the various events, you can use the information stored in your
custom scope to perform checks, defer checks,…</p>
</li>
<li>
<p>determine a <em>pointcut</em> where you exit the scope, call&nbsp;<code>scopeExit</code>
and eventually perform additional checks</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="Typecheckingextensions-Otherusefulmethods"><a class="anchor" href="#Typecheckingextensions-Otherusefulmethods"></a>Other useful methods</h7>
<div class="paragraph">
<p>For the complete list of helper methods, please refer to
the&nbsp;<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/stc/GroovyTypeCheckingExtensionSupport.html">org.codehaus.groovy.transform.stc.GroovyTypeCheckingExtensionSupport</a> and&nbsp;
<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/stc/TypeCheckingExtension.html">org.codehaus.groovy.transform.stc.TypeCheckingExtension</a> classes.&nbsp;However,
take special attention to those methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isDynamic</code>: takes a VariableExpression as argument and returns true
if the variable is a DynamicExpression, which means, in a script, that
it wasn’t defined using a type or <code>def</code>.</p>
</li>
<li>
<p><code>isGenerated</code>: takes a MethodNode as an argument and tells if the
method is one that was generated by the type checker extension using
the&nbsp;<code>newMethod</code> method</p>
</li>
<li>
<p><code>isAnnotatedBy</code>: takes an AST node and a Class (or ClassNode), and
tells if the node is annotated with this class. For example:
<code>isAnnotatedBy(node, NotNull)</code></p>
</li>
<li>
<p><code>getTargetMethod</code>: takes a method call as argument and returns
the&nbsp;<code>MethodNode</code> that the type checker has determined for it</p>
</li>
<li>
<p><code>delegatesTo</code>: emulates the behaviour of the&nbsp;<code>@DelegatesTo</code>
annotation. It allows you to tell that the argument will delegate to a
specific type (you can also specify the delegation strategy)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_type_checking_extensions"><a class="anchor" href="#_advanced_type_checking_extensions"></a>Advanced type checking extensions</h5>
<div class="sect5">
<h6 id="_precompiled_type_checking_extensions"><a class="anchor" href="#_precompiled_type_checking_extensions"></a>Precompiled type checking extensions</h6>
<div class="paragraph">
<p>All the examples above use type checking scripts. They are found in source form in classpath, meaning that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a Groovy source file, corresponding to the type checking extension, is available on compilation classpath</p>
</li>
<li>
<p>this file is compiled by the Groovy compiler for each source unit being compiled (often, a source unit corresponds
to a single file)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is a very convenient way to develop type checking extensions, however it implies a slower compilation phase, because
of the compilation of the extension itself for each file being compiled. For those reasons, it can be practical to rely
on a precompiled extension. You have two options to do this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>write the extension in Groovy, compile it, then use a reference to the extension class instead of the source</p>
</li>
<li>
<p>write the extension in Java, compile it, then use a reference to the extension class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Writing a type checking extension in Groovy is the easiest path. Basically, the idea is that the type checking extension
script becomes the body of the main method of a type checking extension class, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">GroovyTypeCheckingExtensionSupport</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PrecompiledExtension</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">GroovyTypeCheckingExtensionSupport</span><span class="pun">.</span><span class="typ">TypeCheckingDSL</span><span class="pln"> </span><span class="pun">{</span><span class="pln">     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="typ">Object</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                                                          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        unresolvedVariable </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">var</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="str">'robot'</span><span class="pun">==</span><span class="kwd">var</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                storeType</span><span class="pun">(</span><span class="kwd">var</span><span class="pun">,</span><span class="pln"> classNodeFor</span><span class="pun">(</span><span class="typ">Robot</span><span class="pun">))</span><span class="pln">                                         </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
                handled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>extending the <code>TypeCheckingDSL</code> class is the easiest</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then the extension code needs to go inside the <code>run</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and you can use the very same events as an extension written in source form</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Setting up the extension is very similar to using a source form extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">TypeChecked</span><span class="pun">,</span><span class="pln">
        extensions</span><span class="pun">:[</span><span class="str">'typing.PrecompiledExtension'</span><span class="pun">])</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The difference is that instead of using a path in classpath, you just specify the fully qualified class name of the
precompiled extension.</p>
</div>
<div class="paragraph">
<p>In case you really want to write an extension in Java, then you will not benefit from the type checking extension DSL.
The extension above can be rewritten in Java this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">ast</span><span class="pun">.</span><span class="typ">ClassHelper</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">ast</span><span class="pun">.</span><span class="pln">expr</span><span class="pun">.</span><span class="typ">VariableExpression</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">AbstractTypeCheckingExtension</span><span class="pun">;</span><span class="pln">


</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">stc</span><span class="pun">.</span><span class="typ">StaticTypeCheckingVisitor</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PrecompiledJavaExtension</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AbstractTypeCheckingExtension</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">PrecompiledJavaExtension</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">StaticTypeCheckingVisitor</span><span class="pln"> typeCheckingVisitor</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">typeCheckingVisitor</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> handleUnresolvedVariableExpression</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">VariableExpression</span><span class="pln"> vexp</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="str">"robot"</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">vexp</span><span class="pun">.</span><span class="pln">getName</span><span class="pun">()))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            storeType</span><span class="pun">(</span><span class="pln">vexp</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ClassHelper</span><span class="pun">.</span><span class="pln">make</span><span class="pun">(</span><span class="typ">Robot</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">));</span><span class="pln">
            setHandled</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>extend the <code>AbstractTypeCheckingExtension</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then override the <code>handleXXX</code> methods as required</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_using_grab_in_a_type_checking_extension"><a class="anchor" href="#_using_grab_in_a_type_checking_extension"></a>Using @Grab in a type checking extension</h6>
<div class="paragraph">
<p>It is totally possible to use the <code>@Grab</code> annotation in a type checking extension.
This means you can include libraries that would only be
available at compile time. In that case, you must understand that you
would increase the time of compilation significantly (at least, the
first time it grabs the dependencies).</p>
</div>
</div>
<div class="sect5">
<h6 id="_sharing_or_packaging_type_checking_extensions"><a class="anchor" href="#_sharing_or_packaging_type_checking_extensions"></a>Sharing or packaging type checking extensions</h6>
<div class="paragraph">
<p>A type checking extension is just a script that need to be on classpath. As such,
you can share it as is, or bundle it in a jar file that would be added to classpath.</p>
</div>
</div>
<div class="sect5">
<h6 id="_global_type_checking_extensions"><a class="anchor" href="#_global_type_checking_extensions"></a>Global type checking extensions</h6>
<div class="paragraph">
<p>While you can configure the compiler to transparently add type checking extensions to your
script, there is currently no way to apply an extension transparently just by having it on
classpath.</p>
</div>
</div>
<div class="sect5">
<h6 id="_type_checking_extensions_and_compilestatic"><a class="anchor" href="#_type_checking_extensions_and_compilestatic"></a>Type checking extensions and @CompileStatic</h6>
<div class="paragraph">
<p>Type checking extensions are used with <code>@TypeChecked</code> but can also be used with <code>@CompileStatic</code>. However, you must
be aware that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a type checking extension used with <code>@CompileStatic</code> will in general not be sufficient to let the compiler know how
to generate statically compilable code from "unsafe" code</p>
</li>
<li>
<p>it is possible to use a type checking extension with <code>@CompileStatic</code> just to enhance type checking, that is to say
introduce <strong>more</strong> compilation errors, without actually dealing with dynamic code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s explain the first point, which is that even if you use an extension, the compiler will not know how to compile
your code statically: technically, even if you tell the type checker what is the type of a dynamic
variable, for example, it would not know how to compile it. Is it <code>getBinding('foo')</code>, <code>getProperty('foo')</code>,
<code>delegate.getFoo()</code>,…? There’s absolutely no direct way to tell the static compiler how to compile such
code even if you use a type checking extension (that would, again, only give hints about the type).</p>
</div>
<div class="paragraph">
<p>One possible solution for this particular example is to instruct the compiler to use <a href="#mixed-mode">mixed mode compilation</a>.
The more advanced one is to use <a href="#ast-xform-as-extension">AST transformations during type checking</a> but it is far more
complex.</p>
</div>
<div class="paragraph">
<p>Type checking extensions allow you to help the type checker where it
fails, but it also allow you to fail where it doesn’t. In that context,
it makes sense to support extensions for&nbsp;<code>@CompileStatic</code> too. Imagine
an extension that is capable of type checking SQL queries. In that case,
the extension would be valid in both dynamic and static context, because
without the extension, the code would still pass.</p>
</div>
</div>
<div class="sect5">
<h6 id="mixed-mode"><a class="anchor" href="#mixed-mode"></a>Mixed mode compilation</h6>
<div class="paragraph">
<p>In the previous section, we highlighted the fact that you can activate type checking extensions with
<code>@CompileStatic</code>. In that context, the type checker would not complain anymore about some unresolved variables or
unknown method calls, but it would still wouldn’t know how to compile them statically.</p>
</div>
<div class="paragraph">
<p>Mixed mode compilation offers a third way, which is to instruct the compiler that whenever an unresolved variable
or method call is found, then it should fall back to a dynamic mode. This is possible thanks to type checking extensions
and a special <code>makeDynamic</code> call.</p>
</div>
<div class="paragraph">
<p>To illustrate this, let’s come back to the <code>Robot</code> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">robot</span><span class="pun">.</span><span class="pln">move </span><span class="lit">100</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And let’s try to activate our type checking extension using <code>@CompileStatic</code> instead of <code>@TypeChecked</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">CompileStatic</span><span class="pun">,</span><span class="pln">                                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        extensions</span><span class="pun">:[</span><span class="str">'robotextension.groovy'</span><span class="pun">])</span><span class="pln">               </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">config</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> robot </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Robot</span><span class="pun">()</span><span class="pln">
shell</span><span class="pun">.</span><span class="pln">setVariable</span><span class="pun">(</span><span class="str">'robot'</span><span class="pun">,</span><span class="pln"> robot</span><span class="pun">)</span><span class="pln">
shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="pln">script</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Apply <code>@CompileStatic</code> transparently</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Activate the type checking extension</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The script will run fine because the static compiler is told about the type of the <code>robot</code> variable, so it is capable
of making a direct call to <code>move</code>. But before that, how did the compiler know how to get the <code>robot</code> variable? In fact
by default, in a type checking extension, setting <code>handled=true</code> on an unresolved variable will automatically trigger
a dynamic resolution, so in this case you don’t have anything special to make the compiler use a mixed mode. However,
let’s slightly update our example, starting from the robot script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">move </span><span class="lit">100</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here you can notice that there is no reference to <code>robot</code> anymore. Our extension will not help then because we will not
be able to instruct the compiler that <code>move</code> is done on a <code>Robot</code> instance. This example of code can be executed in a
totally dynamic way thanks to the help of a <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/util/DelegatingScript.html">groovy.util.DelegatingScript</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">scriptBaseClass </span><span class="pun">=</span><span class="pln"> </span><span class="str">'groovy.util.DelegatingScript'</span><span class="pln">     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">config</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> runner </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">script</span><span class="pun">)</span><span class="pln">                            </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
runner</span><span class="pun">.</span><span class="pln">setDelegate</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Robot</span><span class="pun">())</span><span class="pln">                             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
runner</span><span class="pun">.</span><span class="pln">run</span><span class="pun">()</span><span class="pln">                                                </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we configure the compiler to use a <code>DelegatingScript</code> as the base class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the script source needs to be parsed and will return an instance of <code>DelegatingScript</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we can then call <code>setDelegate</code> to use a <code>Robot</code> as the delegate of the script</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then execute the script. <code>move</code> will be directly executed on the delegate</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If we want this to pass with <code>@CompileStatic</code>, we have to use a type checking extension, so let’s update our configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">CompileStatic</span><span class="pun">,</span><span class="pln">                                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        extensions</span><span class="pun">:[</span><span class="str">'robotextension2.groovy'</span><span class="pun">])</span><span class="pln">              </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>apply <code>@CompileStatic</code> transparently</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>use an alternate type checking extension meant to recognize the call to <code>move</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Then in the previous section we have learnt how to deal with unrecognized method calls, so we are able to write this
extension:</p>
</div>
<div class="listingblock">
<div class="title">robotextension2.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">methodNotFound </span><span class="pun">{</span><span class="pln"> receiver</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> argList</span><span class="pun">,</span><span class="pln"> argTypes</span><span class="pun">,</span><span class="pln"> call </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isMethodCallExpression</span><span class="pun">(</span><span class="pln">call</span><span class="pun">)</span><span class="pln">                        </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">&amp;&amp;</span><span class="pln"> call</span><span class="pun">.</span><span class="pln">implicitThis                                </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="str">'move'</span><span class="pun">==</span><span class="pln">name                                     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">&amp;&amp;</span><span class="pln"> argTypes</span><span class="pun">.</span><span class="pln">length</span><span class="pun">==</span><span class="lit">1</span><span class="pln">                               </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">&amp;&amp;</span><span class="pln"> argTypes</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> classNodeFor</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">                 </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        handled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">                                      </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
        newMethod</span><span class="pun">(</span><span class="str">'move'</span><span class="pun">,</span><span class="pln"> classNodeFor</span><span class="pun">(</span><span class="typ">Robot</span><span class="pun">))</span><span class="pln">              </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if the call is a method call (not a static method call)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>that this call is made on "implicit this" (no explicit <code>this.</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>that the method being called is <code>move</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and that the call is done with a single argument</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>and that argument is of type <code>int</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>then tell the type checker that the call is valid</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>and that the return type of the call is <code>Robot</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you try to execute this code, then you could be surprised that it actually fails at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.NoSuchMethodError: java.lang.Object.move()Ltyping/Robot;</pre>
</div>
</div>
<div class="paragraph">
<p>The reason is very simple: while the type checking extension is sufficient for <code>@TypeChecked</code>, which does not involve
static compilation, it is not enough for <code>@CompileStatic</code> which requires additional information. In this case, you told
the compiler that the method existed, but you didn’t explain to it <strong>what</strong> method it is in reality, and what is the
receiver of the message (the delegate).</p>
</div>
<div class="paragraph">
<p>Fixing this is very easy and just implies replacing the <code>newMethod</code> call with something else:</p>
</div>
<div class="listingblock">
<div class="title">robotextension3.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">methodNotFound </span><span class="pun">{</span><span class="pln"> receiver</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> argList</span><span class="pun">,</span><span class="pln"> argTypes</span><span class="pun">,</span><span class="pln"> call </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">isMethodCallExpression</span><span class="pun">(</span><span class="pln">call</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">&amp;&amp;</span><span class="pln"> call</span><span class="pun">.</span><span class="pln">implicitThis
        </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="str">'move'</span><span class="pun">==</span><span class="pln">name
        </span><span class="pun">&amp;&amp;</span><span class="pln"> argTypes</span><span class="pun">.</span><span class="pln">length</span><span class="pun">==</span><span class="lit">1</span><span class="pln">
        </span><span class="pun">&amp;&amp;</span><span class="pln"> argTypes</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> classNodeFor</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        makeDynamic</span><span class="pun">(</span><span class="pln">call</span><span class="pun">,</span><span class="pln"> classNodeFor</span><span class="pun">(</span><span class="typ">Robot</span><span class="pun">))</span><span class="pln">              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>tell the compiler that the call should be make dynamic</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>makeDynamic</code> call does 3 things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it returns a virtual method just like <code>newMethod</code></p>
</li>
<li>
<p>automatically sets the <code>handled</code> flag to <code>true</code> for you</p>
</li>
<li>
<p>but also marks the <code>call</code> to be done dynamically</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So when the compiler will have to generate bytecode for the call to <code>move</code>, since it is now marked as a dynamic call,
it will fallback to the dynamic compiler and let it handle the call. And since the extension tells us that the return
type of the dynamic call is a <code>Robot</code>, subsequent calls will be done statically!</p>
</div>
<div class="paragraph">
<p>Some would wonder why the static compiler doesn’t do this by default without an extension. It is a design decision:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the code is statically compiled, we normally want type safety and best performance</p>
</li>
<li>
<p>so if unrecognized variables/method calls are made dynamic, you loose type safety, but also all support for typos at
compile time!</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In short, if you want to have mixed mode compilation, it <strong>has</strong> to be explicit, through a type checking extension, so
that the compiler, and the designer of the DSL, are totally aware of what they are doing.</p>
</div>
<div class="paragraph">
<p><code>makeDynamic</code> can be used on 3 kind of AST nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a method node (<code>MethodNode</code>)</p>
</li>
<li>
<p>a variable (<code>VariableExpression</code>)</p>
</li>
<li>
<p>a property expression (<code>PropertyExpression</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If that is not enough, then it means that static compilation cannot be done directly and that you have to rely on AST
transformations.</p>
</div>
</div>
<div class="sect5">
<h6 id="ast-xform-as-extension"><a class="anchor" href="#ast-xform-as-extension"></a>Transforming the AST in an extension</h6>
<div class="paragraph">
<p>Type checking extensions look very attractive from an AST transformation design point of view: extensions have access
to context like inferred types, which is often nice to have. And an extension has a direct access to the abstract
syntax tree. Since you have access to the AST, there is nothing in theory that prevents
you from modifying the AST. However, we do not recommend you to do so, unless you are an advanced AST transformation
designer and well aware of the compiler internals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First of all, you would explicitly break the contract of type checking, which is to annotate,
and only annotate the AST. Type checking should&nbsp;<strong>not</strong> modify the AST tree because you wouldn’t be able to
guarantee anymore that code without the&nbsp;<em>@TypeChecked</em> annotation
behaves the same without the annotation.</p>
</li>
<li>
<p>If your extension is meant to work with&nbsp;<em>@CompileStatic</em>, then you&nbsp;<strong>can</strong> modify the AST because
this is indeed what&nbsp;<em>@CompileStatic</em> will eventually do. Static compilation doesn’t guarantee the same semantics at
dynamic Groovy so there is effectively a difference between code compiled with&nbsp;<em>@CompileStatic</em> and code compiled
with&nbsp;<em>@TypeChecked</em>. It’s up to you to choose whatever strategy you want to update the AST, but probably
using an AST transformation that runs before type checking is easier.</p>
</li>
<li>
<p>if you cannot rely on a transformation that kicks in before the type checker, then you must be <strong>very</strong> careful</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The type checking phase is the last phase running in the compiler before bytecode generation. All other AST
transformations run before that and the compiler does a very good job at "fixing" incorrect AST generated before the
type checking phase. As soon as you perform a transformation during type checking, for example directly in a type
checking extension, then you have to do all this work of generating a 100% compiler compliant abstract syntax tree by
yourself, which can easily become complex. That’s why we do not recommend to go that way if you are beginning with
type checking extensions and AST transformations.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_examples"><a class="anchor" href="#_examples"></a>Examples</h6>
<div class="paragraph">
<p>Examples of real life type checking extensions are easy to find. You can download the source code for Groovy and
take a look at the
<a href="https://github.com/apache/groovy/blob/master/src/test/groovy/transform/stc/TypeCheckingExtensionsTest.groovy">TypeCheckingExtensionsTest</a>
class which is linked to
<a href="https://github.com/apache/groovy/tree/master/src/test-resources/groovy/transform/stc">various extension scripts</a>.</p>
</div>
<div class="paragraph">
<p>An example of a complex type checking extension can be found in the <a href="http://docs.groovy-lang.org/latest/html/documentation/markup-template-engine.html">Markup Template Engine</a>
source code: this template engine relies on a type checking extension and AST transformations to transform templates into
fully statically compiled code. Sources for this can be found
<a href="https://github.com/apache/groovy/tree/master/subprojects/groovy-templates/src/main/groovy/groovy/text/markup">here</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tools"><a class="anchor" href="#_tools"></a>2. Tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_running_groovy_from_the_commandline"><a class="anchor" href="#_running_groovy_from_the_commandline"></a>2.1. Running Groovy from the commandline</h3>
<div class="sect3">
<h4 id="section-groovy-commandline"><a class="anchor" href="#section-groovy-commandline"></a>2.1.1. groovy, the Groovy command</h4>
<div class="paragraph">
<p><code>groovy</code> invokes the Groovy command line processor. It 
allows you to run inline Groovy expressions, and scripts, tests or 
application within groovy files.
It plays a similar role to <code>java</code> in the Java world but handles inline scripts and rather than invoking class files, it is normally called with scripts
and will automatically call the Groovy compiler as needed.</p>
</div>
<div class="paragraph">
<p>The easiest way to run a Groovy script, test or application is to run the following command at your shell prompt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&gt; groovy MyScript.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>.groovy</code> part is optional. The <code>groovy</code> command supports a number of command line switches:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short version</th>
<th class="tableblock halign-left valign-top">Long version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-v</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">display the Groovy and JVM versions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy -v</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--autosplit &lt;splitPattern&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">split lines using splitPattern (default '\s') using implicit 'split' variable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--basescript &lt;class&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base class name for scripts (must derive from Script)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--encoding &lt;charset&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specify the encoding of the files</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-cp &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-classpath &lt;path&gt;<br>
--classpath &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the compilation classpath. Must be the first argument.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy -cp lib/dep.jar MyScript</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--configscript &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced compiler configuration script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy --configscript config/config.groovy src/Person.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--define &lt;name=value&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">define a system property</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug mode will print out full stack traces</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--disableopt &lt;optlist&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disables one or all optimization elements.<br>
optlist can be a comma separated list with the elements:<br>
all (disables all optimizations),<br>
int (disable any int based optimizations)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-e &lt;script&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specify an inline command line script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy -e "println new Date()"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-h</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays usage information for the command line groovy command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy --help</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-i &lt;extension&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">modify files in place; create backup if extension is given (e.g. '.bak')</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--indy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables invokedynamic support. Requires Java 7+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovy --indy Person.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-l &lt;port&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">listen on a port and process inbound lines (default: 1960)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-n</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">process files line by line using implicit 'line' variable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-p</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">process files line by line and print result (see also -n)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_compiling_groovy"><a class="anchor" href="#_compiling_groovy"></a>2.2. Compiling Groovy</h3>
<div class="sect3">
<h4 id="section-groovyc-compiler"><a class="anchor" href="#section-groovyc-compiler"></a>2.2.1. groovyc, the Groovy compiler</h4>
<div class="paragraph">
<p><code>groovyc</code> is the Groovy compiler command line tool. It allows you to compile Groovy sources into bytecode. It plays
the same role as <code>javac</code> in the Java world. The easiest way to compile a Groovy script or class is to run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovyc MyClass.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>This will produce a <code>MyClass.class</code> file (as well as other .class files depending on the contents of the source). <code>groovyc</code> supports
a number of command line switches:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short version</th>
<th class="tableblock halign-left valign-top">Long version</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@argfile</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read options and source files from specified file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc @conf/args</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-cp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-classpath, --classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the compilation classpath. Must be the first argument.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -cp lib/dep.jar MyClass.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--sourcepath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory where to find source files. Not used anymore. Specifying this parameter will have no effect.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--temp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Temporary directory for the compiler</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encoding of the source files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc --encoding utf-8 script.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help for the command line groovyc tool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc --help</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-d</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify where to place generated class files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -d target Person.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-v</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the compiler version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -v</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--exception</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the stack trace in case of compilation error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -e script.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-j</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--jointCompilation*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables joint compilation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -j A.groovy B.java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--basescript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base class name for scripts (must derive from Script)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-indy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--indy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables invokedynamic support. Requires Java 7+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc --indy Person.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--configscript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced compiler configuration script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc --configscript config/config.groovy src/Person.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Jproperty=value</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties to be passed to <code>javac</code> if joint compilation is enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -j -Jtarget=1.6 -Jsource=1.6 A.groovy B.java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Fflag</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flags to be passed to <code>javac</code> if joint compilation is enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">groovyc -j -Fnowarn A.groovy B.java</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong>
* for a full description of joint compilation, see <a href="#section-jointcompilation">the joint compilation section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ant_task"><a class="anchor" href="#_ant_task"></a>2.2.2. Ant task</h4>
<div class="sect4">
<h5 id="ThegroovycAntTask-groovyc"><a class="anchor" href="#ThegroovycAntTask-groovyc"></a><code>&lt;groovyc&gt;</code></h5>
<div class="sect5">
<h6 id="ThegroovycAntTask-Description"><a class="anchor" href="#ThegroovycAntTask-Description"></a>Description</h6>
<div class="paragraph">
<p>Compiles Groovy source files and, if joint compilation option is used, Java source files.</p>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovycAntTask-Requiredtaskdef"><a class="anchor" href="#ThegroovycAntTask-Requiredtaskdef"></a>Required taskdef</h6>
<div class="paragraph">
<p>Assuming <code>groovy-all-VERSION.jar</code> is in <em>my.classpath</em> you will need to
declare this task at some point in the <code>build.xml</code> prior to the <code>groovyc</code>
task being invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;taskdef</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"groovyc"</span><span class="pln">
         </span><span class="atn">classname</span><span class="pun">=</span><span class="atv">"org.codehaus.groovy.ant.Groovyc"</span><span class="pln">
         </span><span class="atn">classpathref</span><span class="pun">=</span><span class="atv">"my.classpath"</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovycAntTask-groovycAttributes"><a class="anchor" href="#ThegroovycAntTask-groovycAttributes"></a>&lt;groovyc&gt; Attributes</h6>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configscript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the configuration file used to customize the compilation configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">srcdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the Groovy (and possibly Java) source files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location to store the class files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpathref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use given as a path references.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourcepath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sourcepath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourcepathref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sourcepath to use given as a path reference.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Encoding of source files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">verbose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Asks the compiler for verbose output; defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeAntRuntime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the Ant run-time libraries in the
classpath; defaults to yes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeJavaRuntime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include the default run-time libraries
from the executing VM in the classpath; defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fork</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to execute groovyc using a spawned instance of the JVM;
defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memoryInitialSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The initial size of the memory for the underlying
VM, if using fork mode; ignored otherwise. Defaults to the standard VM
memory setting. (Examples: 83886080, 81920k, or 80m)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">memoryMaximumSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum size of the memory for the underlying
VM, if using fork mode; ignored otherwise. Defaults to the standard VM
memory setting. (Examples: 83886080, 81920k, or 80m)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">failonerror</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether compilation errors will fail the build;
defaults to true.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">listfiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the source files to be compiled will be
listed; defaults to no.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stacktrace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if true each compile error message will contain a
stacktrace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">indy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable compilation with the ``invoke dynamic'' support when using
Groovy 2.0 and beyond and running on JDK 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptBaseClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the base class for Groovy scripts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stubdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the stub directory into which the Java source stub files should be generated.
The directory need not exist and will not be deleted automatically - though its contents
will be cleared unless 'keepStubs' is true. Ignored when forked.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keepStubs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the keepStubs flag. Defaults to false. Set to true for debugging.
Ignored when forked.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forceLookupUnnamedFiles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Groovyc Ant task is frequently used in the context of a build system
that knows the complete list of source files to be compiled. In such a
context, it is wasteful for the Groovy compiler to go searching the
classpath when looking for source files and hence by default the
Groovyc Ant task calls the compiler in a special mode with such searching
turned off. If you wish the compiler to search for source files then
you need to set this flag to true. Defaults to false.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;groovyc</span><span class="pln"> </span><span class="atn">srcdir</span><span class="pun">=</span><span class="atv">"src"</span><span class="pln"> </span><span class="atn">destdir</span><span class="pun">=</span><span class="atv">"target/classes"</span><span class="tag">&gt;</span><span class="pln">
</span><span class="tag">&lt;/groovyc&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovycAntTask-groovycNestedElements"><a class="anchor" href="#ThegroovycAntTask-groovycNestedElements"></a>&lt;groovyc&gt; Nested Elements</h6>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">element</th>
<th class="tableblock halign-left valign-top">kind</th>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Replaces Attribute</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">javac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javac task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jointCompilationOptions</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a path structure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes (unless srcdir is used)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">srcdir</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a path structure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>For path structures see for example
<a href="http://ant.apache.org/manual/using.html#path" class="bare">http://ant.apache.org/manual/using.html#path</a></p>
</li>
<li>
<p>For usages of the javac task see
<a href="https://ant.apache.org/manual/Tasks/javac.html" class="bare">https://ant.apache.org/manual/Tasks/javac.html</a></p>
</li>
<li>
<p>The nested javac task behaves more or less as documented for the
top-level <code>javac</code> task. <code>srcdir</code>, <code>destdir</code>, <code>classpath</code>, <code>encoding</code> for the
nested <code>javac</code> task are taken from the enclosing <code>groovyc</code> task. If these
attributes are specified then they are added, they do not replace. In
fact, you should not attempt to overwrite the destination. Other
attributes and nested elements are unaffected, for example <code>fork</code>,
<code>memoryMaximumSize</code>, etc. may be used freely.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovycAntTask-JointCompilation"><a class="anchor" href="#ThegroovycAntTask-JointCompilation"></a>Joint Compilation</h6>
<div class="paragraph">
<p>Joint compilation is enabled by using an embedded <code>javac</code> element, as shown in
the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;groovyc</span><span class="pln"> </span><span class="atn">srcdir</span><span class="pun">=</span><span class="atv">"${testSourceDirectory}"</span><span class="pln"> </span><span class="atn">destdir</span><span class="pun">=</span><span class="atv">"${testClassesDirectory}"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;classpath&gt;</span><span class="pln">
    </span><span class="tag">&lt;pathelement</span><span class="pln"> </span><span class="atn">path</span><span class="pun">=</span><span class="atv">"${mainClassesDirectory}"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;pathelement</span><span class="pln"> </span><span class="atn">path</span><span class="pun">=</span><span class="atv">"${testClassesDirectory}"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;path</span><span class="pln"> </span><span class="atn">refid</span><span class="pun">=</span><span class="atv">"testPath"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/classpath&gt;</span><span class="pln">
  </span><span class="tag">&lt;javac</span><span class="pln"> </span><span class="atn">source</span><span class="pun">=</span><span class="atv">"1.7"</span><span class="pln"> </span><span class="atn">target</span><span class="pun">=</span><span class="atv">"1.7"</span><span class="pln"> </span><span class="atn">debug</span><span class="pun">=</span><span class="atv">"on"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/groovyc&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is rare to specify <code>srcdir</code> and <code>destdir</code>, the nested <code>javac</code> task is provided with the <code>srcdir</code>
and <code>destdir</code> values from the enclosing <code>groovyc</code> task, and it is invariable
the right thing to do just to leave this as is.
To restate: the <code>javac</code> task gets the <code>srcdir</code>, <code>destdir</code> and <code>classpath</code> from
the enclosing <code>groovyc</code> task.</p>
</div>
<div class="paragraph">
<p>More details about joint compilation can be found in the <a href="#section-jointcompilation">joint compilation</a> section.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Gant"><a class="anchor" href="#Gant"></a>2.2.3. Gant</h4>
<div class="paragraph">
<p><a href="https://github.com/Gant/Gant">Gant</a> is a tool for scripting Ant tasks using Groovy
instead of XML to specify the logic. As such, it has exactly the same features
as the Groovyc Ant task.</p>
</div>
</div>
<div class="sect3">
<h4 id="Gradle"><a class="anchor" href="#Gradle"></a>2.2.4. Gradle</h4>
<div class="paragraph">
<p><a href="http://www.gradle.org/">Gradle</a> is a build tool that allows you to leverage the
flexibility of <a href="http://ant.apache.org/">Ant</a>, while keeping the simplicity of
convention over configuration that tools like <a href="http://maven.apache.org/">Maven</a>
offer. Builds are specified using a Groovy DSL, which offers great flexibility
and succinctness.</p>
</div>
</div>
<div class="sect3">
<h4 id="_maven_integration"><a class="anchor" href="#_maven_integration"></a>2.2.5. Maven integration</h4>
<div class="paragraph">
<p>There are several approaches to compiling Groovy code in your Maven
projects. <a href="#section-gmavenplus">GMavenPlus</a> is the
most flexible and feature rich, but like most Groovy compiler tools, it can
have difficulties with joint Java-Groovy projects (for the same reason
<a href="#section-gmaven">GMaven</a> and <a href="#Gradle">Gradle</a> can have issues).
The <a href="#section-groovyeclipse">Groovy-Eclipse compiler plugin for Maven</a>
sidesteps the joint compilation issues. Read
<a href="https://github.com/groovy/groovy-eclipse/wiki/Groovy-Eclipse-Maven-plugin#why-another-groovy-compiler-for-maven-what-about-gmaven">this</a>
for a deeper discussion of the benefits and disadvantages of the two
approaches.</p>
</div>
<div class="paragraph">
<p>A third approach is to use Maven’s Ant plugin to compile a groovy
project. Note that the Ant plugin is bound to the compile and
test-compile phases of the build in the example below. It will be
invoked during these phases and the contained tasks will be carried out
which runs the Groovy compiler over the source and test directories. The
resulting Java classes will coexist with and be treated like any
standard Java classes compiled from Java source and will appear no
different to the JRE, or the JUnit runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;project</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://maven.apache.org/POM/4.0.0"</span><span class="pln"> </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
    </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;modelVersion&gt;</span><span class="pln">4.0.0</span><span class="tag">&lt;/modelVersion&gt;</span><span class="pln">
    </span><span class="tag">&lt;groupId&gt;</span><span class="pln">com.mycomp.MyGroovy</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
    </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">MyGroovy</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
    </span><span class="tag">&lt;packaging&gt;</span><span class="pln">jar</span><span class="tag">&lt;/packaging&gt;</span><span class="pln">
    </span><span class="tag">&lt;version&gt;</span><span class="pln">1.0-SNAPSHOT</span><span class="tag">&lt;/version&gt;</span><span class="pln">
    </span><span class="tag">&lt;name&gt;</span><span class="pln">Maven Example building a Groovy project</span><span class="tag">&lt;/name&gt;</span><span class="pln">
    </span><span class="tag">&lt;dependencies&gt;</span><span class="pln">
        </span><span class="tag">&lt;dependency&gt;</span><span class="pln">
            </span><span class="tag">&lt;groupId&gt;</span><span class="pln">junit</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
            </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">junit</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
            </span><span class="tag">&lt;version&gt;</span><span class="pln">3.8.1</span><span class="tag">&lt;/version&gt;</span><span class="pln">
            </span><span class="tag">&lt;scope&gt;</span><span class="pln">test</span><span class="tag">&lt;/scope&gt;</span><span class="pln">
        </span><span class="tag">&lt;/dependency&gt;</span><span class="pln">
        </span><span class="tag">&lt;dependency&gt;</span><span class="pln">
            </span><span class="tag">&lt;groupId&gt;</span><span class="pln">org.codehaus.groovy</span><span class="tag">&lt;/groupId&gt;</span><span class="pln">
            </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">groovy-all</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
            </span><span class="tag">&lt;version&gt;</span><span class="pln">2.1.6</span><span class="tag">&lt;/version&gt;</span><span class="pln">
        </span><span class="tag">&lt;/dependency&gt;</span><span class="pln">
    </span><span class="tag">&lt;/dependencies&gt;</span><span class="pln">
    </span><span class="tag">&lt;build&gt;</span><span class="pln">
        </span><span class="tag">&lt;plugins&gt;</span><span class="pln">
            </span><span class="tag">&lt;plugin&gt;</span><span class="pln">
                </span><span class="tag">&lt;artifactId&gt;</span><span class="pln">maven-antrun-plugin</span><span class="tag">&lt;/artifactId&gt;</span><span class="pln">
                </span><span class="tag">&lt;executions&gt;</span><span class="pln">
                    </span><span class="tag">&lt;execution&gt;</span><span class="pln">
                        </span><span class="tag">&lt;id&gt;</span><span class="pln">compile</span><span class="tag">&lt;/id&gt;</span><span class="pln">
                        </span><span class="tag">&lt;phase&gt;</span><span class="pln">compile</span><span class="tag">&lt;/phase&gt;</span><span class="pln">
                        </span><span class="tag">&lt;configuration&gt;</span><span class="pln">
                            </span><span class="tag">&lt;tasks&gt;</span><span class="pln">
                                </span><span class="tag">&lt;mkdir</span><span class="pln"> </span><span class="atn">dir</span><span class="pun">=</span><span class="atv">"${basedir}/src/main/groovy"</span><span class="tag">/&gt;</span><span class="pln">
                                </span><span class="tag">&lt;taskdef</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"groovyc"</span><span class="pln">
                                    </span><span class="atn">classname</span><span class="pun">=</span><span class="atv">"org.codehaus.groovy.ant.Groovyc"</span><span class="tag">&gt;</span><span class="pln">
                                    </span><span class="tag">&lt;classpath</span><span class="pln"> </span><span class="atn">refid</span><span class="pun">=</span><span class="atv">"maven.compile.classpath"</span><span class="tag">/&gt;</span><span class="pln">
                                </span><span class="tag">&lt;/taskdef&gt;</span><span class="pln">
                                </span><span class="tag">&lt;mkdir</span><span class="pln"> </span><span class="atn">dir</span><span class="pun">=</span><span class="atv">"${project.build.outputDirectory}"</span><span class="tag">/&gt;</span><span class="pln">
                                </span><span class="tag">&lt;groovyc</span><span class="pln"> </span><span class="atn">destdir</span><span class="pun">=</span><span class="atv">"${project.build.outputDirectory}"</span><span class="pln">
                                    </span><span class="atn">srcdir</span><span class="pun">=</span><span class="atv">"${basedir}/src/main/groovy/"</span><span class="pln"> </span><span class="atn">listfiles</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
                                    </span><span class="tag">&lt;classpath</span><span class="pln"> </span><span class="atn">refid</span><span class="pun">=</span><span class="atv">"maven.compile.classpath"</span><span class="tag">/&gt;</span><span class="pln">
                                </span><span class="tag">&lt;/groovyc&gt;</span><span class="pln">
                            </span><span class="tag">&lt;/tasks&gt;</span><span class="pln">
                        </span><span class="tag">&lt;/configuration&gt;</span><span class="pln">
                        </span><span class="tag">&lt;goals&gt;</span><span class="pln">
                            </span><span class="tag">&lt;goal&gt;</span><span class="pln">run</span><span class="tag">&lt;/goal&gt;</span><span class="pln">
                        </span><span class="tag">&lt;/goals&gt;</span><span class="pln">
                    </span><span class="tag">&lt;/execution&gt;</span><span class="pln">
                    </span><span class="tag">&lt;execution&gt;</span><span class="pln">
                        </span><span class="tag">&lt;id&gt;</span><span class="pln">test-compile</span><span class="tag">&lt;/id&gt;</span><span class="pln">
                        </span><span class="tag">&lt;phase&gt;</span><span class="pln">test-compile</span><span class="tag">&lt;/phase&gt;</span><span class="pln">
                        </span><span class="tag">&lt;configuration&gt;</span><span class="pln">
                            </span><span class="tag">&lt;tasks&gt;</span><span class="pln">
                                </span><span class="tag">&lt;mkdir</span><span class="pln"> </span><span class="atn">dir</span><span class="pun">=</span><span class="atv">"${basedir}/src/test/groovy"</span><span class="tag">/&gt;</span><span class="pln">
                                </span><span class="tag">&lt;taskdef</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"groovyc"</span><span class="pln">
                                    </span><span class="atn">classname</span><span class="pun">=</span><span class="atv">"org.codehaus.groovy.ant.Groovyc"</span><span class="tag">&gt;</span><span class="pln">
                                    </span><span class="tag">&lt;classpath</span><span class="pln"> </span><span class="atn">refid</span><span class="pun">=</span><span class="atv">"maven.test.classpath"</span><span class="tag">/&gt;</span><span class="pln">
                                </span><span class="tag">&lt;/taskdef&gt;</span><span class="pln">
                                </span><span class="tag">&lt;mkdir</span><span class="pln"> </span><span class="atn">dir</span><span class="pun">=</span><span class="atv">"${project.build.testOutputDirectory}"</span><span class="tag">/&gt;</span><span class="pln">
                                </span><span class="tag">&lt;groovyc</span><span class="pln"> </span><span class="atn">destdir</span><span class="pun">=</span><span class="atv">"${project.build.testOutputDirectory}"</span><span class="pln">
                                    </span><span class="atn">srcdir</span><span class="pun">=</span><span class="atv">"${basedir}/src/test/groovy/"</span><span class="pln"> </span><span class="atn">listfiles</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
                                    </span><span class="tag">&lt;classpath</span><span class="pln"> </span><span class="atn">refid</span><span class="pun">=</span><span class="atv">"maven.test.classpath"</span><span class="tag">/&gt;</span><span class="pln">
                                </span><span class="tag">&lt;/groovyc&gt;</span><span class="pln">
                            </span><span class="tag">&lt;/tasks&gt;</span><span class="pln">
                        </span><span class="tag">&lt;/configuration&gt;</span><span class="pln">
                        </span><span class="tag">&lt;goals&gt;</span><span class="pln">
                            </span><span class="tag">&lt;goal&gt;</span><span class="pln">run</span><span class="tag">&lt;/goal&gt;</span><span class="pln">
                        </span><span class="tag">&lt;/goals&gt;</span><span class="pln">
                    </span><span class="tag">&lt;/execution&gt;</span><span class="pln">
                </span><span class="tag">&lt;/executions&gt;</span><span class="pln">
            </span><span class="tag">&lt;/plugin&gt;</span><span class="pln">
        </span><span class="tag">&lt;/plugins&gt;</span><span class="pln">
    </span><span class="tag">&lt;/build&gt;</span><span class="pln">
</span><span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This assumes you have a Maven project setup with <code>groovy</code> subfolders
as peers to the java src and test subfolders. You can use the <code>java</code>/<code>jar</code>
archetype to set this up then rename the java folders to groovy or keep
the java folders and just create groovy peer folders. There exists, also
a groovy plugin which has not been tested or used in production. After
defining the build section as in the above example, you can invoke the
typical Maven build phases normally. For example, <code>mvn test</code> will
execute the test phase, compiling Groovy source and Groovy test source
and finally executing the unit tests. If you run <code>mvn jar</code> it will
execute the jar phase bundling up all of your compiled production
classes into a jar after all of the unit tests pass. For more detail on
Maven build phases consult the Maven2 documentation.</p>
</div>
<div class="sect4">
<h5 id="_gmaven_and_gmavenplus"><a class="anchor" href="#_gmaven_and_gmavenplus"></a>GMaven and GMavenPlus</h5>
<div class="sect5">
<h6 id="section-gmaven"><a class="anchor" href="#section-gmaven"></a>GMaven</h6>
<div class="paragraph">
<p><a href="https://github.com/groovy/gmaven">GMaven</a> is the original Maven plugin
for Groovy, supporting both compiling and scripting Groovy.</p>
</div>
<div class="paragraph">
<p><strong>Important:</strong></p>
</div>
<div class="paragraph">
<p>You should be aware that GMaven is <strong>not supported anymore</strong> and can have
difficulties with <a href="#section-jointcompilation">joint compilation</a>.
<a href="#section-gmavenplus">GMavenPlus</a> can be a good replacement, but if you
are having problems with joint compilation, you might consider the
<a href="#section-groovyeclipse">Groovy Eclipse maven plugin</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="section-gmavenplus"><a class="anchor" href="#section-gmavenplus"></a>GMavenPlus</h6>
<div class="paragraph">
<p><a href="https://github.com/groovy/GMavenPlus">GMavenPlus</a> is a rewrite of
<a href="#section-gmaven">GMaven</a> and is in active development. It supports most of the
features of GMaven (a couple notable exceptions being
<a href="http://maven.apache.org/plugin-tools/maven-plugin-tools-java/index.html">mojo Javadoc tags</a>
and support for older Groovy versions). Its joint compilation uses stubs (which
means it has the same potential issues as <a href="#section-gmaven">GMaven</a> and <a href="#Gradle">Gradle</a>). The main
advantages over its predecessor are that it supports recent Groovy versions,
InvokeDynamic, Groovy on Android, GroovyDoc, and configuration scripts.</p>
</div>
</div>
<div class="sect5">
<h6 id="section-gmaven2"><a class="anchor" href="#section-gmaven2"></a>GMaven 2</h6>
<div class="paragraph">
<p>Unlike the name might seem to suggest, <a href="http://groovy.github.io/gmaven/">GMaven 2</a>
is not aimed at replacing <a href="#section-gmaven">GMaven</a>. In fact, it removes the
non-scripting features of the GMaven plugin. It has not yet had any release and
appears to be inactive currently.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="section-groovyeclipse"><a class="anchor" href="#section-groovyeclipse"></a>The Groovy Eclipse Maven plugin</h5>
<div class="paragraph">
<p><a href="https://github.com/groovy/groovy-eclipse/wiki/Groovy-Eclipse-Maven-plugin">Groovy-Eclipse</a>
provides a compiler plugin for Maven. Using the compiler
plugin, it is possible to compile your maven projects using the
Groovy-Eclipse compiler. One feature unavailable elsewhere is
stubless joint compilation.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="section-jointcompilation"><a class="anchor" href="#section-jointcompilation"></a>2.2.6. Joint compilation</h4>
<div class="paragraph">
<p>Joint compilation means that the Groovy compiler will parse the
Groovy source files, create stubs for all of them, invoke the Java
compiler to compile the stubs along with Java sources, and then continue
compilation in the normal Groovy compiler way. This allows mixing of
Java and Groovy files without constraint.</p>
</div>
<div class="paragraph">
<p>Joint compilation can be enabled using the <code>-j</code> flag with the command-line compiler,
or using using a nested tag and all the attributes and further nested tags as required
for the Ant task.</p>
</div>
<div class="paragraph">
<p>It is important to know that if you don’t enable joint compilation and try to compile
Java source files with the Groovy compiler, the Java source files will be compiled as
if they were Groovy sources. In some situations, this might work since most of the Java
syntax is compatible with Groovy, but semantics would be different.</p>
</div>
</div>
<div class="sect3">
<h4 id="section-android"><a class="anchor" href="#section-android"></a>2.2.7. Android support</h4>
<div class="paragraph">
<p>It is possible to write an Android application in Groovy. However this requires a special
version of the compiler, meaning that you cannot use the regular
<a href="#section-groovyc-compiler">groovyc tool</a> to target Android bytecode. In particular, Groovy
provides specific JAR files for Android, which have a classifier of <code>grooid</code>. In order to make
things easier, a <a href="https://github.com/groovy/groovy-android-gradle-plugin">Gradle plugin</a> adds
support for the Groovy language in the Android Gradle toolchain.</p>
</div>
<div class="paragraph">
<p>The plugin can be applied like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">buildscript </span><span class="pun">{</span><span class="pln">
    repositories </span><span class="pun">{</span><span class="pln">
        jcenter</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    dependencies </span><span class="pun">{</span><span class="pln">
        classpath </span><span class="str">'com.android.tools.build:gradle:2.1.2'</span><span class="pln">
        classpath </span><span class="str">'org.codehaus.groovy:groovy-android-gradle-plugin:1.0.0'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

apply plugin</span><span class="pun">:</span><span class="pln"> </span><span class="str">'groovyx.android'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you will need to add a dependency on the <code>grooid</code> version of the Groovy compiler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">dependencies </span><span class="pun">{</span><span class="pln">
    compile </span><span class="str">'org.codehaus.groovy:groovy:2.4.8:grooid'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if a Groovy jar does not provide a <code>grooid</code> classifier alternative, then it means
that the jar is directly compatible with Android. In that case, you can add the dependency directly
like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">dependencies </span><span class="pun">{</span><span class="pln">
    compile </span><span class="str">'org.codehaus.groovy:groovy:2.4.8:grooid'</span><span class="pln">       </span><span class="com">// requires the grooid classifier</span><span class="pln">
    compile </span><span class="pun">(</span><span class="str">'org.codehaus.groovy:groovy-json:2.4.8'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">     </span><span class="com">// no grooid version available</span><span class="pln">
        transitive </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">                                  </span><span class="com">// so do not depend on non-grooid version</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>transitive=false</code> parameter for <code>groovy-json</code> will let Gradle download the JSON support jar
without adding a dependency onto the normal jar of Groovy.</p>
</div>
<div class="paragraph">
<p>Please make sure to go to the <a href="https://github.com/groovy/groovy-android-gradle-plugin">plugin homepage</a> in order to
find the latest documentation and version.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovysh_the_groovy_shell"><a class="anchor" href="#_groovysh_the_groovy_shell"></a>2.3. Groovysh, the Groovy shell</h3>
<div class="sect3">
<h4 id="_groovy_groovy_shell"><a class="anchor" href="#_groovy_groovy_shell"></a>2.3.1. Groovy : Groovy Shell</h4>
<div class="paragraph">
<p>The Groovy Shell, aka. <code>groovysh</code> is a command-line application which
allows easy access to evaluate Groovy expressions, define classes and
run simple experiments.</p>
</div>
<div class="sect4">
<h5 id="GroovyShell-Features"><a class="anchor" href="#GroovyShell-Features"></a>Features</h5>
<div class="ulist">
<ul>
<li>
<p>No need for <code>go</code> command to execute buffer.</p>
</li>
<li>
<p>Rich cross-platform edit-line editing, history and completion thanks
to <a href="https://github.com/jline/jline2">JLine2</a>.</p>
</li>
<li>
<p>ANSI colors (prompt, exception traces, etc).</p>
</li>
<li>
<p>Simple, yet robust, command system with online help, user alias
support and more.</p>
</li>
<li>
<p>User profile support</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Command-lineOptionsandArguments"><a class="anchor" href="#GroovyShell-Command-lineOptionsandArguments"></a>Command-line Options and Arguments</h5>
<div class="paragraph">
<p>The shell supports several options to control verbosity, ANSI coloring
and other features.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pun">.</span><span class="str">/bin/</span><span class="pln">groovysh </span><span class="pun">--</span><span class="pln">help
usage</span><span class="pun">:</span><span class="pln"> groovysh </span><span class="pun">[</span><span class="pln">options</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[...]</span><span class="pln">
  </span><span class="pun">-</span><span class="pln">C</span><span class="pun">,</span><span class="pln"> </span><span class="pun">--</span><span class="pln">color</span><span class="pun">[=</span><span class="pln">FLAG</span><span class="pun">]</span><span class="pln">         </span><span class="typ">Enable</span><span class="pln"> </span><span class="kwd">or</span><span class="pln"> disable </span><span class="kwd">use</span><span class="pln"> of ANSI colors
  </span><span class="pun">-</span><span class="pln">D</span><span class="pun">,</span><span class="pln"> </span><span class="pun">--</span><span class="pln">define</span><span class="pun">=</span><span class="pln">NAME</span><span class="pun">=</span><span class="pln">VALUE    </span><span class="typ">Define</span><span class="pln"> a system </span><span class="kwd">property</span><span class="pln">
  </span><span class="pun">-</span><span class="pln">T</span><span class="pun">,</span><span class="pln"> </span><span class="pun">--</span><span class="pln">terminal</span><span class="pun">=</span><span class="pln">TYPE        </span><span class="typ">Specify</span><span class="pln"> the terminal TYPE to </span><span class="kwd">use</span><span class="pln">
  </span><span class="pun">-</span><span class="pln">V</span><span class="pun">,</span><span class="pln"> </span><span class="pun">--</span><span class="pln">version              </span><span class="typ">Display</span><span class="pln"> the version
  </span><span class="pun">-</span><span class="pln">classpath                 </span><span class="typ">Specify</span><span class="pln"> </span><span class="kwd">where</span><span class="pln"> to find the </span><span class="kwd">class</span><span class="pln"> files </span><span class="pun">-</span><span class="pln"> must
                             be first argument
  </span><span class="pun">-</span><span class="pln">cp</span><span class="pun">,</span><span class="pln"> </span><span class="pun">--</span><span class="pln">classpath           </span><span class="typ">Aliases</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> </span><span class="str">'-classpath'</span><span class="pln">
  </span><span class="pun">-</span><span class="pln">d</span><span class="pun">,</span><span class="pln"> </span><span class="pun">--</span><span class="pln">debug                </span><span class="typ">Enable</span><span class="pln"> debug output
  </span><span class="pun">-</span><span class="pln">e</span><span class="pun">,</span><span class="pln"> </span><span class="pun">--</span><span class="pln">evaluate</span><span class="pun">=</span><span class="pln">arg         </span><span class="typ">Evaluate</span><span class="pln"> option first </span><span class="kwd">when</span><span class="pln"> starting
                             interactive session
  </span><span class="pun">-</span><span class="pln">h</span><span class="pun">,</span><span class="pln"> </span><span class="pun">--</span><span class="pln">help                 </span><span class="typ">Display</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> help message
  </span><span class="pun">-</span><span class="pln">q</span><span class="pun">,</span><span class="pln"> </span><span class="pun">--</span><span class="pln">quiet                </span><span class="typ">Suppress</span><span class="pln"> superfluous output
  </span><span class="pun">-</span><span class="pln">v</span><span class="pun">,</span><span class="pln"> </span><span class="pun">--</span><span class="pln">verbose              </span><span class="typ">Enable</span><span class="pln"> verbose output</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-EvaluatingExpressions"><a class="anchor" href="#GroovyShell-EvaluatingExpressions"></a>Evaluating Expressions</h5>
<div class="sect5">
<h6 id="GroovyShell-SimpleExpressions"><a class="anchor" href="#GroovyShell-SimpleExpressions"></a>Simple Expressions</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">println </span><span class="str">"Hello"</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-EvaluationResult"><a class="anchor" href="#GroovyShell-EvaluationResult"></a>Evaluation Result</h6>
<div class="paragraph">
<p>When a complete expression is found, it is compiled and evaluated. The
result of the evaluation is stored into the _ variable.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-Multi-lineExpressions"><a class="anchor" href="#GroovyShell-Multi-lineExpressions"></a>Multi-line Expressions</h6>
<div class="paragraph">
<p>Multi-line/complex expressions (like closure or class definitions) may
be defined over several lines. When the shell detects that it has a
complete expression it will compile and evaluate it.</p>
</div>
<div class="sect6">
<h7 id="GroovyShell-DefineaClass"><a class="anchor" href="#GroovyShell-DefineaClass"></a>Define a Class</h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> bar</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"baz"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-UsetheClass"><a class="anchor" href="#GroovyShell-UsetheClass"></a>Use the Class</h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">foo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">()</span><span class="pln">
foo</span><span class="pun">.</span><span class="pln">bar</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-Variables"><a class="anchor" href="#GroovyShell-Variables"></a>Variables</h6>
<div class="paragraph">
<p>Shell variables are <strong>all</strong> untyped (i.e. no <code>def</code> or other type information).</p>
</div>
<div class="paragraph">
<p>This <strong>will</strong> set a shell variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">foo </span><span class="pun">=</span><span class="pln"> </span><span class="str">"bar"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But, this will evaluate a local variable and will <strong>not</strong> be saved to the shell’s environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> foo </span><span class="pun">=</span><span class="pln"> </span><span class="str">"bar"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This behavior can be changed by activating <a href="#GroovyShell-InterpreterMode">interpreter mode</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-Functions"><a class="anchor" href="#GroovyShell-Functions"></a>Functions</h6>
<div class="paragraph">
<p>Functions can be defined in the shell, and will be saved for later use.</p>
</div>
<div class="paragraph">
<p>Defining a function is easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">groovy</span><span class="pun">:</span><span class="lit">000</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> hello</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
groovy</span><span class="pun">:</span><span class="lit">001</span><span class="pun">&gt;</span><span class="pln"> println</span><span class="pun">(</span><span class="str">"Hello $name"</span><span class="pun">)</span><span class="pln">
groovy</span><span class="pun">:</span><span class="lit">002</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And then using it is as one might expect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">hello</span><span class="pun">(</span><span class="str">"Jason"</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Internally the shell creates a closure to encapsulate the function and
then binds the closure to a variable. So variables and functions share
the same namespace.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Commands"><a class="anchor" href="#GroovyShell-Commands"></a>Commands</h5>
<div class="paragraph">
<p>The shell has a number of different commands, which provide rich access
to the shell’s environment.</p>
</div>
<div class="paragraph">
<p>Commands all have a <em>name</em> and a <em>shortcut</em> (which is something like
<code>\h</code>). Commands may also have some predefined system <em>aliases</em>. Users
may also create their own aliases.</p>
</div>
<div class="sect5">
<h6 id="GroovyShell-RecognizedCommands"><a class="anchor" href="#GroovyShell-RecognizedCommands"></a>Recognized Commands</h6>
<div class="sect6">
<h7 id="GroovyShell-help"><a class="anchor" href="#GroovyShell-help"></a><code>help</code></h7>
<div class="paragraph">
<p>Display the list of commands (and aliases) or the help text for specific command.</p>
</div>
<div id="GroovyShell-TheCommandList" class="paragraph">
<p>The Command List</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :help

For information about Groovy, visit:
    http://groovy-lang.org

Available commands:
  :help      (:h ) Display this help message
  ?          (:? ) Alias to: :help
  :exit      (:x ) Exit the shell
  :quit      (:q ) Alias to: :exit
  import     (:i ) Import a class into the namespace
  :display   (:d ) Display the current buffer
  :clear     (:c ) Clear the buffer and reset the prompt counter
  :show      (:S ) Show variables, classes or imports
  :inspect   (:n ) Inspect a variable or the last result with the GUI object browser
  :purge     (:p ) Purge variables, classes, imports or preferences
  :edit      (:e ) Edit the current buffer
  :load      (:l ) Load a file or URL into the buffer
  .          (:. ) Alias to: :load
  :save      (:s ) Save the current buffer to a file
  :record    (:r ) Record the current session to a file
  :history   (:H ) Display, manage and recall edit-line history
  :alias     (:a ) Create an alias
  :set       (:= ) Set (or list) preferences
  :register  (:rc) Register a new command with the shell
  :doc       (:D ) Open a browser window displaying the doc for the argument

For help on a specific command type:
    :help &lt;command&gt;</pre>
</div>
</div>
<div id="GroovyShell-HelpforaCommand" class="paragraph">
<p>Help for a Command</p>
</div>
<div class="paragraph">
<p>While in the interactive shell, you can ask for help for any command to
get more details about its syntax or function. Here is an example of
what happens when you ask for help for the <code>help</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :help :help

usage: :help [&lt;command&gt;]

Display the list of commands or the help text for &lt;command&gt;.</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-exit"><a class="anchor" href="#GroovyShell-exit"></a><code>exit</code></h7>
<div class="paragraph">
<p>Exit the shell.</p>
</div>
<div class="paragraph">
<p>This is the <strong>only</strong> way to exit the shell. Well, you can still <code>CTRL-C</code>,
but the shell will complain about an abnormal shutdown of the JVM.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-import"><a class="anchor" href="#GroovyShell-import"></a><code>import</code></h7>
<div class="paragraph">
<p>Add a custom import which will be included for all shell evaluations.</p>
</div>
<div class="paragraph">
<p>This command can be given at any time to add new imports.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-display"><a class="anchor" href="#GroovyShell-display"></a><code>display</code></h7>
<div class="paragraph">
<p>Display the contents of the current buffer.</p>
</div>
<div class="paragraph">
<p>This only displays the buffer of an incomplete expression. Once the
expression is complete, the buffer is rest. The prompt will update to
show the size of the current buffer as well.</p>
</div>
<div id="GroovyShell-Example" class="paragraph">
<p>Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; class Foo {
groovy:001&gt; def bar
groovy:002&gt; def baz() {
groovy:003&gt; :display
 001&gt; class Foo {
 002&gt; def bar
 003&gt; def baz() {</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-clear"><a class="anchor" href="#GroovyShell-clear"></a><code>clear</code></h7>
<div class="paragraph">
<p>Clears&nbsp;the&nbsp;current&nbsp;buffer,&nbsp;resetting&nbsp;the&nbsp;prompt&nbsp;counter&nbsp;to&nbsp;000.&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;recover&nbsp;from&nbsp;compilation&nbsp;errors.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-show"><a class="anchor" href="#GroovyShell-show"></a><code>show</code></h7>
<div class="paragraph">
<p>Show variables, classes or preferences or imports.</p>
</div>
<div id="GroovyShell-showvariables" class="paragraph">
<p><code>show variables</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :show variables
Variables:
  _ = true</pre>
</div>
</div>
<div id="GroovyShell-showclasses" class="paragraph">
<p><code>show classes</code></p>
</div>
<div id="GroovyShell-showimports" class="paragraph">
<p><code>show imports</code></p>
</div>
<div id="GroovyShell-showpreferences" class="paragraph">
<p><code>show preferences</code></p>
</div>
<div id="GroovyShell-showall" class="paragraph">
<p><code>show all</code></p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-inspect"><a class="anchor" href="#GroovyShell-inspect"></a><code>inspect</code></h7>
<div class="paragraph">
<p>Opens the GUI object browser to inspect a variable or the result of the
last evaluation.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-purge"><a class="anchor" href="#GroovyShell-purge"></a><code>purge</code></h7>
<div class="paragraph">
<p>Purges objects from the shell.</p>
</div>
<div id="GroovyShell-purgevariables" class="paragraph">
<p><code>purge variables</code></p>
</div>
<div id="GroovyShell-purgeclasses" class="paragraph">
<p><code>purge classes</code></p>
</div>
<div id="GroovyShell-purgeimports" class="paragraph">
<p><code>purge imports</code></p>
</div>
<div id="GroovyShell-purgepreferences" class="paragraph">
<p><code>purge preferences</code></p>
</div>
<div id="GroovyShell-purgeall" class="paragraph">
<p><code>purge all</code></p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-edit"><a class="anchor" href="#GroovyShell-edit"></a><code>edit</code></h7>
<div class="paragraph">
<p>Edit the current buffer in an external editor.</p>
</div>
<div class="paragraph">
<p>Currently only works on UNIX systems which have the <code>EDITOR</code> environment
variable set, or have configured the <code>editor</code> preference.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-load"><a class="anchor" href="#GroovyShell-load"></a><code>load</code></h7>
<div class="paragraph">
<p>Load one or more files (or urls) into the buffer.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-save"><a class="anchor" href="#GroovyShell-save"></a><code>save</code></h7>
<div class="paragraph">
<p>Saves the buffer’s contents to a file.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-record"><a class="anchor" href="#GroovyShell-record"></a><code>record</code></h7>
<div class="paragraph">
<p>Record the current session to a file.</p>
</div>
<div id="GroovyShell-recordstart" class="paragraph">
<p><code>record start</code></p>
</div>
<div id="GroovyShell-recordstop" class="paragraph">
<p><code>record stop</code></p>
</div>
<div id="GroovyShell-recordstatus" class="paragraph">
<p><code>record status</code></p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-history"><a class="anchor" href="#GroovyShell-history"></a><code>history</code></h7>
<div class="paragraph">
<p>Display, manage and recall edit-line history.</p>
</div>
<div id="GroovyShell-historyshow" class="paragraph">
<p><code>history show</code></p>
</div>
<div id="GroovyShell-historyrecall" class="paragraph">
<p><code>history recall</code></p>
</div>
<div id="GroovyShell-historyflush" class="paragraph">
<p><code>history flush</code></p>
</div>
<div id="GroovyShell-historyclear" class="paragraph">
<p><code>history clear</code></p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-alias"><a class="anchor" href="#GroovyShell-alias"></a><code>alias</code></h7>
<div class="paragraph">
<p>Create an alias.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-doc"><a class="anchor" href="#GroovyShell-doc"></a><code>doc</code></h7>
<div class="paragraph">
<p>Opens a browser with documentation for the provided class. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :doc java.util.List
http://docs.oracle.com/javase/7/docs/api/java/util/List.html
http://docs.groovy-lang.org/2.4.2-SNAPSHOT/html/groovy-jdk/java/util/List.html</pre>
</div>
</div>
<div class="paragraph">
<p>will open two windows (or tabs, depending on your browser):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one for the JDK documentation</p>
</li>
<li>
<p>one for the GDK documentation</p>
</li>
</ul>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-set"><a class="anchor" href="#GroovyShell-set"></a><code>set</code></h7>
<div class="paragraph">
<p>Set or list preferences.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Preferences"><a class="anchor" href="#GroovyShell-Preferences"></a>Preferences</h5>
<div class="paragraph">
<p>Some of aspects of <code>groovysh</code> behaviors can be customized by setting
preferences. Preferences are set using the <code>set</code> command or the <code>:=</code>
shortcut.</p>
</div>
<div class="sect5">
<h6 id="GroovyShell-RecognizedPreferences"><a class="anchor" href="#GroovyShell-RecognizedPreferences"></a>Recognized Preferences</h6>
<div class="sect6">
<h7 id="GroovyShell-InterpreterMode"><a class="anchor" href="#GroovyShell-InterpreterMode"></a><code>interpreterMode</code></h7>
<div class="paragraph">
<p>Allows the use of typed variables (i.e. <code>def</code> or other type information):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; def x = 3
===&gt; 3
groovy:000&gt; x
===&gt; 3</pre>
</div>
</div>
<div class="paragraph">
<p>It’s especially useful for copy&amp;pasting code from tutorials etc. into the running session.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-verbosity"><a class="anchor" href="#GroovyShell-verbosity"></a><code>verbosity</code></h7>
<div class="paragraph">
<p>Set the shell’s verbosity level. Expected to be one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DEBUG</code></p>
</li>
<li>
<p><code>VERBOSE</code></p>
</li>
<li>
<p><code>INFO</code></p>
</li>
<li>
<p><code>QUIET</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Default is <code>INFO</code>.</p>
</div>
<div class="paragraph">
<p>If this preference is set to an invalid value, then the previous setting
will be used, or if there is none, then the preference is removed and
the default is used.</p>
</div>
</div>
<div class="sect6">
<h7 id="__code_colors_code"><a class="anchor" href="#__code_colors_code"></a><code>colors</code></h7>
<div class="paragraph">
<p>Set the shell’s use of colors.</p>
</div>
<div class="paragraph">
<p>Default is <code>true</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-show-last-result"><a class="anchor" href="#GroovyShell-show-last-result"></a><code>show-last-result</code></h7>
<div class="paragraph">
<p>Show the last result after an execution.</p>
</div>
<div class="paragraph">
<p>Default is <code>true</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-sanitize-stack-trace"><a class="anchor" href="#GroovyShell-sanitize-stack-trace"></a><code>sanitize-stack-trace</code></h7>
<div class="paragraph">
<p>Sanitize (trim-down/filter) stack traces.</p>
</div>
<div class="paragraph">
<p>Default is <code>true</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-editor"><a class="anchor" href="#GroovyShell-editor"></a><code>editor</code></h7>
<div class="paragraph">
<p>Configures the editor used by the <code>edit</code> command.</p>
</div>
<div class="paragraph">
<p>Default is the value of the system environment variable <code>EDITOR</code>.</p>
</div>
<div class="paragraph">
<p>Mac OS XTo use TextEdit, the default text editor on Mac OS X, configure:
set editor /Applications/TextEdit.app/Contents/MacOS/TextEdit</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-SettingaPreference"><a class="anchor" href="#GroovyShell-SettingaPreference"></a>Setting a Preference</h6>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :set verbosity DEBUG</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-ListingPreferences"><a class="anchor" href="#GroovyShell-ListingPreferences"></a>Listing Preferences</h6>
<div class="paragraph">
<p>To list the current <em>set</em> preferences (and their values):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :show preferences</pre>
</div>
</div>
<div class="paragraph">
<p>Limitation: At the moment, there is no way to list all of the
known/available preferences to be set.</p>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-ClearingPreferencesieResettingtoDefaults"><a class="anchor" href="#GroovyShell-ClearingPreferencesieResettingtoDefaults"></a>Clearing Preferences (i.e. Resetting to Defaults)</h6>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :purge preferences</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-UserProfileScriptsandState"><a class="anchor" href="#GroovyShell-UserProfileScriptsandState"></a>User Profile Scripts and State</h5>
<div class="sect5">
<h6 id="GroovyShell-ProfileScripts"><a class="anchor" href="#GroovyShell-ProfileScripts"></a>Profile Scripts</h6>
<div class="sect6">
<h7 id="GroovyShell-HOMEgroovygroovyshprofile"><a class="anchor" href="#GroovyShell-HOMEgroovygroovyshprofile"></a><code>$HOME/.groovy/groovysh.profile</code></h7>
<div class="paragraph">
<p>This script, if it exists, is loaded when the shell starts up.</p>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-HOMEgroovygroovyshrc"><a class="anchor" href="#GroovyShell-HOMEgroovygroovyshrc"></a><code>$HOME/.groovy/groovysh.rc</code></h7>
<div class="paragraph">
<p>This script, if it exists, is loaded when the shell enters interactive
mode.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="GroovyShell-State"><a class="anchor" href="#GroovyShell-State"></a>State</h6>
<div class="sect6">
<h7 id="GroovyShell-HOMEgroovygroovyshhistory"><a class="anchor" href="#GroovyShell-HOMEgroovygroovyshhistory"></a><code>$HOME/.groovy/groovysh.history</code></h7>
<div class="paragraph">
<p>Edit-line history is stored in this file.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-register"><a class="anchor" href="#GroovyShell-register"></a>Custom commands</h5>
<div class="paragraph">
<p>The <code>register</code> command allows you to register custom commands in the shell. For example, writing the following
will register the <code>Stats</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :register Stats</pre>
</div>
</div>
<div class="paragraph">
<p>where the <code>Stats</code> class is a class extending the <code>org.codehaus.groovy.tools.shell.CommandSupport</code> class. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">tools</span><span class="pun">.</span><span class="pln">shell</span><span class="pun">.</span><span class="typ">CommandSupport</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">tools</span><span class="pun">.</span><span class="pln">shell</span><span class="pun">.</span><span class="typ">Groovysh</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Stats</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">CommandSupport</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">Stats</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Groovysh</span><span class="pln"> shell</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">shell</span><span class="pun">,</span><span class="pln"> </span><span class="str">'stats'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'T'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> execute</span><span class="pun">(</span><span class="typ">List</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"Free memory: ${Runtime.runtime.freeMemory()}"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the command can be called using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy:000&gt; :stats
stats
Free memory: 139474880
groovy:000&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the command class must be found on classpath: you cannot define a new command from within the shell.</p>
</div>
</div>
<div class="sect4">
<h5 id="GroovyShell-Troubleshooting"><a class="anchor" href="#GroovyShell-Troubleshooting"></a>Troubleshooting</h5>
<div class="paragraph">
<p>Please <a href="https://issues.apache.org/jira/browse/GROOVY">report</a> any problems you
run into. Please be sure to mark the JIRA issue with the <code>Groovysh</code>
component.</p>
</div>
<div class="sect5">
<h6 id="GroovyShell-PlatformProblems"><a class="anchor" href="#GroovyShell-PlatformProblems"></a>Platform Problems</h6>
<div class="sect6">
<h7 id="GroovyShell-ProblemsloadingtheJLineDLL"><a class="anchor" href="#GroovyShell-ProblemsloadingtheJLineDLL"></a>Problems loading the JLine DLL</h7>
<div class="paragraph">
<p>On Windows, <a href="https://github.com/jline/jline2">JLine2</a> (which is used for the fancy
shell input/history/completion fluff), uses a <strong>tiny</strong> DLL file to trick
the <strong>evil</strong> Windows faux-shell (<code>CMD.EXE</code> or <code>COMMAND.COM</code>) into
providing Java with unbuffered input. In some rare cases, this might
fail to load or initialize.</p>
</div>
<div class="paragraph">
<p>One solution is to disable the frills and use the unsupported terminal
instance. You can do that on the command-line using the <code>--terminal</code>
flag and set it to one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>none</code></p>
</li>
<li>
<p><code>false</code></p>
</li>
<li>
<p><code>off</code></p>
</li>
<li>
<p><code>jline.UnsupportedTerminal</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>groovysh --terminal=none</pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="GroovyShell-ProblemswithCygwinonWindows"><a class="anchor" href="#GroovyShell-ProblemswithCygwinonWindows"></a>Problems with Cygwin on Windows</h7>
<div class="paragraph">
<p>Some people have issues when running groovysh with cygwin. If you have
troubles, the following may help:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>stty -icanon min 1 -echo
groovysh --terminal=unix
stty icanon echo</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-GMavenPlus"><a class="anchor" href="#GroovyShell-GMavenPlus"></a>2.3.2. GMavenPlus Maven Plugin</h4>
<div class="paragraph">
<p><a href="https://github.com/groovy/GMavenPlus">GMavenPlus</a> is a Maven plugin with goals
that support launching a Groovy Shell or Groovy Console bound to a Maven
project.</p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyShell-GradleGroovyshPlugin"><a class="anchor" href="#GroovyShell-GradleGroovyshPlugin"></a>2.3.3. Gradle Groovysh Plugin</h4>
<div class="paragraph">
<p><a href="https://github.com/tkruse/gradle-groovysh-plugin">Gradle Groovysh Plugin</a> is a Gradle plugin that provides gradle tasks to start a Groovy Shell bound to a Gradle project.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovyconsole_the_groovy_swing_console"><a class="anchor" href="#_groovyconsole_the_groovy_swing_console"></a>2.4. groovyConsole, the Groovy swing console</h3>
<div class="sect3">
<h4 id="title-heading"><a class="anchor" href="#title-heading"></a>2.4.1. Groovy : Groovy Console</h4>
<div class="paragraph">
<p>The Groovy Swing Console allows a user to enter and run Groovy scripts.
This page documents the features of this user interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-Basics"><a class="anchor" href="#GroovyConsole-Basics"></a>2.4.2. Basics</h4>
<div class="paragraph">
<p><span class="image"><script data-pagespeed-no-defer="">//<![CDATA[
(function(){var g=this;function h(b,d){var a=b.split("."),c=g;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var e;a.length&&(e=a.shift());)a.length||void 0===d?c[e]?c=c[e]:c=c[e]={}:c[e]=d};function l(b){var d=b.length;if(0<d){for(var a=Array(d),c=0;c<d;c++)a[c]=b[c];return a}return[]};function m(b){var d=window;if(d.addEventListener)d.addEventListener("load",b,!1);else if(d.attachEvent)d.attachEvent("onload",b);else{var a=d.onload;d.onload=function(){b.call(this);a&&a.call(this)}}};var n;function p(b,d,a,c,e){this.h=b;this.j=d;this.l=a;this.f=e;this.g={height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth};this.i=c;this.b={};this.a=[];this.c={}}function q(b,d){var a,c,e=d.getAttribute("data-pagespeed-url-hash");if(a=e&&!(e in b.c))if(0>=d.offsetWidth&&0>=d.offsetHeight)a=!1;else{c=d.getBoundingClientRect();var f=document.body;a=c.top+("pageYOffset"in window?window.pageYOffset:(document.documentElement||f.parentNode||f).scrollTop);c=c.left+("pageXOffset"in window?window.pageXOffset:(document.documentElement||f.parentNode||f).scrollLeft);f=a.toString()+","+c;b.b.hasOwnProperty(f)?a=!1:(b.b[f]=!0,a=a<=b.g.height&&c<=b.g.width)}a&&(b.a.push(e),b.c[e]=!0)}p.prototype.checkImageForCriticality=function(b){b.getBoundingClientRect&&q(this,b)};h("pagespeed.CriticalImages.checkImageForCriticality",function(b){n.checkImageForCriticality(b)});h("pagespeed.CriticalImages.checkCriticalImages",function(){r(n)});function r(b){b.b={};for(var d=["IMG","INPUT"],a=[],c=0;c<d.length;++c)a=a.concat(l(document.getElementsByTagName(d[c])));if(0!=a.length&&a[0].getBoundingClientRect){for(c=0;d=a[c];++c)q(b,d);a="oh="+b.l;b.f&&(a+="&n="+b.f);if(d=0!=b.a.length)for(a+="&ci="+encodeURIComponent(b.a[0]),c=1;c<b.a.length;++c){var e=","+encodeURIComponent(b.a[c]);131072>=a.length+e.length&&(a+=e)}b.i&&(e="&rd="+encodeURIComponent(JSON.stringify(t())),131072>=a.length+e.length&&(a+=e),d=!0);u=a;if(d){c=b.h;b=b.j;var f;if(window.XMLHttpRequest)f=new XMLHttpRequest;else if(window.ActiveXObject)try{f=new ActiveXObject("Msxml2.XMLHTTP")}catch(k){try{f=new ActiveXObject("Microsoft.XMLHTTP")}catch(v){}}f&&(f.open("POST",c+(-1==c.indexOf("?")?"?":"&")+"url="+encodeURIComponent(b)),f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(a))}}}function t(){var b={},d=document.getElementsByTagName("IMG");if(0==d.length)return{};var a=d[0];if(!("naturalWidth"in a&&"naturalHeight"in a))return{};for(var c=0;a=d[c];++c){var e=a.getAttribute("data-pagespeed-url-hash");e&&(!(e in b)&&0<a.width&&0<a.height&&0<a.naturalWidth&&0<a.naturalHeight||e in b&&a.width>=b[e].o&&a.height>=b[e].m)&&(b[e]={rw:a.width,rh:a.height,ow:a.naturalWidth,oh:a.naturalHeight})}return b}var u="";h("pagespeed.CriticalImages.getBeaconData",function(){return u});h("pagespeed.CriticalImages.Run",function(b,d,a,c,e,f){var k=new p(b,d,a,e,f);n=k;c&&m(function(){window.setTimeout(function(){r(k)},0)})});})();pagespeed.CriticalImages.Run('/mod_pagespeed_beacon','http://docs.groovy-lang.org/latest/html/documentation/index.html','QOs6thfRpi',true,false,'pLM1EiY1mrU');
//]]></script><img src="Groovy-Language-Documentation_files/xGroovyConsole.png" alt="image" data-pagespeed-url-hash="3328547365" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Groovy Console is launched via <code>groovyConsole</code> or
<code>groovyConsole.bat</code>, both located in <code>$GROOVY_HOME/bin</code></p>
</li>
<li>
<p>The Console has an input area and an output area.</p>
</li>
<li>
<p>You type a Groovy script in the input area.</p>
</li>
<li>
<p>When you select <code>Run</code> from the <code>Actions</code> menu, the console
compiles the script and runs it.</p>
</li>
<li>
<p>Anything that would normally be printed on <code>System.out</code> is printed in
the output area.</p>
</li>
<li>
<p>If the script returns a non-null result, that result is printed.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-Features"><a class="anchor" href="#GroovyConsole-Features"></a>2.4.3. Features</h4>
<div class="sect4">
<h5 id="GroovyConsole-RunningScripts"><a class="anchor" href="#GroovyConsole-RunningScripts"></a>Running Scripts</h5>
<div class="paragraph">
<p>There are several shortcuts that you can use to run scripts or code snippets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Ctrl+Enter</code> and <code>Ctrl+R</code> are both shortcut keys for <code>Run Script</code>.</p>
</li>
<li>
<p>If you highlight just part of the text in the input area, then Groovy
runs just that text.</p>
</li>
<li>
<p>The result of a script is the the value of the last expression
executed.</p>
</li>
<li>
<p>You can turn the System.out capture on and off by selecting <code>Capture
System.out</code> from the <code>Actions</code> menu</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-EditingFiles"><a class="anchor" href="#GroovyConsole-EditingFiles"></a>Editing Files</h5>
<div class="paragraph">
<p>You can open any text file, edit it, run it (as a Groovy Script) and
then save it again when you are finished.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select <code>File &gt; Open</code> (shortcut key <code>ctrl+O</code>) to open a file</p>
</li>
<li>
<p>Select <code>File &gt; Save</code> (shortcut key <code>ctrl+S</code>) to save a file</p>
</li>
<li>
<p>Select <code>File &gt; New File</code> (shortcut key <code>ctrl+Q</code>) to start again with a
blank input area</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-Historyandresults"><a class="anchor" href="#GroovyConsole-Historyandresults"></a>History and results</h5>
<div class="ulist">
<ul>
<li>
<p>You can pop-up a gui inspector on the last (non-null) result by
selecting <code>Inspect Last</code> from the <code>Actions</code> menu. The inspector is a
convenient way to view lists and maps.</p>
</li>
<li>
<p>The console remembers the last ten script runs. You can scroll back
and forth through the history by selecting <code>Next</code> and <code>Previous</code>
from the <code>Edit</code> menu. <code>Ctrl-N</code> and <code>ctrl-P</code> are convenient shortcut keys.</p>
</li>
<li>
<p>The last (non-null) result is bound to a variable named <code>_</code> (an
underscore).</p>
</li>
<li>
<p>The last result (null and non-null) for every run in the history is
bound into a list variable named <code><em></em></code><em> (two underscores). The result of
the last run is <code></code></em><code>[-1]</code>, the result of the second to last run is
<code>__[-2]</code> and so forth.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-Interrupt"><a class="anchor" href="#GroovyConsole-Interrupt"></a>Interrupting a script</h5>
<div class="paragraph">
<p>The Groovy console is a very handy tool to develop scripts. Often, you will
find yourself running a script multiple times until it works the way you want
it to. However, what if your code takes too long to finish or worse, creates
an infinite loop? Interrupting script execution can be achieved by clicking
the <code>interrupt</code> button on the small dialog box that pops up when a script
is executing or through the <code>interrupt</code> icon in the tool bar.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="Groovy-Language-Documentation_files/xgconsole-toolbar.jpg" alt="Toolbar" data-pagespeed-url-hash="1232801847" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"></span></p>
</div>
<div class="paragraph">
<p>However, this may not be sufficient to interrupt a script: clicking the button
will interrupt the execution thread, but if your code doesn’t handle the interrupt
flag, the script is likely to keep running without you being able to effectively
stop it. To avoid that, you have to make sure that the <code>Script &gt; Allow interruption</code>
menu item is flagged. This will automatically apply an AST transformation to your
script which will take care of checking the interrupt flag (<code>@ThreadInterrupt</code>).
This way, you guarantee that the script can be interrupted even if you don’t explicitly
handle interruption, at the cost of extra execution time.</p>
</div>
</div>
<div class="sect4">
<h5 id="GroovyConsole-Andmore"><a class="anchor" href="#GroovyConsole-Andmore"></a>And more</h5>
<div class="ulist">
<ul>
<li>
<p>You can change the font size by selecting <code>Smaller Font</code> or <code>Larger
Font</code> from the <code>Actions menu</code></p>
</li>
<li>
<p>The console can be run as an Applet thanks to <code>groovy.ui.ConsoleApplet</code></p>
</li>
<li>
<p>Code is auto indented when you hit return</p>
</li>
<li>
<p>You can drag’n’drop a Groovy script over the text area to open a file</p>
</li>
<li>
<p>You can modify the classpath with which the script in the console is
being run by adding a new JAR or a directory to the classpath from the
<code>Script</code> menu</p>
</li>
<li>
<p>Error hyperlinking from the output area when a compilation error is
expected or when an exception is thrown</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-EmbeddingtheConsole"><a class="anchor" href="#GroovyConsole-EmbeddingtheConsole"></a>2.4.4. Embedding the Console</h4>
<div class="paragraph">
<p>To embed a Swing console in your application, simply create the Console
object, load some variables, and then launch it. The console can be embedded in
either Java or Groovy code. The Java code for this is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">ui</span><span class="pun">.</span><span class="typ">Console</span><span class="pun">;</span><span class="pln">

    </span><span class="pun">...</span><span class="pln">
    </span><span class="typ">Console</span><span class="pln"> console </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Console</span><span class="pun">();</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">setVariable</span><span class="pun">(</span><span class="str">"var1"</span><span class="pun">,</span><span class="pln"> getValueOfVar1</span><span class="pun">());</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">setVariable</span><span class="pun">(</span><span class="str">"var2"</span><span class="pun">,</span><span class="pln"> getValueOfVar2</span><span class="pun">());</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">run</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the console is launched, you can use the variable values in Groovy
code.</p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-Visualizingscriptoutputresults"><a class="anchor" href="#GroovyConsole-Visualizingscriptoutputresults"></a>2.4.5. Visualizing script output results</h4>
<div class="paragraph">
<p>You can customize the way script output results are visualized. Let’s
see how we can customize this. For example, viewing a map result would
show something like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="Groovy-Language-Documentation_files/xgconsole-sc-without-visu.png" alt="image" data-pagespeed-url-hash="243942955" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"></span></p>
</div>
<div class="paragraph">
<p>What you see here is the usual textual representation of a Map. But,
what if we enabled custom visualization of certain results? The Swing
console allows you to do just that. First of all, you have to ensure
that the visualization option is ticked: <code>View → Visualize Script
Results</code> — for the record, all settings of the Groovy Console are stored
and remembered thanks to the Preference API. There are a few result
visualizations built-in: if the script returns a <code>java.awt.Image</code>, a
<code>javax.swing.Icon</code>, or a <code>java.awt.Component</code> with no parent, the object is
displayed instead of its <code>toString()</code> representation. Otherwise,
everything else is still just represented as text. Now, create the
following Groovy script in <code>~/.groovy/OutputTransforms.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.*</span><span class="pln">

transforms </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> result </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">result </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> table </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JTable</span><span class="pun">(</span><span class="pln">
            result</span><span class="pun">.</span><span class="pln">collect</span><span class="pun">{</span><span class="pln"> k</span><span class="pun">,</span><span class="pln"> v </span><span class="pun">-&gt;</span><span class="pln">
                </span><span class="pun">[</span><span class="pln">k</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">?.</span><span class="pln">inspect</span><span class="pun">()]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[][],</span><span class="pln">
            </span><span class="pun">[</span><span class="str">'Key'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Value'</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[])</span><span class="pln">
        table</span><span class="pun">.</span><span class="pln">preferredViewportSize </span><span class="pun">=</span><span class="pln"> table</span><span class="pun">.</span><span class="pln">preferredSize
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JScrollPane</span><span class="pun">(</span><span class="pln">table</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Groovy Swing console will execute that script on startup, injecting
a transforms list in the binding of the script, so that you can add your
own script results representations. In our case, we transform the Map
into a nice-looking Swing JTable. And we’re now able to visualize maps
in a friendly and attractive fashion, as the screenshot below shows:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="Groovy-Language-Documentation_files/xgconsole-sc-with-visu.png" alt="image" data-pagespeed-url-hash="1770717285" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="GroovyConsole-ASTbrowser"><a class="anchor" href="#GroovyConsole-ASTbrowser"></a>2.4.6. AST browser</h4>
<div class="paragraph">
<p>Groovy Console can visualize the AST (Abstract Syntax Tree) representing
the currently edited script, as shown by the screenshot below. This is
particularly handy when you want to develop AST transformations.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="Groovy-Language-Documentation_files/xastbrowser.png" alt="AST Browser" data-pagespeed-url-hash="4010465851" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovydoc_the_groovy_java_documentation_generator"><a class="anchor" href="#_groovydoc_the_groovy_java_documentation_generator"></a>2.5. groovydoc, the Groovy &amp; Java documentation generator</h3>
<div class="paragraph">
<p>GroovyDoc is a tool responsible for generating documentation from your code. It acts like the Javadoc tool in the
Java world but is capable of handling both <code>groovy</code> and <code>java</code> files. The distribution comes with two ways of generating
documentation: from <a href="#Groovydoc-CommandLine">command line</a> or from <a href="#Groovydoc-Ant">Apache Ant</a>. Other build tools
like Maven or Gradle also offer wrappers for Groovydoc.</p>
</div>
<div class="sect3">
<h4 id="Groovydoc-CommandLine"><a class="anchor" href="#Groovydoc-CommandLine"></a>2.5.1. The groovydoc command line tool</h4>
<div class="paragraph">
<p>The <code>groovydoc</code> command line can be invoked to generate groovydocs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovydoc [options] [packagenames] [sourcefiles]</pre>
</div>
</div>
<div class="paragraph">
<p>where options must be picked from the following table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 22%;">
<col style="width: 22%;">
<col style="width: 55%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short version</th>
<th class="tableblock halign-left valign-top">Long version</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-windowtitle &lt;text&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser window title for the documentation</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-author</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include @author paragraphs (currently not used)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-charset &lt;charset&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Charset for cross-platform viewing of generated documentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-classpath, -cp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify where to find the class files - must be
first argument</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--destdir &lt;dir&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination directory for output files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable debug output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-doctitle &lt;html&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include title for the overview page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-exclude &lt;pkglist&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify a list of packages to exclude
(separated by colons for all operating systems)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-fileEncoding &lt;charset&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Charset for generated documentation files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-footer &lt;html&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include footer text for each page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-header &lt;html&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include header text for each page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--help</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display help message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-nomainforscripts</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don’t include the implicit 'public static void
main' method for scripts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-noscripts</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don’t process Groovy Scripts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-notimestamp</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don’t include timestamp within hidden comment in generated HTML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-noversionstamp</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Don’t include Groovy version within hidden comment in generated HTML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-overview &lt;file&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read overview documentation from HTML file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-package</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show package/protected/public classes and members</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-private</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show all classes and members</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-protected</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show protected/public classes and members (default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-public</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show only public classes and members</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-quiet</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suppress superfluous output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-sourcepath &lt;pathlist&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify where to find source files (dirs
separated by platform path separator)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-stylesheetfile &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File to change style of the generated documentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-verbose</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable verbose output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">--version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display the version</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Groovydoc-Ant"><a class="anchor" href="#Groovydoc-Ant"></a>2.5.2. The groovydoc Ant task</h4>
<div class="paragraph">
<p>The <code>groovydoc</code> Ant task allows generating groovydocs from an Ant build.</p>
</div>
<div class="sect4">
<h5 id="ThegroovydocAnttask-Requiredtaskdef"><a class="anchor" href="#ThegroovydocAnttask-Requiredtaskdef"></a>Required taskdef</h5>
<div class="paragraph">
<p>Assuming <code>groovy-all-2.4.11.jar</code> is in <em>my.classpath</em> you will need to
declare this task at some point in the build.xml prior to the groovydoc
task being invoked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;taskdef</span><span class="pln"> </span><span class="atn">name</span><span class="pln">         </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"groovydoc"</span><span class="pln">
         </span><span class="atn">classname</span><span class="pln">    </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"org.codehaus.groovy.ant.Groovydoc"</span><span class="pln">
         </span><span class="atn">classpathref</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"my.classpath"</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="ThegroovydocAnttask-groovydocAttributes"><a class="anchor" href="#ThegroovydocAnttask-groovydocAttributes"></a>&lt;groovydoc&gt; Attributes</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">private</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show all classes and members (i.e. including private ones) if
set to ``true''.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destdir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location to store the class files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sourcepath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sourcepath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packagenames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of package files (with terminating
wildcard).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create class and package usage pages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">windowtitle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser window title for the documentation (text).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">doctitle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include title for the package index(first) page (html-code).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include header text for each page (html-code).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">footer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include footer text for each page (html-code).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overview</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read overview documentation from HTML file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="ThegroovydocAnttask-groovydocNestedElements"><a class="anchor" href="#ThegroovydocAnttask-groovydocNestedElements"></a>&lt;groovydoc&gt; Nested Elements</h5>
<div class="sect5">
<h6 id="ThegroovydocAnttask-link"><a class="anchor" href="#ThegroovydocAnttask-link"></a>link</h6>
<div class="paragraph">
<p>Create link to groovydoc/javadoc output at the given URL.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">href</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base URL of external site</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of package prefixes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="ThegroovydocAnttask-Example1-groovydocAnttask"><a class="anchor" href="#ThegroovydocAnttask-Example1-groovydocAnttask"></a>Example #1 - &lt;groovydoc&gt; Ant task</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;taskdef</span><span class="pln"> </span><span class="atn">name</span><span class="pln">           </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"groovydoc"</span><span class="pln">
         </span><span class="atn">classname</span><span class="pln">      </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"org.codehaus.groovy.ant.Groovydoc"</span><span class="pln">
         </span><span class="atn">classpathref</span><span class="pln">   </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"path_to_groovy_all"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;groovydoc</span><span class="pln"> </span><span class="atn">destdir</span><span class="pln">      </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"${docsDirectory}/gapi"</span><span class="pln">
           </span><span class="atn">sourcepath</span><span class="pln">   </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"${mainSourceDirectory}"</span><span class="pln">
           </span><span class="atn">packagenames</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"**.*"</span><span class="pln">
           </span><span class="atn">use</span><span class="pln">          </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"true"</span><span class="pln">
           </span><span class="atn">windowtitle</span><span class="pln">  </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"${title}"</span><span class="pln">
           </span><span class="atn">doctitle</span><span class="pln">     </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"${title}"</span><span class="pln">
           </span><span class="atn">header</span><span class="pln">       </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"${title}"</span><span class="pln">
           </span><span class="atn">footer</span><span class="pln">       </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"${docFooter}"</span><span class="pln">
           </span><span class="atn">overview</span><span class="pln">     </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"src/main/overview.html"</span><span class="pln">
           </span><span class="atn">private</span><span class="pln">      </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"false"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">packages</span><span class="pun">=</span><span class="atv">"java.,org.xml.,javax.,org.xml."</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"http://docs.oracle.com/javase/8/docs/api/"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">packages</span><span class="pun">=</span><span class="atv">"org.apache.tools.ant."</span><span class="pln">          </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"http://docs.groovy-lang.org/docs/ant/api/"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">packages</span><span class="pun">=</span><span class="atv">"org.junit.,junit.framework."</span><span class="pln">    </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"http://junit.org/junit4/javadoc/latest/"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">packages</span><span class="pun">=</span><span class="atv">"groovy.,org.codehaus.groovy."</span><span class="pln">   </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"http://docs.groovy-lang.org/latest/html/api/"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;link</span><span class="pln"> </span><span class="atn">packages</span><span class="pun">=</span><span class="atv">"org.codehaus.gmaven."</span><span class="pln">           </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"http://groovy.github.io/gmaven/apidocs/"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/groovydoc&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="ThegroovydocAnttask-Example2-ExecutinggroovydocfromGroovy"><a class="anchor" href="#ThegroovydocAnttask-Example2-ExecutinggroovydocfromGroovy"></a>Example #2 - Executing &lt;groovydoc&gt; from Groovy</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> ant </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AntBuilder</span><span class="pun">()</span><span class="pln">
ant</span><span class="pun">.</span><span class="pln">taskdef</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"groovydoc"</span><span class="pun">,</span><span class="pln"> classname</span><span class="pun">:</span><span class="pln"> </span><span class="str">"org.codehaus.groovy.ant.Groovydoc"</span><span class="pun">)</span><span class="pln">
ant</span><span class="pun">.</span><span class="pln">groovydoc</span><span class="pun">(</span><span class="pln">
    destdir      </span><span class="pun">:</span><span class="pln"> </span><span class="str">"${docsDirectory}/gapi"</span><span class="pun">,</span><span class="pln">
    sourcepath   </span><span class="pun">:</span><span class="pln"> </span><span class="str">"${mainSourceDirectory}"</span><span class="pun">,</span><span class="pln">
    packagenames </span><span class="pun">:</span><span class="pln"> </span><span class="str">"**.*"</span><span class="pun">,</span><span class="pln">
    </span><span class="kwd">use</span><span class="pln">          </span><span class="pun">:</span><span class="pln"> </span><span class="str">"true"</span><span class="pun">,</span><span class="pln">
    windowtitle  </span><span class="pun">:</span><span class="pln"> </span><span class="str">"${title}"</span><span class="pun">,</span><span class="pln">
    doctitle     </span><span class="pun">:</span><span class="pln"> </span><span class="str">"${title}"</span><span class="pun">,</span><span class="pln">
    header       </span><span class="pun">:</span><span class="pln"> </span><span class="str">"${title}"</span><span class="pun">,</span><span class="pln">
    footer       </span><span class="pun">:</span><span class="pln"> </span><span class="str">"${docFooter}"</span><span class="pun">,</span><span class="pln">
    overview     </span><span class="pun">:</span><span class="pln"> </span><span class="str">"src/main/overview.html"</span><span class="pun">,</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln">      </span><span class="pun">:</span><span class="pln"> </span><span class="str">"false"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        link</span><span class="pun">(</span><span class="pln">packages</span><span class="pun">:</span><span class="str">"java.,org.xml.,javax.,org.xml."</span><span class="pun">,</span><span class="pln">href</span><span class="pun">:</span><span class="str">"http://docs.oracle.com/javase/8/docs/api/"</span><span class="pun">)</span><span class="pln">
        link</span><span class="pun">(</span><span class="pln">packages</span><span class="pun">:</span><span class="str">"groovy.,org.codehaus.groovy."</span><span class="pun">,</span><span class="pln">  href</span><span class="pun">:</span><span class="str">"http://docs.groovy-lang.org/latest/html/api/"</span><span class="pun">)</span><span class="pln">
        link</span><span class="pun">(</span><span class="pln">packages</span><span class="pun">:</span><span class="str">"org.apache.tools.ant."</span><span class="pun">,</span><span class="pln">         href</span><span class="pun">:</span><span class="str">"http://docs.groovy-lang.org/docs/ant/api/"</span><span class="pun">)</span><span class="pln">
        link</span><span class="pun">(</span><span class="pln">packages</span><span class="pun">:</span><span class="str">"org.junit.,junit.framework."</span><span class="pun">,</span><span class="pln">   href</span><span class="pun">:</span><span class="str">"http://junit.org/junit4/javadoc/latest/"</span><span class="pun">)</span><span class="pln">
        link</span><span class="pun">(</span><span class="pln">packages</span><span class="pun">:</span><span class="str">"org.codehaus.gmaven."</span><span class="pun">,</span><span class="pln">          href</span><span class="pun">:</span><span class="str">"http://groovy.github.io/gmaven/apidocs/"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_custom_templates"><a class="anchor" href="#_custom_templates"></a>Custom templates</h5>
<div class="paragraph">
<p>The <code>groovydoc</code> Ant task supports custom templates, but it requires two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A custom groovydoc class</p>
</li>
<li>
<p>A new groovydoc task definition</p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="_custom_groovydoc_class"><a class="anchor" href="#_custom_groovydoc_class"></a>Custom Groovydoc class</h6>
<div class="paragraph">
<p>The first step requires you to extend the <code>Groovydoc</code> class, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">package</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">tools</span><span class="pun">.</span><span class="pln">groovydoc</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">ant</span><span class="pun">.</span><span class="typ">Groovydoc</span><span class="pun">;</span><span class="pln">

</span><span class="com">/**
 * Overrides GroovyDoc's default class template - for testing purpose only.
 *
 * @author Andre Steingress
 */</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CustomGroovyDoc</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Groovydoc</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> getClassTemplates</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]{</span><span class="str">"org/codehaus/groovy/tools/groovydoc/testfiles/classDocName.html"</span><span class="pun">};</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can override the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getClassTemplates</code> for class-level templates</p>
</li>
<li>
<p><code>getPackageTemplates</code> for package-level templates</p>
</li>
<li>
<p><code>getDocTemplates</code> for top-level templates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can find the list of default templates in the <code>org.codehaus.groovy.tools.groovydoc.gstringTemplates.GroovyDocTemplateInfo</code>
class.</p>
</div>
</div>
<div class="sect5">
<h6 id="_using_the_custom_groovydoc_task"><a class="anchor" href="#_using_the_custom_groovydoc_task"></a>Using the custom groovydoc task</h6>
<div class="paragraph">
<p>Once you’ve written the class, using it is just a matter of redefining the <code>groovydoc</code> task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;taskdef</span><span class="pln"> </span><span class="atn">name</span><span class="pln">           </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"groovydoc"</span><span class="pln">
         </span><span class="atn">classname</span><span class="pln">      </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"org.codehaus.groovy.ant.CustomGroovyDoc"</span><span class="pln">
         </span><span class="atn">classpathref</span><span class="pln">   </span><span class="pun">=</span><span class="pln"> </span><span class="atv">"path_to_groovy_all"</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that template customization is provided as is. APIs are subject to change, so you must consider this as a
fragile feature.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Groovydoc-GMavenPlus"><a class="anchor" href="#Groovydoc-GMavenPlus"></a>2.5.3. GMavenPlus Maven Plugin</h4>
<div class="paragraph">
<p><a href="https://github.com/groovy/GMavenPlus">GMavenPlus</a> is a Maven plugin with goals that
support GroovyDoc generation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ide_integration"><a class="anchor" href="#_ide_integration"></a>2.6. IDE integration</h3>
<div class="paragraph">
<p>The Groovy language is supported by lots of IDEs and text editors.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Editor</th>
<th class="tableblock halign-left valign-top">Support level</th>
<th class="tableblock halign-left valign-top">Syntax highlighting</th>
<th class="tableblock halign-left valign-top">Code completion</th>
<th class="tableblock halign-left valign-top">Refactoring</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.ultraedit.com/">UltraEdit</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/groovy/groovy-eclipse">Groovy Eclipse Plugin</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.jetbrains.com/idea/features/groovy.html">IntelliJ IDEA</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://netbeans.org/features/groovy/">Netbeans</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://spring.io/tools/ggts">Groovy and Grails Toolsuite</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/Groovy-Emacs-Modes/groovy-emacs-modes">Groovy Emacs Modes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/textmate/groovy.tmbundle">TextMate</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em> <em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://www.vim.org/">vim</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em class="icon-star"></em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_guides"><a class="anchor" href="#_user_guides"></a>3. User Guides</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_getting_started"><a class="anchor" href="#_getting_started"></a>3.1. Getting started</h3>
<div class="sect3">
<h4 id="_download"><a class="anchor" href="#_download"></a>3.1.1. Download</h4>
<div class="paragraph">
<p>In this download area, you will be able to download the distribution 
(binary and source), the Windows installer and the documentation for <strong>Groovy</strong>.</p>
</div>
<div class="paragraph">
<p>For a quick and effortless start on Mac OSX, Linux or Cygwin, you can use <a href="http://sdkman.io/">SDKMAN!</a> (The Software Development Kit Manager) to download and configure any <strong>Groovy</strong> version of your choice. Basic <a href="#SDKMAN">instructions</a> can be found below.</p>
</div>
<div class="sect4">
<h5 id="_stable"><a class="anchor" href="#_stable"></a>Stable</h5>
<div class="ulist">
<ul>
<li>
<p><strong>Download zip</strong>: <a href="https://bintray.com/artifact/download/groovy/maven/apache-groovy-binary-2.4.11.zip"><strong>Binary Release</strong></a> | <a href="https://bintray.com/artifact/download/groovy/maven/groovy-src-2.4.11.zip">Source Release</a></p>
</li>
<li>
<p><strong>Download documentation</strong>: <a href="https://bintray.com/artifact/download/groovy/maven/apache-groovy-docs-2.4.11.zip"><strong>JavaDoc and zipped online documentation</strong></a></p>
</li>
<li>
<p><strong>Combined binary / source / documentation bundle</strong>: <a href="https://bintray.com/artifact/download/groovy/maven/apache-groovy-sdk-2.4.11.zip"><strong>Distribution bundle</strong></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can learn more about this version in the <a href="http://groovy-lang.org/releasenotes/groovy-2.4.html">release notes</a> or in the <a href="http://groovy-lang.org/changelogs/changelog-2.4.11.html">changelog</a>.</p>
</div>
<div class="paragraph">
<p>If you plan on using invokedynamic support, <a href="http://docs.groovy-lang.org/latest/html/documentation/invokedynamic-support.html">read those notes</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_snapshots"><a class="anchor" href="#_snapshots"></a>Snapshots</h5>
<div class="paragraph">
<p>For those who want to test the very latest versions of Groovy and live on the bleeding edge, you can use our <a href="https://oss.jfrog.org/oss-snapshot-local/org/codehaus/groovy">snapshot builds</a>.
 As soon as a build succeeds on our continuous integration server a 
snapshot is deployed to Artifactory’s OSS snapshot repository.</p>
</div>
</div>
<div class="sect4">
<h5 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h5>
<div class="paragraph">
<p>Groovy 2.4 requires Java 6+ with full support up to Java 8.
There are currently some known issues for some aspects when using Java 9 snapshots.
The <code>groovy-nio</code> module requires Java 7+.
Using Groovy’s invokeDynamic features require Java 7+ but we recommend Java 8.</p>
</div>
<div class="paragraph">
<p>The Groovy CI server is also useful to look at to confirm supported Java versions for different Groovy releases.
The test suite (getting close to 10000 tests) runs for the currently supported streams of Groovy across
all the main versions of Java each stream supports.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven_repository"><a class="anchor" href="#_maven_repository"></a>3.1.2. Maven Repository</h4>
<div class="paragraph">
<p>If you wish to embed Groovy in your application, you may just prefer to point to your favourite maven repositories or the <a href="https://oss.jfrog.org/oss-release-local/org/codehaus/groovy">JCenter maven repository</a>.</p>
</div>
<div class="sect4">
<h5 id="_stable_release"><a class="anchor" href="#_stable_release"></a>Stable Release</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Gradle</th>
<th class="tableblock halign-left valign-top">Maven</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'org.codehaus.groovy:groovy:2.4.11'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
&lt;artifactId&gt;groovy&lt;/artifactId&gt;
&lt;version&gt;2.4.11&lt;/version&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Just the core of groovy without the modules (see below).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'org.codehaus.groovy:groovy-$module:2.4.11'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
&lt;artifactId&gt;groovy-$module&lt;/artifactId&gt;
&lt;version&gt;2.4.11&lt;/version&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"$module"
 stands for the different optional groovy modules "ant", "bsf", 
"console", "docgenerator", "groovydoc", "groovysh", "jmx", "json", 
"jsr223", "servlet", "sql", "swing", "test", "testng" and "xml". 
Example: &lt;artifactId&gt;groovy-sql&lt;/artifactId&gt;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">'org.codehaus.groovy:groovy-all:2.4.11'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
&lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
&lt;version&gt;2.4.11&lt;/version&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The 
core plus all the modules. Optional dependencies are marked as optional.
 You may need to include some of the optional dependencies to use some 
features of Groovy, e.g. AntBuilder, GroovyMBeans, etc.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To use the <a href="http://docs.groovy-lang.org/latest/html/documentation/invokedynamic-support.html">InvokeDynamic</a> version of the jars just append ':indy' for Gradle or &lt;classifier&gt;indy&lt;/classifier&gt; for Maven.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="SDKMAN"><a class="anchor" href="#SDKMAN"></a>3.1.3. SDKMAN! (The Software Development Kit Manager)</h4>
<div class="paragraph">
<p>This tool makes installing Groovy on any Bash platform (Mac OSX, Linux, Cygwin, Solaris or FreeBSD) very easy.</p>
</div>
<div class="paragraph">
<p>Simply open a new terminal and enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pln">$ curl </span><span class="pun">-</span><span class="pln">s </span><span class="kwd">get</span><span class="pun">.</span><span class="pln">sdkman</span><span class="pun">.</span><span class="pln">io </span><span class="pun">|</span><span class="pln"> bash</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Follow the instructions on-screen to complete installation.</p>
</div>
<div class="paragraph">
<p>Open a new terminal or type the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pln">$ source </span><span class="str">"$HOME/.sdkman/bin/sdkman-init.sh"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the latest stable Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pln">$ sdk install groovy</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After installation is complete and you’ve made it your default version, test it with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pln">$ groovy </span><span class="pun">-</span><span class="pln">version</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s all there is to it!</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_ways_to_get_groovy"><a class="anchor" href="#_other_ways_to_get_groovy"></a>3.1.4. Other ways to get Groovy</h4>
<div class="sect4">
<h5 id="_installation_on_mac_os_x"><a class="anchor" href="#_installation_on_mac_os_x"></a>Installation on Mac OS X</h5>
<div class="sect5">
<h6 id="_macports"><a class="anchor" href="#_macports"></a>MacPorts</h6>
<div class="paragraph">
<p>If you’re on MacOS and have <a href="http://www.macports.org/">MacPorts</a> installed, you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pln">sudo port install groovy</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_homebrew"><a class="anchor" href="#_homebrew"></a>Homebrew</h6>
<div class="paragraph">
<p>If you’re on MacOS and have <a href="http://mxcl.github.com/homebrew">Homebrew</a> installed, you can run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pln">brew install groovy</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_installation_on_windows"><a class="anchor" href="#_installation_on_windows"></a>Installation on Windows</h5>
<div class="paragraph">
<p>If you’re on Windows, you can also use the <a href="http://docs.groovy-lang.org/latest/html/documentation/TODO-Windows+NSIS-Installer">NSIS Windows installer</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_other_distributions"><a class="anchor" href="#_other_distributions"></a>Other Distributions</h5>
<div class="paragraph">
<p>You may download other distributions of Groovy from <a href="https://bintray.com/groovy/maven">this site</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_source_code"><a class="anchor" href="#_source_code"></a>Source Code</h5>
<div class="paragraph">
<p>If you prefer to live on the bleeding edge, you can also grab the <a href="https://github.com/apache/groovy">source code from GitHub</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ide_plugin"><a class="anchor" href="#_ide_plugin"></a>IDE plugin</h5>
<div class="paragraph">
<p>If you are an IDE user, you can just grab the latest <a href="http://docs.groovy-lang.org/latest/html/documentation/tools-ide.html">IDE plugin</a> and follow the plugin installation instructions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_binary"><a class="anchor" href="#_install_binary"></a>3.1.5. Install Binary</h4>
<div class="paragraph">
<p>These instructions describe how to install a binary distribution of <strong>Groovy</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, <a href="#download-groovy">Download</a> a binary distribution of Groovy and unpack it into some file on your local file system.</p>
</li>
<li>
<p>Set your <code>GROOVY_HOME</code> environment variable to the directory you unpacked the distribution.</p>
</li>
<li>
<p>Add <code>GROOVY_HOME/bin</code> to your <code>PATH</code> environment variable.</p>
</li>
<li>
<p>Set your <code>JAVA_HOME</code> environment variable to point to your JDK. On OS X this is <code>/Library/Java/Home</code>, on other unixes its often <code>/usr/java</code> etc. If you’ve already installed tools like Ant or Maven you’ve probably already done this step.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You should now have Groovy installed properly. You can test this by typing the following in a command shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pln">groovysh</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which should create an interactive groovy shell where you can type 
Groovy statements. Or to run the 
&lt;&lt;..\..\../subprojects/groovy-console/src/spec/doc/groovy-console.adoc,Swing
 interactive console&gt;&gt; type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pln">groovyConsole</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To run a specific Groovy script type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pln">groovy </span><span class="typ">SomeScript</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_differences_with_java"><a class="anchor" href="#_differences_with_java"></a>3.2. Differences with Java</h3>
<div class="paragraph">
<p>Groovy tries to be as natural as possible for Java developers. We’ve
tried to follow the principle of least surprise when designing Groovy,
particularly for developers learning Groovy who’ve come from a Java
background.</p>
</div>
<div class="paragraph">
<p>Here we list all the major differences between Java and Groovy.</p>
</div>
<div class="sect3">
<h4 id="_default_imports_2"><a class="anchor" href="#_default_imports_2"></a>3.2.1. Default imports</h4>
<div class="paragraph">
<p>All these packages and classes are imported by default, i.e. you do not
have to use an explicit <code>import</code> statement to use them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>java.io.*</p>
</li>
<li>
<p>java.lang.*</p>
</li>
<li>
<p>java.math.BigDecimal</p>
</li>
<li>
<p>java.math.BigInteger</p>
</li>
<li>
<p>java.net.*</p>
</li>
<li>
<p>java.util.*</p>
</li>
<li>
<p>groovy.lang.*</p>
</li>
<li>
<p>groovy.util.*</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_multi_methods"><a class="anchor" href="#_multi_methods"></a>3.2.2. Multi-methods</h4>
<div class="paragraph">
<p>In Groovy, the methods which will be invoked are chosen at runtime. This is called runtime dispatch or multi-methods. It
means that the method will be chosen based on the types of the arguments at runtime. In Java, this is the opposite: methods
are chosen at compile time, based on the declared types.</p>
</div>
<div class="paragraph">
<p>The following code, written as Java code, can be compiled in both Java and Groovy, but it will behave differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">int</span><span class="pln"> method</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> arg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> method</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> arg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">Object</span><span class="pln"> o </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Object"</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> method</span><span class="pun">(</span><span class="pln">o</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Java, you would have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">assertEquals</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> result</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whereas in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">assertEquals</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> result</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is because Java will use the static information type, which is that <code>o</code> is declared as an <code>Object</code>, whereas
Groovy will choose at runtime, when the method is actually called. Since it is called with a <code>String</code>, then the
<code>String</code> version is called.</p>
</div>
</div>
<div class="sect3">
<h4 id="_array_initializers"><a class="anchor" href="#_array_initializers"></a>3.2.3. Array initializers</h4>
<div class="paragraph">
<p>In Groovy, the <code>{ …​ }</code> block is reserved for closures. That means that you cannot create array literals with this
syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> array </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You actually have to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> array </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_package_scope_visibility"><a class="anchor" href="#_package_scope_visibility"></a>3.2.4. Package scope visibility</h4>
<div class="paragraph">
<p>In Groovy, omitting a modifier on a field doesn’t result in a package-private field like in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead, it is used to create a <em>property</em>, that is to say a <em>private field</em>, an associated <em>getter</em> and an associated
<em>setter</em>.</p>
</div>
<div class="paragraph">
<p>It is possible to create a package-private field by annotating it with <code>@PackageScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@PackageScope</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arm_blocks"><a class="anchor" href="#_arm_blocks"></a>3.2.5. ARM blocks</h4>
<div class="paragraph">
<p>ARM (Automatic Resource Management) block from Java 7 are not supported in Groovy. Instead, Groovy provides various
methods relying on closures, which have the same effect while being more idiomatic. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Path</span><span class="pln"> file </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Paths</span><span class="pun">.</span><span class="pln">get</span><span class="pun">(</span><span class="str">"/path/to/file"</span><span class="pun">);</span><span class="pln">
</span><span class="typ">Charset</span><span class="pln"> charset </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Charset</span><span class="pun">.</span><span class="pln">forName</span><span class="pun">(</span><span class="str">"UTF-8"</span><span class="pun">);</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">(</span><span class="typ">BufferedReader</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Files</span><span class="pun">.</span><span class="pln">newBufferedReader</span><span class="pun">(</span><span class="pln">file</span><span class="pun">,</span><span class="pln"> charset</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> line</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">((</span><span class="pln">line </span><span class="pun">=</span><span class="pln"> reader</span><span class="pun">.</span><span class="pln">readLine</span><span class="pun">())</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">System</span><span class="pun">.</span><span class="pln">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">line</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">IOException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    e</span><span class="pun">.</span><span class="pln">printStackTrace</span><span class="pun">();</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>can be written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="str">'/path/to/file'</span><span class="pun">).</span><span class="pln">eachLine</span><span class="pun">(</span><span class="str">'UTF-8'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   println it
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or, if you want a version closer to Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="str">'/path/to/file'</span><span class="pun">).</span><span class="pln">withReader</span><span class="pun">(</span><span class="str">'UTF-8'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> reader </span><span class="pun">-&gt;</span><span class="pln">
   reader</span><span class="pun">.</span><span class="pln">eachLine </span><span class="pun">{</span><span class="pln">
       println it
   </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inner_classes"><a class="anchor" href="#_inner_classes"></a>3.2.6. Inner classes</h4>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The implementation of anonymous inner classes and nested classes follows the Java lead, but
you should not take out the Java Language Spec and keep shaking the head
about things that are different. The implementation done looks much like
what we do for <code>groovy.lang.Closure</code>, with some benefits and some
differences. Accessing private fields and methods for example can become
a problem, but on the other hand local variables don’t have to be final.
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_static_inner_classes"><a class="anchor" href="#_static_inner_classes"></a>Static inner classes</h5>
<div class="paragraph">
<p>Here’s an example of static inner class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> A </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> B </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">new</span><span class="pln"> A</span><span class="pun">.</span><span class="pln">B</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The usage of static inner classes is the best supported one. If you
absolutely need an inner class, you should make it a static one.</p>
</div>
</div>
<div class="sect4">
<h5 id="_anonymous_inner_classes"><a class="anchor" href="#_anonymous_inner_classes"></a>Anonymous Inner Classes</h5>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">concurrent</span><span class="pun">.</span><span class="typ">CountDownLatch</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">concurrent</span><span class="pun">.</span><span class="typ">TimeUnit</span><span class="pln">

</span><span class="typ">CountDownLatch</span><span class="pln"> called </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CountDownLatch</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">

</span><span class="typ">Timer</span><span class="pln"> timer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Timer</span><span class="pun">()</span><span class="pln">
timer</span><span class="pun">.</span><span class="pln">schedule</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TimerTask</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        called</span><span class="pun">.</span><span class="pln">countDown</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">},</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> called</span><span class="pun">.</span><span class="pln">await</span><span class="pun">(</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TimeUnit</span><span class="pun">.</span><span class="pln">SECONDS</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_creating_instances_of_non_static_inner_classes"><a class="anchor" href="#_creating_instances_of_non_static_inner_classes"></a>Creating Instances of Non-Static Inner Classes</h5>
<div class="paragraph">
<p>In Java you can do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> Y </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> X </span><span class="pun">{}</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> X foo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> X</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> X createX</span><span class="pun">(</span><span class="pln">Y y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> y</span><span class="pun">.</span><span class="kwd">new</span><span class="pln"> X</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy doesn’t support the <code>y.new X()</code> syntax. Instead, you have to write <code>new X(y)</code>, like in the code below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> Y </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> X </span><span class="pun">{}</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> X foo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> X</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> X createX</span><span class="pun">(</span><span class="pln">Y y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> X</span><span class="pun">(</span><span class="pln">y</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Caution though, Groovy supports calling methods with one
parameter without giving an argument. The parameter will then have the
value null. Basically the same rules apply to calling a constructor.
There is a danger that you will write new X() instead of new X(this) for
example. Since this might also be the regular way we have not yet found
a good way to prevent this problem.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lambdas"><a class="anchor" href="#_lambdas"></a>3.2.7. Lambdas</h4>
<div class="paragraph">
<p>Java 8 supports lambdas and method references:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Runnable</span><span class="pln"> run </span><span class="pun">=</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="str">"Run"</span><span class="pun">);</span><span class="pln">
list</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">::</span><span class="pln">println</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Java 8 lambdas can be more or less considered as anonymous inner classes. Groovy doesn’t support that syntax, but has closures
instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Runnable</span><span class="pln"> run </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'run'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
list</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> println it </span><span class="pun">}</span><span class="pln"> </span><span class="com">// or list.each(this.&amp;println)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gstrings"><a class="anchor" href="#_gstrings"></a>3.2.8. GStrings</h4>
<div class="paragraph">
<p>As double-quoted string literals are interpreted as <code>GString</code> values, Groovy may fail
with compile error or produce subtly different code if a class with <code>String</code> literal
containing a dollar character is compiled with Groovy and Java compiler.</p>
</div>
<div class="paragraph">
<p>While typically, Groovy will auto-cast between <code>GString</code> and <code>String</code> if an API declares
the type of a parameter, beware of Java APIs that accept an <code>Object</code> parameter and then
check the actual type.</p>
</div>
</div>
<div class="sect3">
<h4 id="_string_and_character_literals"><a class="anchor" href="#_string_and_character_literals"></a>3.2.9. String and Character literals</h4>
<div class="paragraph">
<p>Singly-quoted literals in Groovy are used for <code>String</code>, and double-quoted result in
<code>String</code> or <code>GString</code>, depending whether there is interpolation in the literal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()==</span><span class="typ">String</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()==</span><span class="typ">String</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"c${1}"</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="typ">GString</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy will automatically cast a single-character <code>String</code> to <code>char</code> only when assigning to
a variable of type <code>char</code>. When calling methods with arguments of type <code>char</code> we need
to either cast explicitly or make sure the value has been cast in advance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">char</span><span class="pln"> a</span><span class="pun">=</span><span class="str">'a'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Character</span><span class="pun">.</span><span class="pln">digit</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> </span><span class="lit">16</span><span class="pun">)==</span><span class="lit">10</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'But Groovy does boxing'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Character</span><span class="pun">.</span><span class="pln">digit</span><span class="pun">((</span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">16</span><span class="pun">)==</span><span class="lit">10</span><span class="pln">

</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Character</span><span class="pun">.</span><span class="pln">digit</span><span class="pun">(</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">16</span><span class="pun">)==</span><span class="lit">10</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Need explicit cast'</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pun">(</span><span class="typ">MissingMethodException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy supports two styles of casting and in the case of casting to <code>char</code> there
are subtle differences when casting a multi-char strings. The Groovy style cast is
more lenient and will take the first character, while the C-style cast will fail
with exception.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// for single char strings, both are the same</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">((</span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">).</span><span class="kwd">class</span><span class="pun">==</span><span class="typ">Character</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="str">"c"</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">).</span><span class="kwd">class</span><span class="pun">==</span><span class="typ">Character</span><span class="pln">

</span><span class="com">// for multi char strings they are not</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">((</span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> </span><span class="str">'cx'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'c'</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">:</span><span class="pln"> </span><span class="str">'will fail - not castable'</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pun">(</span><span class="typ">GroovyCastException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="str">'cx'</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'c'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">'cx'</span><span class="pun">.</span><span class="pln">asType</span><span class="pun">(</span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'c'</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_primitives_and_wrappers"><a class="anchor" href="#_primitives_and_wrappers"></a>3.2.10. Primitives and wrappers</h4>
<div class="paragraph">
<p>Because Groovy uses Objects for everything, it <a href="http://docs.groovy-lang.org/latest/html/documentation/core-object-orientation.html#_primitive_types">autowraps</a> references
to primitives. Because of this, it does not follow Java’s behavior of widening taking priority over boxing.
Here’s an example using <code>int</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> i
m</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> m</span><span class="pun">(</span><span class="kwd">long</span><span class="pln"> l</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
  println </span><span class="str">"in m(long)"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> m</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
  println </span><span class="str">"in m(Integer)"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This is the method that Java would call, since widening has precedence over unboxing.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This is the method Groovy actually calls, since all primitive references use their wrapper class.</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect3">
<h4 id="_behaviour_of_code_code"><a class="anchor" href="#_behaviour_of_code_code"></a>3.2.11. Behaviour of <code>==</code></h4>
<div class="paragraph">
<p>In Java <code>==</code> means equality of primitive types or identity for objects.  In
Groovy <code>==</code> translates to <code>a.compareTo(b)==0</code>, if they are <code>Comparable</code>, and
<code>a.equals(b)</code> otherwise.  To check for identity, there is <code>is</code>.  E.g.
<code>a.is(b)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conversions"><a class="anchor" href="#_conversions"></a>3.2.12. Conversions</h4>
<div class="paragraph">
<p>Java does automatic widening and narrowing
<a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-5.html">conversions</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Java Conversions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-center valign-top" colspan="8"><div><div class="paragraph">
<p><strong>Converts to</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Converts from</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>boolean</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>byte</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>short</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>char</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>int</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>long</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>float</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>double</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>boolean</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>byte</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>short</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>char</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>int</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>long</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>float</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>double</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>C</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><sup>*</sup> 'Y' indicates a conversion Java can make, 'C' indicates a conversion Java can make when there is an explicit cast,
'T` indicates a conversion Java can make but data is truncated, 'N' indicates a conversion Java can’t make.</p>
</div>
<div class="paragraph">
<p>Groovy expands greatly on this.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Groovy Conversions</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
<col style="width: 5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"></td>
<td class="tableblock halign-center valign-top" colspan="18"><div><div class="paragraph">
<p><strong>Converts to</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Converts from</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>boolean</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>Boolean</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>byte</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>Byte</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>short</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>Short</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>char</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>Character</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>int</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>Integer</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>long</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>Long</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>BigInteger</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>float</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>Float</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>double</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>Double</strong></p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p><strong>BigDecimal</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>boolean</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Boolean</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>N</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>byte</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Byte</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>short</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Short</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>char</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Character</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>int</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Integer</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>long</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Long</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>BigInteger</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>float</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Float</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>double</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>Double</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>B</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>Y</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>BigDecimal</strong></p></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>T</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>D</p>
</div></div></td>
<td class="tableblock halign-center valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><sup>*</sup> 'Y' indicates a conversion Groovy can make, 'D' indicates a conversion Groovy can make when compiled dynamically or
explicitly cast, 'T` indicates a conversion Groovy can make but data is truncated, 'B' indicates a boxing/unboxing
operation, 'N' indicates a conversion Groovy can’t make.</p>
</div>
<div class="paragraph">
<p>The truncation uses <a href="#Groovy-Truth">Groovy Truth</a> when converting to <code>boolean</code>/<code>Boolean</code>. Converting
from a number to a character casts the <code>Number.intvalue()</code> to <code>char</code>. Groovy constructs <code>BigInteger</code> and <code>BigDecimal</code>
using <code>Number.doubleValue()</code> when converting from a <code>Float</code> or <code>Double</code>, otherwise it constructs using <code>toString()</code>.
Other conversions have their behavior defined by <code>java.lang.Number</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_extra_keywords"><a class="anchor" href="#_extra_keywords"></a>3.2.13. Extra keywords</h4>
<div class="paragraph">
<p>There are a few more keywords in Groovy than in Java.  Don’t use them for
variable names etc.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>as</code></p>
</li>
<li>
<p><code>def</code></p>
</li>
<li>
<p><code>in</code></p>
</li>
<li>
<p><code>trait</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_groovy_development_kit"><a class="anchor" href="#_groovy_development_kit"></a>3.3. Groovy Development Kit</h3>
<div class="sect3">
<h4 id="_working_with_io"><a class="anchor" href="#_working_with_io"></a>3.3.1. Working with IO</h4>
<div class="paragraph">
<p>Groovy provides a number of
<a href="http://docs.groovy-lang.org/latest/html/documentation/gdk.html">helper methods</a> for working
with I/O. While you could use standard Java code in Groovy to deal with those,
Groovy provides much more convenient ways to handle files, streams, readers, …​</p>
</div>
<div class="paragraph">
<p>In particular, you should take a look at methods added to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>java.io.File</code> class : <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/File.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/File.html</a></p>
</li>
<li>
<p>the <code>java.io.InputStream</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/InputStream.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/InputStream.html</a></p>
</li>
<li>
<p>the <code>java.io.OutputStream</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/OutputStream.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/OutputStream.html</a></p>
</li>
<li>
<p>the <code>java.io.Reader</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Reader.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Reader.html</a></p>
</li>
<li>
<p>the <code>java.io.Writer</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Writer.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/Writer.html</a></p>
</li>
<li>
<p>the <code>java.nio.file.Path</code> class: <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/nio/file/Path.html" class="bare">http://docs.groovy-lang.org/latest/html/groovy-jdk/java/nio/file/Path.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following section focuses on sample idiomatic constructs using helper methods available above but is not meant
to be a complete description of all available methods. For that, please read the <a href="http://docs.groovy-lang.org/latest/html/documentation/gdk.html">GDK API</a>.</p>
</div>
<div class="sect4">
<h5 id="_reading_files"><a class="anchor" href="#_reading_files"></a>Reading files</h5>
<div class="paragraph">
<p>As a first example, let’s see how you would print all lines of a text file in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'haiku.txt'</span><span class="pun">).</span><span class="pln">eachLine </span><span class="pun">{</span><span class="pln"> line </span><span class="pun">-&gt;</span><span class="pln">
    println line
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>eachLine</code> method is a method added to the <code>File</code> class automatically by Groovy and has many variants, for example
if you need to know the line number, you can use this variant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'haiku.txt'</span><span class="pun">).</span><span class="pln">eachLine </span><span class="pun">{</span><span class="pln"> line</span><span class="pun">,</span><span class="pln"> nb </span><span class="pun">-&gt;</span><span class="pln">
    println </span><span class="str">"Line $nb: $line"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If for whatever reason the an exception is thrown in the <code>eachLine</code> body, the method makes sure that the resource
is properly closed. This is true for all I/O resource methods that Groovy adds.</p>
</div>
<div class="paragraph">
<p>For example in some cases you will prefer to use a <code>Reader</code>, but still benefit from the automatic resource management
from Groovy. In the next example, the reader <strong>will</strong> be closed even if the exception occurs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> MAXSIZE </span><span class="pun">=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="str">"haiku.txt"</span><span class="pun">).</span><span class="pln">withReader </span><span class="pun">{</span><span class="pln"> reader </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">reader</span><span class="pun">.</span><span class="pln">readLine</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(++</span><span class="pln">count </span><span class="pun">&gt;</span><span class="pln"> MAXSIZE</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">(</span><span class="str">'Haiku should only have 3 verses'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Should you need to collect the lines of a text file into a list, you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'haiku.txt'</span><span class="pun">).</span><span class="pln">collect </span><span class="pun">{</span><span class="pln">it</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can even leverage the <code>as</code> operator to get the contents of the file into an array of lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> array </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'haiku.txt'</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>How many times did you have to get the contents of a file into a <code>byte[]</code> and how much code does it require? Groovy
makes it very easy actually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">byte</span><span class="pun">[]</span><span class="pln"> contents </span><span class="pun">=</span><span class="pln"> file</span><span class="pun">.</span><span class="pln">bytes</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Working with I/O is not limited to dealing with files. In fact, a lot of operations rely on input/output streams,
hence why Groovy adds a lot of support methods to those, as you can see in the
<a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/io/InputStream.html">documentation</a>.</p>
</div>
<div class="paragraph">
<p>As an example, you can obtain an <code>InputStream</code> from a <code>File</code> very easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="str">'haiku.txt'</span><span class="pun">).</span><span class="pln">newInputStream</span><span class="pun">()</span><span class="pln">
</span><span class="com">// do something ...</span><span class="pln">
</span><span class="kwd">is</span><span class="pun">.</span><span class="pln">close</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However you can see that it requires you to deal with closing the inputstream. In Groovy it is in general a better
idea to use the <code>withInputStream</code> idiom that will take care of that for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="str">'haiku.txt'</span><span class="pun">).</span><span class="pln">withInputStream </span><span class="pun">{</span><span class="pln"> stream </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="com">// do something ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_writing_files"><a class="anchor" href="#_writing_files"></a>Writing files</h5>
<div class="paragraph">
<p>Of course in some cases you won’t want to read but write a file. One of the options is to use a <code>Writer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="str">'haiku.txt'</span><span class="pun">).</span><span class="pln">withWriter</span><span class="pun">(</span><span class="str">'utf-8'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> writer </span><span class="pun">-&gt;</span><span class="pln">
    writer</span><span class="pun">.</span><span class="pln">writeLine </span><span class="str">'Into the ancient pond'</span><span class="pln">
    writer</span><span class="pun">.</span><span class="pln">writeLine </span><span class="str">'A frog jumps'</span><span class="pln">
    writer</span><span class="pun">.</span><span class="pln">writeLine </span><span class="str">'Water’s sound!'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But for such a simple example, using the <code>&lt;&lt;</code> operator would have been enough:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="str">'haiku.txt'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'''Into the ancient pond
A frog jumps
Water’s sound!'''</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course we do not always deal with text contents, so you could use the <code>Writer</code> or directly write bytes as in
this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">file</span><span class="pun">.</span><span class="pln">bytes </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">66</span><span class="pun">,</span><span class="lit">22</span><span class="pun">,</span><span class="lit">11</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can also directly deal with output streams. For example, here is how you would create an output
stream to write into a file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> os </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="str">'data.bin'</span><span class="pun">).</span><span class="pln">newOutputStream</span><span class="pun">()</span><span class="pln">
</span><span class="com">// do something ...</span><span class="pln">
os</span><span class="pun">.</span><span class="pln">close</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However you can see that it requires you to deal with closing the output stream. Again it is in general a better
idea to use the <code>withOutputStream</code> idiom that will handle the exceptions and close the stream in any case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">baseDir</span><span class="pun">,</span><span class="str">'data.bin'</span><span class="pun">).</span><span class="pln">withOutputStream </span><span class="pun">{</span><span class="pln"> stream </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="com">// do something ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_traversing_file_trees"><a class="anchor" href="#_traversing_file_trees"></a>Traversing file trees</h5>
<div class="paragraph">
<p>In scripting contexts it is a common task to traverse a file tree in order to find some specific files and do
something with them. Groovy provides multiple methods to do this. For example you can perform something on all files
of a directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">dir</span><span class="pun">.</span><span class="pln">eachFile </span><span class="pun">{</span><span class="pln"> file </span><span class="pun">-&gt;</span><span class="pln">                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    println file</span><span class="pun">.</span><span class="pln">name
</span><span class="pun">}</span><span class="pln">
dir</span><span class="pun">.</span><span class="pln">eachFileMatch</span><span class="pun">(~</span><span class="str">/.*\.txt/</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> file </span><span class="pun">-&gt;</span><span class="pln">     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    println file</span><span class="pun">.</span><span class="pln">name
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>executes the closure code on each file found in the directory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>executes the closure code on files in the directory matching the specified pattern</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Often you will have to deal with a deeper hierarchy of files, in which case you can use <code>eachFileRecurse</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">dir</span><span class="pun">.</span><span class="pln">eachFileRecurse </span><span class="pun">{</span><span class="pln"> file </span><span class="pun">-&gt;</span><span class="pln">                      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    println file</span><span class="pun">.</span><span class="pln">name
</span><span class="pun">}</span><span class="pln">

dir</span><span class="pun">.</span><span class="pln">eachFileRecurse</span><span class="pun">(</span><span class="typ">FileType</span><span class="pun">.</span><span class="pln">FILES</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> file </span><span class="pun">-&gt;</span><span class="pln">      </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    println file</span><span class="pun">.</span><span class="pln">name
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>executes the closure code on each file or directory found in the directory, recursively</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>executes the closure code only on files, but recursively</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For more complex traversal techniques you can use the <code>traverse</code> method, which requires you to set a special flag
indicating what to do with the traversal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">dir</span><span class="pun">.</span><span class="pln">traverse </span><span class="pun">{</span><span class="pln"> file </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">file</span><span class="pun">.</span><span class="pln">directory </span><span class="pun">&amp;&amp;</span><span class="pln"> file</span><span class="pun">.</span><span class="pln">name</span><span class="pun">==</span><span class="str">'bin'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">FileVisitResult</span><span class="pun">.</span><span class="pln">TERMINATE                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println file</span><span class="pun">.</span><span class="pln">name
        </span><span class="typ">FileVisitResult</span><span class="pun">.</span><span class="pln">CONTINUE                    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if the current file is a directory and its name is <code>bin</code>, stop the traversal</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>otherwise print the file name and continue</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_data_and_objects"><a class="anchor" href="#_data_and_objects"></a>Data and objects</h5>
<div class="paragraph">
<p>In Java it is not uncommon to serialize and deserialize data using the <code>java.io.DataOutputStream</code> and
<code>java.io.DataInputStream</code> classes respectively. Groovy will make it even easier to deal with them. For example, you could
serialize data into a file and deserialize it using this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">boolean</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> message </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Hello from Groovy'</span><span class="pln">
</span><span class="com">// Serialize data into a file</span><span class="pln">
file</span><span class="pun">.</span><span class="pln">withDataOutputStream </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">writeBoolean</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">writeUTF</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="com">// ...</span><span class="pln">
</span><span class="com">// Then read it back</span><span class="pln">
file</span><span class="pun">.</span><span class="pln">withDataInputStream </span><span class="pun">{</span><span class="pln"> input </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> input</span><span class="pun">.</span><span class="pln">readBoolean</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> b
    </span><span class="kwd">assert</span><span class="pln"> input</span><span class="pun">.</span><span class="pln">readUTF</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> message
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And similarily, if the data you want to serialize implements the <code>Serializable</code> interface, you can proceed with
an object output stream, as illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Person</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Bob'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="lit">76</span><span class="pun">)</span><span class="pln">
</span><span class="com">// Serialize data into a file</span><span class="pln">
file</span><span class="pun">.</span><span class="pln">withObjectOutputStream </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">writeObject</span><span class="pun">(</span><span class="pln">p</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="com">// ...</span><span class="pln">
</span><span class="com">// Then read it back</span><span class="pln">
file</span><span class="pun">.</span><span class="pln">withObjectInputStream </span><span class="pun">{</span><span class="pln"> input </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> input</span><span class="pun">.</span><span class="pln">readObject</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">name
    </span><span class="kwd">assert</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">age </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">age
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="process-management"><a class="anchor" href="#process-management"></a>Executing External Processes</h5>
<div class="paragraph">
<p>The previous section described how easy it was to deal with files, readers or streams in Groovy. However in domains
like system administration or devops it is often required to communicate with external processes.</p>
</div>
<div class="paragraph">
<p>Groovy provides a simple way to execute command line processes. Simply
write the command line as a string and call the <code>execute()</code> method.
E.g., on a *nix machine (or a windows machine with appropriate *nix
commands installed), you can execute this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> process </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ls -l"</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
println </span><span class="str">"Found text ${process.text}"</span><span class="pln">        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>executes the <code>ls</code> command in an external process</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>consume the output of the command and retrieve the text</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>execute()</code> method returns a <code>java.lang.Process</code> instance which will
subsequently allow the in/out/err streams to be processed and the exit
value from the process to be inspected etc.</p>
</div>
<div class="paragraph">
<p>e.g. here is the same command as above but we will now process the
resulting stream a line at a time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> process </span><span class="pun">=</span><span class="pln"> </span><span class="str">"ls -l"</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
process</span><span class="pun">.</span><span class="kwd">in</span><span class="pun">.</span><span class="pln">eachLine </span><span class="pun">{</span><span class="pln"> line </span><span class="pun">-&gt;</span><span class="pln">               </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    println line                            </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>executes the <code>ls</code> command in an external process</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>for each line of the input stream of the process</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>print the line</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is worth noting that <code>in</code> corresponds to an input stream to the standard output of the command. <code>out</code> will refer
to a stream where you can send data to the process (its standard input).</p>
</div>
<div class="paragraph">
<p>Remember that many commands are shell built-ins and need special
handling. So if you want a listing of files in a directory on a Windows
machine and write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> process </span><span class="pun">=</span><span class="pln"> </span><span class="str">"dir"</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">
println </span><span class="str">"${process.text}"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>you will receive an <code>IOException</code> saying&nbsp; <em>Cannot run program "dir":
CreateProcess error=2, The system cannot find the file specified.</em></p>
</div>
<div class="paragraph">
<p>This is because <code>dir</code> is built-in to the Windows shell (<code>cmd.exe</code>) and
can’t be run as a simple executable. Instead, you will need to write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> process </span><span class="pun">=</span><span class="pln"> </span><span class="str">"cmd /c dir"</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">
println </span><span class="str">"${process.text}"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, because this functionality currently makes use of
<code>java.lang.Process</code> undercover, the deficiencies of that class
must be taken into consideration. In particular, the javadoc
for this class says:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Because some native platforms only provide limited buffer size for
standard input and output streams, failure to promptly write the input
stream or read the output stream of the subprocess may cause the
subprocess to block, and even deadlock</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Because of this, Groovy provides some additional helper methods which
make stream handling for processes easier.</p>
</div>
<div class="paragraph">
<p>Here is how to gobble all of the output (including the error stream
output) from your process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="str">"rm -f foo.tmp"</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">([],</span><span class="pln"> tmpDir</span><span class="pun">)</span><span class="pln">
p</span><span class="pun">.</span><span class="pln">consumeProcessOutput</span><span class="pun">()</span><span class="pln">
p</span><span class="pun">.</span><span class="pln">waitFor</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are also variations of <code>consumeProcessOutput</code> that make use of <code>StringBuffer</code>, <code>InputStream</code>,
<code>OutputStream</code> etc…​ For a complete list, please read the
<a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/lang/Process.html">GDK API for java.lang.Process</a></p>
</div>
<div class="paragraph">
<p>In addition, these is a <code>pipeTo</code> command (mapped to <code>|</code>
to allow overloading) which lets the output stream of one process be fed
into the input stream of another process.</p>
</div>
<div class="paragraph">
<p>Here are some examples of use:</p>
</div>
<div class="listingblock">
<div class="title">Pipes in action</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">proc1 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'ls'</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">
proc2 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tr -d o'</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">
proc3 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tr -d e'</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">
proc4 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tr -d i'</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">
proc1 </span><span class="pun">|</span><span class="pln"> proc2 </span><span class="pun">|</span><span class="pln"> proc3 </span><span class="pun">|</span><span class="pln"> proc4
proc4</span><span class="pun">.</span><span class="pln">waitFor</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">proc4</span><span class="pun">.</span><span class="pln">exitValue</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println proc4</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">text
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println proc4</span><span class="pun">.</span><span class="pln">text
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Consuming errors</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> sout </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuilder</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> serr </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuilder</span><span class="pun">()</span><span class="pln">
proc2 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tr -d o'</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">
proc3 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tr -d e'</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">
proc4 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tr -d i'</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">()</span><span class="pln">
proc4</span><span class="pun">.</span><span class="pln">consumeProcessOutput</span><span class="pun">(</span><span class="pln">sout</span><span class="pun">,</span><span class="pln"> serr</span><span class="pun">)</span><span class="pln">
proc2 </span><span class="pun">|</span><span class="pln"> proc3 </span><span class="pun">|</span><span class="pln"> proc4
</span><span class="pun">[</span><span class="pln">proc2</span><span class="pun">,</span><span class="pln"> proc3</span><span class="pun">].</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">consumeProcessErrorStream</span><span class="pun">(</span><span class="pln">serr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
proc2</span><span class="pun">.</span><span class="pln">withWriter </span><span class="pun">{</span><span class="pln"> writer </span><span class="pun">-&gt;</span><span class="pln">
    writer </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'testfile.groovy'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
proc4</span><span class="pun">.</span><span class="pln">waitForOrKill</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">)</span><span class="pln">
println </span><span class="str">"Standard output: $sout"</span><span class="pln">
println </span><span class="str">"Standard error: $serr"</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_collections"><a class="anchor" href="#_working_with_collections"></a>3.3.2. Working with collections</h4>
<div class="paragraph">
<p>Groovy provides native support for various collection types, including <a href="#Collections-Lists">lists</a>,
<a href="#Collections-Maps">maps</a> or <a href="#Collections-Ranges">ranges</a>. Most of those are based on the Java
collection types and decorated with additional methods found in the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a>.</p>
</div>
<div class="sect4">
<h5 id="Collections-Lists"><a class="anchor" href="#Collections-Lists"></a>Lists</h5>
<div class="sect5">
<h6 id="_list_literals"><a class="anchor" href="#_list_literals"></a>List literals</h6>
<div class="paragraph">
<p>You can create lists as follows. Notice that <code>[]</code> is the empty list
expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">List</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> emptyList </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> emptyList</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
emptyList</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> emptyList</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each list expression creates an implementation of <a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html">java.util.List</a>.</p>
</div>
<div class="paragraph">
<p>Of course lists can be used as a source to construct another list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list1 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">]</span><span class="pln">
</span><span class="com">//construct a new list, seeded with the same items as in list1</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> list2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;(</span><span class="pln">list1</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> list2 </span><span class="pun">==</span><span class="pln"> list1 </span><span class="com">// == checks that each corresponding element is the same</span><span class="pln">

</span><span class="com">// clone() can also be called</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> list3 </span><span class="pun">=</span><span class="pln"> list1</span><span class="pun">.</span><span class="pln">clone</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list3 </span><span class="pun">==</span><span class="pln"> list1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A list is an ordered collection of objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pln">     </span><span class="com">// the specific kind of list being used</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">                     </span><span class="com">// indexing starts at 0</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">getAt</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">               </span><span class="com">// equivalent method to subscript operator []</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">                 </span><span class="com">// alternative method</span><span class="pln">

list</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">9</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">,]</span><span class="pln">           </span><span class="com">// trailing comma OK</span><span class="pln">

list</span><span class="pun">.</span><span class="pln">putAt</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">)</span><span class="pln">                       </span><span class="com">// equivalent method to [] when value being changed</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">11</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span><span class="pln">            </span><span class="com">// alternative method that returns old value</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2.5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2.5f</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2.5d</span><span class="pun">,</span><span class="pln"> </span><span class="str">'hello'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7g</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">byte</span><span class="pun">]</span><span class="pln">
</span><span class="com">//objects can be of different types; duplicates allowed</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">][-</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span><span class="pln">             </span><span class="com">// use negative indices to count from the end</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">][-</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">].</span><span class="pln">getAt</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">       </span><span class="com">// getAt() available with negative index...</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">].</span><span class="kwd">get</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">)</span><span class="pln">                 </span><span class="com">// but negative index not allowed with get()</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> e </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ArrayIndexOutOfBoundsException</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_list_as_a_boolean_expression"><a class="anchor" href="#_list_as_a_boolean_expression"></a>List as a boolean expression</h6>
<div class="paragraph">
<p>Lists can be evaluated as a <code>boolean</code> value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">![]</span><span class="pln">             </span><span class="com">// an empty list evaluates as false</span><span class="pln">

</span><span class="com">//all other lists, irrespective of contents, evaluate as true</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0.0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">false</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">null</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_iterating_on_a_list"><a class="anchor" href="#_iterating_on_a_list"></a>Iterating on a list</h6>
<div class="paragraph">
<p>Iterating on elements of a list is usually done calling the <code>each</code> and <code>eachWithIndex</code> methods, which execute code on each
item of a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">each </span><span class="pun">{</span><span class="pln">
    println </span><span class="str">"Item: $it"</span><span class="pln"> </span><span class="com">// `it` is an implicit parameter corresponding to the current element</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">].</span><span class="pln">eachWithIndex </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="com">// `it` is the current element, while `i` is the index</span><span class="pln">
    println </span><span class="str">"$i: $it"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to iterating, it is often useful to create a new list by transforming each of its elements into
something else. This operation, often called mapping, is done in Groovy thanks to the <code>collect</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">collect </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]</span><span class="pln">

</span><span class="com">// shortcut syntax instead of collect</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]*.</span><span class="pln">multiply</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">collect </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">multiply</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
</span><span class="com">// it is possible to give `collect` the list which collects the elements</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">collect</span><span class="pun">(</span><span class="pln">list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_manipulating_lists"><a class="anchor" href="#_manipulating_lists"></a>Manipulating lists</h6>
<div class="sect6">
<h7 id="List-Filtering"><a class="anchor" href="#List-Filtering"></a>Filtering and searching</h7>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> contains a lot of methods on collections that enhance
the standard collections with pragmatic methods, some of which are illustrated here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">           </span><span class="com">// find 1st element matching criteria</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">findAll </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">   </span><span class="com">// find all elements matching critieria</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'e'</span><span class="pun">].</span><span class="pln">findIndexOf </span><span class="pun">{</span><span class="pln">      </span><span class="com">// find index of 1st element matching criteria</span><span class="pln">
    it </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'e'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'g'</span><span class="pun">]</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">].</span><span class="pln">indexOf</span><span class="pun">(</span><span class="str">'c'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">  </span><span class="com">// index returned</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">].</span><span class="pln">indexOf</span><span class="pun">(</span><span class="str">'z'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="com">// index -1 means value not in list</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">].</span><span class="pln">lastIndexOf</span><span class="pun">(</span><span class="str">'c'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">every </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">}</span><span class="pln">               </span><span class="com">// returns true if all elements match the predicate</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">![</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">every </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">any </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">}</span><span class="pln">                 </span><span class="com">// returns true if any element matches the predicate</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">![</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">any </span><span class="pun">{</span><span class="pln"> it </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">].</span><span class="pln">sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">21</span><span class="pln">                </span><span class="com">// sum anything with a plus() method</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'e'</span><span class="pun">].</span><span class="pln">sum </span><span class="pun">{</span><span class="pln">
    it </span><span class="pun">==</span><span class="pln"> </span><span class="str">'a'</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> it </span><span class="pun">==</span><span class="pln"> </span><span class="str">'b'</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> it </span><span class="pun">==</span><span class="pln"> </span><span class="str">'c'</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> it </span><span class="pun">==</span><span class="pln"> </span><span class="str">'d'</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> it </span><span class="pun">==</span><span class="pln"> </span><span class="str">'e'</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">5</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="com">// custom value to use in sum</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">15</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'e'</span><span class="pun">].</span><span class="pln">sum </span><span class="pun">{</span><span class="pln"> </span><span class="pun">((</span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">((</span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'e'</span><span class="pun">].</span><span class="pln">sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'abcde'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">]].</span><span class="pln">sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">]</span><span class="pln">

</span><span class="com">// an initial value can be provided</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[].</span><span class="pln">sum</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1000</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">sum</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1006</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">join</span><span class="pun">(</span><span class="str">'-'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1-2-3'</span><span class="pln">           </span><span class="com">// String joining</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">inject</span><span class="pun">(</span><span class="str">'counting: '</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    str</span><span class="pun">,</span><span class="pln"> item </span><span class="pun">-&gt;</span><span class="pln"> str </span><span class="pun">+</span><span class="pln"> item                     </span><span class="com">// reduce operation</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'counting: 123'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">inject</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> count</span><span class="pun">,</span><span class="pln"> item </span><span class="pun">-&gt;</span><span class="pln">
    count </span><span class="pun">+</span><span class="pln"> item
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">6</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is idiomatic Groovy code for finding the maximum and minimum in a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">max</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">min</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">

</span><span class="com">// we can also compare single characters, as anything comparable</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'x'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'y'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">].</span><span class="pln">min</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'a'</span><span class="pln">

</span><span class="com">// we can use a closure to specify the sorting behaviour</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> list2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'abc'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'xyzuvw'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Hello'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'321'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list2</span><span class="pun">.</span><span class="pln">max </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'xyzuvw'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list2</span><span class="pun">.</span><span class="pln">min </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'z'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to closures, you can use a <code>Comparator</code> to define the comparison criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Comparator</span><span class="pln"> mc </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> b </span><span class="pun">?</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">(</span><span class="pln">a </span><span class="pun">&lt;</span><span class="pln"> b </span><span class="pun">?</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">13</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(</span><span class="pln">mc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">11</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">min</span><span class="pun">(</span><span class="pln">mc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">13</span><span class="pln">

</span><span class="typ">Comparator</span><span class="pln"> mc2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> b </span><span class="pun">?</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">b</span><span class="pun">))</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">


</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">max</span><span class="pun">(</span><span class="pln">mc2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">13</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">min</span><span class="pun">(</span><span class="pln">mc2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">max </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">13</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">min </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln"> a</span><span class="pun">.</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_adding_or_removing_elements"><a class="anchor" href="#_adding_or_removing_elements"></a>Adding or removing elements</h7>
<div class="paragraph">
<p>We can use <code>[]</code> to assign a new empty list and <code>&lt;&lt;</code> to append items to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">empty

list </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">5</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

list </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">'i'</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">11</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="str">'i'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">11</span><span class="pun">]</span><span class="pln">

list </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">[</span><span class="str">'m'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'o'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="str">'i'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="str">'m'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'o'</span><span class="pun">]]</span><span class="pln">

</span><span class="com">//first item in chain of &lt;&lt; is target list</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">([</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">6</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">],</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]</span><span class="pln">

</span><span class="com">//using leftShift is equivalent to using &lt;&lt;</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">([</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">([</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">leftShift</span><span class="pun">(</span><span class="lit">4</span><span class="pun">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can add to a list in many ways:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">6</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]</span><span class="pln">
</span><span class="com">// equivalent to calling the `plus` method</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">].</span><span class="pln">plus</span><span class="pun">(</span><span class="lit">3</span><span class="pun">).</span><span class="pln">plus</span><span class="pun">([</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]).</span><span class="pln">plus</span><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">
a </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">4</span><span class="pln">      </span><span class="com">// creates a new list and assigns it to `a`</span><span class="pln">
a </span><span class="pun">+=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">*[</span><span class="lit">222</span><span class="pun">,</span><span class="pln"> </span><span class="lit">333</span><span class="pun">],</span><span class="pln"> </span><span class="lit">456</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">222</span><span class="pun">,</span><span class="pln"> </span><span class="lit">333</span><span class="pun">,</span><span class="pln"> </span><span class="lit">456</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[*[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">],</span><span class="pln"> </span><span class="lit">6</span><span class="pun">],</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">]].</span><span class="pln">flatten</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln">
list</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln">
list</span><span class="pun">.</span><span class="pln">addAll</span><span class="pun">([</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">]</span><span class="pln">

list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln">
list</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="com">// add 3 just before index 1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln">

list</span><span class="pun">.</span><span class="pln">addAll</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">])</span><span class="pln"> </span><span class="com">//add [5,4] just before index 2</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln">

list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'e'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'u'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'v'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'g'</span><span class="pun">]</span><span class="pln">
list</span><span class="pun">[</span><span class="lit">8</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'x'</span><span class="pln"> </span><span class="com">// the [] operator is growing the list as needed</span><span class="pln">
</span><span class="com">// nulls inserted if required</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'e'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'u'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'v'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'g'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="str">'x'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is however important that the <code>+</code> operator on a list is <strong>not mutating</strong>. Compared to <code>&lt;&lt;</code>, it will create a new
list, which is often not what you want and can lead to performance issues.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> also contains methods allowing you to easily remove elements from a list by value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="str">'c'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="str">'b'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">[</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
list </span><span class="pun">-=</span><span class="pln"> </span><span class="lit">3</span><span class="pln">           </span><span class="com">// creates a new list by removing `3` from the original one</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> list </span><span class="pun">-=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="lit">4</span><span class="pun">]</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to remove an element by passing its index to the <code>remove</code> method, in which case the list is mutated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'d'</span><span class="pun">,</span><span class="str">'e'</span><span class="pun">,</span><span class="str">'f'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'a'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'c'</span><span class="pln">        </span><span class="com">// remove the third element, and return it</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'d'</span><span class="pun">,</span><span class="str">'e'</span><span class="pun">,</span><span class="str">'f'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'a'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you only want to remove the first element having the same value in a list, instead of removing all
elements, you can call the <code>remove</code> method passing the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list</span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'c'</span><span class="pun">)</span><span class="pln">             </span><span class="com">// remove 'c', and return true because element removed</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'b'</span><span class="pun">)</span><span class="pln">             </span><span class="com">// remove first 'b', and return true because element removed</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="str">'z'</span><span class="pun">)</span><span class="pln">           </span><span class="com">// return false because no elements removed</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, there are two <code>remove</code> methods available.  One that takes an integer and removes an element
by its index, and another that will remove the first element that matches the passed value.  So what should we
do when we have a list of integers?  In this case, you may wish to use <code>removeAt</code> to remove an element by its
index, and <code>removeElement</code> to remove the first element that matches a value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">          </span><span class="com">// this removes the element at index 2, and returns it</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">removeElement</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln">        </span><span class="com">// remove first 2 and return true</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">removeElement</span><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span><span class="pln">      </span><span class="com">// return false because 8 is not in the list</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">1</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">removeAt</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">        </span><span class="com">// remove element at index 1, and return it</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">5</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, <code>removeAt</code> and <code>removeElement</code> will work with lists of any type.</p>
</div>
<div class="paragraph">
<p>Additionally, removing all the elements in a list can be done by calling the <code>clear</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list</span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="lit">4</span><span class="pun">]</span><span class="pln">
list</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[]</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_set_operations"><a class="anchor" href="#_set_operations"></a>Set operations</h7>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> also includes methods making it easy to reason on sets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="str">'a'</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">]</span><span class="pln">             </span><span class="com">// returns true if an element belongs to the list</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">].</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'a'</span><span class="pun">)</span><span class="pln">      </span><span class="com">// equivalent to the `contains` method in Java</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">].</span><span class="pln">containsAll</span><span class="pun">([</span><span class="lit">1</span><span class="pun">,</span><span class="lit">4</span><span class="pun">])</span><span class="pln">       </span><span class="com">// `containsAll` will check that all elements are found</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">].</span><span class="pln">count</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">  </span><span class="com">// count the number of elements which have some value</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">].</span><span class="pln">count </span><span class="pun">{</span><span class="pln">
    it</span><span class="pun">%</span><span class="lit">2</span><span class="pun">==</span><span class="lit">0</span><span class="pln">                             </span><span class="com">// count the number of elements which match the predicate</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">8</span><span class="pun">,</span><span class="lit">10</span><span class="pun">,</span><span class="lit">12</span><span class="pun">].</span><span class="pln">intersect</span><span class="pun">([</span><span class="lit">1</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">9</span><span class="pun">,</span><span class="lit">12</span><span class="pun">])</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">12</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">].</span><span class="pln">disjoint</span><span class="pun">(</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="lit">6</span><span class="pun">,</span><span class="lit">9</span><span class="pun">]</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">![</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">].</span><span class="pln">disjoint</span><span class="pun">(</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">6</span><span class="pun">]</span><span class="pln"> </span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_sorting"><a class="anchor" href="#_sorting"></a>Sorting</h7>
<div class="paragraph">
<p>Working with collections often implies sorting. Groovy offers a variety of options to sort lists,
from using closures to comparators, as in the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">].</span><span class="pln">sort</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'abc'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'xyzuvw'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Hello'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'321'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">sort </span><span class="pun">{</span><span class="pln">
    it</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'z'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'abc'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'321'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Hello'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'xyzuvw'</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list2 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">13</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list2</span><span class="pun">.</span><span class="pln">sort </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> b </span><span class="pun">?</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln">
        </span><span class="pun">[-</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">13</span><span class="pun">]</span><span class="pln">

</span><span class="typ">Comparator</span><span class="pln"> mc </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> b </span><span class="pun">-&gt;</span><span class="pln"> a </span><span class="pun">==</span><span class="pln"> b </span><span class="pun">?</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="pln">b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="com">// JDK 8+ only</span><span class="pln">
</span><span class="com">// list2.sort(mc)</span><span class="pln">
</span><span class="com">// assert list2 == [-1, 2, 3, 4, 5, -6, 7, -9, 11, -13]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list3 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]</span><span class="pln">

</span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">(</span><span class="pln">list3</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list3 </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[-</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">]</span><span class="pln">

</span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">(</span><span class="pln">list3</span><span class="pun">,</span><span class="pln"> mc</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list3 </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_duplicating_elements"><a class="anchor" href="#_duplicating_elements"></a>Duplicating elements</h7>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> also takes advantage of operator overloading to provide methods allowing duplication of elements
of a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">].</span><span class="pln">multiply</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">nCopies</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">]</span><span class="pln">

</span><span class="com">// nCopies from the JDK has different semantics than multiply for lists</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">nCopies</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">])</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]]</span><span class="pln"> </span><span class="com">//not [1,2,1,2]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Collections-Maps"><a class="anchor" href="#Collections-Maps"></a>Maps</h5>
<div class="sect5">
<h6 id="_map_literals"><a class="anchor" href="#_map_literals"></a>Map literals</h6>
<div class="paragraph">
<p>In Groovy, maps (also known as associative arrays) can be created using the map literal syntax: <code>[:]</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Gromit'</span><span class="pun">,</span><span class="pln"> likes</span><span class="pun">:</span><span class="pln"> </span><span class="str">'cheese'</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1234</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'name'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Gromit'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'id'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1234</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">[</span><span class="str">'name'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Gromit'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">[</span><span class="str">'id'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1234</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Map</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> emptyMap </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> emptyMap</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
emptyMap</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"foo"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> emptyMap</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> emptyMap</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">"foo"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Map keys are strings by default: <code>[a:1]</code> is equivalent to <code>['a':1]</code>. This can be confusing if you define a variable
named <code>a</code> and that you want the <strong>value</strong> of <code>a</code> to be the key in your map. If this is the case, then you <strong>must</strong> escape
the key by adding parenthesis, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> ages </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="lit">43</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> ages</span><span class="pun">[</span><span class="str">'Bob'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="com">// `Bob` is not found</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> ages</span><span class="pun">[</span><span class="str">'a'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">43</span><span class="pln">     </span><span class="com">// because `a` is a literal!</span><span class="pln">

ages </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[(</span><span class="pln">a</span><span class="pun">):</span><span class="pln"> </span><span class="lit">43</span><span class="pun">]</span><span class="pln">            </span><span class="com">// now we escape `a` by using parenthesis</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> ages</span><span class="pun">[</span><span class="str">'Bob'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">43</span><span class="pln">   </span><span class="com">// and the value is found!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to map literals, it is possible, to get a new copy of a map, to clone it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
        simple </span><span class="pun">:</span><span class="pln"> </span><span class="lit">123</span><span class="pun">,</span><span class="pln">
        complex</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">a</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> map2 </span><span class="pun">=</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">clone</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map2</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'simple'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'simple'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map2</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'complex'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'complex'</span><span class="pun">)</span><span class="pln">
map2</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'complex'</span><span class="pun">).</span><span class="pln">put</span><span class="pun">(</span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'complex'</span><span class="pun">).</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'c'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting map is a <strong>shallow</strong> copy of the original one, as illustrated in the previous example.</p>
</div>
</div>
<div class="sect5">
<h6 id="_map_property_notation"><a class="anchor" href="#_map_property_notation"></a>Map property notation</h6>
<div class="paragraph">
<p>Maps also act like beans so you can use the property notation to get/set
items inside the <code>Map</code> as long as the keys are strings which are valid
Groovy identifiers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Gromit'</span><span class="pun">,</span><span class="pln"> likes</span><span class="pun">:</span><span class="pln"> </span><span class="str">'cheese'</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1234</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Gromit'</span><span class="pln">     </span><span class="com">// can be used instead of map.get('name')</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">id </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1234</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> emptyMap </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> emptyMap</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
emptyMap</span><span class="pun">.</span><span class="pln">foo </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> emptyMap</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> emptyMap</span><span class="pun">.</span><span class="pln">foo </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: by design <code>map.foo</code> will always look for the key <code>foo</code> in the map. This
means <code>foo.class</code> will return <code>null</code> on a map that doesn’t contain the <code>class</code> key. Should you really want to know
the class, then you must use <code>getClass()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Gromit'</span><span class="pun">,</span><span class="pln"> likes</span><span class="pun">:</span><span class="pln"> </span><span class="str">'cheese'</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1234</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'class'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">getClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">LinkedHashMap</span><span class="pln"> </span><span class="com">// this is probably what you want</span><span class="pln">

map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pln">      </span><span class="pun">:</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">,</span><span class="pln">
       </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'p'</span><span class="pun">,</span><span class="pln">
       </span><span class="pun">(</span><span class="kwd">false</span><span class="pun">):</span><span class="pln"> </span><span class="str">'q'</span><span class="pun">,</span><span class="pln">
       </span><span class="pun">(</span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'x'</span><span class="pun">,</span><span class="pln">
       </span><span class="str">'null'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="com">// 1 is not an identifier so used as is</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">true</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">false</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'p'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'q'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">null</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'z'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'x'</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_iterating_on_maps"><a class="anchor" href="#_iterating_on_maps"></a>Iterating on maps</h6>
<div class="paragraph">
<p>As usual in the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a>, idiomatic iteration on maps makes use of the <code>each</code> and <code>eachWithIndex</code> methods.
It’s worth noting that maps created using the map literal notation are <strong>ordered</strong>, that is to say that if you iterate
on map entries, it is guaranteed that the entries will be returned in the same order they were added in the map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
        </span><span class="typ">Bob</span><span class="pln">  </span><span class="pun">:</span><span class="pln"> </span><span class="lit">42</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">Alice</span><span class="pun">:</span><span class="pln"> </span><span class="lit">54</span><span class="pun">,</span><span class="pln">
        </span><span class="typ">Max</span><span class="pln">  </span><span class="pun">:</span><span class="pln"> </span><span class="lit">33</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

</span><span class="com">// `entry` is a map entry</span><span class="pln">
map</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> entry </span><span class="pun">-&gt;</span><span class="pln">
    println </span><span class="str">"Name: $entry.key Age: $entry.value"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// `entry` is a map entry, `i` the index in the map</span><span class="pln">
map</span><span class="pun">.</span><span class="pln">eachWithIndex </span><span class="pun">{</span><span class="pln"> entry</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">-&gt;</span><span class="pln">
    println </span><span class="str">"$i - Name: $entry.key Age: $entry.value"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// Alternatively you can use key and value directly</span><span class="pln">
map</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> key</span><span class="pun">,</span><span class="pln"> value </span><span class="pun">-&gt;</span><span class="pln">
    println </span><span class="str">"Name: $key Age: $value"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// Key, value and i as the index in the map</span><span class="pln">
map</span><span class="pun">.</span><span class="pln">eachWithIndex </span><span class="pun">{</span><span class="pln"> key</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">,</span><span class="pln"> i </span><span class="pun">-&gt;</span><span class="pln">
    println </span><span class="str">"$i - Name: $key Age: $value"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_manipulating_maps"><a class="anchor" href="#_manipulating_maps"></a>Manipulating maps</h6>
<div class="sect6">
<h7 id="_adding_or_removing_elements_2"><a class="anchor" href="#_adding_or_removing_elements_2"></a>Adding or removing elements</h7>
<div class="paragraph">
<p>Adding an element to a map can be done either using the <code>put</code> method, the subscript operator or using <code>putAll</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> defaults </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">:</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> overrides </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">:</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">:</span><span class="pln"> </span><span class="str">'x'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="pln"> </span><span class="str">'x'</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LinkedHashMap</span><span class="pun">(</span><span class="pln">defaults</span><span class="pun">)</span><span class="pln">
result</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="lit">15</span><span class="pun">,</span><span class="pln"> </span><span class="str">'t'</span><span class="pun">)</span><span class="pln">
result</span><span class="pun">[</span><span class="lit">17</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'u'</span><span class="pln">
result</span><span class="pun">.</span><span class="pln">putAll</span><span class="pun">(</span><span class="pln">overrides</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">:</span><span class="pln"> </span><span class="str">'d'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">:</span><span class="pln"> </span><span class="str">'x'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">13</span><span class="pun">:</span><span class="pln"> </span><span class="str">'x'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">15</span><span class="pun">:</span><span class="pln"> </span><span class="str">'t'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">17</span><span class="pun">:</span><span class="pln"> </span><span class="str">'u'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Removing all the elements of a map can be done by calling the <code>clear</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">:</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="str">'b'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> m</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'a'</span><span class="pln">
m</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> m </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[:]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Maps generated using the map literal syntax are using the object <code>equals</code> and <code>hashcode</code> methods. This means that
you should <strong>never</strong> use an object which hash code is subject to change over time, or you wouldn’t be able to get
the associated value back.</p>
</div>
<div class="paragraph">
<p>It is also worth noting that you should <strong>never</strong> use a <code>GString</code> as the key of a map, because the hash code of a <code>GString</code>
is not the same as the hash code of an equivalent <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> key </span><span class="pun">=</span><span class="pln"> </span><span class="str">'some key'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> gstringKey </span><span class="pun">=</span><span class="pln"> </span><span class="str">"${key.toUpperCase()}"</span><span class="pln">
map</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">gstringKey</span><span class="pun">,</span><span class="str">'value'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="str">'SOME KEY'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="JN1035-Maps-Collectionviewsofamap"><a class="anchor" href="#JN1035-Maps-Collectionviewsofamap"></a>Keys, values and entries</h7>
<div class="paragraph">
<p>We can inspect the keys, values, and entries in a view:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">:</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span><span class="str">'c'</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> entries </span><span class="pun">=</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">entrySet</span><span class="pun">()</span><span class="pln">
entries</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> entry </span><span class="pun">-&gt;</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> entry</span><span class="pun">.</span><span class="pln">key </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">]</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> entry</span><span class="pun">.</span><span class="pln">value </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> keys </span><span class="pun">=</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">keySet</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> keys </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Set</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mutating values returned by the view (be it a map entry, a key or a value) is highly discouraged because success
of the operation directly depends on the type of the map being manipulated. In particular, Groovy relies on collections
from the JDK that in general make no guarantee that a collection can safely be manipulated through <code>keySet</code>, <code>entrySet</code>, or
<code>values</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_filtering_and_searching"><a class="anchor" href="#_filtering_and_searching"></a>Filtering and searching</h7>
<div class="paragraph">
<p>The <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> contains filtering, searching and collecting methods similar to those found
for <a href="#List-Filtering">lists</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> people </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Bob'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">32</span><span class="pun">,</span><span class="pln"> gender</span><span class="pun">:</span><span class="pln"> </span><span class="str">'M'</span><span class="pun">],</span><span class="pln">
    </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Johnny'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">36</span><span class="pun">,</span><span class="pln"> gender</span><span class="pun">:</span><span class="pln"> </span><span class="str">'M'</span><span class="pun">],</span><span class="pln">
    </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Claire'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">21</span><span class="pun">,</span><span class="pln"> gender</span><span class="pun">:</span><span class="pln"> </span><span class="str">'F'</span><span class="pun">],</span><span class="pln">
    </span><span class="lit">4</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Amy'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">54</span><span class="pun">,</span><span class="pln"> gender</span><span class="pun">:</span><span class="str">'F'</span><span class="pun">]</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> bob </span><span class="pun">=</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// find a single entry</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> females </span><span class="pun">=</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">findAll </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">gender </span><span class="pun">==</span><span class="pln"> </span><span class="str">'F'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="com">// both return entries, but you can use collect to retrieve the ages for example</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> ageOfBob </span><span class="pun">=</span><span class="pln"> bob</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">age
</span><span class="kwd">def</span><span class="pln"> agesOfFemales </span><span class="pun">=</span><span class="pln"> females</span><span class="pun">.</span><span class="pln">collect </span><span class="pun">{</span><span class="pln">
    it</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">age
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> ageOfBob </span><span class="pun">==</span><span class="pln"> </span><span class="lit">32</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> agesOfFemales </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">21</span><span class="pun">,</span><span class="lit">54</span><span class="pun">]</span><span class="pln">

</span><span class="com">// but you could also use a key/pair value as the parameters of the closures</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> agesOfMales </span><span class="pun">=</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">findAll </span><span class="pun">{</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> person </span><span class="pun">-&gt;</span><span class="pln">
    person</span><span class="pun">.</span><span class="pln">gender </span><span class="pun">==</span><span class="pln"> </span><span class="str">'M'</span><span class="pln">
</span><span class="pun">}.</span><span class="pln">collect </span><span class="pun">{</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> person </span><span class="pun">-&gt;</span><span class="pln">
    person</span><span class="pun">.</span><span class="pln">age
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> agesOfMales </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">32</span><span class="pun">,</span><span class="pln"> </span><span class="lit">36</span><span class="pun">]</span><span class="pln">

</span><span class="com">// `every` returns true if all entries match the predicate</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">every </span><span class="pun">{</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> person </span><span class="pun">-&gt;</span><span class="pln">
    person</span><span class="pun">.</span><span class="pln">age </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">18</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// `any` returns true if any entry matches the predicate</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">any </span><span class="pun">{</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> person </span><span class="pun">-&gt;</span><span class="pln">
    person</span><span class="pun">.</span><span class="pln">age </span><span class="pun">==</span><span class="pln"> </span><span class="lit">54</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="Maps-Grouping"><a class="anchor" href="#Maps-Grouping"></a>Grouping</h7>
<div class="paragraph">
<p>We can group a list into a map using some criteria:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]].</span><span class="pln">groupBy </span><span class="pun">{</span><span class="pln">
    it</span><span class="pun">.</span><span class="kwd">class</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[(</span><span class="typ">String</span><span class="pun">)</span><span class="pln">   </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">],</span><span class="pln">
      </span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">)</span><span class="pln">  </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="lit">7</span><span class="pun">],</span><span class="pln">
      </span><span class="pun">(</span><span class="typ">ArrayList</span><span class="pun">):</span><span class="pln"> </span><span class="pun">[[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]]</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
        </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Clark'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'London'</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Sharma'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'London'</span><span class="pun">],</span><span class="pln">
        </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Maradona'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'LA'</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Zhang'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'HK'</span><span class="pun">],</span><span class="pln">
        </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Ali'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'HK'</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Liu'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'HK'</span><span class="pun">],</span><span class="pln">
</span><span class="pun">].</span><span class="pln">groupBy </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">city </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
        </span><span class="typ">London</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Clark'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'London'</span><span class="pun">],</span><span class="pln">
                 </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Sharma'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'London'</span><span class="pun">]],</span><span class="pln">
        LA    </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Maradona'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'LA'</span><span class="pun">]],</span><span class="pln">
        HK    </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Zhang'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'HK'</span><span class="pun">],</span><span class="pln">
                 </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Ali'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'HK'</span><span class="pun">],</span><span class="pln">
                 </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Liu'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'HK'</span><span class="pun">]],</span><span class="pln">
</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Collections-Ranges"><a class="anchor" href="#Collections-Ranges"></a>Ranges</h5>
<div class="paragraph">
<p>Ranges allow you to create a list of sequential values. These can be
used as <code>List</code> since
<a href="http://docs.groovy-lang.org/latest/html/api/groovy/lang/Range.html">Range</a> extends
<a href="http://docs.oracle.com/javase/8/docs/api/java/util/List.html">java.util.List</a>.</p>
</div>
<div class="paragraph">
<p>Ranges defined with the <code>..</code> notation are inclusive (that is the list
contains the from and to value).</p>
</div>
<div class="paragraph">
<p>Ranges defined with the <code>..&lt;</code> notation are half-open, they include the
first value but not the last value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// an inclusive range</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> range </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5.</span><span class="pun">.</span><span class="lit">8</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">List</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span><span class="pln">

</span><span class="com">// lets use a half-open range</span><span class="pln">
range </span><span class="pun">=</span><span class="pln"> </span><span class="lit">5.</span><span class="pun">.&lt;</span><span class="lit">8</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">7</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">List</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">range</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span><span class="pln">

</span><span class="com">//get the end points of the range without using indexes</span><span class="pln">
range </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1.</span><span class="pun">.</span><span class="lit">10</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="kwd">from</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="pln">to </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that int ranges are implemented efficiently, creating a lightweight
Java object containing a from and to value.</p>
</div>
<div class="paragraph">
<p>Ranges can be used for any Java object which implements java.lang.Comparable
for comparison and also have methods <code>next()</code> and <code>previous()</code> to return the
next / previous item in the range. For example, you can create a range of <code>String</code> elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// an inclusive range</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> range </span><span class="pun">=</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">..</span><span class="str">'d'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'c'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'c'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range </span><span class="kwd">instanceof</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">List</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'a'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> range</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'d'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">range</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'e'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can iterate on a range using a classic <code>for</code> loop:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> </span><span class="lit">1.</span><span class="pun">.</span><span class="lit">10</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println </span><span class="str">"Hello ${i}"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>but alternatively you can achieve the same effect in a more Groovy idiomatic style, by iterating a range
with <code>each</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pun">(</span><span class="lit">1.</span><span class="pun">.</span><span class="lit">10</span><span class="pun">).</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> i </span><span class="pun">-&gt;</span><span class="pln">
    println </span><span class="str">"Hello ${i}"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ranges can be also used in the <code>switch</code> statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">years</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">1.</span><span class="pun">.</span><span class="lit">10</span><span class="pun">:</span><span class="pln"> interestRate </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.076</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">case</span><span class="pln"> </span><span class="lit">11.</span><span class="pun">.</span><span class="lit">25</span><span class="pun">:</span><span class="pln"> interestRate </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.052</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">break</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">default</span><span class="pun">:</span><span class="pln"> interestRate </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.037</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_syntax_enhancements_for_collections"><a class="anchor" href="#_syntax_enhancements_for_collections"></a>Syntax enhancements for collections</h5>
<div class="sect5">
<h6 id="_gpath_support"><a class="anchor" href="#_gpath_support"></a>GPath support</h6>
<div class="paragraph">
<p>Thanks to the support of property notation for both lists and maps, Groovy provides syntactic sugar making it
really easy to deal with nested collections, as illustrated in the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> listOfMaps </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[</span><span class="str">'a'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">12</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">21</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">22</span><span class="pun">]]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> listOfMaps</span><span class="pun">.</span><span class="pln">a </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="lit">21</span><span class="pun">]</span><span class="pln"> </span><span class="com">//GPath notation</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> listOfMaps</span><span class="pun">*.</span><span class="pln">a </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="lit">21</span><span class="pun">]</span><span class="pln"> </span><span class="com">//spread dot notation</span><span class="pln">

listOfMaps </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[</span><span class="str">'a'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">12</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">21</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">22</span><span class="pun">],</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> listOfMaps</span><span class="pun">*.</span><span class="pln">a </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="lit">21</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">]</span><span class="pln"> </span><span class="com">// caters for null values</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> listOfMaps</span><span class="pun">*.</span><span class="pln">a </span><span class="pun">==</span><span class="pln"> listOfMaps</span><span class="pun">.</span><span class="pln">collect </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">?.</span><span class="pln">a </span><span class="pun">}</span><span class="pln"> </span><span class="com">//equivalent notation</span><span class="pln">
</span><span class="com">// But this will only collect non-null values</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> listOfMaps</span><span class="pun">.</span><span class="pln">a </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">11</span><span class="pun">,</span><span class="lit">21</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_spread_operator_2"><a class="anchor" href="#_spread_operator_2"></a>Spread operator</h6>
<div class="paragraph">
<p>The spread operator can be used to "inline" a collection into another. It is syntactic sugar which often avoids calls
to <code>putAll</code> and facilitates the realization of one-liners:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">900</span><span class="pun">,</span><span class="pln">
         </span><span class="pun">*:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">200</span><span class="pun">],</span><span class="pln"> </span><span class="str">'a'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">300</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">300</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">200</span><span class="pun">,</span><span class="pln"> </span><span class="str">'z'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">900</span><span class="pun">]</span><span class="pln">
</span><span class="com">//spread map notation in map definition</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[*:</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="pun">*:</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]],</span><span class="pln"> </span><span class="lit">7</span><span class="pun">:</span><span class="pln"> </span><span class="lit">7</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">:</span><span class="pln"> </span><span class="lit">7</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="str">'u'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> </span><span class="str">'v'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> </span><span class="str">'w'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[*:</span><span class="pln"> f</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">10</span><span class="pun">:</span><span class="pln"> </span><span class="str">'zz'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="str">'u'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">:</span><span class="pln"> </span><span class="str">'zz'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> </span><span class="str">'v'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> </span><span class="str">'w'</span><span class="pun">]</span><span class="pln">
</span><span class="com">//spread map notation in function arguments</span><span class="pln">
f </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> map </span><span class="pun">-&gt;</span><span class="pln"> map</span><span class="pun">.</span><span class="pln">c </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> f</span><span class="pun">(*:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">20</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">30</span><span class="pun">],</span><span class="pln"> </span><span class="str">'e'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">50</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">30</span><span class="pln">

f </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> j</span><span class="pun">,</span><span class="pln"> k </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">[</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> j</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="com">//using spread map notation with mixed unnamed and named arguments</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> f</span><span class="pun">(</span><span class="str">'e'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100</span><span class="pun">,</span><span class="pln"> </span><span class="pun">*[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">],</span><span class="pln"> </span><span class="pun">*:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">20</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">:</span><span class="pln"> </span><span class="lit">30</span><span class="pun">],</span><span class="pln"> </span><span class="lit">6</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln">
        </span><span class="pun">[[</span><span class="str">"e"</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100</span><span class="pun">,</span><span class="pln"> </span><span class="str">"b"</span><span class="pun">:</span><span class="pln"> </span><span class="lit">20</span><span class="pun">,</span><span class="pln"> </span><span class="str">"c"</span><span class="pun">:</span><span class="pln"> </span><span class="lit">30</span><span class="pun">,</span><span class="pln"> </span><span class="str">"a"</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10</span><span class="pun">],</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="Collections-Gettingefficientwiththestar-dotoperator"><a class="anchor" href="#Collections-Gettingefficientwiththestar-dotoperator"></a>The star-dot `*.' operator</h6>
<div class="paragraph">
<p>The "star-dot" operator is a shortcut operator allowing you to call a method or a property on all elements of a
collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'few'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'words'</span><span class="pun">]*.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> persons </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Hugo'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="lit">17</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Sandra'</span><span class="pun">,</span><span class="pln">age</span><span class="pun">:</span><span class="lit">19</span><span class="pun">)]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="lit">17</span><span class="pun">,</span><span class="pln"> </span><span class="lit">19</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> persons</span><span class="pun">*.</span><span class="pln">age</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="Collections-Slicingwiththesubscriptoperator"><a class="anchor" href="#Collections-Slicingwiththesubscriptoperator"></a>Slicing with the subscript operator</h6>
<div class="paragraph">
<p>You can index into lists, arrays, maps using the subscript expression. It is interesting that strings
are considered as special kinds of collections in that context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> text </span><span class="pun">=</span><span class="pln"> </span><span class="str">'nice cheese gromit!'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> text</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="str">'c'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">String</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">sub</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> text</span><span class="pun">[</span><span class="lit">5.</span><span class="pun">.</span><span class="lit">10</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">sub</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'cheese'</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">11</span><span class="pun">,</span><span class="pln"> </span><span class="lit">12</span><span class="pun">,</span><span class="pln"> </span><span class="lit">13</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> answer </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> answer </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">12</span><span class="pun">,</span><span class="lit">13</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that you can use ranges to extract part of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">list </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100.</span><span class="pun">.</span><span class="lit">200</span><span class="pln">
</span><span class="kwd">sub</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20.</span><span class="pun">.</span><span class="lit">25</span><span class="pun">,</span><span class="pln"> </span><span class="lit">33</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">sub</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">101</span><span class="pun">,</span><span class="pln"> </span><span class="lit">103</span><span class="pun">,</span><span class="pln"> </span><span class="lit">120</span><span class="pun">,</span><span class="pln"> </span><span class="lit">121</span><span class="pun">,</span><span class="pln"> </span><span class="lit">122</span><span class="pun">,</span><span class="pln"> </span><span class="lit">123</span><span class="pun">,</span><span class="pln"> </span><span class="lit">124</span><span class="pun">,</span><span class="pln"> </span><span class="lit">125</span><span class="pun">,</span><span class="pln"> </span><span class="lit">133</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The subscript operator can be used to update an existing collection (for collection type which are not immutable):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'x'</span><span class="pun">,</span><span class="str">'x'</span><span class="pun">,</span><span class="str">'d'</span><span class="pun">]</span><span class="pln">
list</span><span class="pun">[</span><span class="lit">1.</span><span class="pun">.</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">,</span><span class="str">'d'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is worth noting that negative indices are allowed, to extract more easily from the end of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">text </span><span class="pun">=</span><span class="pln"> </span><span class="str">"nice cheese gromit!"</span><span class="pln">
x </span><span class="pun">=</span><span class="pln"> text</span><span class="pun">[-</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="str">"!"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use negative indices to count from the end of the List, array,
String etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> text</span><span class="pun">[-</span><span class="lit">7.</span><span class="pun">.-</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> name </span><span class="pun">==</span><span class="pln"> </span><span class="str">"gromit"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Eventually, if you use a backwards range (the starting index is greater than
the end index), then the answer is reversed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">text </span><span class="pun">=</span><span class="pln"> </span><span class="str">"nice cheese gromit!"</span><span class="pln">
name </span><span class="pun">=</span><span class="pln"> text</span><span class="pun">[</span><span class="lit">3.</span><span class="pun">.</span><span class="lit">1</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> name </span><span class="pun">==</span><span class="pln"> </span><span class="str">"eci"</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Collections-EnhancedCollectionMethods"><a class="anchor" href="#Collections-EnhancedCollectionMethods"></a>Enhanced Collection Methods</h5>
<div class="paragraph">
<p>In addition to <a href="#Collections-Lists">lists</a>, <a href="#Collections-Maps">maps</a> or <a href="#Collections-Ranges">ranges</a>, Groovy offers
a lot of additional methods for filtering, collecting, grouping, counting, …​ which are directly available on either
collections or more easily iterables.</p>
</div>
<div class="paragraph">
<p>In particular, we invite you to read the <a href="http://www.groovy-lang.org/gdk.html">Groovy development kit</a> API docs and specifically:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>methods added to <code>Iterable</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/lang/Iterable.html">here</a></p>
</li>
<li>
<p>methods added to <code>Iterator</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Iterator.html">here</a></p>
</li>
<li>
<p>methods added to <code>Collection</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Collection.html">here</a></p>
</li>
<li>
<p>methods added to <code>List</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/List.html">here</a></p>
</li>
<li>
<p>methods added to <code>Map</code> can be found <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/util/Map.html">here</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_handy_utilities"><a class="anchor" href="#_handy_utilities"></a>3.3.3. Handy utilities</h4>
<div class="sect4">
<h5 id="_configslurper"><a class="anchor" href="#_configslurper"></a>ConfigSlurper</h5>
<div class="paragraph">
<p><code>ConfigSlurper</code> is a utility class for reading configuration files defined in the form of Groovy scripts. Like it is
the case with Java <code>*.properties</code> files, <code>ConfigSlurper</code> allows a dot notation. But in addition, it allows for Closure scoped
configuration values and arbitrary object types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConfigSlurper</span><span class="pun">().</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'''
    app.date = new Date()  </span><i class="conum" data-value="1"></i><b><span class="str">(1)</span></b><span class="str">
    app.age  = 42
    app {                  </span><i class="conum" data-value="2"></i><b><span class="str">(2)</span></b><span class="str">
        name = "Test${42}"
    }
'''</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">app</span><span class="pun">.</span><span class="pln">date </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Date</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">app</span><span class="pun">.</span><span class="pln">age </span><span class="pun">==</span><span class="pln"> </span><span class="lit">42</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">app</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Test42'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Usage of the dot notation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Usage of Closure scopes as an alternative to the dot notation</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As can be seen in the above example, the <code>parse</code> method can be used to retrieve <code>groovy.util.ConfigObject</code> instances. The
<code>ConfigObject</code> is a specialized <code>java.util.Map</code> implementation that either returns the configured value or a new <code>ConfigObject</code>
instance but never <code>null</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConfigSlurper</span><span class="pun">().</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'''
    app.date = new Date()
    app.age  = 42
    app.name = "Test${42}"
'''</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">test </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>config.test</code> has not been specified yet it returns a <code>ConfigObject</code> when being called.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In the case of a dot being part of a configuration variable name, it can be escaped by using single or double quotes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConfigSlurper</span><span class="pun">().</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'''
    app."person.age"  = 42
'''</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">app</span><span class="pun">.</span><span class="str">"person.age"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">42</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, <code>ConfigSlurper</code> comes with support for <code>environments</code>. The <code>environments</code> method can be used to hand over
a Closure instance that itself may consist of a several sections. Let’s say we wanted to create a particular configuration
value for the development environment. When creating the <code>ConfigSlurper</code> instance we can use the <code>ConfigSlurper(String)</code>
constructor to specify the target environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConfigSlurper</span><span class="pun">(</span><span class="str">'development'</span><span class="pun">).</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'''
  environments {
       development {
           app.port = 8080
       }

       test {
           app.port = 8082
       }

       production {
           app.port = 80
       }
  }
'''</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">app</span><span class="pun">.</span><span class="pln">port </span><span class="pun">==</span><span class="pln"> </span><span class="lit">8080</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>ConfigSlurper</code> environments aren’t restricted to any particular environment names. It solely depends on the
<code>ConfigSlurper</code> client code what value are supported and interpreted accordingly.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>environments</code> method is built-in but the <code>registerConditionalBlock</code> method can be used to register other method names
in addition to the <code>environments</code> name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> slurper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConfigSlurper</span><span class="pun">()</span><span class="pln">
slurper</span><span class="pun">.</span><span class="pln">registerConditionalBlock</span><span class="pun">(</span><span class="str">'myProject'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'developers'</span><span class="pun">)</span><span class="pln">   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> slurper</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'''
  sendMail = true

  myProject {
       developers {
           sendMail = false
       }
  }
'''</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">config</span><span class="pun">.</span><span class="pln">sendMail</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Once the new block is registered <code>ConfigSlurper</code> can parse it.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>For Java integration purposes the <code>toProperties</code> method can be used to convert the <code>ConfigObject</code> to a <code>java.util.Properties</code>
object that might be stored to a <code>*.properties</code> text file. Be aware though that the configuration values are converted to
<code>String</code> instances during adding them to the newly created <code>Properties</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConfigSlurper</span><span class="pun">().</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'''
    app.date = new Date()
    app.age  = 42
    app {
        name = "Test${42}"
    }
'''</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> properties </span><span class="pun">=</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">toProperties</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> properties</span><span class="pun">.</span><span class="str">"app.date"</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">String</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> properties</span><span class="pun">.</span><span class="str">"app.age"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'42'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> properties</span><span class="pun">.</span><span class="str">"app.name"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Test42'</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_expando"><a class="anchor" href="#_expando"></a>Expando</h5>
<div class="paragraph">
<p>The <code>Expando</code> class can be used to create a dynamically expandable object. Despite its name it does not use the
<code>ExpandoMetaClass</code> underneath. Each <code>Expando</code> object represents a standalone, dynamically-crafted instance that can be
extended with properties (or methods) at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> expando </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Expando</span><span class="pun">()</span><span class="pln">
expando</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'John'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> expando</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'John'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A special case occurs when a dynamic property registers a <code>Closure</code> code block. Once being registered it can be invoked
as it would be done with a method call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> expando </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Expando</span><span class="pun">()</span><span class="pln">
expando</span><span class="pun">.</span><span class="pln">toString </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="str">'John'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
expando</span><span class="pun">.</span><span class="pln">say </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> s </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="str">"John says: ${s}"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> expando </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'John'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> expando</span><span class="pun">.</span><span class="pln">say</span><span class="pun">(</span><span class="str">'Hi'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'John says: Hi'</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_observable_list_map_and_set"><a class="anchor" href="#_observable_list_map_and_set"></a>Observable list, map and set</h5>
<div class="paragraph">
<p>Groovy comes with observable lists, maps and sets. Each of these collections trigger <code>java.beans.PropertyChangeEvent</code> events when elements
are added, removed or changed. Note that a <code>PropertyChangeEvent</code> is not only signalling that a certain event has
 occurred, moreover, it holds information on the property name and the old/new value a certain property has been changed to.</p>
</div>
<div class="paragraph">
<p>Depending on the type of change that has happened, observable collections might fire more specialized <code>PropertyChangeEvent</code>
 types. For example, adding an element to an observable list fires an <code>ObservableList.ElementAddedEvent</code> event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="kwd">event</span><span class="pln">                                       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> listener </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">it </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ObservableList</span><span class="pun">.</span><span class="typ">ElementEvent</span><span class="pun">)</span><span class="pln">  </span><span class="pun">{</span><span class="pln">  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> it
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">PropertyChangeListener</span><span class="pln">


</span><span class="kwd">def</span><span class="pln"> observable </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">ObservableList</span><span class="pln">    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
observable</span><span class="pun">.</span><span class="pln">addPropertyChangeListener</span><span class="pun">(</span><span class="pln">listener</span><span class="pun">)</span><span class="pln">  </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">

observable</span><span class="pun">.</span><span class="pln">add </span><span class="lit">42</span><span class="pln">                               </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ObservableList</span><span class="pun">.</span><span class="typ">ElementAddedEvent</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> elementAddedEvent </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">ObservableList</span><span class="pun">.</span><span class="typ">ElementAddedEvent</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> elementAddedEvent</span><span class="pun">.</span><span class="pln">changeType </span><span class="pun">==</span><span class="pln"> </span><span class="typ">ObservableList</span><span class="pun">.</span><span class="typ">ChangeType</span><span class="pun">.</span><span class="pln">ADDED
</span><span class="kwd">assert</span><span class="pln"> elementAddedEvent</span><span class="pun">.</span><span class="pln">index </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> elementAddedEvent</span><span class="pun">.</span><span class="pln">oldValue </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> elementAddedEvent</span><span class="pun">.</span><span class="pln">newValue </span><span class="pun">==</span><span class="pln"> </span><span class="lit">42</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declares a <code>PropertyChangeEventListener</code> that is capturing the fired events</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>ObservableList.ElementEvent</code> and its descendant types are relevant for this listener</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Registers the listener</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creates an <code>ObservableList</code> from the given list</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Triggers an <code>ObservableList.ElementAddedEvent</code> event</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Be aware that adding an element in fact causes two events to be triggered. The first is of type <code>ObservableList.ElementAddedEvent</code>,
the second is a plain <code>PropertyChangeEvent</code> that informs listeners about the change of property <code>size</code>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>ObservableList.ElementClearedEvent</code> event type is another interesting one. Whenever multiple
 elements are removed, for example when calling <code>clear()</code>, it holds the elements being removed from the list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="kwd">event</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> listener </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">it </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ObservableList</span><span class="pun">.</span><span class="typ">ElementEvent</span><span class="pun">)</span><span class="pln">  </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> it
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">PropertyChangeListener</span><span class="pln">


</span><span class="kwd">def</span><span class="pln"> observable </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">ObservableList</span><span class="pln">
observable</span><span class="pun">.</span><span class="pln">addPropertyChangeListener</span><span class="pun">(</span><span class="pln">listener</span><span class="pun">)</span><span class="pln">

observable</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ObservableList</span><span class="pun">.</span><span class="typ">ElementClearedEvent</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> elementClearedEvent </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">ObservableList</span><span class="pun">.</span><span class="typ">ElementClearedEvent</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> elementClearedEvent</span><span class="pun">.</span><span class="pln">values </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> observable</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To get an overview of all the supported event types the reader is encouraged to have a look at the JavaDoc documentation
or the source code of the observable collection in use.</p>
</div>
<div class="paragraph">
<p><code>ObservableMap</code> and <code>ObservableSet</code> come with the same concepts as we have seen for <code>ObservableList</code> in this section.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_metaprogramming"><a class="anchor" href="#_metaprogramming"></a>3.4. Metaprogramming</h3>
<div class="paragraph">
<p>The Groovy language supports two flavors of metaprogramming: runtime and compile-time.
The first allows altering the class model and the behavior of a program at runtime while the second only occurs
at compile-time. Both have pros and cons that we will detail in this section.</p>
</div>
<div class="sect3">
<h4 id="_runtime_metaprogramming"><a class="anchor" href="#_runtime_metaprogramming"></a>3.4.1. Runtime metaprogramming</h4>
<div class="paragraph">
<p>With runtime metaprogramming we can postpone to runtime the decision 
to intercept, inject and even synthesize methods of classes and 
interfaces. For a deep understanding of Groovy’s metaobject protocol 
(MOP) we need to understand Groovy objects and Groovy’s method handling.
In Groovy we work with three kinds of objects: POJO, POGO and Groovy 
Interceptors. Groovy allows metaprogramming for all types of objects but
 in a different manner.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>POJO - A regular Java object, whose class can be written in Java or any other language for the JVM.</p>
</li>
<li>
<p>POGO - A Groovy object, whose class is written in Groovy. It extends <code>java.lang.Object</code> and implements the <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/GroovyObject.html">groovy.lang.GroovyObject</a> interface by default.</p>
</li>
<li>
<p>Groovy Interceptor - A Groovy object that implements the <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/GroovyInterceptable.html">groovy.lang.GroovyInterceptable</a> interface and has method-interception capability, which we’ll discuss in the <a href="#_groovyinterceptable">GroovyInterceptable</a> section.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For every method call Groovy checks whether the object is a POJO or a POGO. For POJOs, Groovy fetches its <code>MetaClass</code> from the <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/MetaClassRegistry.html">groovy.lang.MetaClassRegistry</a> and delegates method invocation to it. For POGOs, Groovy takes more steps, as illustrated in the following figure:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="Groovy-Language-Documentation_files/xGroovyInterceptions.png" alt="GroovyInterceptions" data-pagespeed-url-hash="1624168544" onload="pagespeed.CriticalImages.checkImageForCriticality(this);">
</div>
<div class="title">Figure 1. Groovy interception mechanism</div>
</div>
<div class="sect4">
<h5 id="_groovyobject_interface"><a class="anchor" href="#_groovyobject_interface"></a>GroovyObject interface</h5>
<div class="paragraph">
<p><a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/GroovyObject.html">groovy.lang.GroovyObject</a> is the main interface in Groovy as the <code>Object</code> class is in Java. <code>GroovyObject</code> has a default implementation in the <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/GroovyObjectSupport.html">groovy.lang.GroovyObjectSupport</a> class and it is responsible to transfer invocation to the <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/MetaClass.html">groovy.lang.MetaClass</a> object. The <code>GroovyObject</code> source looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">package</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">GroovyObject</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">Object</span><span class="pln"> invokeMethod</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> args</span><span class="pun">);</span><span class="pln">

    </span><span class="typ">Object</span><span class="pln"> getProperty</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> propertyName</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> setProperty</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> propertyName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> newValue</span><span class="pun">);</span><span class="pln">

    </span><span class="typ">MetaClass</span><span class="pln"> getMetaClass</span><span class="pun">();</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> setMetaClass</span><span class="pun">(</span><span class="typ">MetaClass</span><span class="pln"> metaClass</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_invokemethod"><a class="anchor" href="#_invokemethod"></a>invokeMethod</h6>
<div class="paragraph">
<p>This method is primarily intended to be used in conjunction with the <a href="#_groovyinterceptable">GroovyInterceptable</a>
interface or an object’s <code>MetaClass</code> where it will intercept all method calls.</p>
</div>
<div class="paragraph">
<p>It is also invoked when the method called is not present on a Groovy object. Here is a simple example using an
overridden <code>invokeMethod()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SomeGroovyClass</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> invokeMethod</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"called invokeMethod $name $args"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> test</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'method exists'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> someGroovyClass </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SomeGroovyClass</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> someGroovyClass</span><span class="pun">.</span><span class="pln">test</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'method exists'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> someGroovyClass</span><span class="pun">.</span><span class="pln">someMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'called invokeMethod someMethod []'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, the use of <code>invokeMethod</code> to intercept missing methods is discouraged.  In cases where the intent is to only
intercept method calls in the case of a failed method dispatch use <a href="#_methodmissing">methodMissing</a>
instead.</p>
</div>
</div>
<div class="sect5">
<h6 id="_get_setproperty"><a class="anchor" href="#_get_setproperty"></a>get/setProperty</h6>
<div class="paragraph">
<p>Every read access to a property can be intercepted by overriding the <code>getProperty()</code> method of the current object.
Here is a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SomeGroovyClass</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> property1 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'ha'</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> field2 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'ho'</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> field4 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'hu'</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> getField1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'getHa'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> getProperty</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">name </span><span class="pun">!=</span><span class="pln"> </span><span class="str">'field3'</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> metaClass</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'field3'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> someGroovyClass </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SomeGroovyClass</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> someGroovyClass</span><span class="pun">.</span><span class="pln">field1 </span><span class="pun">==</span><span class="pln"> </span><span class="str">'getHa'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> someGroovyClass</span><span class="pun">.</span><span class="pln">field2 </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ho'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> someGroovyClass</span><span class="pun">.</span><span class="pln">field3 </span><span class="pun">==</span><span class="pln"> </span><span class="str">'field3'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> someGroovyClass</span><span class="pun">.</span><span class="pln">field4 </span><span class="pun">==</span><span class="pln"> </span><span class="str">'hu'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Forwards the request to the getter for all properties except <code>field3</code>.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>You can intercept write access to properties by overriding the <code>setProperty()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> POGO </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">property</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> setProperty</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.@</span><span class="str">"$name"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'overridden'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> pogo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> POGO</span><span class="pun">()</span><span class="pln">
pogo</span><span class="pun">.</span><span class="kwd">property</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'a'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> pogo</span><span class="pun">.</span><span class="kwd">property</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'overridden'</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_get_setmetaclass"><a class="anchor" href="#_get_setmetaclass"></a>get/setMetaClass</h6>
<div class="paragraph">
<p>You can a access an object’s <code>metaClass</code> or set your own <code>MetaClass</code> implementation for changing the default interception mechanism. For example, you can write your own implementation of the <code>MetaClass</code> interface and assign it to objects in order to change the interception mechanism:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// getMetaclass</span><span class="pln">
someObject</span><span class="pun">.</span><span class="pln">metaClass

</span><span class="com">// setMetaClass</span><span class="pln">
someObject</span><span class="pun">.</span><span class="pln">metaClass </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">OwnMetaClassImplementation</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can find an additional example in the <a href="#_groovyinterceptable">GroovyInterceptable</a> topic.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_get_setattribute"><a class="anchor" href="#_get_setattribute"></a>get/setAttribute</h5>
<div class="paragraph">
<p>This functionality is related to the <code>MetaClass</code> 
implementation. In the default implementation you can access fields 
without invoking their getters and setters. The examples below 
demonstrates this approach:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SomeGroovyClass</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> field1 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'ha'</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> field2 </span><span class="pun">=</span><span class="pln"> </span><span class="str">'ho'</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> getField1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">'getHa'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> someGroovyClass </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SomeGroovyClass</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> someGroovyClass</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="pln">someGroovyClass</span><span class="pun">,</span><span class="pln"> </span><span class="str">'field1'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ha'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> someGroovyClass</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="pln">someGroovyClass</span><span class="pun">,</span><span class="pln"> </span><span class="str">'field2'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ho'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> POGO </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> field
    </span><span class="typ">String</span><span class="pln"> property1

    </span><span class="kwd">void</span><span class="pln"> setProperty1</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> property1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">property1 </span><span class="pun">=</span><span class="pln"> </span><span class="str">"setProperty1"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> pogo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> POGO</span><span class="pun">()</span><span class="pln">
pogo</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="pln">pogo</span><span class="pun">,</span><span class="pln"> </span><span class="str">'field'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'ha'</span><span class="pun">)</span><span class="pln">
pogo</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="pln">pogo</span><span class="pun">,</span><span class="pln"> </span><span class="str">'property1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'ho'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> pogo</span><span class="pun">.</span><span class="pln">field </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ha'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> pogo</span><span class="pun">.</span><span class="pln">property1 </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ho'</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_methodmissing"><a class="anchor" href="#_methodmissing"></a>methodMissing</h5>
<div class="paragraph">
<p>Groovy supports the concept of <code>methodMissing</code>. This method differs from <code>invokeMethod</code> in that it
is only invoked in the case of a failed method dispatch when no method can be found for the given name and/or the
given arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

   </span><span class="kwd">def</span><span class="pln"> methodMissing</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"this is me"</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">().</span><span class="pln">someUnknownMethod</span><span class="pun">(</span><span class="lit">42l</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'this is me'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically when using <code>methodMissing</code> it is possible to cache the result for the next time the same method is called.</p>
</div>
<div class="paragraph">
<p>For example, consider dynamic finders in GORM. These are implemented in terms of <code>methodMissing</code>. The code resembles
something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> GORM </span><span class="pun">{</span><span class="pln">

   </span><span class="kwd">def</span><span class="pln"> dynamicMethods </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[...]</span><span class="pln"> </span><span class="com">// an array of dynamic methods that use regex</span><span class="pln">

   </span><span class="kwd">def</span><span class="pln"> methodMissing</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       </span><span class="kwd">def</span><span class="pln"> method </span><span class="pun">=</span><span class="pln"> dynamicMethods</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
       </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">method</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          GORM</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="str">"$name"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> varArgs </span><span class="pun">-&gt;</span><span class="pln">
             method</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> varArgs</span><span class="pun">)</span><span class="pln">
          </span><span class="pun">}</span><span class="pln">
          </span><span class="kwd">return</span><span class="pln"> method</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">,</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln">
       </span><span class="pun">}</span><span class="pln">
       </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MissingMethodException</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how, if we find a method to invoke, we then dynamically register a new method on the fly using <a href="#metaprogramming_emc">ExpandoMetaClass</a>.
This is so that the next time the same method is called it is more efficient. This way of using <code>methodMissing</code> does not have
the overhead of <code>invokeMethod</code> <em>and</em> is not expensive from the second call on.</p>
</div>
</div>
<div class="sect4">
<h5 id="_propertymissing"><a class="anchor" href="#_propertymissing"></a>propertyMissing</h5>
<div class="paragraph">
<p>Groovy supports the concept of <code>propertyMissing</code> for intercepting otherwise failing property resolution attempts. In the
case of a getter method, <code>propertyMissing</code> takes a single <code>String</code> argument containing the property name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> propertyMissing</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> name </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">().</span><span class="pln">boo </span><span class="pun">==</span><span class="pln"> </span><span class="str">'boo'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>propertyMissing(String)</code> method is only called when no getter method for the given property can be found by the Groovy
runtime.</p>
</div>
<div class="paragraph">
<p>For setter methods a second <code>propertyMissing</code> definition can be added that takes an additional value argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> storage </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> propertyMissing</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> storage</span><span class="pun">[</span><span class="pln">name</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value </span><span class="pun">}</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> propertyMissing</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> storage</span><span class="pun">[</span><span class="pln">name</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">()</span><span class="pln">
f</span><span class="pun">.</span><span class="pln">foo </span><span class="pun">=</span><span class="pln"> </span><span class="str">"bar"</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">foo </span><span class="pun">==</span><span class="pln"> </span><span class="str">"bar"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As with <code>methodMissing</code> it is best practice to dynamically register new properties at runtime to improve the overall lookup
performance.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>methodMissing</code> and <code>propertyMissing</code> methods that deal with static methods and properties can be added via
the <a href="#metaprogramming_emc">ExpandoMetaClass</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_groovyinterceptable"><a class="anchor" href="#_groovyinterceptable"></a>GroovyInterceptable</h5>
<div class="paragraph">
<p>The <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/GroovyInterceptable.html">groovy.lang.GroovyInterceptable</a> interface is marker interface that extends <code>GroovyObject</code>
 and is used to notify the Groovy runtime that all methods should be 
intercepted through the method dispatcher mechanism of the Groovy 
runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">package</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">GroovyInterceptable</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">GroovyObject</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When a Groovy object implements the <code>GroovyInterceptable</code> interface, its <code>invokeMethod()</code> is called for any method calls. Below you can see a simple example of a object of this type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Interception</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">GroovyInterceptable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> definedMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> invokeMethod</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">'invokedMethod'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next piece of code is a test which shows that both calls to existing and non-existing methods will return the same value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">InterceptableTest</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">GroovyTestCase</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> testCheckInterception</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> interception </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Interception</span><span class="pun">()</span><span class="pln">

        </span><span class="kwd">assert</span><span class="pln"> interception</span><span class="pun">.</span><span class="pln">definedMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'invokedMethod'</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> interception</span><span class="pun">.</span><span class="pln">someMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'invokedMethod'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We cannot use default groovy methods like <code>println</code> because these methods are injected into all Groovy objects so they will be intercepted too.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If we want to intercept all method calls but do not want to implement the <code>GroovyInterceptable</code> interface we can implement <code>invokeMethod()</code> on an object’s <code>MetaClass</code>.
This approach works for both POGOs and POJOs, as shown by this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">InterceptionThroughMetaClassTest</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">GroovyTestCase</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> testPOJOMetaClassInterception</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">String</span><span class="pln"> invoking </span><span class="pun">=</span><span class="pln"> </span><span class="str">'ha'</span><span class="pln">
        invoking</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">invokeMethod </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> args </span><span class="pun">-&gt;</span><span class="pln">
            </span><span class="str">'invoked'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">assert</span><span class="pln"> invoking</span><span class="pun">.</span><span class="pln">length</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'invoked'</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> invoking</span><span class="pun">.</span><span class="pln">someMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'invoked'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> testPOGOMetaClassInterception</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Entity</span><span class="pln"> entity </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Entity</span><span class="pun">(</span><span class="str">'Hello'</span><span class="pun">)</span><span class="pln">
        entity</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">invokeMethod </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> args </span><span class="pun">-&gt;</span><span class="pln">
            </span><span class="str">'invoked'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">assert</span><span class="pln"> entity</span><span class="pun">.</span><span class="pln">build</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">())</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'invoked'</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> entity</span><span class="pun">.</span><span class="pln">someMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'invoked'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Additional information about <code>MetaClass</code> can be found in the <a href="#_metaclasses">MetaClasses</a> section.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="categories"><a class="anchor" href="#categories"></a>Categories</h5>
<div class="paragraph">
<p>There are situations where it is useful if a class <em>not</em> under control had additional methods. In order to enable this
capability, Groovy implements a feature borrowed from Objective-C, called <em>Categories</em>.</p>
</div>
<div class="paragraph">
<p>Categories are implemented with so-called <em>category classes</em>. A category class is special in that it needs to meet certain
pre-defined rules for defining extension methods.</p>
</div>
<div class="paragraph">
<p>There are a few categories that are included in the system for adding functionality to classes that make them more
usable within the Groovy environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/time/TimeCategory.html">groovy.time.TimeCategory</a></p>
</li>
<li>
<p><a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/servlet/ServletCategory.html">groovy.servlet.ServletCategory</a></p>
</li>
<li>
<p><a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/xml/dom/DOMCategory.html">groovy.xml.dom.DOMCategory</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Category classes aren’t enabled by default. To use the methods defined in a category class it is necessary to apply
the scoped <code>use</code> method that is provided by the GDK and available from inside every Groovy object instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">use</span><span class="pun">(</span><span class="typ">TimeCategory</span><span class="pun">)</span><span class="pln">  </span><span class="pun">{</span><span class="pln">
    println </span><span class="lit">1.minute</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">.</span><span class="pln">now       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    println </span><span class="lit">10.hours</span><span class="pun">.</span><span class="pln">ago

    </span><span class="kwd">def</span><span class="pln"> someDate </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln">       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    println someDate </span><span class="pun">-</span><span class="pln"> </span><span class="lit">3.months</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>TimeCategory</code> adds methods to <code>Integer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>TimeCategory</code> adds methods to <code>Date</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>use</code> method takes the category class as its first parameter and a closure code block as second parameter. Inside the
<code>Closure</code> access to the category methods is available. As can be seen in the example above even JDK classes
like <code>java.lang.Integer</code> or <code>java.util.Date</code> can be enriched with user-defined methods.</p>
</div>
<div class="paragraph">
<p>A category needs not to be directly exposed to the user code, the following will also do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">JPACategory</span><span class="pun">{</span><span class="pln">
  </span><span class="com">// Let's enhance JPA EntityManager without getting into the JSR committee</span><span class="pln">
  </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> persistAll</span><span class="pun">(</span><span class="typ">EntityManager</span><span class="pln"> em </span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> entities</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">//add an interface to save all</span><span class="pln">
    entities</span><span class="pun">?.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> em</span><span class="pun">.</span><span class="pln">persist</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> transactionContext </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">EntityManager</span><span class="pln"> em</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> c </span><span class="pun">-&gt;</span><span class="pln">
  </span><span class="kwd">def</span><span class="pln"> tx </span><span class="pun">=</span><span class="pln"> em</span><span class="pun">.</span><span class="pln">transaction
  </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    tx</span><span class="pun">.</span><span class="kwd">begin</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">use</span><span class="pun">(</span><span class="typ">JPACategory</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      c</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    tx</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">()</span><span class="pln">
  </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    tx</span><span class="pun">.</span><span class="pln">rollback</span><span class="pun">()</span><span class="pln">
  </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">//cleanup your resource here</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// user code, they always forget to close resource in exception, some even forget to commit, let's not rely on them.</span><span class="pln">
</span><span class="typ">EntityManager</span><span class="pln"> em</span><span class="pun">;</span><span class="pln"> </span><span class="com">//probably injected</span><span class="pln">
transactionContext </span><span class="pun">(</span><span class="pln">em</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
 em</span><span class="pun">.</span><span class="pln">persistAll</span><span class="pun">(</span><span class="pln">obj1</span><span class="pun">,</span><span class="pln"> obj2</span><span class="pun">,</span><span class="pln"> obj3</span><span class="pun">)</span><span class="pln">
 </span><span class="com">// let's do some logics here to make the example sensible</span><span class="pln">
 em</span><span class="pun">.</span><span class="pln">persistAll</span><span class="pun">(</span><span class="pln">obj2</span><span class="pun">,</span><span class="pln"> obj4</span><span class="pun">,</span><span class="pln"> obj6</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we have a look at the <code>groovy.time.TimeCategory</code> class we see that the extension methods are all declared as <code>static</code>
methods. In fact, this is one of the requirements that must be met by 
category classes for its methods to be successfully added to
a class inside the <code>use</code> code block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">TimeCategory</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> plus</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> date</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">BaseDuration</span><span class="pln"> duration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> duration</span><span class="pun">.</span><span class="pln">plus</span><span class="pun">(</span><span class="pln">date</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> minus</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> date</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">BaseDuration</span><span class="pln"> duration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Calendar</span><span class="pln"> cal </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">getInstance</span><span class="pun">();</span><span class="pln">

        cal</span><span class="pun">.</span><span class="pln">setTime</span><span class="pun">(</span><span class="pln">date</span><span class="pun">);</span><span class="pln">
        cal</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">YEAR</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">duration</span><span class="pun">.</span><span class="pln">getYears</span><span class="pun">());</span><span class="pln">
        cal</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">MONTH</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">duration</span><span class="pun">.</span><span class="pln">getMonths</span><span class="pun">());</span><span class="pln">
        cal</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">DAY_OF_YEAR</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">duration</span><span class="pun">.</span><span class="pln">getDays</span><span class="pun">());</span><span class="pln">
        cal</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">HOUR_OF_DAY</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">duration</span><span class="pun">.</span><span class="pln">getHours</span><span class="pun">());</span><span class="pln">
        cal</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">MINUTE</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">duration</span><span class="pun">.</span><span class="pln">getMinutes</span><span class="pun">());</span><span class="pln">
        cal</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">SECOND</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">duration</span><span class="pun">.</span><span class="pln">getSeconds</span><span class="pun">());</span><span class="pln">
        cal</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">MILLISECOND</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="pln">duration</span><span class="pun">.</span><span class="pln">getMillis</span><span class="pun">());</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> cal</span><span class="pun">.</span><span class="pln">getTime</span><span class="pun">();</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="com">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another requirement is the first argument of the static method must 
define the type the method is attached to once being activated. The
other arguments are the normal arguments the method will take as 
parameters.</p>
</div>
<div class="paragraph">
<p>Because of the parameter and static method convention, category method definitions may be a bit less intuitive than
normal method definitions. As an alternative Groovy comes with a <code>@Category</code> annotation that transforms annotated classes
into category classes at compile-time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Distance</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> number
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"${number}m"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Category</span><span class="pun">(</span><span class="typ">Number</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NumberCategory</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Distance</span><span class="pln"> getMeters</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Distance</span><span class="pun">(</span><span class="pln">number</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">use</span><span class="pln"> </span><span class="pun">(</span><span class="typ">NumberCategory</span><span class="pun">)</span><span class="pln">  </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">42.meters</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'42m'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Applying the <code>@Category</code> annotation has the advantage of being able to use instance methods without the target type as a
first parameter. The target type class is given as an argument to the annotation instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is a distinct section on <code>@Category</code> in the <a href="#xform-Category">compile-time metaprogramming section</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_metaclasses"><a class="anchor" href="#_metaclasses"></a>Metaclasses</h5>
<div class="paragraph">
<p>(TBD)</p>
</div>
<div class="sect5">
<h6 id="_custom_metaclasses"><a class="anchor" href="#_custom_metaclasses"></a>Custom metaclasses</h6>
<div class="paragraph">
<p>(TBD)</p>
</div>
<div class="sect6">
<h7 id="_delegating_metaclass"><a class="anchor" href="#_delegating_metaclass"></a>Delegating metaclass</h7>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
<div class="sect6">
<h7 id="_magic_package_maksym_stavytskyi"><a class="anchor" href="#_magic_package_maksym_stavytskyi"></a>Magic package (Maksym Stavytskyi)</h7>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_per_instance_metaclass"><a class="anchor" href="#_per_instance_metaclass"></a>Per instance metaclass</h6>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
<div class="sect5">
<h6 id="metaprogramming_emc"><a class="anchor" href="#metaprogramming_emc"></a>ExpandoMetaClass</h6>
<div class="paragraph">
<p>Groovy comes with a special <code>MetaClass</code> the so-called <code>ExpandoMetaClass</code>. It is special in that it allows for dynamically
adding or changing methods, constructors, properties and even static methods by using a neat closure syntax.</p>
</div>
<div class="paragraph">
<p>Applying those modifications can be especially useful in mocking or stubbing scenarios as shown in the <a href="#testing_guide_emc">Testing Guide</a>.</p>
</div>
<div class="paragraph">
<p>Every <code>java.lang.Class</code> is supplied by Groovy with a special <code>metaClass</code> property that will give you a reference to an
<code>ExpandoMetaClass</code> instance. This instance can then be used to add methods or change the behaviour of already existing
ones.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default <code>ExpandoMetaClass</code> doesn’t do inheritance. To enable this you must call <code>ExpandoMetaClass#enableGlobally()</code>
before your app starts such as in the main method or servlet bootstrap.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following sections go into detail on how <code>ExpandoMetaClass</code> can be used in various scenarios.</p>
</div>
<div class="sect6">
<h7 id="_methods_4"><a class="anchor" href="#_methods_4"></a>Methods</h7>
<div class="paragraph">
<p>Once the <code>ExpandoMetaClass</code> is accessed by calling the <code>metaClass</code> property, methods can added by using either the left shift
<code>&lt;&lt;</code> or the <code>=</code> operator.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that the left shift operator is used to <em>append</em> a new method. If a public method with the same name and
parameter types is declared by the class or interface, including those inherited from superclasses and superinterfaces
but excluding those added to the <code>metaClass</code> at runtime, an exception will be thrown. If you want to <em>replace</em> a
method declared by the class or interface you can use the <code>=</code> operator.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The operators are applied on a non-existent property of <code>metaClass</code> passing an instance of a <code>Closure</code> code block.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="typ">String</span><span class="pln"> title
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Book</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">titleInUpperCase </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">{-&gt;</span><span class="pln"> title</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="str">"The Stand"</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"THE STAND"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">titleInUpperCase</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows how a new method can be added to a class by accessing the <code>metaClass</code> property and using the <code>&lt;&lt;</code> or
 <code>=</code> operator to assign a <code>Closure</code> code block. The <code>Closure</code> parameters are interpreted as method parameters. Parameterless methods
 can be added by using the <code>{→ …​}</code> syntax.</p>
</div>
</div>
<div class="sect6">
<h7 id="_properties_2"><a class="anchor" href="#_properties_2"></a>Properties</h7>
<div class="paragraph">
<p><code>ExpandoMetaClass</code> supports two mechanisms for adding or overriding properties.</p>
</div>
<div class="paragraph">
<p>Firstly, it has support for declaring a <em>mutable property</em> by simply assigning a value to a property of <code>metaClass</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="typ">String</span><span class="pln"> title
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Book</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">author </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Stephen King"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"Stephen King"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">author</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another way is to add getter and/or setter methods by using the standard mechanisms for adding instance methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> title
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">Book</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">getAuthor </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">{-&gt;</span><span class="pln"> </span><span class="str">"Stephen King"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"Stephen King"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">author</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the source code example above the property is dictated by the closure and is a read-only property. It is feasible to add
an equivalent setter method but then the property value needs to be stored for later usage. This could be done as
shown in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> title
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> properties </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Collections</span><span class="pun">.</span><span class="pln">synchronizedMap</span><span class="pun">([:])</span><span class="pln">

</span><span class="typ">Book</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">setAuthor </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> value </span><span class="pun">-&gt;</span><span class="pln">
   properties</span><span class="pun">[</span><span class="typ">System</span><span class="pun">.</span><span class="pln">identityHashCode</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"author"</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">Book</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">getAuthor </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{-&gt;</span><span class="pln">
   properties</span><span class="pun">[</span><span class="typ">System</span><span class="pun">.</span><span class="pln">identityHashCode</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"author"</span><span class="pun">]</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is not the only technique however. For example in a servlet container one way might be to store the values in
the currently executing request as request attributes (as is done in some cases in Grails).</p>
</div>
</div>
<div class="sect6">
<h7 id="_constructors_2"><a class="anchor" href="#_constructors_2"></a>Constructors</h7>
<div class="paragraph">
<p>Constructors can be added by using a special <code>constructor</code> property. Either the <code>&lt;&lt;</code> or <code>=</code> operator can be used
to assign a <code>Closure</code> code block. The <code>Closure</code> arguments will become the constructor arguments when the code is
executed at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> title
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">Book</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">constructor </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="pln">title</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">(</span><span class="str">'Groovy in Action - 2nd Edition'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> book</span><span class="pun">.</span><span class="pln">title </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Groovy in Action - 2nd Edition'</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Be careful when adding constructors however, as it is very easy to get into stack overflow troubles.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect6">
<h7 id="_static_methods"><a class="anchor" href="#_static_methods"></a>Static Methods</h7>
<div class="paragraph">
<p>Static methods can be added using the same technique as instance methods with the addition of the <code>static</code> qualifier
before the method name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="typ">String</span><span class="pln"> title
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Book</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="kwd">static</span><span class="pun">.</span><span class="pln">create </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="pln">title</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="str">"The Stand"</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_borrowing_methods"><a class="anchor" href="#_borrowing_methods"></a>Borrowing Methods</h7>
<div class="paragraph">
<p>With <code>ExpandoMetaClass</code> it is possible to use Groovy’s method pointer syntax to borrow methods from other classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MortgageLender</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> borrowMoney</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="str">"buy house"</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> lender </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MortgageLender</span><span class="pun">()</span><span class="pln">

</span><span class="typ">Person</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">buyHouse </span><span class="pun">=</span><span class="pln"> lender</span><span class="pun">.&amp;</span><span class="pln">borrowMoney

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"buy house"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">buyHouse</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_dynamic_method_names"><a class="anchor" href="#_dynamic_method_names"></a>Dynamic Method Names</h7>
<div class="paragraph">
<p>Since Groovy allows you to use Strings as property names this in turns allows you to dynamically create method and
property names at runtime. To create a method with a dynamic name simply use the language feature of reference property
names as strings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Fred"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> methodName </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Bob"</span><span class="pln">

</span><span class="typ">Person</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="str">"changeNameTo${methodName}"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{-&gt;</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Bob"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"Fred"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">name

p</span><span class="pun">.</span><span class="pln">changeNameToBob</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"Bob"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">name</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The same concept can be applied to static methods and properties.</p>
</div>
<div class="paragraph">
<p>One application of dynamic method names can be found in the Grails web application framework. The concept of "dynamic
codecs" is implemented by using dynamic method names.</p>
</div>
<div class="listingblock">
<div class="title"><code>HTMLCodec</code> Class</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">HTMLCodec</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> encode </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> theTarget </span><span class="pun">-&gt;</span><span class="pln">
        </span><span class="typ">HtmlUtils</span><span class="pun">.</span><span class="pln">htmlEscape</span><span class="pun">(</span><span class="pln">theTarget</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">())</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">static</span><span class="pln"> decode </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> theTarget </span><span class="pun">-&gt;</span><span class="pln">
    	</span><span class="typ">HtmlUtils</span><span class="pun">.</span><span class="pln">htmlUnescape</span><span class="pun">(</span><span class="pln">theTarget</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">())</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above shows a codec implementation. Grails comes with various codec implementations each defined in a single class.
At runtime there will be multiple codec classes in the application classpath. At application startup the framework adds
a <code>encodeXXX</code> and a <code>decodeXXX</code> method to certain meta-classes where <code>XXX</code> is the first part of the codec class name (e.g.
<code>encodeHTML</code>). This mechanism is in the following shown in some Groovy pseudo-code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> codecs </span><span class="pun">=</span><span class="pln"> classes</span><span class="pun">.</span><span class="pln">findAll </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">endsWith</span><span class="pun">(</span><span class="str">'Codec'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

codecs</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> codec </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="str">"encodeAs${codec.name-'Codec'}"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">().</span><span class="pln">encode</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Object</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="str">"decodeFrom${codec.name-'Codec'}"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> codec</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">().</span><span class="pln">decode</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">


</span><span class="kwd">def</span><span class="pln"> html </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;html&gt;&lt;body&gt;hello&lt;/body&gt;&lt;/html&gt;'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">'&lt;html&gt;&lt;body&gt;hello&lt;/body&gt;&lt;/html&gt;'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> html</span><span class="pun">.</span><span class="pln">encodeAsHTML</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="_runtime_discovery"><a class="anchor" href="#_runtime_discovery"></a>Runtime Discovery</h7>
<div class="paragraph">
<p>At runtime it is often useful to know what other methods or properties exist at the time the method is executed. <code>ExpandoMetaClass</code>
provides the following methods as of this writing:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getMetaMethod</code></p>
</li>
<li>
<p><code>hasMetaMethod</code></p>
</li>
<li>
<p><code>getMetaProperty</code></p>
</li>
<li>
<p><code>hasMetaProperty</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Why can’t you just use reflection? Well because Groovy is different, it has the methods that are "real" methods and
methods that are available only at runtime. These are sometimes (but not always) represented as MetaMethods. The
MetaMethods tell you what methods are available at runtime, thus your code can adapt.</p>
</div>
<div class="paragraph">
<p>This is of particular use when overriding <code>invokeMethod</code>, <code>getProperty</code> and/or <code>setProperty</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_groovyobject_methods"><a class="anchor" href="#_groovyobject_methods"></a>GroovyObject Methods</h7>
<div class="paragraph">
<p>Another feature of <code>ExpandoMetaClass</code> is that it allows to override the methods <code>invokeMethod</code>, <code>getProperty</code> and
<code>setProperty</code>, all of them can be found in the <code>groovy.lang.GroovyObject</code> class.</p>
</div>
<div class="paragraph">
<p>The following example shows how to override <code>invokeMethod</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Stuff</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> invokeMe</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"foo"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Stuff</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">invokeMethod </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> args </span><span class="pun">-&gt;</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> metaMethod </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Stuff</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">getMetaMethod</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> result
   </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">metaMethod</span><span class="pun">)</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> metaMethod</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">,</span><span class="pln">args</span><span class="pun">)</span><span class="pln">
   </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"bar"</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
   result
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> stf </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Stuff</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"foo"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> stf</span><span class="pun">.</span><span class="pln">invokeMe</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"bar"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> stf</span><span class="pun">.</span><span class="pln">doStuff</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first step in the <code>Closure</code> code is to lookup the <code>MetaMethod</code> for the given name and arguments. If the method
can be found everything is fine and it is delegated to. If not, a dummy value is returned.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <code>MetaMethod</code> is a method that is known to exist on the <code>MetaClass</code> whether added at runtime or at compile-time.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The same logic can be used to override <code>setProperty</code> or <code>getProperty</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="typ">String</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Fred"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Person</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">getProperty </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name </span><span class="pun">-&gt;</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> metaProperty </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">getMetaProperty</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> result
   </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">metaProperty</span><span class="pun">)</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> metaProperty</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">)</span><span class="pln">
   </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Flintstone"</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
   result
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"Fred"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">name
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"Flintstone"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">other</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The important thing to note here is that instead of a <code>MetaMethod</code> a <code>MetaProperty</code> instance is looked up. If that exists
the <code>getProperty</code> method of the <code>MetaProperty</code> is called, passing the delegate.</p>
</div>
</div>
<div class="sect6">
<h7 id="_overriding_static_invokemethod"><a class="anchor" href="#_overriding_static_invokemethod"></a>Overriding Static invokeMethod</h7>
<div class="paragraph">
<p><code>ExpandoMetaClass</code> even allows for overriding static method with a special <code>invokeMethod</code> syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Stuff</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">static</span><span class="pln"> invokeMe</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"foo"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Stuff</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="str">'static'</span><span class="pun">.</span><span class="pln">invokeMethod </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> args </span><span class="pun">-&gt;</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> metaMethod </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Stuff</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">getStaticMetaMethod</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> result
   </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">metaMethod</span><span class="pun">)</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> metaMethod</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">,</span><span class="pln">args</span><span class="pun">)</span><span class="pln">
   </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      result </span><span class="pun">=</span><span class="pln"> </span><span class="str">"bar"</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
   result
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"foo"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Stuff</span><span class="pun">.</span><span class="pln">invokeMe</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"bar"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Stuff</span><span class="pun">.</span><span class="pln">doStuff</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The logic that is used for overriding the static method is the same as we’ve seen before for overriding instance methods. The
only difference is the access to the <code>metaClass.static</code> property and the call to <code>getStaticMethodName</code> for retrieving
the static <code>MetaMethod</code> instance.</p>
</div>
</div>
<div class="sect6">
<h7 id="_extending_interfaces"><a class="anchor" href="#_extending_interfaces"></a>Extending Interfaces</h7>
<div class="paragraph">
<p>It is possible to add methods onto interfaces with <code>ExpandoMetaClass</code>. To do this however, it <strong>must</strong> be enabled
globally using the <code>ExpandoMetaClass.enableGlobally()</code> method before application start-up.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">List</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">sizeDoubled </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{-&gt;</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">

list </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
list </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">2</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">sizeDoubled</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_extension_modules"><a class="anchor" href="#_extension_modules"></a>Extension modules</h5>
<div class="sect5">
<h6 id="_extending_existing_classes"><a class="anchor" href="#_extending_existing_classes"></a>Extending existing classes</h6>
<div class="paragraph">
<p>An extension module allows you to add new methods to existing classes, including classes which are precompiled, like
classes from the JDK. Those new methods, unlike those defined through a metaclass or using a category, are available
globally. For example, when you write:</p>
</div>
<div class="listingblock">
<div class="title">Standard extension method</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> file </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(...)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> contents </span><span class="pun">=</span><span class="pln"> file</span><span class="pun">.</span><span class="pln">getText</span><span class="pun">(</span><span class="str">'utf-8'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>getText</code> method doesn’t exist on the <code>File</code> class. However, Groovy knows it because it is defined in a special
class, <code>ResourceGroovyMethods</code>:</p>
</div>
<div class="listingblock">
<div class="title">ResourceGroovyMethods.java</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getText</span><span class="pun">(</span><span class="typ">File</span><span class="pln"> file</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> charset</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
 </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">IOGroovyMethods</span><span class="pun">.</span><span class="pln">getText</span><span class="pun">(</span><span class="pln">newReader</span><span class="pun">(</span><span class="pln">file</span><span class="pun">,</span><span class="pln"> charset</span><span class="pun">));</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You may notice that the extension method is defined using a static method in a helper class (where various extension
methods are defined). The first argument of the <code>getText</code> method corresponds to the receiver, while additional parameters
correspond to the arguments of the extension method. So here, we are defining a method called <em>getText</em> on
the <code>File</code> class (because the first argument is of type <code>File</code>), which takes a single argument as a parameter (the encoding <code>String</code>).</p>
</div>
<div class="paragraph">
<p>The process of creating an extension module is simple:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>write an extension class like above</p>
</li>
<li>
<p>write a module descriptor file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then you have to make the extension module visible to Groovy, which is as simple as having the extension module classes
and descriptor available on classpath. This means that you have the choice:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>either provide the classes and module descriptor directly on classpath</p>
</li>
<li>
<p>or bundle your extension module into a jar for reusability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An extension module may add two kind of methods to a class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>instance methods (to be called on an instance of a class)</p>
</li>
<li>
<p>static methods (to be called on the class itself)</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_instance_methods"><a class="anchor" href="#_instance_methods"></a>Instance methods</h6>
<div class="paragraph">
<p>To add an instance method to an existing class, you need to create an extension class. For example, let’s say you
want to add a <code>maxRetries</code> method on <code>Integer</code> which accepts a closure and executes it at most <em>n</em> times until no
exception is thrown. To do that, you only need to write the following:</p>
</div>
<div class="listingblock">
<div class="title">MaxRetriesExtension.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">MaxRetriesExtension</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                     </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> maxRetries</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> code</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> retries </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        </span><span class="typ">Throwable</span><span class="pln"> e
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">retries</span><span class="pun">&lt;</span><span class="kwd">self</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                code</span><span class="pun">.</span><span class="pln">call</span><span class="pun">()</span><span class="pln">
                </span><span class="kwd">break</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Throwable</span><span class="pln"> err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                e </span><span class="pun">=</span><span class="pln"> err
                retries</span><span class="pun">++</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">retries</span><span class="pun">==</span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> e
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The extension class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>First argument of the static method corresponds to the receiver of the message, that is to say the extended instance</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Then, after <a href="#module-descriptor">having declared your extension class</a>, you can call it this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pln">
</span><span class="lit">5.maxRetries</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    i</span><span class="pun">++</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> i </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
i</span><span class="pun">=</span><span class="lit">0</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">5.maxRetries</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">(</span><span class="str">"oops"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">RuntimeException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> i </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_static_methods_2"><a class="anchor" href="#_static_methods_2"></a>Static methods</h6>
<div class="paragraph">
<p>It is also possible to add static methods to a class. In that case, the static method needs to be defined in its <strong>own</strong>
file. Static and instance extension methods <strong>cannot</strong> be present in the same class.</p>
</div>
<div class="listingblock">
<div class="title">StaticStringExtension.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">StaticStringExtension</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> greeting</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                           </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The static extension class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>First argument of the static method corresponds to the class being extended and is <strong>unused</strong></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In which case you can call it directly on the <code>String</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello, world!'</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="module-descriptor"><a class="anchor" href="#module-descriptor"></a>Module descriptor</h6>
<div class="paragraph">
<p>For Groovy to be able to load your extension methods, you must declare
your extension helper classes. You must create a file named
<code>org.codehaus.groovy.runtime.ExtensionModule</code> into the
<code>META-INF/services</code> directory:</p>
</div>
<div class="listingblock">
<div class="title">org.codehaus.groovy.runtime.ExtensionModule</div>
<div class="content">
<pre>moduleName=Test module for specifications
moduleVersion=1.0-test
extensionClasses=support.MaxRetriesExtension
staticExtensionClasses=support.StaticStringExtension</pre>
</div>
</div>
<div class="paragraph">
<p>The module descriptor requires 4 keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>moduleName</em> : the name of your module</p>
</li>
<li>
<p><em>moduleVersion</em>: the version of your module. Note that version number
is only used to check that you don’t load the same module in two
different versions.</p>
</li>
<li>
<p><em>extensionClasses</em>: the list of extension helper classes for instance
methods. You can provide several classes, given that they are comma
separated.</p>
</li>
<li>
<p><em>staticExtensionClasses</em>: the list of extension helper classes for
static methods. You can provide several classes, given that they are
comma separated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that it is not required for a module to define both static helpers
and instance helpers, and that you may add several classes to a single
module. You can also extend different classes in a single module without
problem. It is even possible to use different classes in a single
extension class, but it is recommended to group extension methods into
classes by feature set.</p>
</div>
</div>
<div class="sect5">
<h6 id="_extension_modules_and_classpath"><a class="anchor" href="#_extension_modules_and_classpath"></a>Extension modules and classpath</h6>
<div class="paragraph">
<p>It’s worth noting that you can’t use an extension which is compiled at the same time as code using it. That means that
to use an extension, it <strong>has</strong> to be available on classpath, as compiled classes, before the code using it gets compiled.
Usually, this means that you can’t have the <em>test</em> classes in the same source unit as the extension class itself. Since
in general, test sources are separated from normal sources and executed in another step of the build, this is not an issue.</p>
</div>
</div>
<div class="sect5">
<h6 id="_compatibility_with_type_checking"><a class="anchor" href="#_compatibility_with_type_checking"></a>Compatibility with type checking</h6>
<div class="paragraph">
<p>Unlike categories, extension modules are compatible with type checking: if they are found on classpath, then the type
checker is aware of the extension methods and will not complain when you call them. It is also compatible with static
compilation.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_compile_time_metaprogramming"><a class="anchor" href="#_compile_time_metaprogramming"></a>3.4.2. Compile-time metaprogramming</h4>
<div class="paragraph">
<p>Compile-time metaprogramming in Groovy allows code generation at compile-time. Those transformations are altering the
Abstract Syntax Tree (AST) of a program, which is why in Groovy we call it AST transformations. AST transformations
allow you to hook into the compilation process, modify the AST and continue the compilation process to generate regular
bytecode. Compared to runtime metaprogramming, this has the advantage of making the changes visible in the class file
itself (that is to say, in the bytecode). Making it visible in the bytecode is important for example if you want the
transformations to be part of the class contract (implementing interfaces, extending abstract classes, …​) or even
if you need your class to be callable from Java (or other JVM languages). For example, an AST transformation can add
methods to a class. If you do it with runtime metaprogramming, the new method would only be visible from Groovy. If you
do the same using compile-time metaprogramming, the method would be visible from Java too. Last but not least, performance
would likely be better with compile-time metaprogramming (because no initialization phase is required).</p>
</div>
<div class="paragraph">
<p>In this section, we will start with explaining the various compile-time transformations that are bundled with the Groovy
distribution. In a subsequent section, we will describe how you can <a href="#developing-ast-xforms">implement your own AST transformations</a>
and what are the disadvantages of this technique.</p>
</div>
<div class="sect4">
<h5 id="_available_ast_transformations"><a class="anchor" href="#_available_ast_transformations"></a>Available AST transformations</h5>
<div class="paragraph">
<p>Groovy comes with various AST transformations covering different needs: reducing boilerplate (code generation), implementing
design patterns (delegation, …​), logging, declarative concurrency, cloning, safer scripting, tweaking the compilation,
implementing Swing patterns, testing and eventually managing dependencies. If none of those AST transformations cover
your needs, you can still implement your own, as show in section <a href="#developing-ast-xforms">Developing your own AST
transformations</a>.</p>
</div>
<div class="paragraph">
<p>AST transformations can be separated into two categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>global AST transformations are applied transparently, globally, as soon as they are found on compile classpath</p>
</li>
<li>
<p>local AST transformations are applied by annotating the source code with markers. Unlike global AST transformations,
local AST transformations may support parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Groovy doesn’t ship with any global AST transformation, but you can find a list of local AST transformations
available for you to use in your code here:</p>
</div>
<div class="sect5">
<h6 id="_code_generation_transformations"><a class="anchor" href="#_code_generation_transformations"></a>Code generation transformations</h6>
<div class="paragraph">
<p>This category of transformation includes AST transformations which help removing boilerplate code. This is typically
code that you have to write but that does not carry any useful information. By autogenerating this boilerplate code,
the code you have to write is left clean and concise and the chance of introducing an error by getting such
boilerplate code incorrect is reduced.</p>
</div>
<div class="sect6">
<h7 id="xform-ToString"><a class="anchor" href="#xform-ToString"></a><code>@groovy.transform.ToString</code></h7>
<div class="paragraph">
<p>The <code>@ToString</code> AST transformation generates a human readable <code>toString</code> representation of the class. For example,
annotating the <code>Person</code> class like below will automatically generate the <code>toString</code> method for you:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">ToString</span><span class="pln">

</span><span class="lit">@ToString</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this definition, then the following assertion passes, meaning that a <code>toString</code> method taking the field values from
the class and printing them out has been generated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack, Nicholson)'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@ToString</code> annotation accepts several parameters which are summarized in the following table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeNames</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include names of properties in generated toString.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ToString</span><span class="pun">(</span><span class="pln">includeNames</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(firstName:Jack, lastName:Nicholson)'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from toString</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ToString</span><span class="pun">(</span><span class="pln">excludes</span><span class="pun">=[</span><span class="str">'firstName'</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Nicholson)'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in toString</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ToString</span><span class="pun">(</span><span class="pln">includes</span><span class="pun">=[</span><span class="str">'lastName'</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Nicholson)'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should superclass be included in toString</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ToString</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> id </span><span class="pun">}</span><span class="pln">

</span><span class="lit">@ToString</span><span class="pun">(</span><span class="pln">includeSuper</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Id</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack, Nicholson, Id(1))'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should super properties be included in toString</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@ToString</span><span class="pun">(</span><span class="pln">includeSuperProperties </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> includeNames </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">BandMember</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> bandName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> bono </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BandMember</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Bono'</span><span class="pun">,</span><span class="pln"> bandName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'U2'</span><span class="pun">).</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> bono</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'BandMember(bandName:U2, name:Bono)'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in toString, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ToString</span><span class="pun">(</span><span class="pln">includeFields</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> age
    </span><span class="kwd">void</span><span class="pln"> test</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       age </span><span class="pun">=</span><span class="pln"> </span><span class="lit">42</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
p</span><span class="pun">.</span><span class="pln">test</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack, Nicholson, 42)'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreNulls</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties/fields with null value be displayed</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ToString</span><span class="pun">(</span><span class="pln">ignoreNulls</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack)'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includePackage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use fully qualified class name instead of simple name in toString</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ToString</span><span class="pun">(</span><span class="pln">includePackage</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'acme.Person(Jack, Nicholson)'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache the toString string. Should only be set to true if the class is immutable.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ToString</span><span class="pun">(</span><span class="pln">cache</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> s1 </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> s2 </span><span class="pun">=</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> s1 </span><span class="pun">==</span><span class="pln"> s2
</span><span class="kwd">assert</span><span class="pln"> s1 </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack, Nicholson)'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> s1</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="pln">s2</span><span class="pun">)</span><span class="pln"> </span><span class="com">// same instance</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-EqualsAndHashCode"><a class="anchor" href="#xform-EqualsAndHashCode"></a><code>@groovy.transform.EqualsAndHashCode</code></h7>
<div class="paragraph">
<p>The <code>@EqualsAndHashCode</code> AST transformation aims at generating <code>equals</code> and <code>hashCode</code> methods for you. The generated
hashcode follows the best practices as described in <em>Effective Java</em> by <em>Josh Bloch</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">EqualsAndHashCode</span><span class="pln">

</span><span class="lit">@EqualsAndHashCode</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">==</span><span class="pln">p2
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are several options available to tweak the behavior of <code>@EqualsAndHashCode</code>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from equals/hashCode</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">EqualsAndHashCode</span><span class="pln">

</span><span class="lit">@EqualsAndHashCode</span><span class="pun">(</span><span class="pln">excludes</span><span class="pun">=[</span><span class="str">'firstName'</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">==</span><span class="pln">p2
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in equals/hashCode</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">EqualsAndHashCode</span><span class="pln">

</span><span class="lit">@EqualsAndHashCode</span><span class="pun">(</span><span class="pln">includes</span><span class="pun">=[</span><span class="str">'lastName'</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Bob'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">==</span><span class="pln">p2
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">callSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to include super in equals and hashCode calculations</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">EqualsAndHashCode</span><span class="pln">

</span><span class="lit">@EqualsAndHashCode</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Living</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> race
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@EqualsAndHashCode</span><span class="pun">(</span><span class="pln">callSuper</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Living</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">race</span><span class="pun">:</span><span class="str">'Human'</span><span class="pun">,</span><span class="pln"> firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">race</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Human beeing'</span><span class="pun">,</span><span class="pln"> firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">!=</span><span class="pln">p2
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in equals/hashCode, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">EqualsAndHashCode</span><span class="pln">

</span><span class="lit">@EqualsAndHashCode</span><span class="pun">(</span><span class="pln">includeFields</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> firstName

    </span><span class="typ">Person</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> firstName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">firstName </span><span class="pun">=</span><span class="pln"> firstName
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p3 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Bob'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1 </span><span class="pun">==</span><span class="pln"> p2
</span><span class="kwd">assert</span><span class="pln"> p1 </span><span class="pun">!=</span><span class="pln"> p3</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache the hashCode computation. Should only be set to true if the class is immutable.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">EqualsAndHashCode</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Immutable</span><span class="pln">

</span><span class="lit">@Immutable</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">SlowHashCode</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        sleep </span><span class="lit">100</span><span class="pln">
        </span><span class="lit">127</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@EqualsAndHashCode</span><span class="pun">(</span><span class="pln">cache</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Immutable</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">SlowHashCode</span><span class="pln"> slowHashCode </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SlowHashCode</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">
p</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> start </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="pln">currentTimeMillis</span><span class="pun">()</span><span class="pln">
p</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="pln">currentTimeMillis</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> start </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">100</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useCanEqual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should equals call canEqual helper method.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>See <a href="http://www.artima.com/lejava/articles/equality.html" class="bare">http://www.artima.com/lejava/articles/equality.html</a></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-TupleConstructor"><a class="anchor" href="#xform-TupleConstructor"></a><code>@groovy.transform.TupleConstructor</code></h7>
<div class="paragraph">
<p>The <code>@TupleConstructor</code> annotation aims at eliminating boilerplate code by generating constructors for you. A tuple
constructor is created for each property, with default values (using the Java default values). For example, the
following code will generate 3 constructors:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">

</span><span class="lit">@TupleConstructor</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// traditional map-style constructor</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="com">// generated tuple constructor</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="com">// generated tuple constructor with default value for second property</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p3 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first constructor is a no-arg constructor which allows the traditional map-style construction. It is worth noting
that if the first property (or field) has type LinkedHashMap or if there is a single Map, AbstractMap or HashMap
property (or field), then the map-style mapping is not available.</p>
</div>
<div class="paragraph">
<p>The other constructors are generated by taking the properties in the order they are defined. Groovy will generate as
many constructors as they are properties (or fields, depending on the options).</p>
</div>
<div class="paragraph">
<p>The <code>@TupleConstructor</code> AST transformation accepts several configuration options:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">

</span><span class="lit">@TupleConstructor</span><span class="pun">(</span><span class="pln">excludes</span><span class="pun">=[</span><span class="str">'lastName'</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// will fail because the second property is excluded</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> p3 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">message</span><span class="pun">.</span><span class="pln">contains </span><span class="pun">(</span><span class="str">'Could not find matching constructor'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">

</span><span class="lit">@TupleConstructor</span><span class="pun">(</span><span class="pln">includes</span><span class="pun">=[</span><span class="str">'firstName'</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// will fail because the second property is not included</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> p3 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">message</span><span class="pun">.</span><span class="pln">contains </span><span class="pun">(</span><span class="str">'Could not find matching constructor'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields be included in tuple constructor generation, in addition to properties</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">

</span><span class="lit">@TupleConstructor</span><span class="pun">(</span><span class="pln">includeFields</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> occupation
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"$firstName $lastName: $occupation"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">,</span><span class="pln"> occupation</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Actor'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Actor'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">firstName </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">firstName
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">lastName </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">lastName
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Jack Nicholson: Actor'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">

</span><span class="lit">@TupleConstructor</span><span class="pun">(</span><span class="pln">includeProperties</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// will fail because properties are not included</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should fields from super classes be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> occupation
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> occupation</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">occupation </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@TupleConstructor</span><span class="pun">(</span><span class="pln">includeSuperFields</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"$firstName $lastName: ${occupation()}"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">,</span><span class="pln"> occupation</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Actor'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Actor'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">firstName </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">firstName
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">lastName </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">lastName
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Jack Nicholson: Actor'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSuperProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should properties from super classes be included in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> occupation
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@TupleConstructor</span><span class="pun">(</span><span class="pln">includeSuperProperties</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"$firstName $lastName: $occupation"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Actor'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">firstName </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">firstName
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">lastName </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">lastName
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Jack Nicholson: null'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Jack Nicholson: Actor'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">callSuper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should super properties be called within a call to the parent constructor rather than set as properties</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> occupation
    </span><span class="typ">Base</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
    </span><span class="typ">Base</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> job</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> occupation </span><span class="pun">=</span><span class="pln"> job</span><span class="pun">?.</span><span class="pln">toLowerCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@TupleConstructor</span><span class="pun">(</span><span class="pln">includeSuperProperties </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> callSuper</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"$firstName $lastName: $occupation"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'ACTOR'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">firstName </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">firstName
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">lastName </span><span class="pun">==</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">lastName
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Jack Nicholson: null'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Jack Nicholson: actor'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">force</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the transformation will do nothing if a constructor is already defined. Setting this property
to true, the constructor will be generated and it’s your responsibility to ensure that no duplicate constructor
is defined</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>See javadocs</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Canonical"><a class="anchor" href="#xform-Canonical"></a><code>@groovy.transform.Canonical</code></h7>
<div class="paragraph">
<p>The <code>@Canonical</code> AST transformation combines the effects of the <a href="#xform-ToString">@ToString</a>,
<a href="#xform-EqualsAndHashCode">@EqualsAndHashCode</a> and <a href="#xform-TupleConstructor">@TupleConstructor</a>
annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Canonical</span><span class="pln">

</span><span class="lit">@Canonical</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack, Nicholson)'</span><span class="pln"> </span><span class="com">// Effect of @ToString</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">,</span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln"> </span><span class="com">// Effect of @TupleConstructor</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack, Nicholson)'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">==</span><span class="pln">p2 </span><span class="com">// Effect of @EqualsAndHashCode</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()==</span><span class="pln">p2</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="com">// Effect of @EqualsAndHashCode</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A similar immutable class can be generated using the <a href="#xform-Immutable">@Immutable</a> AST transformation instead.
The <code>@Canonical</code> AST transformation supports several configuration options:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of properties to exclude from tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Canonical</span><span class="pln">

</span><span class="lit">@Canonical</span><span class="pun">(</span><span class="pln">excludes</span><span class="pun">=[</span><span class="str">'lastName'</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack)'</span><span class="pln"> </span><span class="com">// Effect of @ToString</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">)</span><span class="pln"> </span><span class="com">// Effect of @TupleConstructor</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack)'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">==</span><span class="pln">p2 </span><span class="com">// Effect of @EqualsAndHashCode</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()==</span><span class="pln">p2</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="com">// Effect of @EqualsAndHashCode</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of fields to include in tuple constructor generation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Canonical</span><span class="pln">

</span><span class="lit">@Canonical</span><span class="pun">(</span><span class="pln">includes</span><span class="pun">=[</span><span class="str">'firstName'</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">firstName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jack'</span><span class="pun">,</span><span class="pln"> lastName</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Nicholson'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack)'</span><span class="pln"> </span><span class="com">// Effect of @ToString</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="str">'Jack'</span><span class="pun">)</span><span class="pln"> </span><span class="com">// Effect of @TupleConstructor</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p2</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Jack)'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">==</span><span class="pln">p2 </span><span class="com">// Effect of @EqualsAndHashCode</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> p1</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()==</span><span class="pln">p2</span><span class="pun">.</span><span class="pln">hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="com">// Effect of @EqualsAndHashCode</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-InheritConstructors"><a class="anchor" href="#xform-InheritConstructors"></a><code>@groovy.transform.InheritConstructors</code></h7>
<div class="paragraph">
<p>The <code>@InheritConstructor</code> AST transformation aims at generating constructors matching super constructors for you. This
is in particular useful when overriding exception classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">InheritConstructors</span><span class="pln">

</span><span class="lit">@InheritConstructors</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CustomException</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Exception</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

</span><span class="com">// all those are generated constructors</span><span class="pln">
</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CustomException</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CustomException</span><span class="pun">(</span><span class="str">"A custom message"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CustomException</span><span class="pun">(</span><span class="str">"A custom message"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">())</span><span class="pln">
</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CustomException</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">())</span><span class="pln">

</span><span class="com">// Java 7 only</span><span class="pln">
</span><span class="com">// new CustomException("A custom message", new RuntimeException(), false, true)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@InheritConstructor</code> AST transformation supports the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">constructorAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the constructor during copying</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Retention</span><span class="pun">(</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Target</span><span class="pun">([</span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">CONSTRUCTOR</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">ConsAnno</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="lit">@ConsAnno</span><span class="pln"> </span><span class="typ">Base</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@InheritConstructors</span><span class="pun">(</span><span class="pln">constructorAnnotations</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Child</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Child</span><span class="pun">.</span><span class="pln">constructors</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">annotations</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">annotationType</span><span class="pun">().</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ConsAnno'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameterAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the constructor parameters when copying the constructor</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Retention</span><span class="pun">(</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">RUNTIME</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Target</span><span class="pun">([</span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">PARAMETER</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">ParamAnno</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">Base</span><span class="pun">(</span><span class="lit">@ParamAnno</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@InheritConstructors</span><span class="pun">(</span><span class="pln">parameterAnnotations</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Child</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Child</span><span class="pun">.</span><span class="pln">constructors</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">parameterAnnotations</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">].</span><span class="pln">annotationType</span><span class="pun">().</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ParamAnno'</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Category"><a class="anchor" href="#xform-Category"></a><code>@groovy.lang.Category</code></h7>
<div class="paragraph">
<p>The <code>@Category</code> AST transformation simplifies the creation of Groovy categories. Historically, a Groovy category was
written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">TripleCategory</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> triple</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="lit">3</span><span class="pun">*</span><span class="kwd">self</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">use</span><span class="pln"> </span><span class="pun">(</span><span class="typ">TripleCategory</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">9</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3.triple</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Category</code> transformation lets you write the same using an instance-style class, rather than a static class style.
This removes the need for having the first argument of each method being the receiver. The category can be written like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Category</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">TripleCategory</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln"> triple</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">3</span><span class="pun">*</span><span class="kwd">this</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">use</span><span class="pln"> </span><span class="pun">(</span><span class="typ">TripleCategory</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">9</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3.triple</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the mixed in class can be referenced using <code>this</code> instead. It’s also worth noting that using instance fields
in a category class is inherently unsafe: categories are not stateful (like traits).</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-IndexedProperty"><a class="anchor" href="#xform-IndexedProperty"></a><code>@groovy.transform.IndexedProperty</code></h7>
<div class="paragraph">
<p>The <code>@IndexedProperty</code> annotation aims at generating indexed getters/setters for properties of list/array types.
This is in particular useful if you want to use a Groovy class from Java. While Groovy supports GPath to access properties,
this is not available from Java. The <code>@IndexedProperty</code> annotation will generate indexed properties of the following
form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SomeBean</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@IndexedProperty</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> someArray </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">String</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
    </span><span class="lit">@IndexedProperty</span><span class="pln"> </span><span class="typ">List</span><span class="pln"> someList </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> bean </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SomeBean</span><span class="pun">()</span><span class="pln">
bean</span><span class="pun">.</span><span class="pln">setSomeArray</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">'value'</span><span class="pun">)</span><span class="pln">
bean</span><span class="pun">.</span><span class="pln">setSomeList</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">123</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> bean</span><span class="pun">.</span><span class="pln">someArray</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'value'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> bean</span><span class="pun">.</span><span class="pln">someList </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">123</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Lazy"><a class="anchor" href="#xform-Lazy"></a><code>@groovy.lang.Lazy</code></h7>
<div class="paragraph">
<p>The <code>@Lazy</code> AST transformation implements lazy initialization of fields. For example, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SomeBean</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Lazy</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pln"> myField
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>will produce the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">List</span><span class="pln"> $myField
</span><span class="typ">List</span><span class="pln"> getMyField</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$myField</span><span class="pun">!=</span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> $myField </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        $myField </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> $myField
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default value which is used to initialize the field is the default constructor of the declaration type. It is possible
to define a default value by using a closure on the right hand side of the property assignment, as in the following
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>class SomeBean {
    @Lazy LinkedList myField = { ['a','b','c']}()
}</pre>
</div>
</div>
<div class="paragraph">
<p>In that case, the generated code looks like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>List $myField
List getMyField() {
    if ($myField!=null) { return $myField }
    else {
        $myField = { ['a','b','c']}()
        return $myField
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>If the field is declared volatile then initialization will be synchronized using the
<a href="http://en.wikipedia.org/wiki/Double-checked_locking">double-checked locking</a> pattern.</p>
</div>
<div class="paragraph">
<p>Using the <code>soft=true</code> parameter, the helper field will use a <code>SoftReference</code> instead, providing a simple way to
implement caching. In that case, if the garbage collector decides to collect the reference, initialization will occur
the next time the field is accessed.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Newify"><a class="anchor" href="#xform-Newify"></a><code>@groovy.lang.Newify</code></h7>
<div class="paragraph">
<p>The <code>@Newify</code> AST transformation is used to bring alternative syntaxes to construct objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using the <code>Python</code> style:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Newify([Tree,Leaf])
class TreeBuilder {
    Tree tree = Tree(Leaf('A'),Leaf('B'),Tree(Leaf('C')))
}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>or using the <code>Ruby</code> style:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>@Newify([Tree,Leaf])
class TreeBuilder {
    Tree tree = Tree.new(Leaf.new('A'),Leaf.new('B'),Tree.new(Leaf.new('C')))
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Ruby</code> version can be disabled by setting the <code>auto</code> flag to <code>false</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Sortable"><a class="anchor" href="#xform-Sortable"></a><code>@groovy.transform.Sortable</code></h7>
<div class="paragraph">
<p>The <code>@Sortable</code> AST transformation is used to help write classes that are <code>Comparable</code> and easily sorted by
numerous properties. It is easy to use as shown in the following example where we annotate the <code>Person</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Sortable</span><span class="pln">

</span><span class="lit">@Sortable</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> first
    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
    </span><span class="typ">Integer</span><span class="pln"> born
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated class has the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it implements the <code>Comparable</code> interface</p>
</li>
<li>
<p>it contains a <code>compareTo</code> method with an implementation based on the natural ordering of the <code>first</code>, <code>last</code> and <code>born</code> properties</p>
</li>
<li>
<p>it has three methods returning comparators: <code>comparatorByFirst</code>, <code>comparatorByLast</code> and <code>comparatorByBorn</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The generated <code>compareTo</code> method will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> compareTo</span><span class="pun">(</span><span class="pln">java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">Object</span><span class="pln"> obj</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="pln">obj</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">obj </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">Integer</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">first </span><span class="pun">&lt;=&gt;</span><span class="pln"> obj</span><span class="pun">.</span><span class="pln">first
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> value
    </span><span class="pun">}</span><span class="pln">
    value </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">&lt;=&gt;</span><span class="pln"> obj</span><span class="pun">.</span><span class="kwd">last</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> value
    </span><span class="pun">}</span><span class="pln">
    value </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">born </span><span class="pun">&lt;=&gt;</span><span class="pln"> obj</span><span class="pun">.</span><span class="pln">born
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> value
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example of the generated comparators, the <code>comparatorByFirst</code> comparator will have a <code>compare</code> method that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> compare</span><span class="pun">(</span><span class="pln">java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">Object</span><span class="pln"> arg0</span><span class="pun">,</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">Object</span><span class="pln"> arg1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">arg0 </span><span class="pun">==</span><span class="pln"> arg1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">arg0 </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> arg1 </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">arg0 </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> arg1 </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> arg0</span><span class="pun">.</span><span class="pln">first </span><span class="pun">&lt;=&gt;</span><span class="pln"> arg1</span><span class="pun">.</span><span class="pln">first
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Person</code> class can be used wherever a <code>Comparable</code> is expected and the generated comparators
wherever a <code>Comparator</code> is expected as shown by these examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> people </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Johnny'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Depp'</span><span class="pun">,</span><span class="pln"> born</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1963</span><span class="pun">),</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Keira'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Knightley'</span><span class="pun">,</span><span class="pln"> born</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1985</span><span class="pun">),</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Geoffrey'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Rush'</span><span class="pun">,</span><span class="pln"> born</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1951</span><span class="pun">),</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Orlando'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Bloom'</span><span class="pun">,</span><span class="pln"> born</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1977</span><span class="pun">)</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> people</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> people</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">()*.</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Rush'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Depp'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Knightley'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Bloom'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">comparatorByFirst</span><span class="pun">())*.</span><span class="pln">first </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Geoffrey'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Johnny'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Keira'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Orlando'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">comparatorByLast</span><span class="pun">())*.</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Bloom'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Depp'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Knightley'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Rush'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">comparatorByBorn</span><span class="pun">())*.</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Rush'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Depp'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Bloom'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Knightley'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Normally, all properties are used in the generated <code>compareTo</code> method in the priority order in which they are defined.
You can include or exclude certain properties from the generated <code>compareTo</code> method by giving a list of property names
in the <code>includes</code> or <code>excludes</code> annotation attributes. If using <code>includes</code>, the order of the property names given will
determine the priority of properties when comparing. To illustrate, consider the following <code>Person</code> class definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Sortable</span><span class="pun">(</span><span class="pln">includes</span><span class="pun">=</span><span class="str">'first,born'</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> born
    </span><span class="typ">String</span><span class="pln"> first
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It will have two comparator methods <code>comparatorByFirst</code> and <code>comparatorByBorn</code> and the generated <code>compareTo</code> method will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> compareTo</span><span class="pun">(</span><span class="pln">java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">Object</span><span class="pln"> obj</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="pln">obj</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(</span><span class="pln">obj </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">Integer</span><span class="pln"> value </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">first </span><span class="pun">&lt;=&gt;</span><span class="pln"> obj</span><span class="pun">.</span><span class="pln">first
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> value
    </span><span class="pun">}</span><span class="pln">
    value </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">born </span><span class="pun">&lt;=&gt;</span><span class="pln"> obj</span><span class="pun">.</span><span class="pln">born
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">value </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> value
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>Person</code> class can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> people </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Ben'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Affleck'</span><span class="pun">,</span><span class="pln"> born</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1972</span><span class="pun">),</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Ben'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Stiller'</span><span class="pun">,</span><span class="pln"> born</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1965</span><span class="pun">)</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">()*.</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Stiller'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Affleck'</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Builder"><a class="anchor" href="#xform-Builder"></a><code>@groovy.transform.builder.Builder</code></h7>
<div class="paragraph">
<p>The <code>@Builder</code> AST transformation is used to help write classes that can be created using <em>fluent</em> api calls.
The transform supports multiple building strategies to cover a range of cases and there are a number
of configuration options to customize the building process. If you’re an AST hacker, you can also define your own
strategy class. The following table lists the available strategies that are bundled with Groovy and the
configuration options each strategy supports.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">builderClassName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">builderMethodName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildMethodName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes/excludes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SimpleStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chained setters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "set"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ExternalStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">explicit builder class, class being built untouched</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n/a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "build"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DefaultStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a nested helper class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <em>&lt;TypeName&gt;</em>Builder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "builder"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "build"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InitializerStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">creates a nested helper class providing type-safe fluent creation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default <em>&lt;TypeName&gt;</em>Initializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "createInitializer"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default "create" but usually only used internally</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes, default ""</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">SimpleStrategy</div>
<p>To use the <code>SimpleStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation, and specify the strategy as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">builderStrategy</span><span class="pun">=</span><span class="typ">SimpleStrategy</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> first
    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
    </span><span class="typ">Integer</span><span class="pln"> born
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, just call the setters in a chained fashion as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> p1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">().</span><span class="pln">setFirst</span><span class="pun">(</span><span class="str">'Johnny'</span><span class="pun">).</span><span class="pln">setLast</span><span class="pun">(</span><span class="str">'Depp'</span><span class="pun">).</span><span class="pln">setBorn</span><span class="pun">(</span><span class="lit">1963</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"$p1.first $p1.last"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Johnny Depp'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For each property, a generated setter will be created which looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> setFirst</span><span class="pun">(</span><span class="pln">java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">String</span><span class="pln"> first</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">first </span><span class="pun">=</span><span class="pln"> first
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can specify a prefix as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">builderStrategy</span><span class="pun">=</span><span class="typ">SimpleStrategy</span><span class="pun">,</span><span class="pln"> prefix</span><span class="pun">=</span><span class="str">""</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> first
    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
    </span><span class="typ">Integer</span><span class="pln"> born
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And calling the chained setters would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">().</span><span class="pln">first</span><span class="pun">(</span><span class="str">'Johnny'</span><span class="pun">).</span><span class="kwd">last</span><span class="pun">(</span><span class="str">'Depp'</span><span class="pun">).</span><span class="pln">born</span><span class="pun">(</span><span class="lit">1963</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"$p.first $p.last"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Johnny Depp'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the <code>SimpleStrategy</code> in conjunction with <code>@Canonical</code>. If your <code>@Builder</code> annotation doesn’t have
explicit <code>includes</code> or <code>excludes</code> annotation attributes but your <code>@Canonical</code> annotation does, the ones
from <code>@Canonical</code> will be re-used for <code>@Builder</code>.</p>
</div>
<div class="paragraph">
<p>The annotation attributes <code>builderClassName</code>, <code>buildMethodName</code>, <code>builderMethodName</code> and <code>forClass</code> are not supported for this strategy.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Groovy already has built-in building mechanisms. Don’t rush to using <code>@Builder</code> if the built-in mechanisms meet your needs. Some examples:
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> p2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Keira'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Knightley'</span><span class="pun">,</span><span class="pln"> born</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1985</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> p3 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">().</span><span class="kwd">with</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    first </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Geoffrey'</span><span class="pln">
    </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Rush'</span><span class="pln">
    born </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1951</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">ExternalStrategy</div>
<p>To use the <code>ExternalStrategy</code>, create and annotate a Groovy builder class using the <code>@Builder</code> annotation, specify the
class the builder is for using <code>forClass</code> and indicate use of the <code>ExternalStrategy</code>.
Suppose you have the following class you would like a builder for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> first
    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> born
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>you explicitly create and use your builder class as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">builderStrategy</span><span class="pun">=</span><span class="typ">ExternalStrategy</span><span class="pun">,</span><span class="pln"> forClass</span><span class="pun">=</span><span class="typ">Person</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonBuilder</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonBuilder</span><span class="pun">().</span><span class="pln">first</span><span class="pun">(</span><span class="str">'Johnny'</span><span class="pun">).</span><span class="kwd">last</span><span class="pun">(</span><span class="str">'Depp'</span><span class="pun">).</span><span class="pln">born</span><span class="pun">(</span><span class="lit">1963</span><span class="pun">).</span><span class="pln">build</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"$p.first $p.last"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Johnny Depp'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the (normally empty) builder class you provide will be filled in with appropriate setters and a build method.
The generated build method will look something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> build</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> _thePerson </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">
    _thePerson</span><span class="pun">.</span><span class="pln">first </span><span class="pun">=</span><span class="pln"> first
    _thePerson</span><span class="pun">.</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
    _thePerson</span><span class="pun">.</span><span class="pln">born </span><span class="pun">=</span><span class="pln"> born
    </span><span class="kwd">return</span><span class="pln"> _thePerson
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The class you are creating the builder for can be any Java or Groovy class following the normal JavaBean conventions,
e.g. a no-arg constructor and setters for the properties. Here is an example using a Java class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">builderStrategy</span><span class="pun">=</span><span class="typ">ExternalStrategy</span><span class="pun">,</span><span class="pln"> forClass</span><span class="pun">=</span><span class="pln">javax</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.</span><span class="typ">DefaultButtonModel</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ButtonModelBuilder</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> model </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ButtonModelBuilder</span><span class="pun">().</span><span class="pln">enabled</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">).</span><span class="pln">pressed</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">).</span><span class="pln">armed</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">).</span><span class="pln">rollover</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">).</span><span class="pln">selected</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">).</span><span class="pln">build</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> model</span><span class="pun">.</span><span class="pln">isArmed</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> model</span><span class="pun">.</span><span class="pln">isPressed</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> model</span><span class="pun">.</span><span class="pln">isEnabled</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> model</span><span class="pun">.</span><span class="pln">isSelected</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> model</span><span class="pun">.</span><span class="pln">isRollover</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated builder can be customised using the <code>prefix</code>, <code>includes</code>, <code>excludes</code> and <code>buildMethodName</code> annotation attributes.
Here is an example illustrating various customisations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Canonical</span><span class="pln">

</span><span class="lit">@Canonical</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> first
    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> born
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">builderStrategy</span><span class="pun">=</span><span class="typ">ExternalStrategy</span><span class="pun">,</span><span class="pln"> forClass</span><span class="pun">=</span><span class="typ">Person</span><span class="pun">,</span><span class="pln"> includes</span><span class="pun">=[</span><span class="str">'first'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'last'</span><span class="pun">],</span><span class="pln"> buildMethodName</span><span class="pun">=</span><span class="str">'create'</span><span class="pun">,</span><span class="pln"> prefix</span><span class="pun">=</span><span class="str">'with'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">PersonBuilder</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PersonBuilder</span><span class="pun">().</span><span class="pln">withFirst</span><span class="pun">(</span><span class="str">'Johnny'</span><span class="pun">).</span><span class="pln">withLast</span><span class="pun">(</span><span class="str">'Depp'</span><span class="pun">).</span><span class="pln">create</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"$p.first $p.last"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Johnny Depp'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>builderMethodName</code> and <code>builderClassName</code> annotation attributes for <code>@Builder</code> aren’t applicable for this strategy.</p>
</div>
<div class="paragraph">
<p>You can use the <code>ExternalStrategy</code> in conjunction with <code>@Canonical</code>. If your <code>@Builder</code> annotation doesn’t have
explicit <code>includes</code> or <code>excludes</code> annotation attributes but the <code>@Canonical</code> annotation of the class you are creating
the builder for does, the ones from <code>@Canonical</code> will be re-used for <code>@Builder</code>.</p>
</div>
<div class="paragraph">
<div class="title">DefaultStrategy</div>
<p>To use the <code>DefaultStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.</span><span class="typ">Builder</span><span class="pln">

</span><span class="lit">@Builder</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
    </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">().</span><span class="pln">firstName</span><span class="pun">(</span><span class="str">"Robert"</span><span class="pun">).</span><span class="pln">lastName</span><span class="pun">(</span><span class="str">"Lewandowski"</span><span class="pun">).</span><span class="pln">age</span><span class="pun">(</span><span class="lit">21</span><span class="pun">).</span><span class="pln">build</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">firstName </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Robert"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">lastName </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Lewandowski"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> person</span><span class="pun">.</span><span class="pln">age </span><span class="pun">==</span><span class="pln"> </span><span class="lit">21</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want, you can customize various aspects of the building process
using the <code>builderClassName</code>, <code>buildMethodName</code>, <code>builderMethodName</code>, <code>prefix</code>, <code>includes</code> and <code>excludes</code> annotation attributes,
some of which are used in the example here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.</span><span class="typ">Builder</span><span class="pln">

</span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">buildMethodName</span><span class="pun">=</span><span class="str">'make'</span><span class="pun">,</span><span class="pln"> builderMethodName</span><span class="pun">=</span><span class="str">'maker'</span><span class="pun">,</span><span class="pln"> prefix</span><span class="pun">=</span><span class="str">'with'</span><span class="pun">,</span><span class="pln"> excludes</span><span class="pun">=</span><span class="str">'age'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
    </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">maker</span><span class="pun">().</span><span class="pln">withFirstName</span><span class="pun">(</span><span class="str">"Robert"</span><span class="pun">).</span><span class="pln">withLastName</span><span class="pun">(</span><span class="str">"Lewandowski"</span><span class="pun">).</span><span class="pln">make</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"$p.firstName $p.lastName"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Robert Lewandowski"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This strategy also supports annotating static methods and constructors. In this case, the static method or constructor
parameters become the properties to use for building purposes and in the case of static methods, the return type
of the method becomes the target class being built. If you have more than one <code>@Builder</code> annotation used within
a class (at either the class, method or constructor positions) then it is up to you to ensure that the generated
helper classes and factory methods have unique names (i.e. no more than one can use the default name values).
Here is an example highlighting method and constructor usage (and also illustrating the renaming required for unique names).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@ToString</span><span class="pln">
</span><span class="lit">@Builder</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> first</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
  </span><span class="kwd">int</span><span class="pln"> born

  </span><span class="typ">Person</span><span class="pun">(){}</span><span class="pln">

  </span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">builderClassName</span><span class="pun">=</span><span class="str">'MovieBuilder'</span><span class="pun">,</span><span class="pln"> builderMethodName</span><span class="pun">=</span><span class="str">'byRoleBuilder'</span><span class="pun">)</span><span class="pln">
  </span><span class="typ">Person</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> roleName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
     </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">roleName </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Jack Sparrow'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
         </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">first </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Johnny'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Depp'</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">born </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1963</span><span class="pln">
     </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">builderClassName</span><span class="pun">=</span><span class="str">'NameBuilder'</span><span class="pun">,</span><span class="pln"> builderMethodName</span><span class="pun">=</span><span class="str">'nameBuilder'</span><span class="pun">,</span><span class="pln"> prefix</span><span class="pun">=</span><span class="str">'having'</span><span class="pun">,</span><span class="pln"> buildMethodName</span><span class="pun">=</span><span class="str">'fullName'</span><span class="pun">)</span><span class="pln">
  </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> join</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> first</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      first </span><span class="pun">+</span><span class="pln"> </span><span class="str">' '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">

  </span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">builderClassName</span><span class="pun">=</span><span class="str">'SplitBuilder'</span><span class="pun">,</span><span class="pln"> builderMethodName</span><span class="pun">=</span><span class="str">'splitBuilder'</span><span class="pun">)</span><span class="pln">
  </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> split</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> year</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="kwd">def</span><span class="pln"> parts </span><span class="pun">=</span><span class="pln"> name</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">' '</span><span class="pun">)</span><span class="pln">
      </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="pln"> parts</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> parts</span><span class="pun">[</span><span class="lit">1</span><span class="pun">],</span><span class="pln"> born</span><span class="pun">:</span><span class="pln"> year</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">splitBuilder</span><span class="pun">().</span><span class="pln">name</span><span class="pun">(</span><span class="str">"Johnny Depp"</span><span class="pun">).</span><span class="pln">year</span><span class="pun">(</span><span class="lit">1963</span><span class="pun">).</span><span class="pln">build</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Johnny, Depp, 1963)'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">byRoleBuilder</span><span class="pun">().</span><span class="pln">roleName</span><span class="pun">(</span><span class="str">"Jack Sparrow"</span><span class="pun">).</span><span class="pln">build</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Johnny, Depp, 1963)'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">nameBuilder</span><span class="pun">().</span><span class="pln">havingFirst</span><span class="pun">(</span><span class="str">'Johnny'</span><span class="pun">).</span><span class="pln">havingLast</span><span class="pun">(</span><span class="str">'Depp'</span><span class="pun">).</span><span class="pln">fullName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Johnny Depp'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">().</span><span class="pln">first</span><span class="pun">(</span><span class="str">"Johnny"</span><span class="pun">).</span><span class="kwd">last</span><span class="pun">(</span><span class="str">'Depp'</span><span class="pun">).</span><span class="pln">born</span><span class="pun">(</span><span class="lit">1963</span><span class="pun">).</span><span class="pln">build</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(Johnny, Depp, 1963)'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>forClass</code> annotation attribute is not supported for this strategy.</p>
</div>
<div class="paragraph">
<div class="title">InitializerStrategy</div>
<p>To use the <code>InitializerStrategy</code>, annotate your Groovy class using the <code>@Builder</code> annotation, and specify the strategy as shown in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@ToString</span><span class="pln">
</span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">builderStrategy</span><span class="pun">=</span><span class="typ">InitializerStrategy</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> firstName
    </span><span class="typ">String</span><span class="pln"> lastName
    </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Your class will be locked down to have a single public constructor taking a "fully set" initializer.
It will also have a factory method to create the initializer. These are used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@CompileStatic</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> firstLastAge</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="typ">Person</span><span class="pun">.</span><span class="pln">createInitializer</span><span class="pun">().</span><span class="pln">firstName</span><span class="pun">(</span><span class="str">"John"</span><span class="pun">).</span><span class="pln">lastName</span><span class="pun">(</span><span class="str">"Smith"</span><span class="pun">).</span><span class="pln">age</span><span class="pun">(</span><span class="lit">21</span><span class="pun">)).</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person(John, Smith, 21)'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
firstLastAge</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Any attempt to use the initializer which doesn’t involve setting all 
the properties (though order is not important) will result in
a compilation error. If you don’t need this level of strictness, you 
don’t need to use <code>@CompileStatic</code>.</p>
</div>
<div class="paragraph">
<p>You can use the <code>InitializerStrategy</code> in conjunction with <code>@Canonical</code> and <code>@Immutable</code>. If your <code>@Builder</code> annotation
doesn’t have explicit <code>includes</code> or <code>excludes</code> annotation attributes but your <code>@Canonical</code> annotation does, the ones
from <code>@Canonical</code> will be re-used for <code>@Builder</code>. Here is an example using <code>@Builder</code> with <code>@Immutable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@Builder</span><span class="pun">(</span><span class="pln">builderStrategy</span><span class="pun">=</span><span class="typ">InitializerStrategy</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Immutable</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> first
    </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> born
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@CompileStatic</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> createFirstLastBorn</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="typ">Person</span><span class="pun">.</span><span class="pln">createInitializer</span><span class="pun">().</span><span class="pln">first</span><span class="pun">(</span><span class="str">'Johnny'</span><span class="pun">).</span><span class="kwd">last</span><span class="pun">(</span><span class="str">'Depp'</span><span class="pun">).</span><span class="pln">born</span><span class="pun">(</span><span class="lit">1963</span><span class="pun">))</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"$p.first $p.last $p.born"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Johnny Depp 1963'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

createFirstLastBorn</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This strategy also supports annotating static methods and constructors. In this case, the static method or constructor
parameters become the properties to use for building purposes and in the case of static methods, the return type
of the method becomes the target class being built. If you have more than one <code>@Builder</code> annotation used within
a class (at either the class, method or constructor positions) then it is up to you to ensure that the generated
helper classes and factory methods have unique names (i.e. no more than one can use the default name values).
For an example of method and constructor usage but using the <code>DefaultStrategy</code> strategy, consult that strategy’s
documentation.</p>
</div>
<div class="paragraph">
<p>The annotation attribute <code>forClass</code> is not supported for this strategy.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_class_design_annotations"><a class="anchor" href="#_class_design_annotations"></a>Class design annotations</h6>
<div class="paragraph">
<p>This category of annotations are aimed at simplifying the implementation of well-known design patterns (delegation,
singleton, …​) by using a declarative style.</p>
</div>
<div class="sect6">
<h7 id="xform-Delegate"><a class="anchor" href="#xform-Delegate"></a><code>@groovy.lang.Delegate</code></h7>
<div class="paragraph">
<p>The <code>@Delegate</code> AST transformation aims at implementing the delegation design pattern. In the following class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> </span><span class="kwd">when</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> title
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>when</code> field is annotated with <code>@Delegate</code>, meaning that the <code>Event</code> class will delegate calls to <code>Date</code> methods
to the <code>when</code> field. In this case, the generated code looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Event</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Date</span><span class="pln"> </span><span class="kwd">when</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> title
    </span><span class="kwd">boolean</span><span class="pln"> before</span><span class="pun">(</span><span class="typ">Date</span><span class="pln"> other</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">when</span><span class="pun">.</span><span class="pln">before</span><span class="pun">(</span><span class="pln">other</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can call the <code>before</code> method, for example, directly on the <code>Event</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> ev </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Event</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="str">'Groovy keynote'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">when</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'yyyy/MM/dd'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'2013/09/10'</span><span class="pun">))</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> now </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> ev</span><span class="pun">.</span><span class="pln">before</span><span class="pun">(</span><span class="pln">now</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The behavior of the <code>@Delegate</code> AST transformation can be changed using the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">interfaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the interfaces implemented by the field be implemented by the class too</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sayHello</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyGreeter</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> sayHello</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'Hello!'</span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DelegatingGreeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">// no explicit interface</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pln"> </span><span class="typ">MyGreeter</span><span class="pln"> greeter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyGreeter</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> greeter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DelegatingGreeter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> greeter </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="com">// interface was added transparently</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deprecated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, also delegates methods annotated with @Deprecated</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">WithDeprecation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Deprecated</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> foo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">WithoutDeprecation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Deprecated</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> bar</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Delegating</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pun">(</span><span class="pln">deprecated</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="typ">WithDeprecation</span><span class="pln"> </span><span class="kwd">with</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">WithDeprecation</span><span class="pun">()</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pln"> </span><span class="typ">WithoutDeprecation</span><span class="pln"> without </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">WithoutDeprecation</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Delegating</span><span class="pun">()</span><span class="pln">
d</span><span class="pun">.</span><span class="pln">foo</span><span class="pun">()</span><span class="pln"> </span><span class="com">// passes thanks to deprecated=true</span><span class="pln">
d</span><span class="pun">.</span><span class="pln">bar</span><span class="pun">()</span><span class="pln"> </span><span class="com">// fails because of @Deprecated</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">methodAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the methods of the delegate to your delegating method.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">WithAnnotations</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Transactional</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> method</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DelegatingWithoutAnnotations</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pln"> </span><span class="typ">WithAnnotations</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DelegatingWithAnnotations</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pun">(</span><span class="pln">methodAnnotations </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="typ">WithAnnotations</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DelegatingWithoutAnnotations</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DelegatingWithAnnotations</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d1</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getDeclaredMethod</span><span class="pun">(</span><span class="str">'method'</span><span class="pun">).</span><span class="pln">annotations</span><span class="pun">.</span><span class="pln">length</span><span class="pun">==</span><span class="lit">0</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d2</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getDeclaredMethod</span><span class="pun">(</span><span class="str">'method'</span><span class="pun">).</span><span class="pln">annotations</span><span class="pun">.</span><span class="pln">length</span><span class="pun">==</span><span class="lit">1</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">parameterAnnotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">False</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to carry over annotations from the method parameters of the delegate to your delegating method.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">WithAnnotations</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> method</span><span class="pun">(</span><span class="lit">@NotNull</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> str</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DelegatingWithoutAnnotations</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pln"> </span><span class="typ">WithAnnotations</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DelegatingWithAnnotations</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pun">(</span><span class="pln">parameterAnnotations </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="typ">WithAnnotations</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DelegatingWithoutAnnotations</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DelegatingWithAnnotations</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d1</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getDeclaredMethod</span><span class="pun">(</span><span class="str">'method'</span><span class="pun">,</span><span class="typ">String</span><span class="pun">).</span><span class="pln">parameterAnnotations</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">length</span><span class="pun">==</span><span class="lit">0</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> d2</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">getDeclaredMethod</span><span class="pun">(</span><span class="str">'method'</span><span class="pun">,</span><span class="typ">String</span><span class="pun">).</span><span class="pln">parameterAnnotations</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">length</span><span class="pun">==</span><span class="lit">1</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of methods to be excluded from delegation. For more fine-grained control, see also <code>excludeTypes</code>.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Worker</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> task1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> task2</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Delegating</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pun">(</span><span class="pln">excludes</span><span class="pun">=[</span><span class="str">'task2'</span><span class="pun">])</span><span class="pln"> </span><span class="typ">Worker</span><span class="pln"> worker </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Worker</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Delegating</span><span class="pun">()</span><span class="pln">
d</span><span class="pun">.</span><span class="pln">task1</span><span class="pun">()</span><span class="pln"> </span><span class="com">// passes</span><span class="pln">
d</span><span class="pun">.</span><span class="pln">task2</span><span class="pun">()</span><span class="pln"> </span><span class="com">// fails because method is excluded</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of methods to be included in delegation. For more fine-grained control, see also <code>includeTypes</code>.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Worker</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> task1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> task2</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Delegating</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pun">(</span><span class="pln">includes</span><span class="pun">=[</span><span class="str">'task1'</span><span class="pun">])</span><span class="pln"> </span><span class="typ">Worker</span><span class="pln"> worker </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Worker</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Delegating</span><span class="pun">()</span><span class="pln">
d</span><span class="pun">.</span><span class="pln">task1</span><span class="pun">()</span><span class="pln"> </span><span class="com">// passes</span><span class="pln">
d</span><span class="pun">.</span><span class="pln">task2</span><span class="pun">()</span><span class="pln"> </span><span class="com">// fails because method is not included</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludeTypes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of interfaces containing method signatures to be excluded from delegation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">AppendStringSelector</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">StringBuilder</span><span class="pln"> append</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> str</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">UpperStringBuilder</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pun">(</span><span class="pln">excludeTypes</span><span class="pun">=</span><span class="typ">AppendStringSelector</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">StringBuilder</span><span class="pln"> sb1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuilder</span><span class="pun">()</span><span class="pln">

    </span><span class="lit">@Delegate</span><span class="pun">(</span><span class="pln">includeTypes</span><span class="pun">=</span><span class="typ">AppendStringSelector</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">StringBuilder</span><span class="pln"> sb2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuilder</span><span class="pun">()</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> sb1</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> sb2</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">().</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> usb </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">UpperStringBuilder</span><span class="pun">()</span><span class="pln">
usb</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="lit">3.5d</span><span class="pun">)</span><span class="pln">
usb</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="str">'hello'</span><span class="pun">)</span><span class="pln">
usb</span><span class="pun">.</span><span class="pln">append</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> usb</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'3.5trueHELLO'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeTypes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of interfaces containing method signatures to be included in delegation</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">AppendBooleanSelector</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">StringBuilder</span><span class="pln"> append</span><span class="pun">(</span><span class="kwd">boolean</span><span class="pln"> b</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">AppendFloatSelector</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">StringBuilder</span><span class="pln"> append</span><span class="pun">(</span><span class="kwd">float</span><span class="pln"> b</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NumberBooleanBuilder</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pun">(</span><span class="pln">includeTypes</span><span class="pun">=</span><span class="typ">AppendBooleanSelector</span><span class="pun">,</span><span class="pln"> interfaces</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">StringBuilder</span><span class="pln"> nums </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuilder</span><span class="pun">()</span><span class="pln">
    </span><span class="lit">@Delegate</span><span class="pun">(</span><span class="pln">includeTypes</span><span class="pun">=[</span><span class="typ">AppendFloatSelector</span><span class="pun">],</span><span class="pln"> interfaces</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">StringBuilder</span><span class="pln"> bools </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuilder</span><span class="pun">()</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> result</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"${nums.toString()}</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Immutable"><a class="anchor" href="#xform-Immutable"></a><code>@groovy.transform.Immutable</code></h7>
<div class="paragraph">
<p>The <code>@Immutable</code> AST transformation simplifies the creation of immutable classes, that is to say classes for which
members are deemed immutable. For that, all you have to do is annotating the class like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Immutable</span><span class="pln">

</span><span class="lit">@Immutable</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Point</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> x
    </span><span class="kwd">int</span><span class="pln"> y
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Immutable classes generated with <code>@Immutable</code> are automatically made final. For a class to be immutable, you have to
make sure that properties are of an immutable type (primitive or boxed types), of a known-immutable type or another
class annotated with <code>@Immutable</code>. The effect of applying <code>@Immutable</code> to a class are pretty similar to those of
applying the <a href="#xform-Canonical">@Canonical</a> AST transformation, but with an immutable class: automatic generation of
<code>toString</code>, <code>equals</code> and <code>hashCode</code> methods for example, but trying to modify a property would throw a <code>ReadOnlyPropertyException</code>
in that case.</p>
</div>
<div class="paragraph">
<p>Since <code>@Immutable</code> relies on a predefined list of known immutable classes (like <code>java.net.URI</code> or <code>java.lang.String</code>
and fails if you use a type which is not in that list, you are allowed to instruct the transformation that some types
are deemed immutable thanks to the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">knownImmutableClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of classes which are deemed immutable.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Immutable</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">

</span><span class="lit">@TupleConstructor</span><span class="pln">
</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Point</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> x
    </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"($x,$y)"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Immutable</span><span class="pun">(</span><span class="pln">knownImmutableClasses</span><span class="pun">=[</span><span class="typ">Point</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Triangle</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Point</span><span class="pln"> a</span><span class="pun">,</span><span class="pln">b</span><span class="pun">,</span><span class="pln">c
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">knownImmutables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of property names which are deemed immutable.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Immutable</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TupleConstructor</span><span class="pln">

</span><span class="lit">@TupleConstructor</span><span class="pln">
</span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Point</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> x
    </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"($x,$y)"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Immutable</span><span class="pun">(</span><span class="pln">knownImmutables</span><span class="pun">=[</span><span class="str">'a'</span><span class="pun">,</span><span class="str">'b'</span><span class="pun">,</span><span class="str">'c'</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Triangle</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Point</span><span class="pln"> a</span><span class="pun">,</span><span class="pln">b</span><span class="pun">,</span><span class="pln">c
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">copyWith</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean whether to generate a <code>copyWith( Map )</code> method.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Immutable</span><span class="pln">

</span><span class="lit">@Immutable</span><span class="pun">(</span><span class="pln"> copyWith</span><span class="pun">=</span><span class="kwd">true</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln">  name
    </span><span class="typ">Integer</span><span class="pln"> age
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> bob   </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">User</span><span class="pun">(</span><span class="pln"> </span><span class="str">'bob'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">43</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> alice </span><span class="pun">=</span><span class="pln"> bob</span><span class="pun">.</span><span class="pln">copyWith</span><span class="pun">(</span><span class="pln"> name</span><span class="pun">:</span><span class="str">'alice'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> alice</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'alice'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> alice</span><span class="pun">.</span><span class="pln">age  </span><span class="pun">==</span><span class="pln"> </span><span class="lit">43</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Memoized"><a class="anchor" href="#xform-Memoized"></a><code>@groovy.transform.Memoized</code></h7>
<div class="paragraph">
<p>The <code>@Memoized</code> AST transformations simplifies the implementation of caching by allowing the result of method calls
to be cached just by annotating the method with <code>@Memoized</code>. Let’s imagine the following method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">long</span><span class="pln"> longComputation</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> seed</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// slow computation</span><span class="pln">
    </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">(</span><span class="lit">100</span><span class="pun">*</span><span class="pln">seed</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">System</span><span class="pun">.</span><span class="pln">nanoTime</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This emulates a long computation, based on the actual parameters of the method. Without <code>@Memoized</code>, each method call
would take several seconds plus it would return a random result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> longComputation</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> longComputation</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x</span><span class="pun">!=</span><span class="pln">y</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding <code>@Memoized</code> changes the semantics of the method by adding caching, based on the parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Memoized</span><span class="pln">
</span><span class="kwd">long</span><span class="pln"> longComputation</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> seed</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// slow computation</span><span class="pln">
    </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">(</span><span class="lit">100</span><span class="pun">*</span><span class="pln">seed</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">System</span><span class="pun">.</span><span class="pln">nanoTime</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> longComputation</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="com">// returns after 100 milliseconds</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> longComputation</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="com">// returns immediatly</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> z </span><span class="pun">=</span><span class="pln"> longComputation</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="com">// returns after 200 milliseconds</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x</span><span class="pun">==</span><span class="pln">y
</span><span class="kwd">assert</span><span class="pln"> x</span><span class="pun">!=</span><span class="pln">z</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The size of the cache can be configured using two optional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>protectedCacheSize</em>: the number of results which are guaranteed not to be cleared after garbage collection</p>
</li>
<li>
<p><em>maxCacheSize</em>: the maximum number of results that can be kept in memory</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, the size of the cache is unlimited and no cache result is protected from garbage collection. Setting a
<em>protectedCacheSize&gt;0</em> would create an unlimited cache with some results protected. Setting <em>maxCacheSize&gt;0</em> would
 create a limited cache but without any protection from garbage protection. Setting both would create a limited,
 protected cache.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Singleton"><a class="anchor" href="#xform-Singleton"></a><code>@groovy.lang.Singleton</code></h7>
<div class="paragraph">
<p>The <code>@Singleton</code> annotation can be used to implement the singleton design pattern on a class. The singleton instance
is defined eagerly by default, using class initialization, or lazily, in which case the field is initialized using
double checked locking.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Singleton</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GreetingService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> greeting</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Hello, $name!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">GreetingService</span><span class="pun">.</span><span class="pln">instance</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">(</span><span class="str">'Bob'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello, Bob!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the singleton is created eagerly when the class is initialized and available through the <code>instance</code> property.
It is possible to change the name of the singleton using the <code>property</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Singleton</span><span class="pun">(</span><span class="kwd">property</span><span class="pun">=</span><span class="str">'theOne'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GreetingService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> greeting</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Hello, $name!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">GreetingService</span><span class="pun">.</span><span class="pln">theOne</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">(</span><span class="str">'Bob'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello, Bob!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And it is also possible to make initialization lazy using the <code>lazy</code> parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Collaborator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> init </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="lit">@Singleton</span><span class="pun">(</span><span class="pln">lazy</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">,</span><span class="pln">strict</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GreetingService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> init</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
    </span><span class="typ">GreetingService</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Collaborator</span><span class="pun">.</span><span class="pln">init </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> greeting</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"Hello, $name!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">GreetingService</span><span class="pun">.</span><span class="pln">init</span><span class="pun">()</span><span class="pln"> </span><span class="com">// make sure class is initialized</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Collaborator</span><span class="pun">.</span><span class="pln">init </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="typ">GreetingService</span><span class="pun">.</span><span class="pln">instance
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Collaborator</span><span class="pun">.</span><span class="pln">init </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">GreetingService</span><span class="pun">.</span><span class="pln">instance</span><span class="pun">.</span><span class="pln">greeting</span><span class="pun">(</span><span class="str">'Bob'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello, Bob!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we also set the <code>strict</code> parameter to false, which allows us to define our own constructor.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-Mixin"><a class="anchor" href="#xform-Mixin"></a><code>@groovy.transform.Mixin</code></h7>
<div class="paragraph">
<p>Deprecated. Consider using traits instead.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_logging_improvements"><a class="anchor" href="#_logging_improvements"></a>Logging improvements</h6>
<div class="paragraph">
<p>Groovy provides AST transformation that helps integrating with the most widely used logging frameworks. It’s worth noting
that annotating a class with one of those annotations doesn’t prevent you from adding the appropriate logging framework
on classpath.</p>
</div>
<div class="paragraph">
<p>All transformations work in a similar way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add static final <code>log</code> field corresponding to the logger</p>
</li>
<li>
<p>wrap all calls to <code>log.level()</code> into the appropriate <code>log.isLevelEnabled</code> guard, depending on the underlying framework</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Those transformations support two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>value</code> (default <code>log</code>) corresponds to the name of the logger field</p>
</li>
<li>
<p><code>category</code> (defaults to the class name) is the name of the logger category</p>
</li>
</ul>
</div>
<div class="sect6">
<h7 id="xform-Log"><a class="anchor" href="#xform-Log"></a><code>@groovy.util.logging.Log</code></h7>
<div class="paragraph">
<p>The first logging AST transformation available is the <code>@Log</code> annotation which relies on the JDK logging framework. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="typ">Log</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        log</span><span class="pun">.</span><span class="pln">info </span><span class="str">'Called greeter'</span><span class="pln">
        println </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="typ">Level</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="typ">Logger</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Logger</span><span class="pun">.</span><span class="pln">getLogger</span><span class="pun">(</span><span class="typ">Greeter</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">log</span><span class="pun">.</span><span class="pln">isLoggable</span><span class="pun">(</span><span class="typ">Level</span><span class="pun">.</span><span class="pln">INFO</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            log</span><span class="pun">.</span><span class="pln">info </span><span class="str">'Called greeter'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        println </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Commons"><a class="anchor" href="#xform-Commons"></a><code>@groovy.util.logging.Commons</code></h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://commons.apache.org/proper/commons-logging/">Apache Commons Logging</a> framework using to the
<code>@Commons</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="typ">Commons</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        log</span><span class="pun">.</span><span class="pln">debug </span><span class="str">'Called greeter'</span><span class="pln">
        println </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="typ">LogFactory</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="typ">Log</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Log</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="typ">LogFactory</span><span class="pun">.</span><span class="pln">getLog</span><span class="pun">(</span><span class="typ">Greeter</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">log</span><span class="pun">.</span><span class="pln">isDebugEnabled</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            log</span><span class="pun">.</span><span class="pln">debug </span><span class="str">'Called greeter'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        println </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Log4j"><a class="anchor" href="#xform-Log4j"></a><code>@groovy.util.logging.Log4j</code></h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://logging.apache.org/log4j/1.2/">Apache Log4j 1.x</a> framework using to the
<code>@Log4j</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="typ">Log4j</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        log</span><span class="pun">.</span><span class="pln">debug </span><span class="str">'Called greeter'</span><span class="pln">
        println </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">log4j</span><span class="pun">.</span><span class="typ">Logger</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Logger</span><span class="pun">.</span><span class="pln">getLogger</span><span class="pun">(</span><span class="typ">Greeter</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">log</span><span class="pun">.</span><span class="pln">isDebugEnabled</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            log</span><span class="pun">.</span><span class="pln">debug </span><span class="str">'Called greeter'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        println </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Log4j2"><a class="anchor" href="#xform-Log4j2"></a><code>@groovy.util.logging.Log4j2</code></h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://logging.apache.org/log4j/2.x/">Apache Log4j 2.x</a> framework using to the
<code>@Log4j2</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="typ">Log4j2</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        log</span><span class="pun">.</span><span class="pln">debug </span><span class="str">'Called greeter'</span><span class="pln">
        println </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="pln">log4j</span><span class="pun">.</span><span class="typ">LogManager</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="pln">log4j</span><span class="pun">.</span><span class="typ">Logger</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="typ">LogManager</span><span class="pun">.</span><span class="pln">getLogger</span><span class="pun">(</span><span class="typ">Greeter</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">log</span><span class="pun">.</span><span class="pln">isDebugEnabled</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            log</span><span class="pun">.</span><span class="pln">debug </span><span class="str">'Called greeter'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        println </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-Slf4j"><a class="anchor" href="#xform-Slf4j"></a><code>@groovy.util.logging.Slf4j</code></h7>
<div class="paragraph">
<p>Groovy supports the <a href="http://www.slf4j.org/">Simple Logging Facade for Java (SLF4J)</a> framework using to the
<code>@Slf4j</code> annotation. Writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="typ">Slf4j</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        log</span><span class="pun">.</span><span class="pln">debug </span><span class="str">'Called greeter'</span><span class="pln">
        println </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">slf4j</span><span class="pun">.</span><span class="typ">LoggerFactory</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">slf4j</span><span class="pun">.</span><span class="typ">Logger</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="typ">LoggerFactory</span><span class="pun">.</span><span class="pln">getLogger</span><span class="pun">(</span><span class="typ">Greeter</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">log</span><span class="pun">.</span><span class="pln">isDebugEnabled</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            log</span><span class="pun">.</span><span class="pln">debug </span><span class="str">'Called greeter'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        println </span><span class="str">'Hello, world!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_declarative_concurrency"><a class="anchor" href="#_declarative_concurrency"></a>Declarative concurrency</h6>
<div class="paragraph">
<p>The Groovy language provides a set of annotations aimed at simplifying common concurrency patterns in a declarative
approach.</p>
</div>
<div class="sect6">
<h7 id="xform-Synchronized"><a class="anchor" href="#xform-Synchronized"></a><code>@groovy.transform.Synchronized</code></h7>
<div class="paragraph">
<p>The <code>@Synchronized</code> AST transformations works in a similar way to the <code>synchronized</code> keyword but locks on different
objects for safer concurrency. It can be applied on any method or static method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Synchronized</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">concurrent</span><span class="pun">.</span><span class="typ">Executors</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">concurrent</span><span class="pun">.</span><span class="typ">TimeUnit</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Counter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cpt
    </span><span class="lit">@Synchronized</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> incrementAndGet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cpt</span><span class="pun">++</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cpt
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Writing this is equivalent to creating a lock object and wrapping the whole method into a synchronized block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Counter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cpt
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> $lock </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">()</span><span class="pln">

    </span><span class="kwd">int</span><span class="pln"> incrementAndGet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">synchronized</span><span class="pun">(</span><span class="pln">$lock</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            cpt</span><span class="pun">++</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cpt
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, <code>@Synchronized</code> creates a field named <code>$lock</code> (or <code>$LOCK</code> for a static method) but you can make it use any
field you want by specifying the value attribute, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Synchronized</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">concurrent</span><span class="pun">.</span><span class="typ">Executors</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">concurrent</span><span class="pun">.</span><span class="typ">TimeUnit</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Counter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> cpt
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> myLock </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">()</span><span class="pln">

    </span><span class="lit">@Synchronized</span><span class="pun">(</span><span class="str">'myLock'</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> incrementAndGet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cpt</span><span class="pun">++</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        cpt
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-WithReadLock"><a class="anchor" href="#xform-WithReadLock"></a><code>@groovy.transform.WithReadLock</code> and <code>@groovy.transform.WithWriteLock</code></h7>
<div class="paragraph">
<p>The <code>@WithReadLock</code> AST transformation works in conjunction with the <code>@WithWriteLock</code> transformation
to provide read/write synchronization using the <code>ReentrantReadWriteLock</code> facility that the JDK provides. The annotation
can be added to a method or a static method. It will transparently create a <code>$reentrantLock</code> final field (or
<code>$REENTRANTLOCK</code> for a static method) and proper synchronization code will be added. For example, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">WithReadLock</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">WithWriteLock</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Counters</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:].</span><span class="pln">withDefault </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@WithReadLock</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@WithWriteLock</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> add</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> num</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">(</span><span class="lit">200</span><span class="pun">)</span><span class="pln"> </span><span class="com">// emulate long computation</span><span class="pln">
        map</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">id</span><span class="pun">)+</span><span class="pln">num</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">WithReadLock</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">WithReadLock</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">WithWriteLock</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">WithWriteLock</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Counters</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> map
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">concurrent</span><span class="pun">.</span><span class="pln">locks</span><span class="pun">.</span><span class="typ">ReentrantReadWriteLock</span><span class="pln"> $reentrantlock

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="pln">java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">String</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        $reentrantlock</span><span class="pun">.</span><span class="pln">readLock</span><span class="pun">().</span><span class="kwd">lock</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            $reentrantlock</span><span class="pun">.</span><span class="pln">readLock</span><span class="pun">().</span><span class="pln">unlock</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">String</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> num</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        $reentrantlock</span><span class="pun">.</span><span class="pln">writeLock</span><span class="pun">().</span><span class="kwd">lock</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">(</span><span class="lit">200</span><span class="pun">)</span><span class="pln">
            map</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> num </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            $reentrantlock</span><span class="pun">.</span><span class="pln">writeLock</span><span class="pun">().</span><span class="pln">unlock</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>@WithReadLock</code> and <code>@WithWriteLock</code> support specifying an alternative lock object. In that case, the referenced
 field must be declared by the user, like in the following alternative:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">WithReadLock</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">WithWriteLock</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">concurrent</span><span class="pun">.</span><span class="pln">locks</span><span class="pun">.</span><span class="typ">ReentrantReadWriteLock</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Counters</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:].</span><span class="pln">withDefault </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">ReentrantReadWriteLock</span><span class="pln"> customLock </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ReentrantReadWriteLock</span><span class="pun">()</span><span class="pln">

    </span><span class="lit">@WithReadLock</span><span class="pun">(</span><span class="str">'customLock'</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">get</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> id</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">id</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@WithWriteLock</span><span class="pun">(</span><span class="str">'customLock'</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> add</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> id</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> num</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">(</span><span class="lit">200</span><span class="pun">)</span><span class="pln"> </span><span class="com">// emulate long computation</span><span class="pln">
        map</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="pln">id</span><span class="pun">,</span><span class="pln"> map</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="pln">id</span><span class="pun">)+</span><span class="pln">num</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For details</p>
</div>
<div class="ulist">
<ul>
<li>
<p>See Javadoc for <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/WithReadLock.html">groovy.transform.WithReadLock</a></p>
</li>
<li>
<p>See Javadoc for <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/WithWriteLock.html">groovy.transform.WithWriteLock</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_easier_cloning_and_externalizing"><a class="anchor" href="#_easier_cloning_and_externalizing"></a>Easier cloning and externalizing</h6>
<div class="paragraph">
<p>Groovy provides two annotations aimed at facilitating the implementation of <code>Cloneable</code> and <code>Externalizable</code> interfaces,
respectively named <code>@AutoClone</code> and <code>@AutoExternalize</code>.</p>
</div>
<div class="sect6">
<h7 id="xform-AutoClone"><a class="anchor" href="#xform-AutoClone"></a><code>@groovy.transform.AutoClone</code></h7>
<div class="paragraph">
<p>The <code>@AutoClone</code> annotation is aimed at implementing the <code>@java.lang.Cloneable</code> interface using various strategies, thanks to the <code>style</code> parameter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the default <code>AutoCloneStyle.CLONE</code> strategy calls <code>super.clone()</code> first then <code>clone()</code> on each cloneable property</p>
</li>
<li>
<p>the <code>AutoCloneStyle.SIMPLE</code> strategy uses a regular constructor call and copies properties from the source to the clone</p>
</li>
<li>
<p>the <code>AutoCloneStyle.COPY_CONSTRUCTOR</code> strategy creates and uses a copy constructor</p>
</li>
<li>
<p>the <code>AutoCloneStyle.SERIALIZATION</code> strategy uses serialization (or externalization) to clone the object</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of those strategies have pros and cons which are discussed in the Javadoc for <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/AutoClone.html">groovy.transform.AutoClone</a> and <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/AutoCloneStyle.html">groovy.transform.AutoCloneStyle</a> .</p>
</div>
<div class="paragraph">
<p>For example, the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">AutoClone</span><span class="pln">

</span><span class="lit">@AutoClone</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> isbn
    </span><span class="typ">String</span><span class="pln"> title
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> authors
    </span><span class="typ">Date</span><span class="pln"> publicationDate
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Cloneable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> isbn
    </span><span class="typ">String</span><span class="pln"> title
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> authors
    </span><span class="typ">Date</span><span class="pln"> publicationDate

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> clone</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">CloneNotSupportedException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Book</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">clone</span><span class="pun">()</span><span class="pln">
        result</span><span class="pun">.</span><span class="pln">authors </span><span class="pun">=</span><span class="pln"> authors </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Cloneable</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="pun">(</span><span class="typ">List</span><span class="pun">)</span><span class="pln"> authors</span><span class="pun">.</span><span class="pln">clone</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> authors
        result</span><span class="pun">.</span><span class="pln">publicationDate </span><span class="pun">=</span><span class="pln"> publicationDate</span><span class="pun">.</span><span class="pln">clone</span><span class="pun">()</span><span class="pln">
        result
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the String properties aren’t explicitly handled because Strings are immutable and the <code>clone()</code> method from <code>Object</code> will copy the String references. The same would apply to primitive fields and most of the concrete subclasses of <code>java.lang.Number</code>.</p>
</div>
<div class="paragraph">
<p>In addition to cloning styles, <code>@AutoClone</code> supports multiple options:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A 
list of property or field names that need to be excluded from cloning. A
 string consisting of a comma-separated field/property names is also 
allowed.
See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/AutoClone.html#excludes">groovy.transform.AutoClone#excludes</a> for details</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">AutoClone</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">AutoCloneStyle</span><span class="pln">

</span><span class="lit">@AutoClone</span><span class="pun">(</span><span class="pln">style</span><span class="pun">=</span><span class="typ">AutoCloneStyle</span><span class="pun">.</span><span class="pln">SIMPLE</span><span class="pun">,</span><span class="pln">excludes</span><span class="pun">=</span><span class="str">'authors'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> isbn
    </span><span class="typ">String</span><span class="pln"> title
    </span><span class="typ">List</span><span class="pln"> authors
    </span><span class="typ">Date</span><span class="pln"> publicationDate
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, only properties are cloned. Setting this flag to true will also clone fields.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">AutoClone</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">AutoCloneStyle</span><span class="pln">

</span><span class="lit">@AutoClone</span><span class="pun">(</span><span class="pln">style</span><span class="pun">=</span><span class="typ">AutoCloneStyle</span><span class="pun">.</span><span class="pln">SIMPLE</span><span class="pun">,</span><span class="pln">includeFields</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> isbn
    </span><span class="typ">String</span><span class="pln"> title
    </span><span class="typ">List</span><span class="pln"> authors
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">Date</span><span class="pln"> publicationDate
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-AutoExternalize"><a class="anchor" href="#xform-AutoExternalize"></a><code>@groovy.transform.AutoExternalize</code></h7>
<div class="paragraph">
<p>The <code>@AutoExternalize</code> AST transformation will assist in the creation of <code>java.io.Externalizable</code> classes. It will
automatically add the interface to the class and generate the <code>writeExternal</code> and <code>readExternal</code> methods. For example, this
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">AutoExternalize</span><span class="pln">

</span><span class="lit">@AutoExternalize</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> isbn
    </span><span class="typ">String</span><span class="pln"> title
    </span><span class="kwd">float</span><span class="pln"> price
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>will be converted into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">Externalizable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> isbn
    </span><span class="typ">String</span><span class="pln"> title
    </span><span class="kwd">float</span><span class="pln"> price

    </span><span class="kwd">void</span><span class="pln"> writeExternal</span><span class="pun">(</span><span class="typ">ObjectOutput</span><span class="pln"> </span><span class="kwd">out</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">writeObject</span><span class="pun">(</span><span class="pln">isbn</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">writeObject</span><span class="pun">(</span><span class="pln">title</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">out</span><span class="pun">.</span><span class="pln">writeFloat</span><span class="pun">(</span><span class="pln"> price </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> readExternal</span><span class="pun">(</span><span class="typ">ObjectInput</span><span class="pln"> oin</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        isbn </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> oin</span><span class="pun">.</span><span class="pln">readObject</span><span class="pun">()</span><span class="pln">
        title </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> oin</span><span class="pun">.</span><span class="pln">readObject</span><span class="pun">()</span><span class="pln">
        price </span><span class="pun">=</span><span class="pln"> oin</span><span class="pun">.</span><span class="pln">readFloat</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@AutoExternalize</code> annotation supports two parameters which will let you slightly customize its behavior:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A 
list of property or field names that need to be excluded from 
externalizing. A string consisting of a comma-separated field/property 
names is also allowed.
See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/AutoExternalize.html#excludes">groovy.transform.AutoExternalize#excludes</a> for details</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">AutoExternalize</span><span class="pln">

</span><span class="lit">@AutoExternalize</span><span class="pun">(</span><span class="pln">excludes</span><span class="pun">=</span><span class="str">'price'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> isbn
    </span><span class="typ">String</span><span class="pln"> title
    </span><span class="kwd">float</span><span class="pln"> price
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeFields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, only properties are externalized. Setting this flag to true will also clone fields.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">AutoExternalize</span><span class="pln">

</span><span class="lit">@AutoExternalize</span><span class="pun">(</span><span class="pln">includeFields</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> isbn
    </span><span class="typ">String</span><span class="pln"> title
    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">float</span><span class="pln"> price
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_safer_scripting"><a class="anchor" href="#_safer_scripting"></a>Safer scripting</h6>
<div class="paragraph">
<p>The Groovy language makes it easy to execute user scripts at runtime (for example using <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/GroovyShell.html">groovy.lang.GroovyShell</a>),
but how do you make sure that a script won’t eat all CPU (infinite loops) or that concurrent scripts won’t slowly consume
all available threads of a thread pool? Groovy provides several annotations which are aimed towards safer scripting,
generating code which will for example allow you to interrupt execution automatically.</p>
</div>
<div class="sect6">
<h7 id="xform-ThreadInterrupt"><a class="anchor" href="#xform-ThreadInterrupt"></a><code>@groovy.transform.ThreadInterrupt</code></h7>
<div class="paragraph">
<p>One complicated situation in the JVM world is when a thread can’t be stopped. The <code>Thread#stop</code> method exists but is
deprecated (and isn’t reliable) so your only chance relies in <code>Thread#interrupt</code>. Calling the latter will set the
<code>interrupt</code> flag on the thread, but it will <strong>not</strong> stop the execution of the thread. This is problematic because it’s the
responsibility of the code executing in the thread to check the interrupt flag and properly exit. This makes sense when
you, as a developer, know that the code you are executing is meant to be run in an independent thread, but in general,
you don’t know it. It’s even worse with user scripts, who might not even know what a thread is (think of DSLs).</p>
</div>
<div class="paragraph">
<p><code>@ThreadInterrupt</code> simplifies this by adding thread interruption checks at critical places in the code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>loops (for, while)</p>
</li>
<li>
<p>first instruction of a method</p>
</li>
<li>
<p>first instruction of a closure body</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s imagine the following user script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    i</span><span class="pun">++</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an obvious infinite loop. If this code executes in its own thread, interrupting wouldn’t help: if you <code>join</code> on
the thread, then the calling code would be able to continue, but the thread would still be alive, running in background
without any ability for you to stop it, slowly causing thread starvation.</p>
</div>
<div class="paragraph">
<p>One possibility to work around this is to set up your shell this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="typ">ThreadInterrupt</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> binding </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">(</span><span class="pln">i</span><span class="pun">:</span><span class="lit">0</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">binding</span><span class="pun">,</span><span class="pln">config</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The shell is then configured to automatically apply the <code>@ThreadInterrupt</code> AST transformations on all scripts. This allows
you to execute user scripts this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln">
    shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="pln">userCode</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
t</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">)</span><span class="pln"> </span><span class="com">// give at most 1000ms for the script to complete</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">.</span><span class="pln">alive</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    t</span><span class="pun">.</span><span class="pln">interrupt</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The transformation automatically modified user code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">currentThread</span><span class="pun">().</span><span class="pln">interrupted</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">InterruptedException</span><span class="pun">(</span><span class="str">'The current thread has been interrupted.'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    i</span><span class="pun">++</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The check which is introduced inside the loop guarantees that if the <code>interrupt</code> flag is set on the current thread, an
exception will be thrown, interrupting the execution of the thread.</p>
</div>
<div class="paragraph">
<p><code>@ThreadInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.InterruptedException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if the thread is interrupted.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">BadException</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Exception</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">BadException</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="pln">thrown</span><span class="pun">:</span><span class="typ">BadException</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ThreadInterrupt</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> binding </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">(</span><span class="pln">i</span><span class="pun">:</span><span class="lit">0</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">classLoader</span><span class="pun">,</span><span class="pln">binding</span><span class="pun">,</span><span class="pln">config</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> userCode </span><span class="pun">=</span><span class="pln"> </span><span class="str">"""
try {
    while (true) {
        i++
    }
} catch (BadException e) {
    i = -1
}
"""</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln">
    shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="pln">userCode</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
t</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">)</span><span class="pln"> </span><span class="com">// give at most 1s for the script to complete</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> binding</span><span class="pun">.</span><span class="pln">i </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">t</span><span class="pun">.</span><span class="pln">alive</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    t</span><span class="pun">.</span><span class="pln">interrupt</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">(</span><span class="lit">500</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> binding</span><span class="pun">.</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="str">'''</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/ThreadInterrupt.html">groovy.transform.ThreadInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ThreadInterrupt</span><span class="pun">(</span><span class="pln">checkOnMethodStart</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/ThreadInterrupt.html">groovy.transform.ThreadInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ThreadInterrupt</span><span class="pun">(</span><span class="pln">applyToAllClasses</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> A </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// interrupt checks added</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> B </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// no interrupt checks</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/ThreadInterrupt.html">groovy.transform.ThreadInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> A </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@ThreadInterrupt</span><span class="pun">(</span><span class="pln">applyToAllMembers</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> method1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// interrupt checked added</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> method2</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// no interrupt checks</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-TimedInterrupt"><a class="anchor" href="#xform-TimedInterrupt"></a><code>@groovy.transform.TimedInterrupt</code></h7>
<div class="paragraph">
<p>The <code>@TimedInterrupt</code> AST transformation tries to solve a slightly different problem from <a href="#xform-ThreadInterrupt"><code>@groovy.transform.ThreadInterrupt</code></a>: instead of checking the <code>interrupt</code> flag of the thread, it will automatically
throw an exception if the thread has been running for too long.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This annotation does <strong>not</strong> spawn a monitoring thread. Instead, it works in a similar manner as <code>@ThreadInterrupt</code> by placing checks at appropriate places in the code. This means that if you
have a thread blocked by I/O, it will <strong>not</strong> be interrupted.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Imagine the following user code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> fib</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> n</span><span class="pun">&lt;</span><span class="lit">2</span><span class="pun">?</span><span class="pln">n</span><span class="pun">:</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)+</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

result </span><span class="pun">=</span><span class="pln"> fib</span><span class="pun">(</span><span class="lit">600</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of the famous Fibonacci number computation here is far from optimized. If it is called with a high <code>n</code> value, it can take minutes to answer. With <code>@TimedInterrupt</code>, you can
choose how long a script is allowed to run. The following setup code will allow the user script to run for 1 second at max:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="pln">value</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TimedInterrupt</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> binding </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">(</span><span class="pln">result</span><span class="pun">:</span><span class="lit">0</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">classLoader</span><span class="pun">,</span><span class="pln"> binding</span><span class="pun">,</span><span class="pln">config</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code is equivalent to annotating a class with <code>@TimedInterrupt</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@TimedInterrupt</span><span class="pun">(</span><span class="pln">value</span><span class="pun">=</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> unit</span><span class="pun">=</span><span class="typ">TimeUnit</span><span class="pun">.</span><span class="pln">SECONDS</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyClass</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> fib</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        n</span><span class="pun">&lt;</span><span class="lit">2</span><span class="pun">?</span><span class="pln">n</span><span class="pun">:</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)+</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@TimedInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long.MAX_VALUE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used in combination with <code>unit</code> to specify after how long execution times out.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@TimedInterrupt</span><span class="pun">(</span><span class="pln">value</span><span class="pun">=</span><span class="lit">500L</span><span class="pun">,</span><span class="pln"> unit</span><span class="pun">=</span><span class="pln"> </span><span class="typ">TimeUnit</span><span class="pun">.</span><span class="pln">MILLISECONDS</span><span class="pun">,</span><span class="pln"> applyToAllClasses </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Slow</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> n</span><span class="pun">&lt;</span><span class="lit">2</span><span class="pun">?</span><span class="pln">n</span><span class="pun">:</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)+</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> result
</span><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln">
    result </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Slow</span><span class="pun">().</span><span class="pln">fib</span><span class="pun">(</span><span class="lit">500</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
t</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="lit">5000</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">t</span><span class="pun">.</span><span class="pln">alive</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">unit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeUnit.SECONDS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used in combination with <code>value</code> to specify after how long execution times out.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@TimedInterrupt</span><span class="pun">(</span><span class="pln">value</span><span class="pun">=</span><span class="lit">500L</span><span class="pun">,</span><span class="pln"> unit</span><span class="pun">=</span><span class="pln"> </span><span class="typ">TimeUnit</span><span class="pun">.</span><span class="pln">MILLISECONDS</span><span class="pun">,</span><span class="pln"> applyToAllClasses </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Slow</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> n</span><span class="pun">&lt;</span><span class="lit">2</span><span class="pun">?</span><span class="pln">n</span><span class="pun">:</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)+</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> result
</span><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln">
    result </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Slow</span><span class="pun">().</span><span class="pln">fib</span><span class="pun">(</span><span class="lit">500</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
t</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="lit">5000</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">t</span><span class="pun">.</span><span class="pln">alive</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.concurrent.TimeoutException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if timeout is reached.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@TimedInterrupt</span><span class="pun">(</span><span class="pln">thrown</span><span class="pun">=</span><span class="typ">TooLongException</span><span class="pun">,</span><span class="pln"> applyToAllClasses </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="lit">1L</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Slow</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">(</span><span class="lit">100</span><span class="pun">);</span><span class="pln"> n</span><span class="pun">&lt;</span><span class="lit">2</span><span class="pun">?</span><span class="pln">n</span><span class="pun">:</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">1</span><span class="pun">)+</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">n</span><span class="pun">-</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> result
</span><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Slow</span><span class="pun">().</span><span class="pln">fib</span><span class="pun">(</span><span class="lit">50</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">TooLongException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
t</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="lit">5000</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/TimedInterrupt.html">groovy.transform.TimedInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@TimedInterrupt</span><span class="pun">(</span><span class="pln">checkOnMethodStart</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/TimedInterrupt.html">groovy.transform.TimedInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@TimedInterrupt</span><span class="pun">(</span><span class="pln">applyToAllClasses</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> A </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// interrupt checks added</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> B </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// no interrupt checks</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/TimedInterrupt.html">groovy.transform.TimedInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> A </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@TimedInterrupt</span><span class="pun">(</span><span class="pln">applyToAllMembers</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> method1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// interrupt checked added</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> method2</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// no interrupt checks</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>@TimedInterrupt</code> is currently not compatible with static methods!
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect6">
<h7 id="xform-ConditionalInterrupt"><a class="anchor" href="#xform-ConditionalInterrupt"></a><code>@groovy.transform.ConditionalInterrupt</code></h7>
<div class="paragraph">
<p>The last annotation for safer scripting is the base annotation when 
you want to interrupt a script using a custom strategy. In particular, 
this is the annotation of choice if you
want to use resource management (limit the number of calls to an API, 
…​). In the following example, user code is using an infinite loop, but <code>@ConditionalInterrupt</code> will allow us
to check a quota manager and interrupt automatically the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ConditionalInterrupt</span><span class="pun">({</span><span class="typ">Quotas</span><span class="pun">.</span><span class="pln">disallow</span><span class="pun">(</span><span class="str">'user'</span><span class="pun">)})</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">UserCode</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pln">
        </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            println </span><span class="str">"Consuming resources ${++i}"</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The quota checking is very basic here, but it can be any code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Quotas</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> quotas </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:].</span><span class="pln">withDefault </span><span class="pun">{</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> disallow</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> userName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"Checking quota for $userName"</span><span class="pln">
        </span><span class="pun">(</span><span class="pln">quotas</span><span class="pun">[</span><span class="pln">userName</span><span class="pun">]--)&lt;</span><span class="lit">0</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can make sure <code>@ConditionalInterrupt</code> works properly using this test code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Quotas</span><span class="pun">.</span><span class="pln">quotas</span><span class="pun">[</span><span class="str">'user'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">UserCode</span><span class="pun">().</span><span class="pln">doSomething</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
t</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="lit">5000</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">t</span><span class="pun">.</span><span class="pln">alive
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Quotas</span><span class="pun">.</span><span class="pln">quotas</span><span class="pun">[</span><span class="str">'user'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, in practice, it is unlikely that <code>@ConditionalInterrupt</code> will be itself added by hand on user code. It can be injected in a similar manner as the example shown in the
<a href="#xform-ThreadInterrupt">ThreadInterrupt</a> section, using the <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/control/customizers/ASTTransformationCustomizer.html">org.codehaus.groovy.control.customizers.ASTTransformationCustomizer</a> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> checkExpression </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ClosureExpression</span><span class="pun">(</span><span class="pln">
        </span><span class="typ">Parameter</span><span class="pun">.</span><span class="pln">EMPTY_ARRAY</span><span class="pun">,</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ExpressionStatement</span><span class="pun">(</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MethodCallExpression</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ClassExpression</span><span class="pun">(</span><span class="typ">ClassHelper</span><span class="pun">.</span><span class="pln">make</span><span class="pun">(</span><span class="typ">Quotas</span><span class="pun">)),</span><span class="pln"> </span><span class="str">'disallow'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConstantExpression</span><span class="pun">(</span><span class="str">'user'</span><span class="pun">))</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="pln">value</span><span class="pun">:</span><span class="pln"> checkExpression</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConditionalInterrupt</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">classLoader</span><span class="pun">,</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">(),</span><span class="pln">config</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> userCode </span><span class="pun">=</span><span class="pln"> </span><span class="str">"""
        int i=0
        while (true) {
            println "</span><span class="typ">Consuming</span><span class="pln"> resources \\$</span><span class="pun">{++</span><span class="pln">i</span><span class="pun">}</span><span class="str">"
        }
"""</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Quotas</span><span class="pun">.</span><span class="pln">quotas</span><span class="pun">[</span><span class="str">'user'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln">
    shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="pln">userCode</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
t</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="lit">5000</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">t</span><span class="pun">.</span><span class="pln">alive
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Quotas</span><span class="pun">.</span><span class="pln">quotas</span><span class="pun">[</span><span class="str">'user'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@ConditionalInterrupt</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The 
closure which will be called to check if execution is allowed. If the 
closure returns false, execution is allowed. If it returns true, then an
 exception will be thrown.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ConditionalInterrupt</span><span class="pun">({</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">})</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">thrown</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.InterruptedException</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of exception which is thrown if execution should be aborted.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="pln">thrown</span><span class="pun">:</span><span class="pln"> </span><span class="typ">QuotaExceededException</span><span class="pun">,</span><span class="pln">value</span><span class="pun">:</span><span class="pln"> checkExpression</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ConditionalInterrupt</span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Quotas</span><span class="pun">.</span><span class="pln">quotas</span><span class="pun">[</span><span class="str">'user'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">10</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> t </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="pln">userCode</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">QuotaExceededException</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Quotas</span><span class="pun">.</span><span class="pln">quotas</span><span class="pun">[</span><span class="str">'user'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Quota exceeded'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
t</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="lit">5000</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">t</span><span class="pun">.</span><span class="pln">alive
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Quotas</span><span class="pun">.</span><span class="pln">quotas</span><span class="pun">[</span><span class="str">'user'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Quota exceeded'</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkOnMethodStart</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should an interruption check be inserted at the beginning of each method body. See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/ConditionalInterrupt.html">groovy.transform.ConditionalInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ConditionalInterrupt</span><span class="pun">(</span><span class="pln">checkOnMethodStart</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllClasses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all classes of the same source unit (in the same source file). See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/ConditionalInterrupt.html">groovy.transform.ConditionalInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@ConditionalInterrupt</span><span class="pun">(</span><span class="pln">applyToAllClasses</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> A </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// interrupt checks added</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> B </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// no interrupt checks</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyToAllMembers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should the transformation be applied on all members of class. See <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/transform/ConditionalInterrupt.html">groovy.transform.ConditionalInterrupt</a> for details.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> A </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@ConditionalInterrupt</span><span class="pun">(</span><span class="pln">applyToAllMembers</span><span class="pun">=</span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> method1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// interrupt checked added</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> method2</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="com">// no interrupt checks</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_compiler_directives"><a class="anchor" href="#_compiler_directives"></a>Compiler directives</h6>
<div class="paragraph">
<p>This category of AST transformations groups annotations which have a direct impact on the semantics of the code, rather
than focusing on code generation. With that regards, they can be seen as compiler directives that either change the
behavior of a program at compile time or runtime.</p>
</div>
<div class="sect6">
<h7 id="xform-Field"><a class="anchor" href="#xform-Field"></a><code>@groovy.transform.Field</code></h7>
<div class="paragraph">
<p>The <code>@Field</code> annotation only makes sense in the context of a script and aims at solving a common scoping error with
scripts. The following example will for example fail at runtime:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x

</span><span class="typ">String</span><span class="pln"> line</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">"="</span><span class="pun">*</span><span class="pln">x
</span><span class="pun">}</span><span class="pln">

x</span><span class="pun">=</span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"==="</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> line</span><span class="pun">()</span><span class="pln">
x</span><span class="pun">=</span><span class="lit">5</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"====="</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> line</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The error that is thrown may be difficult to interpret: 
groovy.lang.MissingPropertyException: No such property: x. The reason is
 that scripts are compiled
to classes and the script body is itself compiled as a single <em>run()</em> method. Methods which are defined in the scripts are independent, so the code above is
equivalent to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyScript</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Script</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> line</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"="</span><span class="pun">*</span><span class="pln">x
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> x
        x</span><span class="pun">=</span><span class="lit">3</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"==="</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> line</span><span class="pun">()</span><span class="pln">
        x</span><span class="pun">=</span><span class="lit">5</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"====="</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> line</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So <code>def x</code> is effectively interpreted as a local variable, outside of the scope of the <code>line</code> method. The <code>@Field</code> AST transformation aims at fixing this
by changing the scope of the variable to a field of the enclosing script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Field</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> x

</span><span class="typ">String</span><span class="pln"> line</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="str">"="</span><span class="pun">*</span><span class="pln">x
</span><span class="pun">}</span><span class="pln">

x</span><span class="pun">=</span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"==="</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> line</span><span class="pun">()</span><span class="pln">
x</span><span class="pun">=</span><span class="lit">5</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"====="</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> line</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting, equivalent, code is now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyScript</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Script</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> x

    </span><span class="typ">String</span><span class="pln"> line</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"="</span><span class="pun">*</span><span class="pln">x
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        x</span><span class="pun">=</span><span class="lit">3</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"==="</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> line</span><span class="pun">()</span><span class="pln">
        x</span><span class="pun">=</span><span class="lit">5</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"====="</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> line</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-PackageScope"><a class="anchor" href="#xform-PackageScope"></a><code>@groovy.transform.PackageScope</code></h7>
<div class="paragraph">
<p>By default, Groovy visibility rules imply that if you create a field 
without specifying a modifier, then the field is interpreted as a 
property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name </span><span class="com">// this is a property</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Should you want to create a package private field instead of a 
property (private field+getter/setter), then annotate your field with <code>@PackageScope</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@PackageScope</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name </span><span class="com">// not a property anymore</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@PackageScope</code> annotation can also be used for classes, methods and constructors. In addition, by specifying a list
of <code>PackageScopeTarget</code> values as the annotation attribute at the class level, all members within that class that don’t
have an explicit modifier and match the provided <code>PackageScopeTarget</code> will remain package protected. For example to apply
to fields within a class use the following annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">PackageScopeTarget</span><span class="pun">.</span><span class="pln">FIELDS
</span><span class="lit">@PackageScope</span><span class="pun">(</span><span class="pln">FIELDS</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="typ">String</span><span class="pln"> name     </span><span class="com">// not a property, package protected</span><span class="pln">
  </span><span class="typ">Date</span><span class="pln"> dob        </span><span class="com">// not a property, package protected</span><span class="pln">
  </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> age </span><span class="com">// explicit modifier, so won't be touched</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@PackageScope</code> annotation is seldom used as part of normal Groovy conventions but is sometimes useful
for factory methods that should be visible internally within a package or for methods or constructors provided
for testing purposes, or when integrating with third-party libraries which require such visibility conventions.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-AnnotationCollector"><a class="anchor" href="#xform-AnnotationCollector"></a><code>@groovy.transform.AnnotationCollector</code></h7>
<div class="paragraph">
<p><code>@AnnotationCollector</code> allows the creation of meta-annotation, which are described in a <a href="#meta-annotations">dedicated section</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-TypeChecked"><a class="anchor" href="#xform-TypeChecked"></a><code>@groovy.transform.TypeChecked</code></h7>
<div class="paragraph">
<p><code>@TypeChecked</code> activates compile-time type checking on your Groovy code. See <a href="#section-typechecked">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-CompileStatic"><a class="anchor" href="#xform-CompileStatic"></a><code>@groovy.transform.CompileStatic</code></h7>
<div class="paragraph">
<p><code>@CompileStatic</code> activates static compilation on your Groovy code. See <a href="#section-typechecked">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-CompileDynamic"><a class="anchor" href="#xform-CompileDynamic"></a><code>@groovy.transform.CompileDynamic</code></h7>
<div class="paragraph">
<p><code>@CompileDynamic</code> disables static compilation on parts of your Groovy code. See <a href="#section-typechecked">section on type checking</a> for details.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-DelegatesTo"><a class="anchor" href="#xform-DelegatesTo"></a><code>@groovy.lang.DelegatesTo</code></h7>
<div class="paragraph">
<p><code>@DelegatesTo</code> is not, technically speaking, an AST transformation. It is aimed at documenting code and helping the compiler in case you are
using <a href="#xform-TypeChecked">type checking</a> or <a href="#xform-CompileStatic">static compilation</a>. The annotation is described thoroughly in the
<a href="#section-delegatesto">DSL section</a> of this guide.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_swing_patterns"><a class="anchor" href="#_swing_patterns"></a>Swing patterns</h6>
<div class="sect6">
<h7 id="xform-Bindable"><a class="anchor" href="#xform-Bindable"></a><code>@groovy.beans.Bindable</code></h7>
<div class="paragraph">
<p><code>@Bindable</code> is an AST transformation that transforms a regular property into a bound property (according to the <a href="http://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans specification</a>).
The <code>@Bindable</code> annotation can be placed on a property or a 
class. To convert all properties of a class into bound properties, on 
can annotate the class like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">Bindable</span><span class="pln">

</span><span class="lit">@Bindable</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is equivalent to writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">PropertyChangeListener</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">PropertyChangeSupport</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">PropertyChangeSupport</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">$propertyChangeSupport

    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">int</span><span class="pln"> age

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addPropertyChangeListener</span><span class="pun">(</span><span class="typ">PropertyChangeListener</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">$propertyChangeSupport</span><span class="pun">.</span><span class="pln">addPropertyChangeListener</span><span class="pun">(</span><span class="pln">listener</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addPropertyChangeListener</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">PropertyChangeListener</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">$propertyChangeSupport</span><span class="pun">.</span><span class="pln">addPropertyChangeListener</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removePropertyChangeListener</span><span class="pun">(</span><span class="typ">PropertyChangeListener</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">$propertyChangeSupport</span><span class="pun">.</span><span class="pln">removePropertyChangeListener</span><span class="pun">(</span><span class="pln">listener</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removePropertyChangeListener</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">PropertyChangeListener</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">$propertyChangeSupport</span><span class="pun">.</span><span class="pln">removePropertyChangeListener</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> firePropertyChange</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> oldValue</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> newValue</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">$propertyChangeSupport</span><span class="pun">.</span><span class="pln">firePropertyChange</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> oldValue</span><span class="pun">,</span><span class="pln"> newValue</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">PropertyChangeListener</span><span class="pun">[]</span><span class="pln"> getPropertyChangeListeners</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">$propertyChangeSupport</span><span class="pun">.</span><span class="pln">getPropertyChangeListeners</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">PropertyChangeListener</span><span class="pun">[]</span><span class="pln"> getPropertyChangeListeners</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">$propertyChangeSupport</span><span class="pun">.</span><span class="pln">getPropertyChangeListeners</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Bindable</code> therefore removes a lot of boilerplate from 
your class, dramatically increasing readability. If the annotation is 
put on a single property, only that property is bound:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">Bindable</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="lit">@Bindable</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect6">
<h7 id="xform-ListenerList"><a class="anchor" href="#xform-ListenerList"></a><code>@groovy.beans.ListenerList</code></h7>
<div class="paragraph">
<p>The <code>@ListenerList</code> AST transformation generates code for 
adding, removing and getting the list of listeners to a class, just by 
annotating a collection property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">awt</span><span class="pun">.</span><span class="kwd">event</span><span class="pun">.</span><span class="typ">ActionListener</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">ListenerList</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Component</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@ListenerList</span><span class="pln">
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">ActionListener</span><span class="pun">&gt;</span><span class="pln"> listeners</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The transform will generate the appropriate add/remove methods based 
on the generic type of the list. In addition, it will also create <code>fireXXX</code> methods based on the public methods declared on the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">awt</span><span class="pun">.</span><span class="kwd">event</span><span class="pun">.</span><span class="typ">ActionEvent</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">awt</span><span class="pun">.</span><span class="kwd">event</span><span class="pun">.</span><span class="typ">ActionListener</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">ActionListener</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">ListenerList</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">ListenerList</span><span class="pln">

</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Component</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@ListenerList</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">ActionListener</span><span class="pun">&gt;</span><span class="pln"> listeners

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addActionListener</span><span class="pun">(</span><span class="typ">ActionListener</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> listener </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> listeners </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            listeners </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        listeners</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">listener</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removeActionListener</span><span class="pun">(</span><span class="typ">ActionListener</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> listener </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> listeners </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            listeners </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        listeners</span><span class="pun">.</span><span class="pln">remove</span><span class="pun">(</span><span class="pln">listener</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">ActionListener</span><span class="pun">[]</span><span class="pln"> getActionListeners</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Object</span><span class="pln"> __result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> listeners </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            __result</span><span class="pun">.</span><span class="pln">addAll</span><span class="pun">(</span><span class="pln">listeners</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">((</span><span class="pln"> __result </span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">ActionListener</span><span class="pun">[])</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> fireActionPerformed</span><span class="pun">(</span><span class="typ">ActionEvent</span><span class="pln"> param0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> listeners </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">ArrayList</span><span class="pun">&lt;</span><span class="typ">ActionListener</span><span class="pun">&gt;</span><span class="pln"> __list </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayList</span><span class="pun">&lt;</span><span class="typ">ActionListener</span><span class="pun">&gt;(</span><span class="pln">listeners</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">def</span><span class="pln"> listener </span><span class="pun">:</span><span class="pln"> __list </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                listener</span><span class="pun">.</span><span class="pln">actionPerformed</span><span class="pun">(</span><span class="pln">param0</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Bindable</code> supports multiple options that will let you further customize the behavior of the transformation:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generic type name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the suffix which will be appended to add/remove/…​ methods is the simple class name of the generic type of the list.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Component</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@ListenerList</span><span class="pun">(</span><span class="pln">name</span><span class="pun">=</span><span class="str">'item'</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">ActionListener</span><span class="pun">&gt;</span><span class="pln"> listeners</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">synchronize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, generated methods will be synchronized</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Component</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@ListenerList</span><span class="pun">(</span><span class="pln">synchronize </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">ActionListener</span><span class="pun">&gt;</span><span class="pln"> listeners</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect6">
<h7 id="xform-Vetoable"><a class="anchor" href="#xform-Vetoable"></a><code>@groovy.beans.Vetoable</code></h7>
<div class="paragraph">
<p>The <code>@Vetoable</code> annotation works in a similar manner to <code>@Bindable</code>
 but generates constrained property according to the JavaBeans 
specification, instead of bound properties. The annotation
can be placed on a class, meaning that all properties will be converted 
to constrained properties, or on a single property. For example, 
annotating this class with <code>@Vetoable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">Vetoable</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">PropertyVetoException</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">VetoableChangeListener</span><span class="pln">

</span><span class="lit">@Vetoable</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to writing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> age
    </span><span class="kwd">final</span><span class="pln"> </span><span class="kwd">private</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">VetoableChangeSupport</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">$vetoableChangeSupport

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addVetoableChangeListener</span><span class="pun">(</span><span class="typ">VetoableChangeListener</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">$vetoableChangeSupport</span><span class="pun">.</span><span class="pln">addVetoableChangeListener</span><span class="pun">(</span><span class="pln">listener</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> addVetoableChangeListener</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">VetoableChangeListener</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">$vetoableChangeSupport</span><span class="pun">.</span><span class="pln">addVetoableChangeListener</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removeVetoableChangeListener</span><span class="pun">(</span><span class="typ">VetoableChangeListener</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">$vetoableChangeSupport</span><span class="pun">.</span><span class="pln">removeVetoableChangeListener</span><span class="pun">(</span><span class="pln">listener</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> removeVetoableChangeListener</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">VetoableChangeListener</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">$vetoableChangeSupport</span><span class="pun">.</span><span class="pln">removeVetoableChangeListener</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> listener</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> fireVetoableChange</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> oldValue</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> newValue</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">PropertyVetoException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">$vetoableChangeSupport</span><span class="pun">.</span><span class="pln">fireVetoableChange</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> oldValue</span><span class="pun">,</span><span class="pln"> newValue</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">VetoableChangeListener</span><span class="pun">[]</span><span class="pln"> getVetoableChangeListeners</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">$vetoableChangeSupport</span><span class="pun">.</span><span class="pln">getVetoableChangeListeners</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">VetoableChangeListener</span><span class="pun">[]</span><span class="pln"> getVetoableChangeListeners</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">$vetoableChangeSupport</span><span class="pun">.</span><span class="pln">getVetoableChangeListeners</span><span class="pun">(</span><span class="pln">name</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setName</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">PropertyVetoException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">fireVetoableChange</span><span class="pun">(</span><span class="str">'name'</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">)</span><span class="pln">
        name </span><span class="pun">=</span><span class="pln"> value
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setAge</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">PropertyVetoException</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">fireVetoableChange</span><span class="pun">(</span><span class="str">'age'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">)</span><span class="pln">
        age </span><span class="pun">=</span><span class="pln"> value
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the annotation is put on a single property, only that property is made vetoable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">Vetoable</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="lit">@Vetoable</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_test_assistance"><a class="anchor" href="#_test_assistance"></a>Test assistance</h6>
<div class="sect6">
<h7 id="xform-NotYetImplemented"><a class="anchor" href="#xform-NotYetImplemented"></a><code>@groovy.lang.NotYetImplemented</code></h7>
<div class="paragraph">
<p><code>@NotYetImplemented</code> is used to invert the result of a 
JUnit 3/4 test case. It is in particular useful if a feature is not yet 
implemented but the test is. In that case, it is expected
that the test fails. Marking it with <code>@NotYetImplemented</code> will inverse the result of the test, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">NotYetImplemented</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Maths</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> fib</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// todo: implement later</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MathsTest</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">GroovyTestCase</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@NotYetImplemented</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> testFib</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> dataTable </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
                </span><span class="lit">1</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span><span class="pln">
                </span><span class="lit">2</span><span class="pun">:</span><span class="lit">1</span><span class="pun">,</span><span class="pln">
                </span><span class="lit">3</span><span class="pun">:</span><span class="lit">2</span><span class="pun">,</span><span class="pln">
                </span><span class="lit">4</span><span class="pun">:</span><span class="lit">3</span><span class="pun">,</span><span class="pln">
                </span><span class="lit">5</span><span class="pun">:</span><span class="lit">5</span><span class="pun">,</span><span class="pln">
                </span><span class="lit">6</span><span class="pun">:</span><span class="lit">8</span><span class="pun">,</span><span class="pln">
                </span><span class="lit">7</span><span class="pun">:</span><span class="lit">13</span><span class="pln">
        </span><span class="pun">]</span><span class="pln">
        dataTable</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> i</span><span class="pun">,</span><span class="pln"> r </span><span class="pun">-&gt;</span><span class="pln">
            </span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Maths</span><span class="pun">.</span><span class="pln">fib</span><span class="pun">(</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> r
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another advantage of using this technique is that you can write test 
cases for bugs before knowing how to fix them. If some time in the 
future, a modification in the code fixes a bug by side effect,
you’ll be notified because a test which was expected to fail passed.</p>
</div>
</div>
<div class="sect6">
<h7 id="xform-ASTTest"><a class="anchor" href="#xform-ASTTest"></a><code>@groovy.transform.ASTTest</code></h7>
<div class="paragraph">
<p><code>@ASTTest</code> is a special AST transformation meant to help 
debugging other AST transformations or the Groovy compiler itself. It 
will let the developer "explore" the AST during compilation and
perform assertions on the AST rather than on the result of compilation. 
This means that this AST transformations gives access to the AST before 
the bytecode is produced. <code>@ASTTest</code> can be
placed on any annotable node and requires two parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>phase</em>: sets at which phase at which <code>@ASTTest</code> will be triggered. The test code will work on the AST tree at the end of this phase.</p>
</li>
<li>
<p><em>value</em>: the code which will be executed once the phase is reached, on the annotated node</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Compile phase has to be chosen from one of <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/control/CompilePhase.html">org.codehaus.groovy.control.CompilePhase</a> . However, since it is not possible to annotate a node twice with the same annotation, you will
not be able to use <code>@ASTTest</code> on the same node at two distinct compile phases.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>value</code> is a closure expression which has access to a special variable <code>node</code> corresponding to the annotated node, and a helper <code>lookup</code> method which will be discussed <a href="#asttest-lookup">here</a>.
For example, you can annotate a class node like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">ASTTest</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">ast</span><span class="pun">.</span><span class="typ">ClassNode</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="typ">CompilePhase</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@ASTTest</span><span class="pun">(</span><span class="pln">phase</span><span class="pun">=</span><span class="pln">CONVERSION</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">={</span><span class="pln">   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> node </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ClassNode</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> node</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Person'</span><span class="pln">     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we’re checking the state of the Abstract Syntax Tree after the CONVERSION phase</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>node refers to the AST node which is annotated by @ASTTest</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>it can be used to perform assertions at compile time</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>One interesting feature of <code>@ASTTest</code> is that if an assertion fails, then <strong>compilation will fail</strong>. Now imagine that we want to check the behavior of an AST transformation at compile time.
We will take <code>@PackageScope</code> here, and we will want to verify that a property annotated with <code>@PackageScope</code> becomes a package private field. For this, we have to know at which phase the
transform runs, which can be found in <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/PackageScopeASTTransformation.html">org.codehaus.groovy.transform.PackageScopeASTTransformation</a> : semantic analysis. Then a test can be written like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">ASTTest</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">PackageScope</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="typ">CompilePhase</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@ASTTest</span><span class="pun">(</span><span class="pln">phase</span><span class="pun">=</span><span class="pln">SEMANTIC_ANALYSIS</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> nameNode </span><span class="pun">=</span><span class="pln"> node</span><span class="pun">.</span><span class="pln">properties</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'name'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> ageNode </span><span class="pun">=</span><span class="pln"> node</span><span class="pun">.</span><span class="pln">properties</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'age'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> nameNode
    </span><span class="kwd">assert</span><span class="pln"> ageNode </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pln"> </span><span class="com">// shouldn't be a property anymore</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> ageField </span><span class="pun">=</span><span class="pln"> node</span><span class="pun">.</span><span class="pln">getDeclaredField </span><span class="str">'age'</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> ageField</span><span class="pun">.</span><span class="pln">modifiers </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="lit">@PackageScope</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div id="asttest-lookup" class="paragraph">
<p>The <code>@ASTTest</code> annotation can only be placed wherever the 
grammar allows it. Sometimes, you would like to test the contents of an 
AST node which is not annotable. In this case,
<code>@ASTTest</code> provides a convenient <code>lookup</code> method which will search the AST for nodes which are labelled with a special token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> lookup</span><span class="pun">(</span><span class="str">'anchor'</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">Statement</span><span class="pln"> stmt </span><span class="pun">=</span><span class="pln"> list</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>returns the list of AST nodes which label is 'anchor'</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>it is always necessary to choose which element to process since lookup always returns a list</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Imagine, for example, that you want to test the declared type of a for loop variable. Then you can do it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">ASTTest</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">PackageScope</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">ast</span><span class="pun">.</span><span class="typ">ClassHelper</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">ast</span><span class="pun">.</span><span class="pln">expr</span><span class="pun">.</span><span class="typ">DeclarationExpression</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">ast</span><span class="pun">.</span><span class="pln">stmt</span><span class="pun">.</span><span class="typ">ForStatement</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="typ">CompilePhase</span><span class="pun">.*</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Something</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@ASTTest</span><span class="pun">(</span><span class="pln">phase</span><span class="pun">=</span><span class="pln">SEMANTIC_ANALYSIS</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> forLoop </span><span class="pun">=</span><span class="pln"> lookup</span><span class="pun">(</span><span class="str">'anchor'</span><span class="pun">)[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> forLoop </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ForStatement</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> decl </span><span class="pun">=</span><span class="pln"> forLoop</span><span class="pun">.</span><span class="pln">collectionExpression</span><span class="pun">.</span><span class="pln">expressions</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> decl </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">DeclarationExpression</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> decl</span><span class="pun">.</span><span class="pln">variableExpression</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'i'</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> decl</span><span class="pun">.</span><span class="pln">variableExpression</span><span class="pun">.</span><span class="pln">originType </span><span class="pun">==</span><span class="pln"> </span><span class="typ">ClassHelper</span><span class="pun">.</span><span class="pln">int_TYPE
    </span><span class="pun">})</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> someMethod</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span><span class="pln">
        anchor</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i</span><span class="pun">=</span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">&lt;</span><span class="pln">x</span><span class="pun">+</span><span class="pln">y</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            println </span><span class="str">"$i"</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@ASTTest</code> also exposes those variables inside the test closure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>node</code> corresponds to the annotated node, as usual</p>
</li>
<li>
<p><code>compilationUnit</code> gives access to the current <code>org.codehaus.groovy.control.CompilationUnit</code></p>
</li>
<li>
<p><code>compilePhase</code> returns the current compile phase (<code>org.codehaus.groovy.control.CompilePhase</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The latter is interesting if you don’t specify the <code>phase</code> attribute. In that case, the closure will be executed after
each compile phase after (and including) <code>SEMANTIC_ANALYSIS</code>. The context of the transformation is kept after each phase,
giving you a chance to check what changed between two phases.</p>
</div>
<div class="paragraph">
<p>As an example, here is how you could dump the list of AST transformations registered on a class node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">ASTTest</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">CompileStatic</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">Immutable</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">ast</span><span class="pun">.</span><span class="typ">ClassNode</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="typ">CompilePhase</span><span class="pln">

</span><span class="lit">@ASTTest</span><span class="pun">(</span><span class="pln">value</span><span class="pun">={</span><span class="pln">
    </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println </span><span class="str">"Compile phase: $compilePhase"</span><span class="pln">
    </span><span class="typ">ClassNode</span><span class="pln"> cn </span><span class="pun">=</span><span class="pln"> node
    </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println </span><span class="str">"Global AST xforms: ${compilationUnit?.ASTTransformationsContext?.globalTransformNames}"</span><span class="pln">
    </span><span class="typ">CompilePhase</span><span class="pun">.</span><span class="pln">values</span><span class="pun">().</span><span class="pln">each </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> transforms </span><span class="pun">=</span><span class="pln"> cn</span><span class="pun">.</span><span class="pln">getTransforms</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">transforms</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println </span><span class="str">"Ast xforms for phase $it:"</span><span class="pln">
            transforms</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> map </span><span class="pun">-&gt;</span><span class="pln">
                </span><span class="typ">System</span><span class="pun">.</span><span class="pln">err</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="pln">map</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="lit">@CompileStatic</span><span class="pln">
</span><span class="lit">@Immutable</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is how you can memorize variables for testing between two phases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">ASTTest</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">ToString</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">ast</span><span class="pun">.</span><span class="typ">ClassNode</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="typ">CompilePhase</span><span class="pln">

</span><span class="lit">@ASTTest</span><span class="pun">(</span><span class="pln">value</span><span class="pun">={</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">compilePhase</span><span class="pun">==</span><span class="typ">CompilePhase</span><span class="pun">.</span><span class="pln">INSTRUCTION_SELECTION</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        println </span><span class="str">"toString() was added at phase: ${added}"</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> added </span><span class="pun">==</span><span class="pln"> </span><span class="typ">CompilePhase</span><span class="pun">.</span><span class="pln">CANONICALIZATION                   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">node</span><span class="pun">.</span><span class="pln">getDeclaredMethods</span><span class="pun">(</span><span class="str">'toString'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> added</span><span class="pun">==</span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">       </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
            added </span><span class="pun">=</span><span class="pln"> compilePhase                                        </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">})</span><span class="pln">
</span><span class="lit">@ToString</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>if the current compile phase is instruction selection</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>then we want to make sure <code>toString</code> was added at <code>CANONICALIZATION</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>otherwise, if <code>toString</code> exists and that the variable from the context, <code>added</code> is null</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then it means that this compile phase is the one where <code>toString</code> was added</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_grape_handling"><a class="anchor" href="#_grape_handling"></a>Grape handling</h6>
<div class="sect6">
<h7 id="xform-Grab"><a class="anchor" href="#xform-Grab"></a><code>@groovy.lang.Grab</code></h7>

</div>
<div class="sect6">
<h7 id="xform-GrabConfig"><a class="anchor" href="#xform-GrabConfig"></a><code>@groovy.lang.GrabConfig</code></h7>

</div>
<div class="sect6">
<h7 id="xform-GrabExclude"><a class="anchor" href="#xform-GrabExclude"></a><code>@groovy.lang.GrabExclude</code></h7>

</div>
<div class="sect6">
<h7 id="xform-GrabResolver"><a class="anchor" href="#xform-GrabResolver"></a><code>@groovy.lang.GrabResolver</code></h7>

</div>
<div class="sect6">
<h7 id="xform-Grapes"><a class="anchor" href="#xform-Grapes"></a><code>@groovy.lang.Grapes</code></h7>
<div class="paragraph">
<p><code>Grape</code> is a dependency management engine embedded into Groovy, relying on several annotations which are described
thoroughly in this <a href="#section-grape">section of the guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="developing-ast-xforms"><a class="anchor" href="#developing-ast-xforms"></a>Developing AST transformations</h5>
<div class="paragraph">
<p>There are two kinds of transformations: global and local transformations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#transforms-global">Global transformations</a> are applied to by the compiler on the code being compiled,
wherever the transformation apply. Compiled classes that implement global transformations
are in a JAR added to the classpath of the compiler and contain service locator file
<code>META-INF/services/org.codehaus.groovy.transform.ASTTransformation</code> with a line with the name of the
transformation class. The transformation class must have a no-args constructor and implement the
<code>org.codehaus.groovy.transform.ASTTransformation</code> interface.
It will be run against <strong>every source in the compilation</strong>, so be sure to not create transformations which
scan all the AST in an expansive and time-consuming manner, to keep the compiler fast.</p>
</li>
<li>
<p><a href="#transforms-local">Local transformations</a> are transformations applied locally by annotating code elements you want to
transform. For this, we reuse the annotation notation, and those annotations should implement
<code>org.codehaus.groovy.transform.ASTTransformation</code>. The compiler will discover them and apply the
transformation on these code elements.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_compilation_phases_guide"><a class="anchor" href="#_compilation_phases_guide"></a>Compilation phases guide</h6>
<div class="paragraph">
<p>Groovy AST transformations must be performed in one of the nine defined
compilation phases (<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/control/CompilePhase.html">org.codehaus.groovy.control.CompilePhase</a>).</p>
</div>
<div class="paragraph">
<p>Global transformations may be applied in any phase, but local
transformations may only be applied in the semantic analysis phase or
later. Briefly, the compiler phases are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Initialization</em>: source files are opened and environment configured</p>
</li>
<li>
<p><em>Parsing</em>: the grammar is used to to produce tree of tokens representing
the source code</p>
</li>
<li>
<p><em>Conversion</em>: An abstract syntax tree (AST) is created from token trees.</p>
</li>
<li>
<p><em>Semantic Analysis</em>: Performs consistency and validity checks that the
grammar can’t check for, and resolves classes.</p>
</li>
<li>
<p><em>Canonicalization</em>: Complete building the AST</p>
</li>
<li>
<p><em>Instruction Selection</em>: instruction set is chosen, for example Java 6 or Java 7 bytecode level</p>
</li>
<li>
<p><em>Class Generation</em>: creates the bytecode of the class in memory</p>
</li>
<li>
<p><em>Output</em>: write the binary output to the file system</p>
</li>
<li>
<p><em>Finalization</em>: Perform any last cleanup</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Generally speaking, there is more type information available later in
the phases. If your transformation is concerned with reading the AST,
then a later phase where information is more plentiful might be a good
choice. If your transformation is concerned with writing AST, then an
earlier phase where the tree is more sparse might be more convenient.</p>
</div>
</div>
<div class="sect5">
<h6 id="transforms-local"><a class="anchor" href="#transforms-local"></a>Local transformations</h6>
<div class="paragraph">
<p>Local AST transformations are relative to the context they are applied to. In
most cases, the context is defined by an annotation that will define the scope
of the transform. For example, annotating a field would mean that the transformation
<em>applies to</em> the field, while annotating the class would mean that the transformation
<em>applies to</em> the whole class.</p>
</div>
<div class="paragraph">
<p>As a naive and simple example, consider wanting to write a <code>@WithLogging</code>
transformation that would add console messages at the start and end of a
method invocation. So the following "Hello World" example would
actually print "Hello World" along with a start and stop message:</p>
</div>
<div class="listingblock">
<div class="title">Poor man’s aspect oriented programming</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@WithLogging</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println </span><span class="str">"Hello World"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

greet</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A local AST transformation is an easy way to do this. It requires two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a definition of the <code>@WithLogging</code> annotation</p>
</li>
<li>
<p>an implementation of <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/ASTTransformation.html">org.codehaus.groovy.transform.ASTTransformation</a> that adds the logging
expressions to the method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An <code>ASTTransformation</code> is a callback that gives you access to the
<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/control/SourceUnit.html">org.codehaus.groovy.control.SourceUnit</a>,
through which you can get a reference to the
<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/ast/ModuleNode.html">org.codehaus.groovy.ast.ModuleNode</a> (AST).</p>
</div>
<div class="paragraph">
<p>The AST (Abstract Syntax Tree) is a tree structure consisting mostly of
<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/ast/expr/Expression.html">org.codehaus.groovy.ast.expr.Expression</a> (expressions) or
<a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/ast/expr/Statement.html">org.codehaus.groovy.ast.expr.Statement</a> (statements). An easy way to
learn about the AST is to explore it in a debugger. Once you have the AST,
you can analyze it to find out information about the code or rewrite it to add
new functionality.</p>
</div>
<div class="paragraph">
<p>The local transformation annotation is the simple part. Here is the
<code>@WithLogging</code> one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">GroovyASTTransformationClass</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">ElementType</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">Retention</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">RetentionPolicy</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">Target</span><span class="pln">

</span><span class="lit">@Retention</span><span class="pun">(</span><span class="typ">RetentionPolicy</span><span class="pun">.</span><span class="pln">SOURCE</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Target</span><span class="pun">([</span><span class="typ">ElementType</span><span class="pun">.</span><span class="pln">METHOD</span><span class="pun">])</span><span class="pln">
</span><span class="lit">@GroovyASTTransformationClass</span><span class="pun">([</span><span class="str">"gep.WithLoggingASTTransformation"</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="lit">@interface</span><span class="pln"> </span><span class="typ">WithLogging</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation retention can be <code>SOURCE</code> because you won’t need the annotation
past that. The element type here is <code>METHOD</code>, the <code>@WithLogging</code> because the annotation
applies to methods.</p>
</div>
<div class="paragraph">
<p>But the most important part is the
<code>@GroovyASTTransformationClass</code> annotation. This links the <code>@WithLogging</code>
annotation to the <code>ASTTransformation</code> class you will write.
<code>gep.WithLoggingASTTransformation</code> is the fully qualified class name of the
<code>ASTTransformation</code> we are going to write. This line wires the annotation to the transformation.</p>
</div>
<div class="paragraph">
<p>With this in place, the Groovy compiler is going to invoke
<code>gep.WithLoggingASTTransformation</code> every time an <code>@WithLogging</code> is found in a
source unit. Any breakpoint set within <code>LoggingASTTransformation</code> will now
be hit within the IDE when running the sample script.</p>
</div>
<div class="paragraph">
<p>The <code>ASTTransformation</code> class is a little more complex. Here is the
very simple, and very naive, transformation to add a method start and
stop message for <code>@WithLogging</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@CompileStatic</span><span class="pln">                                                                  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="lit">@GroovyASTTransformation</span><span class="pun">(</span><span class="pln">phase</span><span class="pun">=</span><span class="typ">CompilePhase</span><span class="pun">.</span><span class="pln">SEMANTIC_ANALYSIS</span><span class="pun">)</span><span class="pln">                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">WithLoggingASTTransformation</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ASTTransformation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">ASTNode</span><span class="pun">[]</span><span class="pln"> nodes</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SourceUnit</span><span class="pln"> sourceUnit</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                        </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
        </span><span class="typ">MethodNode</span><span class="pln"> method </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">MethodNode</span><span class="pun">)</span><span class="pln"> nodes</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln">                               </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">

        </span><span class="kwd">def</span><span class="pln"> startMessage </span><span class="pun">=</span><span class="pln"> createPrintlnAst</span><span class="pun">(</span><span class="str">"Starting $method.name"</span><span class="pun">)</span><span class="pln">            </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> endMessage </span><span class="pun">=</span><span class="pln"> createPrintlnAst</span><span class="pun">(</span><span class="str">"Ending $method.name"</span><span class="pun">)</span><span class="pln">                </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">

        </span><span class="kwd">def</span><span class="pln"> existingStatements </span><span class="pun">=</span><span class="pln"> </span><span class="pun">((</span><span class="typ">BlockStatement</span><span class="pun">)</span><span class="pln">method</span><span class="pun">.</span><span class="pln">code</span><span class="pun">).</span><span class="pln">statements       </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
        existingStatements</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> startMessage</span><span class="pun">)</span><span class="pln">                                 </span><i class="conum" data-value="9"></i><b><span class="pun">(</span><span class="lit">9</span><span class="pun">)</span></b><span class="pln">
        existingStatements</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">endMessage</span><span class="pun">)</span><span class="pln">                                      </span><i class="conum" data-value="10"></i><b><span class="pun">(</span><span class="lit">10</span><span class="pun">)</span></b><span class="pln">

    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Statement</span><span class="pln"> createPrintlnAst</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                 </span><i class="conum" data-value="11"></i><b><span class="pun">(</span><span class="lit">11</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ExpressionStatement</span><span class="pun">(</span><span class="pln">
            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MethodCallExpression</span><span class="pun">(</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">VariableExpression</span><span class="pun">(</span><span class="str">"this"</span><span class="pun">),</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConstantExpression</span><span class="pun">(</span><span class="str">"println"</span><span class="pun">),</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArgumentListExpression</span><span class="pun">(</span><span class="pln">
                    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConstantExpression</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
                </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>even if not mandatory, if you write an AST transformation in Groovy, it is highly recommended to use <code>CompileStatic</code>
because it will improve performance of the compiler.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>annotate with <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/GroovyASTTransformation.html">org.codehaus.groovy.transform.GroovyASTTransformation</a> to tell at which compilation phase the
transform needs to run. Here, it’s at the <em>semantic analysis</em> phase.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>implement the <code>ASTTransformation</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>which only has a single <code>visit</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the <code>nodes</code> parameter is a 2 AST node array, for which the first one is the annotation node (<code>@WithLogging</code>) and
the second one is the annotated node (the method node)</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>create a statement that will print a message when we enter the method</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>create a statement that will print a message when we exit the method</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>get the method body, which in this case is a <code>BlockStatement</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>add the enter method message before the first statement of existing code</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>append the exit method message after the last statement of existing code</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>creates an <code>ExpressionStatement</code> wrapping a <code>MethodCallExpression</code> corresponding to <code>this.println("message")</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is important to notice that for the brevity of this example, we didn’t make the necessary checks, such as checking
that the annotated node is really a <code>MethodNode</code>, or that the method body is an instance of <code>BlockStatement</code>. This
exercise is left to the reader.</p>
</div>
<div class="paragraph">
<p>Note the creation of the new println statements in the
<code>createPrintlnAst(String)</code> method. Creating AST for code is not always
simple. In this case we need to construct a new method call, passing in
the receiver/variable, the name of the method, and an argument list.
When creating AST, it might be helpful to write the code you’re trying
to create in a Groovy file and then inspect the AST of that code in the
debugger to learn what to create. Then write a function like
<code>createPrintlnAst</code> using what you learned through the debugger.</p>
</div>
<div class="paragraph">
<p>In the end:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@WithLogging</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println </span><span class="str">"Hello World"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

greet</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Produces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Starting greet
Hello World
Ending greet</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to note that an AST transformation participates directly in the compilation process. A common
error by beginners is to have the AST transformation code in the same source tree as a class that uses the transformation.
Being in the same source tree in general means that they are compiled at the same time. Since the transformation itself
is going to be compiled in phases and that each compile phase processes all files of the same source unit before going
to the next one, there’s a direct consequence: the transformation will not be compiled before the class that uses it! In
conclusion, AST transformations need to be precompiled before you can use them. In general, it is as easy as having them
in a separate source tree.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="transforms-global"><a class="anchor" href="#transforms-global"></a>Global transformations</h6>
<div class="paragraph">
<p>Global AST transformation are similar to local one with a major difference: they do not need an annotation, meaning that
they are applied <em>globally</em>, that is to say on each class being compiled. It is therefore very important to limit their
use to last resort, because it can have a significant impact on the compiler performance.</p>
</div>
<div class="paragraph">
<p>Following the example of the <a href="#transform-local">local AST transformation</a>, imagine that we would like to trace all
methods, and not only those which are annotated with <code>@WithLogging</code>. Basically, we need this code to behave the same
as the one annotated with <code>@WithLogging</code> before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println </span><span class="str">"Hello World"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

greet</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To make this work, there are two steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>create the <code>org.codehaus.groovy.transform.ASTTransformation</code> descriptor inside the <code>META-INF/services</code> directory</p>
</li>
<li>
<p>create the <code>ASTTransformation</code> implementation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The descriptor file is required and must be found on classpath. It will contain a single line:</p>
</div>
<div class="listingblock">
<div class="title">META-INF/services/org.codehaus.groovy.transform.ASTTransformation</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">gep</span><span class="pun">.</span><span class="typ">WithLoggingASTTransformation</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code for the transformation looks similar to the local case, but instead of using the <code>ASTNode[]</code> parameter, we need
to use the <code>SourceUnit</code> instead:</p>
</div>
<div class="listingblock">
<div class="title">gep/WithLoggingASTTransformation.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@CompileStatic</span><span class="pln">                                                                  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="lit">@GroovyASTTransformation</span><span class="pun">(</span><span class="pln">phase</span><span class="pun">=</span><span class="typ">CompilePhase</span><span class="pun">.</span><span class="pln">SEMANTIC_ANALYSIS</span><span class="pun">)</span><span class="pln">                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">WithLoggingASTTransformation</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ASTTransformation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">ASTNode</span><span class="pun">[]</span><span class="pln"> nodes</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SourceUnit</span><span class="pln"> sourceUnit</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                        </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> methods </span><span class="pun">=</span><span class="pln"> sourceUnit</span><span class="pun">.</span><span class="pln">AST</span><span class="pun">.</span><span class="pln">methods                                    </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
        methods</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> method </span><span class="pun">-&gt;</span><span class="pln">                                                </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
            </span><span class="kwd">def</span><span class="pln"> startMessage </span><span class="pun">=</span><span class="pln"> createPrintlnAst</span><span class="pun">(</span><span class="str">"Starting $method.name"</span><span class="pun">)</span><span class="pln">        </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
            </span><span class="kwd">def</span><span class="pln"> endMessage </span><span class="pun">=</span><span class="pln"> createPrintlnAst</span><span class="pun">(</span><span class="str">"Ending $method.name"</span><span class="pun">)</span><span class="pln">            </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">

            </span><span class="kwd">def</span><span class="pln"> existingStatements </span><span class="pun">=</span><span class="pln"> </span><span class="pun">((</span><span class="typ">BlockStatement</span><span class="pun">)</span><span class="pln">method</span><span class="pun">.</span><span class="pln">code</span><span class="pun">).</span><span class="pln">statements   </span><i class="conum" data-value="9"></i><b><span class="pun">(</span><span class="lit">9</span><span class="pun">)</span></b><span class="pln">
            existingStatements</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> startMessage</span><span class="pun">)</span><span class="pln">                             </span><i class="conum" data-value="10"></i><b><span class="pun">(</span><span class="lit">10</span><span class="pun">)</span></b><span class="pln">
            existingStatements</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">endMessage</span><span class="pun">)</span><span class="pln">                                  </span><i class="conum" data-value="11"></i><b><span class="pun">(</span><span class="lit">11</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Statement</span><span class="pln"> createPrintlnAst</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                 </span><i class="conum" data-value="12"></i><b><span class="pun">(</span><span class="lit">12</span><span class="pun">)</span></b><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ExpressionStatement</span><span class="pun">(</span><span class="pln">
            </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MethodCallExpression</span><span class="pun">(</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">VariableExpression</span><span class="pun">(</span><span class="str">"this"</span><span class="pun">),</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConstantExpression</span><span class="pun">(</span><span class="str">"println"</span><span class="pun">),</span><span class="pln">
                </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArgumentListExpression</span><span class="pun">(</span><span class="pln">
                    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConstantExpression</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
                </span><span class="pun">)</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
        </span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>even if not mandatory, if you write an AST transformation in Groovy, it is highly recommended to use <code>CompileStatic</code>
because it will improve performance of the compiler.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>annotate with <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/GroovyASTTransformation.html">org.codehaus.groovy.transform.GroovyASTTransformation</a> to tell at which compilation phase the
transform needs to run. Here, it’s at the <em>semantic analysis</em> phase.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>implement the <code>ASTTransformation</code> interface</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>which only has a single <code>visit</code> method</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the <code>sourceUnit</code> parameter gives access to the source being compiled, so we get the AST of the current source
and retrieve the list of methods from this file</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>we iterate on each method from the source file</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>create a statement that will print a message when we enter the method</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>create a statement that will print a message when we exit the method</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>get the method body, which in this case is a <code>BlockStatement</code></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>add the enter method message before the first statement of existing code</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>append the exit method message after the last statement of existing code</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>creates an <code>ExpressionStatement</code> wrapping a <code>MethodCallExpression</code> corresponding to <code>this.println("message")</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_ast_api_guide"><a class="anchor" href="#_ast_api_guide"></a>AST API guide</h6>
<div class="sect6">
<h7 id="_abstractasttransformation"><a class="anchor" href="#_abstractasttransformation"></a>AbstractASTTransformation</h7>
<div class="paragraph">
<p>While you have seen that you can directly implement the <code>ASTTransformation</code> interface, in almost all cases you will not
do this but extend the <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/transform/AbstractASTTransformation.html">org.codehaus.groovy.transform.AbstractASTTransformation</a> class. This class provides several
utility methods that make AST transformations easier to write. Almost all AST transformations included in Groovy
extend this class.</p>
</div>
</div>
<div class="sect6">
<h7 id="_classcodeexpressiontransformer"><a class="anchor" href="#_classcodeexpressiontransformer"></a>ClassCodeExpressionTransformer</h7>
<div class="paragraph">
<p>It is a common use case to be able to transform an expression into another. Groovy provides a class which makes it
very easy to do this: <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/ast/ClassCodeExpressionTransformer.html">org.codehaus.groovy.ast.ClassCodeExpressionTransformer</a></p>
</div>
<div class="paragraph">
<p>To illustrate this, let’s create a <code>@Shout</code> transformation that will transform all <code>String</code> constants in method call
arguments into their uppercase version. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Shout</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println </span><span class="str">"Hello World"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

greet</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>should print:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>HELLO WORLD</pre>
</div>
</div>
<div class="paragraph">
<p>Then the code for the transformation can use the <code>ClassCodeExpressionTransformer</code> to make this easier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@CompileStatic</span><span class="pln">
</span><span class="lit">@GroovyASTTransformation</span><span class="pun">(</span><span class="pln">phase</span><span class="pun">=</span><span class="typ">CompilePhase</span><span class="pun">.</span><span class="pln">SEMANTIC_ANALYSIS</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ShoutASTTransformation</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">ASTTransformation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Override</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">ASTNode</span><span class="pun">[]</span><span class="pln"> nodes</span><span class="pun">,</span><span class="pln"> </span><span class="typ">SourceUnit</span><span class="pln"> sourceUnit</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">ClassCodeExpressionTransformer</span><span class="pln"> trn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ClassCodeExpressionTransformer</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
            </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> inArgList </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
            </span><span class="lit">@Override</span><span class="pln">
            </span><span class="kwd">protected</span><span class="pln"> </span><span class="typ">SourceUnit</span><span class="pln"> getSourceUnit</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                sourceUnit                                                                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
            </span><span class="pun">}</span><span class="pln">

            </span><span class="lit">@Override</span><span class="pln">
            </span><span class="typ">Expression</span><span class="pln"> transform</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Expression</span><span class="pln"> exp</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">exp </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ArgumentListExpression</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    inArgList </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
                </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">inArgList </span><span class="pun">&amp;&amp;</span><span class="pln">
                    exp </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">ConstantExpression</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> exp</span><span class="pun">.</span><span class="pln">value </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ConstantExpression</span><span class="pun">(</span><span class="pln">exp</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">())</span><span class="pln">                  </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                </span><span class="kwd">def</span><span class="pln"> trn </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">(</span><span class="pln">exp</span><span class="pun">)</span><span class="pln">
                inArgList </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
                trn
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        trn</span><span class="pun">.</span><span class="pln">visitMethod</span><span class="pun">((</span><span class="typ">MethodNode</span><span class="pun">)</span><span class="pln">nodes</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span><span class="pln">                                               </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Internally the transformation creates a <code>ClassCodeExpressionTransformer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The transformer needs to return the source unit</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>if a constant expression of type string is detected inside an argument list, transform it into its upper case version</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>call the transformer on the method being annotated</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect6">
<h7 id="_ast_nodes"><a class="anchor" href="#_ast_nodes"></a>AST Nodes</h7>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Writing an AST transformation requires a deep knowledge of the internal Groovy API. In particular it requires
knowledge about the AST classes. Since those classes are internal, there are chances that the API will change in the
future, meaning that your transformations <em>could</em> break. Despite that warning, the AST has been very stable over time
and such a thing rarely happens.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Classes of the Abstract Syntax Tree belong to the <code>org.codehaus.groovy.ast</code> package. It is recommended to the reader
to use the Groovy Console, in particular the AST browser tool, to gain knowledge about those classes. However, a good
resource for learning is the <a href="https://github.com/apache/groovy/tree/master/src/test/org/codehaus/groovy/ast/builder">AST Builder</a>
test suite.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_testing_ast_transformations"><a class="anchor" href="#_testing_ast_transformations"></a>Testing AST transformations</h6>
<div class="sect6">
<h7 id="_separating_source_trees"><a class="anchor" href="#_separating_source_trees"></a>Separating source trees</h7>
<div class="paragraph">
<p>This section is about good practices with regards to testing AST transformations. Previous sections highlighted the fact
that to be able to execute an AST transformation, it has to be precompiled. It might sound obvious but a lot of people
get caught on this, trying to use an AST transformation in the same source tree as where it is defined.</p>
</div>
<div class="paragraph">
<p>The first tip for testing AST transformation is therefore to separate test sources from the sources of the transform.
Again, this is nothing but best practices, but you must make sure that your build too does actually compile them separately.
This is the case by default with both <a href="http://maven.apache.org/">Apache Maven</a> and <a href="http://gradle.org/">Gradle</a>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_debugging_ast_transformations"><a class="anchor" href="#_debugging_ast_transformations"></a>Debugging AST transformations</h7>
<div class="paragraph">
<p>It is very handy to be able to put a breakpoint in an AST transformation, so that you can debug your code in the IDE.
However, you might be surprised to see that your IDE doesn’t stop on the breakpoint. The reason is actually simple: if
your IDE uses the Groovy compiler to compile the unit tests for your AST transformation, then the compilation is triggered
from the IDE, but the process which will compile the files doesn’t have debugging options. It’s only when the test case
is executed that the debugging options are set on the virtual machine. In short: it is too late, the class has been compiled
already, and your transformation is already applied.</p>
</div>
<div class="paragraph">
<p>A very easy workaround is to use the <code>GroovyTestCase</code> class which provides an <code>assertScript</code> method. This means that
instead of writing this in a test case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">static</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Subject</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@MyTransformToDebug</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> methodToBeTested</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> testMyTransform</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Subject</span><span class="pun">()</span><span class="pln">
    c</span><span class="pun">.</span><span class="pln">methodToBeTested</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You should write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> testMyTransformWithBreakpoint</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    assertScript </span><span class="str">'''
        import metaprogramming.MyTransformToDebug

        class Subject {
            @MyTransformToDebug
            void methodToBeTested() {}
        }
        def c = new Subject()
        c.methodToBeTested()
    '''</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The difference is that when you use <code>assertScript</code>, the code in the <code>assertScript</code> block is compiled <strong>when the
unit test is executed</strong>. That is to say that this time, the <code>Subject</code> class will be compiled with debugging active, and
the breakpoint is going to be hit.</p>
</div>
</div>
<div class="sect6">
<h7 id="_asttest"><a class="anchor" href="#_asttest"></a>ASTTest</h7>
<div class="paragraph">
<p>Last but not least, testing an AST transformation is also about testing the state of the AST <strong>during compilation</strong>. Groovy
provides a tool named <code>@ASTTest</code> for this: it is an annotation that will let you add assertions on an abstract syntax
tree. Please check the <a href="#xform-ASTTest">documentation for ASTTest</a> for more details.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_external_references"><a class="anchor" href="#_external_references"></a>External references</h6>
<div class="paragraph">
<p>If you are interested in a step-by-step tutorial about writing AST transformations, you can follow
<a href="http://melix.github.io/ast-workshop/">this workshop</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="section-grape"><a class="anchor" href="#section-grape"></a>3.5. Dependency management with Grape</h3>
<div class="sect3">
<h4 id="_quick_start"><a class="anchor" href="#_quick_start"></a>3.5.1. Quick start</h4>
<div class="sect4">
<h5 id="_add_a_dependency"><a class="anchor" href="#_add_a_dependency"></a>Add a Dependency</h5>
<div class="paragraph">
<p>Grape is a JAR dependency manager embedded into Groovy. Grape lets you quickly add maven repository dependencies to your
classpath, making scripting even easier. The simplest use is as simple as adding an annotation to your script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'org.springframework'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'spring-orm'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'3.2.5.RELEASE'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">jdbc</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="typ">JdbcTemplate</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Grab</code> also supports a shorthand notation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'org.springframework:spring-orm:3.2.5.RELEASE'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">jdbc</span><span class="pun">.</span><span class="pln">core</span><span class="pun">.</span><span class="typ">JdbcTemplate</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we are using an annotated import here, which is the recommended way. You can also search for
dependencies on <a href="http://mvnrepository.com/">mvnrepository.com</a> and it will
provide you the <code>@Grab</code> annotation form of the <code>pom.xml</code> entry.</p>
</div>
</div>
<div class="sect4">
<h5 id="Grape-SpecifyAdditionalRepositories"><a class="anchor" href="#Grape-SpecifyAdditionalRepositories"></a>Specify Additional Repositories</h5>
<div class="paragraph">
<p>Not all dependencies are in maven central. You can add new ones like
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@GrabResolver</span><span class="pun">(</span><span class="pln">name</span><span class="pun">=</span><span class="str">'restlet'</span><span class="pun">,</span><span class="pln"> root</span><span class="pun">=</span><span class="str">'http://maven.restlet.org/'</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'org.restlet'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'org.restlet'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'1.1.6'</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-MavenClassifiers"><a class="anchor" href="#Grape-MavenClassifiers"></a>Maven Classifiers</h5>
<div class="paragraph">
<p>Some maven dependencies need classifiers in order to be able to resolve.
You can fix that like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'net.sf.json-lib'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'json-lib'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'2.2.3'</span><span class="pun">,</span><span class="pln"> classifier</span><span class="pun">=</span><span class="str">'jdk15'</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-ExcludingTransitiveDependencies"><a class="anchor" href="#Grape-ExcludingTransitiveDependencies"></a>Excluding Transitive Dependencies</h5>
<div class="paragraph">
<p>Sometimes you will want to exclude transitive dependencies as you might
be already using a slightly different but compatible version of some
artifact. You can do this as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'net.sourceforge.htmlunit:htmlunit:2.8'</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@GrabExclude</span><span class="pun">(</span><span class="str">'xml-apis:xml-apis'</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-JDBCDrivers"><a class="anchor" href="#Grape-JDBCDrivers"></a>JDBC Drivers</h5>
<div class="paragraph">
<p>Because of the way JDBC drivers are loaded, you’ll need to configure
Grape to attach JDBC driver dependencies to the system class loader.
I.e:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@GrabConfig</span><span class="pun">(</span><span class="pln">systemClassLoader</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'mysql'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'mysql-connector-java'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'5.1.6'</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-UsingGrapeFromtheGroovyShell"><a class="anchor" href="#Grape-UsingGrapeFromtheGroovyShell"></a>Using Grape From the Groovy Shell</h5>
<div class="paragraph">
<p>From groovysh use the method call variant:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">groovy</span><span class="pun">.</span><span class="pln">grape</span><span class="pun">.</span><span class="typ">Grape</span><span class="pun">.</span><span class="pln">grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">:</span><span class="str">'org.springframework'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">:</span><span class="str">'spring'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">:</span><span class="str">'2.5.6'</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Proxysettings"><a class="anchor" href="#Grape-Proxysettings"></a>Proxy settings</h5>
<div class="paragraph">
<p>If you are behind a firewall and/or need to use Groovy/Grape through a
proxy server, you can specify those settings on the command like via the
<code>http.proxyHost</code> and <code>http.proxyPort</code> system properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy -Dhttp.proxyHost=yourproxy -Dhttp.proxyPort=8080 yourscript.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>Or you can make this system wide by adding these properties to your
JAVA_OPTS environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>JAVA_OPTS = -Dhttp.proxyHost=yourproxy -Dhttp.proxyPort=8080</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Logging"><a class="anchor" href="#Grape-Logging"></a>Logging</h5>
<div class="paragraph">
<p>If you want to see what Grape is doing set the system property
<code>groovy.grape.report.downloads</code> to <code>true</code> (e.g. add
<code>-Dgroovy.grape.report.downloads=true</code> to invocation or JAVA_OPTS) and Grape will
print the following infos to System.error:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Starting resolve of a dependency</p>
</li>
<li>
<p>Starting download of an artifact</p>
</li>
<li>
<p>Retrying download of an artifact</p>
</li>
<li>
<p>Download size and time for downloaded artifacts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To log with even more verbosity, increase the Ivy log level
(defaults to <code>-1</code>). For example <code>-Divy.message.logger.level=4</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Grape-Detail"><a class="anchor" href="#Grape-Detail"></a>3.5.2. Detail</h4>
<div class="paragraph">
<p>Grape (The <em>Groovy Adaptable Packaging Engine</em> or <em>Groovy Advanced
Packaging Engine</em>) is the infrastructure enabling the grab() calls in
Groovy, a set of classes leveraging <a href="http://ant.apache.org/ivy/">Ivy</a> to allow for a repository driven
module system for Groovy. This allows a developer to write a script with
an essentially arbitrary library requirement, and ship just the script.
Grape will, at runtime, download as needed and link the named libraries
and all dependencies forming a transitive closure when the script is run
from existing repositories such as JCenter, Ibiblio and java.net.</p>
</div>
<div class="paragraph">
<p>Grape follows the Ivy conventions for module version identification,
with naming change.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group</code> - Which module group the module comes from. Translates
directly to a Maven groupId or an Ivy Organization. Any group matching
<code>/groovy[x][\..*]^/</code> is reserved and may have special meaning to the
groovy endorsed modules.</p>
</li>
<li>
<p><code>module</code> - The name of the module to load. Translated directly to a
Maven artifactId or an Ivy artifact.</p>
</li>
<li>
<p><code>version</code> - The version of the module to use. Either a literal version
`1.1-RC3' or an Ivy Range `[2.2.1,)' meaning 2.2.1 or any greater
version).</p>
</li>
<li>
<p><code>classifier</code> - The optional classifier to use (for example, <em>jdk15</em>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The downloaded modules will be stored according to Ivy’s standard
mechanism with a cache root of <code>~/.groovy/grapes</code></p>
</div>
</div>
<div class="sect3">
<h4 id="Grape-Usage"><a class="anchor" href="#Grape-Usage"></a>3.5.3. Usage</h4>
<div class="sect4">
<h5 id="Grape-Annotation"><a class="anchor" href="#Grape-Annotation"></a>Annotation</h5>
<div class="paragraph">
<p>One or more <code>groovy.lang.Grab</code> annotations can be added at any place that
annotations are accepted to tell the compiler that this code relies on
the specific library. This will have the effect of adding the library to
the classloader of the groovy compiler. This annotation is detected and
evaluated before any other resolution of classes in the script, so
imported classes can be properly resolved by a <code>@Grab</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">jidesoft</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.</span><span class="typ">JideSplitButton</span><span class="pln">
</span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'com.jidesoft'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'jide-oss'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'[2.2.1,2.3.0)'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">TestClassAnnotation</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> testMethod </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">JideSplitButton</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">name
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An appropriate <code>grab(…​)</code> call will be added to the static initializer
of the class of the containing class (or script class in the case of an
annotated script element).</p>
</div>
</div>
<div class="sect4">
<h5 id="Grape-MultipleGrapeAnnotations"><a class="anchor" href="#Grape-MultipleGrapeAnnotations"></a>Multiple Grape Annotations</h5>
<div class="paragraph">
<p>In order to use a Grape annotation multiple times on the same node you must use the
<code>@Grapes</code> annotation, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grapes</span><span class="pun">([</span><span class="pln">
   </span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'commons-primitives'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'commons-primitives'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'1.0'</span><span class="pun">),</span><span class="pln">
   </span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'org.ccil.cowan.tagsoup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'tagsoup'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'0.9.7'</span><span class="pun">)])</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Example</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
</span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise you’ll encounter the following error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cannot specify duplicate annotation on the same member</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Methodcall"><a class="anchor" href="#Grape-Methodcall"></a>Method call</h5>
<div class="paragraph">
<p>Typically a call to grab will occur early in the script or in class
initialization. This is to insure that the libraries are made available
to the ClassLoader before the groovy code relies on the code. A couple
of typical calls may appear as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">grape</span><span class="pun">.</span><span class="typ">Grape</span><span class="pln">
</span><span class="com">// random maven library</span><span class="pln">
</span><span class="typ">Grape</span><span class="pun">.</span><span class="pln">grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">:</span><span class="str">'com.jidesoft'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">:</span><span class="str">'jide-oss'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">:</span><span class="str">'[2.2.0,)'</span><span class="pun">)</span><span class="pln">
</span><span class="typ">Grape</span><span class="pun">.</span><span class="pln">grab</span><span class="pun">([</span><span class="kwd">group</span><span class="pun">:</span><span class="str">'org.apache.ivy'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">:</span><span class="str">'ivy'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">:</span><span class="str">'2.0.0-beta1'</span><span class="pun">,</span><span class="pln"> conf</span><span class="pun">:[</span><span class="str">'default'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'optional'</span><span class="pun">]],</span><span class="pln">
     </span><span class="pun">[</span><span class="kwd">group</span><span class="pun">:</span><span class="str">'org.apache.ant'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">:</span><span class="str">'ant'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">:</span><span class="str">'1.7.0'</span><span class="pun">])</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Multiple calls to grab in the same context with the same parameters
should be idempotent. However, if the same code is called with a
different <code>ClassLoader</code> context then resolution may be re-run.</p>
</li>
<li>
<p>If the <code>args</code> map passed into the <code>grab</code> call has an attribute
<code>noExceptions</code> that evaluates true no exceptions will be thrown.</p>
</li>
<li>
<p><code>grab</code> requires that a <code>RootLoader</code> or <code>GroovyClassLoader</code> be specified or
be in the <code>ClassLoader</code> chain of the calling class. By default failure to
have such a <code>ClassLoader</code> available will result in module resolution and
an exception being thrown</p>
<div class="ulist">
<ul>
<li>
<p>The ClassLoader passed in via the <code>classLoader:</code> argument and it’s
parent classloaders.</p>
</li>
<li>
<p>The ClassLoader of the object passed in as the <code>referenceObject:</code>
argument, and it’s parent classloaders.</p>
</li>
<li>
<p>The ClassLoader of the class issuing the call to <code>grab</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="Grape-grabHashMapParameters"><a class="anchor" href="#Grape-grabHashMapParameters"></a>grab(HashMap) Parameters</h6>
<div class="ulist">
<ul>
<li>
<p><code>group:</code> - &lt;String&gt; - Which module group the module comes from.
Translates directly to a Maven groupId. Any group matching
<code>/groovy(|\..|x|x\..)/</code> is reserved and may have special meaning to the
groovy endorsed modules.</p>
</li>
<li>
<p><code>module:</code> - &lt;String&gt; - The name of the module to load. Translated
directly to a Maven artifactId.</p>
</li>
<li>
<p><code>version:</code> - &lt;String&gt; and possibly &lt;Range&gt; - The version of the module
to use. Either a literal version `1.1-RC3' or an Ivy Range `[2.2.1,)'
meaning 2.2.1 or any greater version).</p>
</li>
<li>
<p><code>classifier:</code> - &lt;String&gt; - The Maven classifier to resolve by.</p>
</li>
<li>
<p><code>conf:</code> - &lt;String&gt;, default <code>default' - The configuration or scope of
the module to download. The default conf is `default:</code> which maps to the
maven <code>runtime</code> and <code>master</code> scopes.</p>
</li>
<li>
<p><code>force:</code>- &lt;boolean&gt;, defaults true - Used to indicate that this
revision must be used in case of conflicts, independently of</p>
</li>
<li>
<p>conflicts manager</p>
</li>
<li>
<p><code>changing:</code> - &lt;boolean&gt;, default false - Whether the artifact can
change without it’s version designation changing.</p>
</li>
<li>
<p><code>transitive:</code> - &lt;boolean&gt;, default true - Whether to resolve other
dependencies this module has or not.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are two principal variants of <code>grab</code>, one with a single Map and
one with an arguments Map and multiple dependencies map. A call to the
single map grab is the same as calling grab with the same map passed in
twice, so grab arguments and dependencies can be mixed in the same map,
and grab can be called as a single method with named parameters.</p>
</div>
<div class="paragraph">
<p>There are synonyms for these parameters. Submitting more than one is a
runtime exception.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>group:</code>, <code>groupId:</code>, <code>organisation:</code>, <code>organization:</code>, <code>org:</code></p>
</li>
<li>
<p><code>module:</code>, <code>artifactId:</code>, <code>artifact:</code></p>
</li>
<li>
<p><code>version:</code>, <code>revision:</code>, <code>rev:</code></p>
</li>
<li>
<p><code>conf:</code>, <code>scope:</code>, <code>configuration:</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="Grape-ArgumentsMaparguments"><a class="anchor" href="#Grape-ArgumentsMaparguments"></a>Arguments Map arguments</h6>
<div class="ulist">
<ul>
<li>
<p><code>classLoader:</code> - &lt;GroovyClassLaoder&gt; or &lt;RootClassLoader&gt; - The
ClassLoader to add resolved Jars to</p>
</li>
<li>
<p><code>refObject:</code> - &lt;Object&gt; - The closest parent ClassLoader for the
object’s class will be treated as though it were passed in as
<code>classLoader:</code></p>
</li>
<li>
<p><code>validate:</code> - &lt;boolean&gt;, default false - Should poms or ivy files be
validated (true), or should we trust the cache (false).</p>
</li>
<li>
<p><code>noExceptions:</code> - &lt;boolean&gt;, default false - If ClassLoader resolution
or repository querying fails, should we throw an exception (false) or
fail silently (true).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-CommandLineTool"><a class="anchor" href="#Grape-CommandLineTool"></a>Command Line Tool</h5>
<div class="paragraph">
<p>Grape added a command line executable `grape' that allows for the
inspection and management of the local grape cache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape install &lt;groupId&gt; &lt;artifactId&gt; [&lt;version&gt;]</pre>
</div>
</div>
<div class="paragraph">
<p>This installs the specified groovy module or maven artifact. If a
version is specified that specific version will be installed, otherwise
the most recent version will be used (as if `*' we passed in).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape list</pre>
</div>
</div>
<div class="paragraph">
<p>Lists locally installed modules (with their full maven name in the case
of groovy modules) and versions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grape resolve (&lt;groupId&gt; &lt;artifactId&gt; &lt;version&gt;)+</pre>
</div>
</div>
<div class="paragraph">
<p>This returns the file locations of the jars representing the artifcats
for the specified module(s) and the respective transitive dependencies.
You may optionally pass in -ant, -dos, or -shell to get the dependencies
expressed in a format applicable for an ant script, windows batch file,
or unix shell script respectively. -ivy may be passed to see the
dependencies expressed in an ivy like format.</p>
</div>
</div>
<div class="sect4">
<h5 id="Grape-Advancedconfiguration"><a class="anchor" href="#Grape-Advancedconfiguration"></a>Advanced configuration</h5>
<div class="sect5">
<h6 id="Grape-RepositoryDirectory"><a class="anchor" href="#Grape-RepositoryDirectory"></a>Repository Directory</h6>
<div class="paragraph">
<p>If you need to change the directory grape uses for downloading libraries
you can specify the grape.root system property to change the default
(which is ~/.groovy/grapes)</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovy -Dgrape.root=/repo/grapes yourscript.groovy</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="Grape-CustomizeIvysettings"><a class="anchor" href="#Grape-CustomizeIvysettings"></a>Customize Ivy settings</h6>
<div class="paragraph">
<p>You can customize the ivy settings that Grape uses by creating a
~/.groovy/grapeConfig.xml file. If no such file exists,
<a href="https://github.com/apache/groovy/blob/master/src/resources/groovy/grape/defaultGrapeConfig.xml">here</a>
are the default settings used by Grape.</p>
</div>
<div class="paragraph">
<p>For more information on how to customize these settings, please refer to
the <a href="https://ant.apache.org/ivy/history/latest-milestone/index.html">Ivy
documentation</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Grape-MoreExamples"><a class="anchor" href="#Grape-MoreExamples"></a>More Examples</h5>
<div class="paragraph">
<p>Using Apache Commons Collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// create and use a primitive array list</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">collections</span><span class="pun">.</span><span class="pln">primitives</span><span class="pun">.</span><span class="typ">ArrayIntList</span><span class="pln">

</span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'commons-primitives'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'commons-primitives'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'1.0'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> createEmptyInts</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ArrayIntList</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> ints </span><span class="pun">=</span><span class="pln"> createEmptyInts</span><span class="pun">()</span><span class="pln">
ints</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">42</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> ints</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> ints</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">42</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using TagSoup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// find the PDF links of the Java specifications</span><span class="pln">
</span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'org.ccil.cowan.tagsoup'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'tagsoup'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'1.2.1'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> getHtml</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> parser </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlParser</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">ccil</span><span class="pun">.</span><span class="pln">cowan</span><span class="pun">.</span><span class="pln">tagsoup</span><span class="pun">.</span><span class="typ">Parser</span><span class="pun">())</span><span class="pln">
    parser</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="str">"https://docs.oracle.com/javase/specs/"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
html</span><span class="pun">.</span><span class="pln">body</span><span class="pun">.</span><span class="str">'**'</span><span class="pun">.</span><span class="pln">a</span><span class="pun">.</span><span class="lit">@href</span><span class="pun">.</span><span class="pln">grep</span><span class="pun">(~</span><span class="str">/.*\.pdf/</span><span class="pun">).</span><span class="pln">each</span><span class="pun">{</span><span class="pln"> println it </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using Google Collections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">google</span><span class="pun">.</span><span class="pln">common</span><span class="pun">.</span><span class="pln">collect</span><span class="pun">.</span><span class="typ">HashBiMap</span><span class="pln">
</span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'com.google.code.google-collections'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'google-collect'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'snapshot-20080530'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> getFruit</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">[</span><span class="pln">grape</span><span class="pun">:</span><span class="str">'purple'</span><span class="pun">,</span><span class="pln"> lemon</span><span class="pun">:</span><span class="str">'yellow'</span><span class="pun">,</span><span class="pln"> orange</span><span class="pun">:</span><span class="str">'orange'</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">HashBiMap</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> fruit</span><span class="pun">.</span><span class="pln">lemon </span><span class="pun">==</span><span class="pln"> </span><span class="str">'yellow'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> fruit</span><span class="pun">.</span><span class="pln">inverse</span><span class="pun">().</span><span class="pln">yellow </span><span class="pun">==</span><span class="pln"> </span><span class="str">'lemon'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Launching a Jetty server to serve Groovy templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grapes</span><span class="pun">([</span><span class="pln">
    </span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'org.eclipse.jetty.aggregate'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'jetty-server'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'8.1.7.v20120910'</span><span class="pun">),</span><span class="pln">
    </span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'org.eclipse.jetty.aggregate'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'jetty-servlet'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'8.1.7.v20120910'</span><span class="pun">),</span><span class="pln">
    </span><span class="lit">@Grab</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">=</span><span class="str">'javax.servlet'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">=</span><span class="str">'javax.servlet-api'</span><span class="pun">,</span><span class="pln"> version</span><span class="pun">=</span><span class="str">'3.0.1'</span><span class="pun">)])</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">eclipse</span><span class="pun">.</span><span class="pln">jetty</span><span class="pun">.</span><span class="pln">server</span><span class="pun">.</span><span class="typ">Server</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">eclipse</span><span class="pun">.</span><span class="pln">jetty</span><span class="pun">.</span><span class="pln">servlet</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">servlet</span><span class="pun">.*</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> runServer</span><span class="pun">(</span><span class="pln">duration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> server </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Server</span><span class="pun">(</span><span class="lit">8080</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> context </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ServletContextHandler</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> </span><span class="str">"/"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ServletContextHandler</span><span class="pun">.</span><span class="pln">SESSIONS</span><span class="pun">);</span><span class="pln">
    context</span><span class="pun">.</span><span class="pln">resourceBase </span><span class="pun">=</span><span class="pln"> </span><span class="str">"."</span><span class="pln">
    context</span><span class="pun">.</span><span class="pln">addServlet</span><span class="pun">(</span><span class="typ">TemplateServlet</span><span class="pun">,</span><span class="pln"> </span><span class="str">"*.gsp"</span><span class="pun">)</span><span class="pln">
    server</span><span class="pun">.</span><span class="pln">start</span><span class="pun">()</span><span class="pln">
    sleep duration
    server</span><span class="pun">.</span><span class="pln">stop</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

runServer</span><span class="pun">(</span><span class="lit">10000</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Grape will download Jetty and its dependencies on first launch of this
script, and cache them. We’re creating a new Jetty Server on port 8080,
then expose Groovy’s TemplateServlet at the root of the context — Groovy
comes with its own powerful template engine mechanism. We start the
server and let it run for a certain duration. Each time someone will hit
http://localhost:8080/somepage.gsp, it will display the somepage.gsp
template to the user — those template pages should be situated in the
same directory as this server script.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_guide"><a class="anchor" href="#_testing_guide"></a>3.6. Testing Guide</h3>
<div class="sect3">
<h4 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a>3.6.1. Introduction</h4>
<div class="paragraph">
<p>The Groovy programming language comes with great support for writing tests. In addition to the language
features and test integration with state-of-the-art testing libraries and frameworks, the Groovy ecosystem has born
a rich set of testing libraries and frameworks.</p>
</div>
<div class="paragraph">
<p>This chapter will start with language specific testing features and continue with a closer look at JUnit
integration, Spock for specifications, and Geb for functional tests. Finally, we’ll do an overview of other testing
libraries known to be working with Groovy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_language_features"><a class="anchor" href="#_language_features"></a>3.6.2. Language Features</h4>
<div class="paragraph">
<p>Besides integrated support for JUnit, the Groovy programming language comes with features that have proven
to be very valuable for test-driven development. This section gives insight on them.</p>
</div>
<div class="sect4">
<h5 id="_power_assertions"><a class="anchor" href="#_power_assertions"></a>Power Assertions</h5>
<div class="paragraph">
<p>Writing tests means formulating assumptions by using assertions. In Java this can be done by using the <code>assert</code>
keyword that has been added in J2SE 1.4. In Java, <code>assert</code> statements can be enabled via the JVM parameters <code>-ea</code>
(or <code>-enableassertions</code>) and <code>-da</code> (or <code>-disableassertions</code>). Assertion statements in Java are disabled by default.</p>
</div>
<div class="paragraph">
<p>Groovy comes with a rather <em>powerful variant</em> of <code>assert</code> also known as <em>power assertion statement</em>. Groovy’s power
<code>assert</code> differs from the Java version in its output given the boolean expression validates to <code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> x </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">

</span><span class="com">// Output:             </span><i class="conum" data-value="1"></i><b><span class="com">(1)</span></b><span class="pln">
</span><span class="com">//</span><span class="pln">
</span><span class="com">// Assertion failed:</span><span class="pln">
</span><span class="com">// assert x == 2</span><span class="pln">
</span><span class="com">//        | |</span><span class="pln">
</span><span class="com">//        1 false</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This section shows the std-err output</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>java.lang.AssertionError</code> that is thrown whenever the assertion can not be validated successfully, contains
an extended version of the original exception message. The power assertion output shows evaluation results from
the outer to the inner expression.</p>
</div>
<div class="paragraph">
<p>The power assertion statements true power unleashes in complex Boolean statements, or statements with
collections or other <code>toString</code>-enabled classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="lit">6</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">6</span><span class="pun">,</span><span class="lit">7</span><span class="pun">,</span><span class="lit">8</span><span class="pun">,</span><span class="lit">9</span><span class="pun">,</span><span class="lit">10</span><span class="pun">]</span><span class="pln">

</span><span class="com">// Output:</span><span class="pln">
</span><span class="com">//</span><span class="pln">
</span><span class="com">// Assertion failed:</span><span class="pln">
</span><span class="com">// assert (x &lt;&lt; 6) == [6,7,8,9,10]</span><span class="pln">
</span><span class="com">//         | |     |</span><span class="pln">
</span><span class="com">//         | |     false</span><span class="pln">
</span><span class="com">//         | [1, 2, 3, 4, 5, 6]</span><span class="pln">
</span><span class="com">//         [1, 2, 3, 4, 5, 6]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another important difference from Java is that in Groovy assertions are <em>enabled by default</em>. It has been a language design
decision to remove the possibility to deactivate assertions. Or, as Bertrand Meyer stated, <code>it makes no sense to take
off your swim ring if you put your feet into real water</code>.</p>
</div>
<div class="paragraph">
<p>One thing to be aware of are methods with side-effects inside Boolean expressions in power assertion statements. As
the internal error message construction mechanism does only store references to instances under target,
 it happens that the error message text is invalid at rendering time in case of side-effecting methods involved:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">]].</span><span class="pln">first</span><span class="pun">().</span><span class="pln">unique</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">]</span><span class="pln">

</span><span class="com">// Output:</span><span class="pln">
</span><span class="com">//</span><span class="pln">
</span><span class="com">// Assertion failed:</span><span class="pln">
</span><span class="com">// assert [[1,2,3,3,3,3,4]].first().unique() == [1,2,3]</span><span class="pln">
</span><span class="com">//                          |       |        |</span><span class="pln">
</span><span class="com">//                          |       |        false</span><span class="pln">
</span><span class="com">//                          |       [1, 2, 3, 4]</span><span class="pln">
</span><span class="com">//                          [1, 2, 3, 4]           </span><i class="conum" data-value="1"></i><b><span class="com">(1)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The error message shows the actual state of the collection, not the state before the <code>unique</code> method was applied</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you choose to provide a custom assertion error message this can be done by using the Java syntax <code>assert
expression1 : expression2</code> where <code>expression1</code> is the Boolean expression and <code>expression2</code> is the custom error message.
 Be aware though that this will disable the power assert and will fully fallback to custom
 error messages on assertion errors.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_mocking_and_stubbing"><a class="anchor" href="#_mocking_and_stubbing"></a>Mocking and Stubbing</h5>
<div class="paragraph">
<p>Groovy has excellent built-in support for a range of mocking and stubbing alternatives. When using Java, dynamic mocking
frameworks are very popular. A key reason for this is that it is hard work creating custom hand-crafted mocks using Java.
Such frameworks can be used easily with Groovy if you choose but creating custom mocks is much easier in Groovy. You
can often get away with simple maps or closures to build your custom mocks.</p>
</div>
<div class="paragraph">
<p>The following sections show ways to create mocks and stubs with Groovy language features only.</p>
</div>
<div class="sect5">
<h6 id="_map_coercion"><a class="anchor" href="#_map_coercion"></a>Map Coercion</h6>
<div class="paragraph">
<p>By using maps or expandos, we can incorporate desired behaviour of a collaborator very easily as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">TranslationService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> convert</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> key</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"test"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> service </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">convert</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> key </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="str">'some text'</span><span class="pln"> </span><span class="pun">}]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">TranslationService</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">'some text'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> service</span><span class="pun">.</span><span class="pln">convert</span><span class="pun">(</span><span class="str">'key.text'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>as</code> operator can be used to coerce a map to a particular class. The given map keys are interpreted as
method names and the values, being <code>groovy.lang.Closure</code> blocks, are interpreted as method code blocks.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Be aware that map coercion can get into the way if you deal with custom <code>java.util.Map</code> descendant classes in combination
with the <code>as</code> operator. The map coercion mechanism is targeted directly at certain collection classes, it doesn’t take
custom classes into account.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_closure_coercion_2"><a class="anchor" href="#_closure_coercion_2"></a>Closure Coercion</h6>
<div class="paragraph">
<p>The 'as' operator can be used with closures in a neat way which is great for developer testing in simple scenarios.
We haven’t found this technique to be so powerful that we want to do away with dynamic mocking, but it can be very
useful in simple cases none-the-less.</p>
</div>
<div class="paragraph">
<p>Classes or interfaces holding a single method, including SAM (single abstract method) classes, can be used to coerce
a closure block to be an object of the given type. Be aware that for doing this, Groovy internally create a proxy object
descending for the given class. So the object will not be a direct instance of the given class. This important if, for
example, the generated proxy object’s meta-class is altered afterwards.</p>
</div>
<div class="paragraph">
<p>Let’s have an example on coercing a closure to be of a specific type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> service </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> key </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="str">'some text'</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">TranslationService</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">'some text'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> service</span><span class="pun">.</span><span class="pln">convert</span><span class="pun">(</span><span class="str">'key.text'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Groovy supports a feature called implicit SAM coercion. This means that the <code>as</code> operator is not necessary in situations
where the runtime can infer the target SAM type. This type of coercion might be useful in tests to mock entire SAM
classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">BaseService</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> doSomething</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">BaseService</span><span class="pln"> service </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> println </span><span class="str">'doing something'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
service</span><span class="pun">.</span><span class="pln">doSomething</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_mockfor_and_stubfor"><a class="anchor" href="#_mockfor_and_stubfor"></a>MockFor and StubFor</h6>
<div class="paragraph">
<p>The Groovy mocking and stubbing classes can be found in the <code>groovy.mock.interceptor</code> package.</p>
</div>
<div class="paragraph">
<p>The <code>MockFor</code> class supports (typically unit) testing of classes in isolation by allowing a <em>strictly ordered</em>
 expectation
of the behavior of collaborators to be defined. A typical test scenario 
involves a class under test and one or more collaborators. In such a 
scenario it is
often desirable to just test the business logic of the class under test.
 One strategy for doing that is to replace
the collaborator instances with simplified mock objects to help isolate 
out the logic in the test target. MockFor
allows such mocks to be created using meta-programming. The desired 
behavior of collaborators is defined as a behavior
specification. The behavior is enforced and checked automatically.</p>
</div>
<div class="paragraph">
<p>Let’s assume our target classes looked like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> first</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Family</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Person</span><span class="pln"> father</span><span class="pun">,</span><span class="pln"> mother
    </span><span class="kwd">def</span><span class="pln"> nameOfMother</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"$mother.first $mother.last"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With <code>MockFor</code>, a mock expectation is always sequence dependent and its use automatically ends with a call to <code>verify</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> mock </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MockFor</span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln">      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
mock</span><span class="pun">.</span><span class="pln">demand</span><span class="pun">.</span><span class="pln">getFirst</span><span class="pun">{</span><span class="pln"> </span><span class="str">'dummy'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
mock</span><span class="pun">.</span><span class="pln">demand</span><span class="pun">.</span><span class="pln">getLast</span><span class="pun">{</span><span class="pln"> </span><span class="str">'name'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
mock</span><span class="pun">.</span><span class="kwd">use</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> mary </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="str">'Mary'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="str">'Smith'</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Family</span><span class="pun">(</span><span class="pln">mother</span><span class="pun">:</span><span class="pln">mary</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">nameOfMother</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'dummy name'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
mock</span><span class="pun">.</span><span class="pln">expect</span><span class="pun">.</span><span class="pln">verify</span><span class="pun">()</span><span class="pln">                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a new mock is created by a new instance of <code>MockFor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a <code>Closure</code> is passed to <code>use</code> which enables the mocking functionality</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>a call to <code>verify</code> checks whether the sequence and number of method calls is as expected</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>StubFor</code> class supports (typically unit) testing of classes in isolation by allowing a <em>loosely-ordered</em> expectation
of the behavior of collaborators to be defined. A typical test scenario involves a class under test and one or more
collaborators. In such a scenario it is often desirable to just test the business logic of the CUT. One strategy for
doing that is to replace the collaborator instances with simplified stub objects to help isolate out the logic
in the target class. <code>StubFor</code> allows such stubs to be created using meta-programming. The desired behavior of
collaborators is defined as a behavior specification.</p>
</div>
<div class="paragraph">
<p>In contrast to <code>MockFor</code> the stub expectation checked with <code>verify</code> is sequence independent and its use is optional:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> stub </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StubFor</span><span class="pun">(</span><span class="typ">Person</span><span class="pun">)</span><span class="pln">      </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
stub</span><span class="pun">.</span><span class="pln">demand</span><span class="pun">.</span><span class="kwd">with</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    getLast</span><span class="pun">{</span><span class="pln"> </span><span class="str">'name'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    getFirst</span><span class="pun">{</span><span class="pln"> </span><span class="str">'dummy'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
stub</span><span class="pun">.</span><span class="kwd">use</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                          </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> john </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="str">'John'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="str">'Smith'</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Family</span><span class="pun">(</span><span class="pln">father</span><span class="pun">:</span><span class="pln">john</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">father</span><span class="pun">.</span><span class="pln">first </span><span class="pun">==</span><span class="pln"> </span><span class="str">'dummy'</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">father</span><span class="pun">.</span><span class="kwd">last</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'name'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
stub</span><span class="pun">.</span><span class="pln">expect</span><span class="pun">.</span><span class="pln">verify</span><span class="pun">()</span><span class="pln">                </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a new stub is created by a new instance of <code>StubFor</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>with</code> method is used for delegating all calls inside the closure to the <code>StubFor</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>a <code>Closure</code> is passed to <code>use</code> which enables the stubbing functionality</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>a call to <code>verify</code> (optional) checks whether the number of method calls is as expected</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><code>MockFor</code> and <code>StubFor</code> can not be used to test statically compiled classes e.g for Java classes or Groovy classes that
make use of <code>@CompileStatic</code>. To stub and/or mock these classes you can use Spock or one of the Java mocking libraries.</p>
</div>
</div>
<div class="sect5">
<h6 id="testing_guide_emc"><a class="anchor" href="#testing_guide_emc"></a>Expando Meta-Class (EMC)</h6>
<div class="paragraph">
<p>Groovy includes a special <code>MetaClass</code> the so-called <code>ExpandoMetaClass</code> (EMC). It allows to dynamically add methods,
constructors, properties and static methods using a neat closure syntax.</p>
</div>
<div class="paragraph">
<p>Every <code>java.lang.Class</code> is supplied with a special <code>metaClass</code> property that will give a reference to an
<code>ExpandoMetaClass</code> instance. The expando meta-class is not restricted to custom classes, it can be used for
JDK classes like for example <code>java.lang.String</code> as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">swapCase </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{-&gt;</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> sb </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringBuffer</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">delegate</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln">
        sb </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Character</span><span class="pun">.</span><span class="pln">isUpperCase</span><span class="pun">(</span><span class="pln">it </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="typ">Character</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">(</span><span class="pln">it </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln">
            </span><span class="typ">Character</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">(</span><span class="pln">it </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    sb</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="str">"heLLo, worLD!"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> s</span><span class="pun">.</span><span class="pln">swapCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'HEllO, WORld!'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ExpandoMetaClass</code> is a rather good candidate for mocking functionality as it allows for more advanced stuff
like mocking static methods</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Book</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> title
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Book</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="kwd">static</span><span class="pun">.</span><span class="pln">create </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="pln">title</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="str">"The Stand"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">title </span><span class="pun">==</span><span class="pln"> </span><span class="str">'The Stand'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or even constructors</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Book</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">constructor </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> title </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="pln">title</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">(</span><span class="str">"The Stand"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">title </span><span class="pun">==</span><span class="pln"> </span><span class="str">'The Stand'</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Mocking constructors might seem like a hack that’s better not even to be considered but even there might be valid
use cases. An example can be found in Grails where domain class constructors are added at run-time with the
help of <code>ExpandoMetaClass</code>. This lets the domain object register itself in the Spring application context and allows
for injection of services or other beans controlled by the dependency-injection container.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you want to change the <code>metaClass</code> property on a per test method level you need to remove the changes that were
done to the meta-class, otherwise those changes would be persistent across test method calls. Changes are removed by
replacing the meta-class in the <code>GroovyMetaClassRegistry</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">GroovySystem</span><span class="pun">.</span><span class="pln">metaClassRegistry</span><span class="pun">.</span><span class="pln">setMetaClass</span><span class="pun">(</span><span class="pln">java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another alternative is to register a <code>MetaClassRegistryChangeEventListener</code>, track the changed classes and remove
the changes in the cleanup method of your chosen testing runtime. A good example can be found
<a href="https://github.com/grails/grails-core/blob/master/grails-bootstrap/src/main/groovy/grails/build/support/MetaClassRegistryCleaner.java">in the Grails web
development framework</a>.</p>
</div>
<div class="paragraph">
<p>Besides using the <code>ExpandoMetaClass</code> on a class-level, there is also support for using the meta-class on a per-object
level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Book</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="pln"> </span><span class="str">"The Stand"</span><span class="pun">)</span><span class="pln">
b</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">getTitle </span><span class="pun">{-&gt;</span><span class="pln"> </span><span class="str">'My Title'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> b</span><span class="pun">.</span><span class="pln">title </span><span class="pun">==</span><span class="pln"> </span><span class="str">'My Title'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the meta-class change is related to the instance only. Depending on the test scenario this might be a better
fit than the global meta-class change.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_gdk_methods"><a class="anchor" href="#_gdk_methods"></a>GDK Methods</h5>
<div class="paragraph">
<p>The following section gives a brief overview on GDK methods that can be leveraged in test case scenarios, for example for
test data generation.</p>
</div>
<div class="sect5">
<h6 id="_iterable_combinations"><a class="anchor" href="#_iterable_combinations"></a>Iterable#combinations</h6>
<div class="paragraph">
<p>The <code>combinations</code> method that is added on <code>java.lang.Iterable</code> compliant classes can be used to get a list of
combinations from a list containing two or more sub-lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> testCombinations</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> combinations </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">],[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]].</span><span class="pln">combinations</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> combinations </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">],</span><span class="pln"> </span><span class="pun">[</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]]</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The method could be used in test case scenarios to generate all possible argument combinations for a specific method
call.</p>
</div>
</div>
<div class="sect5">
<h6 id="_iterable_eachcombination"><a class="anchor" href="#_iterable_eachcombination"></a>Iterable#eachCombination</h6>
<div class="paragraph">
<p>The <code>eachCombination</code> method that is added on <code>java.lang.Iterable</code> can be used to apply a function (or in this
 case a <code>groovy.lang.Closure</code>) to each if the combinations that has been built by the <code>combinations</code> method:</p>
</div>
<div class="paragraph">
<p><code>eachCombination</code> is a GDK method that is added to all classes conforming to the <code>java.lang.Iterable</code> interface.
It applies a function on each combination of the input lists:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> testEachCombination</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">[[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">],[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">]].</span><span class="pln">eachCombination </span><span class="pun">{</span><span class="pln"> println it</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> it</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The method could be used in the testing context to call methods with each of the generated combinations.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_tool_support"><a class="anchor" href="#_tool_support"></a>Tool Support</h5>
<div class="sect5">
<h6 id="_test_code_coverage"><a class="anchor" href="#_test_code_coverage"></a>Test Code Coverage</h6>
<div class="paragraph">
<p>Code coverage is a useful measure of the effectiveness of (unit) tests. A program with high code coverage has a
lower chance to hold critical bugs than a program with no or low coverage. To get code coverage metrics,
the generated byte-code usually needs to be instrumented before the tests are executed. One tool with Groovy support
 for this task is <a href="http://cobertura.github.io/cobertura/">Cobertura</a>.</p>
</div>
<div class="paragraph">
<p>Various frameworks and build tools come with Cobertura integration. For Grails, there is the <a href="http://grails.org/plugin/code-coverage">code coverage plugin</a> based
on Cobertura, for Gradle there is the <a href="https://github.com/eriwen/gradle-cobertura-plugin">gradle-cobertura plugin</a>, to name only two of them.</p>
</div>
<div class="paragraph">
<p>The following code listing shows an example on how to enable Cobertura test coverage reports in a Gradle build script from
a Groovy project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> pluginVersion </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;plugin version&gt;'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> groovyVersion </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;groovy version&gt;'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> junitVersion </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;junit version&gt;'</span><span class="pln">

buildscript </span><span class="pun">{</span><span class="pln">
    repositories </span><span class="pun">{</span><span class="pln">
        mavenCentral</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    dependencies </span><span class="pun">{</span><span class="pln">
        classpath </span><span class="str">'com.eriwen:gradle-cobertura-plugin:${pluginVersion}'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

apply plugin</span><span class="pun">:</span><span class="pln"> </span><span class="str">'groovy'</span><span class="pln">
apply plugin</span><span class="pun">:</span><span class="pln"> </span><span class="str">'cobertura'</span><span class="pln">

repositories </span><span class="pun">{</span><span class="pln">
    mavenCentral</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

dependencies </span><span class="pun">{</span><span class="pln">
    compile </span><span class="str">"org.codehaus.groovy:groovy-all:${groovyVersion}"</span><span class="pln">
    testCompile </span><span class="str">"junit:junit:${junitVersion}"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

cobertura </span><span class="pun">{</span><span class="pln">
    format </span><span class="pun">=</span><span class="pln"> </span><span class="str">'html'</span><span class="pln">
    includes </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'**/*.java'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'**/*.groovy'</span><span class="pun">]</span><span class="pln">
    excludes </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'com/thirdparty/**/*.*'</span><span class="pun">]</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Several output formats can be chosen for Cobertura coverage reports and test code coverage reports can be added to
continuous integration build tasks.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_unit_tests_with_junit_3_and_4"><a class="anchor" href="#_unit_tests_with_junit_3_and_4"></a>3.6.3. Unit Tests with JUnit 3 and 4</h4>
<div class="paragraph">
<p>Groovy simplifies JUnit testing, making it more Groovy. In the following sections we will have a closer look at
JUnit 3/4 Groovy integration.</p>
</div>
<div class="sect4">
<h5 id="_junit_3"><a class="anchor" href="#_junit_3"></a>JUnit 3</h5>
<div class="paragraph">
<p>Maybe one of the most prominent Groovy classes supporting JUnit 3 tests is the <code>GroovyTestCase</code> class. Being
derived from <code>junit.framework.TestCase</code> it offers a bunch of additional methods that make testing in Groovy a breeze.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although <code>GroovyTestCase</code> inherits from <code>TestCase</code> doesn’t mean you can’t use JUnit 4 features in your project. In fact,
the most recent Groovy versions come with a bundled JUnit 4 and that comes with a backwards compatible <code>TestCase</code>
implementation. There have been some discussion on the Groovy mailing-list on whether to use <code>GroovyTestCase</code> or JUnit 4
with the result that it is mostly a matter of taste, but with <code>GroovyTestCase</code> you get a bunch of methods for free that
make certain types of tests easier to write.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In this section, we will have a look at some of the methods provided by <code>GroovyTestCase</code>. A full list of these can be
found in the JavaDoc documentation for <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/util/GroovyTestCase.html">groovy.util.GroovyTestCase</a> ,
don’t forget it is inherited from <code>junit.framework.TestCase</code> which inherits all the <code>assert*</code> methods.</p>
</div>
<div class="sect5">
<h6 id="_assertion_methods"><a class="anchor" href="#_assertion_methods"></a>Assertion Methods</h6>
<div class="paragraph">
<p><code>GroovyTestCase</code> is inherited from <code>junit.framework.TestCase</code> therefore it inherits a large number of assertion methods
being available to be called in every test method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyTestCase</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">GroovyTestCase</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> testAssertions</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        assertTrue</span><span class="pun">(</span><span class="lit">1</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
        assertEquals</span><span class="pun">(</span><span class="str">"test"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"test"</span><span class="pun">)</span><span class="pln">

        </span><span class="kwd">def</span><span class="pln"> x </span><span class="pun">=</span><span class="pln"> </span><span class="str">"42"</span><span class="pln">
        assertNotNull </span><span class="str">"x must not be null"</span><span class="pun">,</span><span class="pln"> x
        assertNull </span><span class="kwd">null</span><span class="pln">

        assertSame x</span><span class="pun">,</span><span class="pln"> x
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen above, in contrast to Java it is possible to leave out the parenthesis in most situations which
leads to even more readability of JUnit assertion method call expressions.</p>
</div>
<div class="paragraph">
<p>An interesting assertion method that is added by <code>GroovyTestCase</code> is <code>assertScript</code>. It ensures that the given Groovy
code string succeeds without any exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> testScriptAssertions</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    assertScript </span><span class="str">'''
        def x = 1
        def y = 2

        assert x + y == 3
    '''</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_shouldfail_methods"><a class="anchor" href="#_shouldfail_methods"></a>shouldFail Methods</h6>
<div class="paragraph">
<p><code>shouldFail</code> can be used to check whether the given code block fails or not. In case it fails, the assertion does hold,
otherwise the assertion fails:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> testInvalidIndexAccess1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">]</span><span class="pln">
    shouldFail </span><span class="pun">{</span><span class="pln">
        numbers</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above uses the basic <code>shouldFail</code> method interface that takes a <code>groovy.lang.Closure</code> as a single argument.
 The <code>Closure</code> instance holds the code that is supposed to be breaking during run-time.</p>
</div>
<div class="paragraph">
<p>If we wanted to assert <code>shouldFail</code> on a specific <code>java.lang.Exception</code> type we could have done so by using the <code>shouldFail</code>
implementation that takes the <code>Exception</code> class as first argument and the <code>Closure</code> as second argument:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> testInvalidIndexAccess2</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">]</span><span class="pln">
    shouldFail </span><span class="typ">IndexOutOfBoundsException</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        numbers</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If anything other than <code>IndexOutOfBoundsException</code> (or a descendant class of it) is thrown, the test case will fail.</p>
</div>
<div class="paragraph">
<p>A pretty nice feature of <code>shouldFail</code> hasn’t been visible so far: it returns the exception message. This is really
useful if you want to assert on the exception error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> testInvalidIndexAccess3</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">]</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> msg </span><span class="pun">=</span><span class="pln"> shouldFail </span><span class="typ">IndexOutOfBoundsException</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        numbers</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> msg</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'Index: 4, Size: 4'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_notyetimplemented_method"><a class="anchor" href="#_notyetimplemented_method"></a>notYetImplemented Method</h6>
<div class="paragraph">
<p>The <code>notYetImplemented</code> method has been greatly influenced by HtmlUnit. It allows to write a test method but mark it
as not yet implemented. As long as the test method fails and is marked with <code>notYetImplemented</code> the test goes green:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> testNotYetImplemented1</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">notYetImplemented</span><span class="pun">())</span><span class="pln"> </span><span class="kwd">return</span><span class="pln">   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

    </span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">                     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a call to <code>notYetImplemented</code> is necessary for <code>GroovyTestCase</code> to get the current method stack.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>as long as the test evaluates to <code>false</code> the test execution will be successful.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>An alternative to the <code>notYetImplemented</code> method is the <code>@NotYetImplemented</code> annotation. It allows for annotating a
method as not yet implemented, with the exact same behavior as <code>GroovyTestCase#notYetImplemented</code> but without the need
for the <code>notYetImplemented</code> method call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@NotYetImplemented</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> testNotYetImplemented2</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_junit_4"><a class="anchor" href="#_junit_4"></a>JUnit 4</h5>
<div class="paragraph">
<p>Groovy can be used to write JUnit 4 test cases without any restrictions. The <code>groovy.test.GroovyAssert</code> holds
various static methods that can be used as replacement for the <code>GroovyTestCase</code> methods in JUnit 4 tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">junit</span><span class="pun">.</span><span class="typ">Test</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">test</span><span class="pun">.</span><span class="typ">GroovyAssert</span><span class="pun">.</span><span class="pln">shouldFail

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">JUnit4ExampleTests</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Test</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> indexOutOfBoundsAccess</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">]</span><span class="pln">
        shouldFail </span><span class="pun">{</span><span class="pln">
            numbers</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen in the example above, the static methods found in <code>GroovyAssert</code> are imported at the beginning of the
 class definition thus <code>shouldFail</code> can be used the same way it can be used in a <code>GroovyTestCase</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>groovy.test.GroovyAssert</code> descends from <code>org.junit.Assert</code> that means it inherits all JUnit assertion methods. However,
with the introduction of the power assertion statement, it turned out to be <em>good practice to rely on assertion statements</em>
instead of using the JUnit assertion methods with the improved message being the main reason.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is worth mentioning that <code>GroovyAssert.shouldFail</code> is not absolutely identical to <code>GroovyTestCase.shouldFail</code>. While
<code>GroovyTestCase.shouldFail</code> returns the exception message, <code>GroovyAssert.shouldFail</code> returns the exception itself. It
takes a few more keystrokes to get the message, but in return you can access other properties and methods of the
exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Test</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> shouldFailReturn</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> e </span><span class="pun">=</span><span class="pln"> shouldFail </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">,</span><span class="pln">
                                   </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pun">(</span><span class="str">'bar'</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> e </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">RuntimeException</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">message </span><span class="pun">==</span><span class="pln"> </span><span class="str">'foo'</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">cause</span><span class="pun">.</span><span class="pln">message </span><span class="pun">==</span><span class="pln"> </span><span class="str">'bar'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_testing_with_spock"><a class="anchor" href="#_testing_with_spock"></a>3.6.4. Testing with Spock</h4>
<div class="paragraph">
<p>Spock is a testing and specification framework for Java and Groovy applications. What makes it stand out from the
crowd is its beautiful and highly expressive specification DSL. In practice, Spock specifications are written as
Groovy classes. Although written in Groovy they can be used to test Java classes. Spock can be used for unit,
integration or BDD (behavior-driven-development) testing, it doesn’t put itself into a specific category of testing
frameworks or libraries.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Beside these awesome features Spock is a good example on how to leverage advanced Groovy programming
language features in third party libraries, for example, by using Groovy AST transformations.
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section should not serve as detailed guide on how to use Spock, it should rather give an impression what Spock
is about and how it can be leveraged for unit, integration, functional or any other type of testing.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The next section we will have an first look at the anatomy of a Spock specification. It should give a
pretty good feeling on what Spock is up to.</p>
</div>
<div class="sect4">
<h5 id="_specifications"><a class="anchor" href="#_specifications"></a>Specifications</h5>
<div class="paragraph">
<p>Spock lets you write specifications that describe features (properties, aspects) exhibited by a system of
interest. The "system" can be anything between a single class and an entire application, a more advanced term for it is
<em>system under specification</em>. The <em>feature description</em> starts from a specific snapshot of the system and its
collaborators, this snapshot is called the <em>feature’s fixture</em>.</p>
</div>
<div class="paragraph">
<p>Spock specification classes are derived from <code>spock.lang.Specification</code>. A concrete specification class might consist
of fields, fixture methods, features methods and helper methods.</p>
</div>
<div class="paragraph">
<p>Let’s have a look at a simple specification with a single feature method for an imaginary <code>Stack</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">StackSpec</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Specification</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> </span><span class="str">"adding an element leads to size increase"</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        setup</span><span class="pun">:</span><span class="pln"> </span><span class="str">"a new stack instance is created"</span><span class="pln">        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
            </span><span class="kwd">def</span><span class="pln"> stack </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Stack</span><span class="pun">()</span><span class="pln">

        </span><span class="kwd">when</span><span class="pun">:</span><span class="pln">                                           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
            stack</span><span class="pun">.</span><span class="pln">push </span><span class="lit">42</span><span class="pln">

        </span><span class="kwd">then</span><span class="pun">:</span><span class="pln">                                           </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
            stack</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Feature method, is by convention named with a String literal.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Setup block, here is where any setup work for this feature needs to be done.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>When block describes a stimulus, a certain action under target by this feature specification.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Then block any expressions that can be used to validate the result of the code that was triggered by the when block.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Spock feature specifications are defined as methods inside a <code>spock.lang.Specification</code> class. They describe the feature
by using a String literal instead of a method name.</p>
</div>
<div class="paragraph">
<p>A feature method holds multiple blocks, in our example we used <code>setup</code>, <code>when</code> and <code>then</code>. The <code>setup</code> block is special
in that it is optional and allows to configure local variables visible inside the feature method. The <code>when</code> block
defines the stimulus and is a companion of the <code>then</code> block which describes the response to the stimulus.</p>
</div>
<div class="paragraph">
<p>Note that the <code>setup</code> method in the <code>StackSpec</code> above additionally
  has a description String. Description Strings are optional and can be added after block labels (like <code>setup</code>, <code>when</code>,
  <code>then</code>).</p>
</div>
</div>
<div class="sect4">
<h5 id="_more_spock"><a class="anchor" href="#_more_spock"></a>More Spock</h5>
<div class="paragraph">
<p>Spock provides much more features like data tables or advanced mocking capabilities. Feel free to consult the
<a href="https://github.com/spockframework/spock">Spock GitHub page</a> for more documentation and download information.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_functional_tests_with_geb"><a class="anchor" href="#_functional_tests_with_geb"></a>3.6.5. Functional Tests with Geb</h4>
<div class="paragraph">
<p>Geb is a functional web testing and scraper library that integrates with JUnit and Spock. It is based upon the
Selenium web drivers and, like Spock, provides a Groovy DSL to write functional tests for web applications.</p>
</div>
<div class="paragraph">
<p>Geb has great features that make it a good fit for a functional testing library:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DOM access via a JQuery-like <code>$</code> function</p>
</li>
<li>
<p>implements the <em>page pattern</em></p>
</li>
<li>
<p>support for modularization of certain web components (e.g. menu-bars, etc.) with <em>modules</em></p>
</li>
<li>
<p>integration with JavaScript via the JS variable</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section should not serve as detailed guide on how to use Geb, it should rather give an impression what Geb
is about and how it can be leveraged functional testing.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The next section will give an example on how Geb can be used to write a functional test for a simple
 web page with a single search field.</p>
</div>
<div class="sect4">
<h5 id="_a_geb_script"><a class="anchor" href="#_a_geb_script"></a>A Geb Script</h5>
<div class="paragraph">
<p>Although Geb can be used standalone in a Groovy script, in many scenarios it’s used in combination with other testing
frameworks. Geb comes with various base classes that can be used in JUnit 3, 4, TestNG or Spock tests. The base classes
are part of additional Geb modules that need to be added as a dependency.</p>
</div>
<div class="paragraph">
<p>For example, the following <code>@Grab</code> dependencies have to be used to run Geb with the Selenium Firefox driver in
JUnit4 tests. The module that is needed for JUnit 3/4 support is <code>geb-junit</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grapes</span><span class="pun">([</span><span class="pln">
    </span><span class="lit">@Grab</span><span class="pun">(</span><span class="str">"org.gebish:geb-core:0.9.2"</span><span class="pun">),</span><span class="pln">
    </span><span class="lit">@Grab</span><span class="pun">(</span><span class="str">"org.gebish:geb-junit:0.9.2"</span><span class="pun">),</span><span class="pln">
    </span><span class="lit">@Grab</span><span class="pun">(</span><span class="str">"org.seleniumhq.selenium:selenium-firefox-driver:2.26.0"</span><span class="pun">),</span><span class="pln">
    </span><span class="lit">@Grab</span><span class="pun">(</span><span class="str">"org.seleniumhq.selenium:selenium-support:2.26.0"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The central class in Geb is the <code>geb.Browser</code> class. As its name implies it is used
 to browse pages and access DOM elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> browser </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Browser</span><span class="pun">(</span><span class="pln">driver</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">FirefoxDriver</span><span class="pun">(),</span><span class="pln"> baseUrl</span><span class="pun">:</span><span class="pln"> </span><span class="str">'http://myhost:8080/myapp'</span><span class="pun">)</span><span class="pln">  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
browser</span><span class="pun">.</span><span class="pln">drive </span><span class="pun">{</span><span class="pln">
    go </span><span class="str">"/login"</span><span class="pln">                        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

    $</span><span class="pun">(</span><span class="str">"#username"</span><span class="pun">).</span><span class="pln">text </span><span class="pun">=</span><span class="pln"> </span><span class="str">'John'</span><span class="pln">       </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    $</span><span class="pun">(</span><span class="str">"#password"</span><span class="pun">).</span><span class="pln">text </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Doe'</span><span class="pln">

    $</span><span class="pun">(</span><span class="str">"#loginButton"</span><span class="pun">).</span><span class="pln">click</span><span class="pun">()</span><span class="pln">

    </span><span class="kwd">assert</span><span class="pln"> title </span><span class="pun">==</span><span class="pln"> </span><span class="str">"My Application - Dashboard"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A new <code>Browser</code> instance is created. In this case it uses the Selenium <code>FirefoxDriver</code> and sets the <code>baseUrl</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>go</code> is used to navigate to an URL or relative URI</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>$</code> together with CSS selectors is used to access the <code>username</code> and <code>password</code> DOM fields.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>Browser</code> class comes with a <code>drive</code> method that delegates all method/property calls to the current
<code>browser</code> instance. The <code>Browser</code> configuration must not be done inline, it can also be externalized in a
<code>GebConfig.groovy</code> configuration file for example. In practice, the usage of the <code>Browser</code> class is mostly hidden
by Geb test base classes. They delegate all missing properties and method calls to the current <code>browser</code> instance
that exists in the background:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SearchTests</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> geb</span><span class="pun">.</span><span class="pln">junit4</span><span class="pun">.</span><span class="typ">GebTest</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="lit">@Test</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> executeSeach</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        go </span><span class="str">'http://somehost/mayapp/search'</span><span class="pln">              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        $</span><span class="pun">(</span><span class="str">'#searchField'</span><span class="pun">).</span><span class="pln">text </span><span class="pun">=</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pln">             </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        $</span><span class="pun">(</span><span class="str">'#searchButton'</span><span class="pun">).</span><span class="pln">click</span><span class="pun">()</span><span class="pln">                      </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

        </span><span class="kwd">assert</span><span class="pln"> $</span><span class="pun">(</span><span class="str">'.searchResult a'</span><span class="pun">).</span><span class="pln">first</span><span class="pun">().</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Mr. John Doe'</span><span class="pln"> </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Browser#go</code> takes a relative or absolute link and calls the page.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>Browser#$</code> is used to access DOM content. Any CSS selectors supported by the underlying Selenium drivers are allowed</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>click</code> is used to click a button.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>$</code> is used to get the first link out of the <code>searchResult</code> block</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The example above shows a simple Geb web test with the JUnit 4 base class <code>geb.junit4.GebTest</code>. Note that in this case
the <code>Browser</code> configuration is externalized. <code>GebTest</code> delegates methods like <code>go</code> and <code>$</code> to the underlying <code>browser</code>
 instance.</p>
</div>
</div>
<div class="sect4">
<h5 id="_more_geb"><a class="anchor" href="#_more_geb"></a>More Geb</h5>
<div class="paragraph">
<p>In the previous section we only scratched the surface of the available Geb features. More information on Geb can be found
at the <a href="http://gebish.org/">project homepage</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processing_json"><a class="anchor" href="#_processing_json"></a>3.7. Processing JSON</h3>
<div class="paragraph">
<p>Groovy comes with integrated support for converting between Groovy objects and JSON. The classes dedicated to
JSON serialisation and parsing are found in the <code>groovy.json</code> package.</p>
</div>
<div class="sect3">
<h4 id="json_jsonslurper"><a class="anchor" href="#json_jsonslurper"></a>3.7.1. JsonSlurper</h4>
<div class="paragraph">
<p><code>JsonSlurper</code> is a class that parses JSON text or reader content into Groovy data structures (objects) such as maps, lists and
primitive types like <code>Integer</code>, <code>Double</code>, <code>Boolean</code> and <code>String</code>.</p>
</div>
<div class="paragraph">
<p>The class comes with a bunch of overloaded <code>parse</code> methods plus some special methods such as <code>parseText</code>,
<code>parseFile</code> and others. For the next example we will use the <code>parseText</code> method. It parses a JSON <code>String</code> and recursively converts it to a
list or map of objects. The other <code>parse*</code> methods are similar in that they return a JSON <code>String</code> but for different parameter
types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> jsonSlurper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JsonSlurper</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> jsonSlurper</span><span class="pun">.</span><span class="pln">parseText</span><span class="pun">(</span><span class="str">'{ "name": "John Doe" } /* some comment */'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Map</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'John Doe'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the result is a plain map and can be handled like a normal Groovy object instance. <code>JsonSlurper</code> parses the
given JSON as defined by the <a href="http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf">ECMA-404 JSON Interchange Standard</a>
plus support for JavaScript comments and dates.</p>
</div>
<div class="paragraph">
<p>In addition to maps <code>JsonSlurper</code> supports JSON arrays which are converted to lists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> jsonSlurper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JsonSlurper</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> jsonSlurper</span><span class="pun">.</span><span class="pln">parseText</span><span class="pun">(</span><span class="str">'{ "myList": [4, 8, 15, 16, 23, 42] }'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Map</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">myList </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">List</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">myList </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">15</span><span class="pun">,</span><span class="pln"> </span><span class="lit">16</span><span class="pun">,</span><span class="pln"> </span><span class="lit">23</span><span class="pun">,</span><span class="pln"> </span><span class="lit">42</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSON standard supports the following primitive data types: string, number, object, <code>true</code>, <code>false</code> and <code>null</code>. <code>JsonSlurper</code>
converts these JSON types into corresponding Groovy types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> jsonSlurper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JsonSlurper</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> jsonSlurper</span><span class="pun">.</span><span class="pln">parseText </span><span class="str">'''
    { "simple": 123,
      "fraction": 123.66,
      "exponential": 123e12
    }'''</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Map</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">simple</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">Integer</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">fraction</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">BigDecimal</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">exponential</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="typ">BigDecimal</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As <code>JsonSlurper</code> is returning pure Groovy object instances without any special JSON classes in the back, its usage
is transparent. In fact, <code>JsonSlurper</code> results conform to GPath expressions. GPath is a powerful expression language
that is supported by multiple slurpers for different data formats (<code>XmlSlurper</code> for XML being one example).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more details please have a look at the section on <a href="#gpath_expressions">GPath expressions</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The following table gives an overview of the JSON types and the corresponding Groovy data types:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JSON</th>
<th class="tableblock halign-left valign-top">Groovy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.String</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.lang.BigDecimal</code> or <code>java.lang.Integer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.LinkedHashMap</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.ArrayList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Date</code> based on the <code>yyyy-MM-dd’T’HH:mm:ssZ</code> date format</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Whenever a value in JSON is <code>null</code>, <code>JsonSlurper</code> supplements it with the Groovy <code>null</code> value. This is in contrast to other
JSON parsers that represent a <code>null</code> value with a library-provided singleton object.
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_parser_variants"><a class="anchor" href="#_parser_variants"></a>Parser Variants</h5>
<div class="paragraph">
<p><code>JsonSlurper</code> comes with a couple of parser implementations. Each parser fits different requirements, it could well be that for certain
scenarios the <code>JsonSlurper</code> default parser is not the best bet for all situations. Here is an overview of the shipped parser implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>JsonParserCharArray</code> parser basically takes a JSON string and operates on the underlying character array. During value
conversion it copies character sub-arrays (a mechanism known as "chopping") and operates on them.</p>
</li>
<li>
<p>The <code>JsonFastParser</code> is a special variant of the <code>JsonParserCharArray</code> and is the fastest parser. However, it is not the
default parser for a reason. <code>JsonFastParser</code> is a so-called index-overlay parser. During parsing of the given JSON <code>String</code> it
tries as hard as possible to avoid creating new char arrays or <code>String</code> instances. It keeps pointers to
the underlying original character array only. In addition, it defers object creation as late as possible. If parsed maps are
put into long-term caches care must be taken as the map objects might not be created and still consist of pointer to the
original char buffer only. However, <code>JsonFastParser</code> comes with a special chop mode which dices up the char buffer
early to keep a small copy of the original buffer. Recommendation is to use the <code>JsonFastParser</code> for JSON buffers
under 2MB and keeping the long-term cache restriction in mind.</p>
</li>
<li>
<p>The <code>JsonParserLax</code> is a special variant of the <code>JsonParserCharArray</code> parser. It has similar performance characteristics as <code>JsonFastParser</code>
but differs in that it isn’t exclusively relying on the ECMA-404 JSON 
grammar. For example it allows for comments, no quote strings etc.</p>
</li>
<li>
<p>The <code>JsonParserUsingCharacterSource</code> is a special parser for very large files. It uses a technique called "character windowing" to
parse large JSON files (large means files over 2MB size in this case) with constant performance characteristics.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default parser implementation for <code>JsonSlurper</code> is <code>JsonParserCharArray</code>. The <code>JsonParserType</code> enumeration contains constants for
the parser implementations described above:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Implementation</th>
<th class="tableblock halign-left valign-top">Constant</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserCharArray</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserType#CHAR_BUFFER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonFastParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserType#INDEX_OVERLAY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserLax</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserType#LAX</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserUsingCharacterSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>JsonParserType#CHARACTER_SOURCE</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Changing the parser implementation is as easy as setting the <code>JsonParserType</code> with a call to <code>JsonSlurper#setType()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> jsonSlurper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JsonSlurper</span><span class="pun">(</span><span class="pln">type</span><span class="pun">:</span><span class="pln"> </span><span class="typ">JsonParserType</span><span class="pun">.</span><span class="pln">INDEX_OVERLAY</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> jsonSlurper</span><span class="pun">.</span><span class="pln">parseText</span><span class="pun">(</span><span class="str">'{ "myList": [4, 8, 15, 16, 23, 42] }'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pln"> </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Map</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">myList </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">List</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">.</span><span class="pln">myList </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">15</span><span class="pun">,</span><span class="pln"> </span><span class="lit">16</span><span class="pun">,</span><span class="pln"> </span><span class="lit">23</span><span class="pun">,</span><span class="pln"> </span><span class="lit">42</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jsonoutput"><a class="anchor" href="#_jsonoutput"></a>3.7.2. JsonOutput</h4>
<div class="paragraph">
<p><code>JsonOutput</code> is responsible for serialising Groovy objects into JSON strings. It can be seen as companion object to
<a href="http://docs.groovy-lang.org/latest/html/documentation/json-userguide.html#json_jsonslurper">JsonSlurper</a>, being a JSON parser.</p>
</div>
<div class="paragraph">
<p><code>JsonOutput</code> comes with overloaded, static <code>toJson</code> methods. Each <code>toJson</code> implementation takes a different parameter type.
The static method can either be used directly or by importing the methods with a static import statement.</p>
</div>
<div class="paragraph">
<p>The result of a <code>toJson</code> call is a <code>String</code> containing the JSON code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> json </span><span class="pun">=</span><span class="pln"> </span><span class="typ">JsonOutput</span><span class="pun">.</span><span class="pln">toJson</span><span class="pun">([</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">42</span><span class="pun">])</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> json </span><span class="pun">==</span><span class="pln"> </span><span class="str">'{"name":"John Doe","age":42}'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>JsonOutput</code> does not only support primitive, maps or list data types to be serialized to JSON, it goes further and even
has support for serialising POGOs, that is, plain-old Groovy objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> name </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> json </span><span class="pun">=</span><span class="pln"> </span><span class="typ">JsonOutput</span><span class="pun">.</span><span class="pln">toJson</span><span class="pun">([</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'John'</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Max'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">])</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> json </span><span class="pun">==</span><span class="pln"> </span><span class="str">'[{"name":"John"},{"name":"Max"}]'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we saw in previous examples, the JSON output is not pretty printed per default. However, the <code>prettyPrint</code> method in <code>JsonOutput</code> comes
to rescue for this task.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> json </span><span class="pun">=</span><span class="pln"> </span><span class="typ">JsonOutput</span><span class="pun">.</span><span class="pln">toJson</span><span class="pun">([</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'John Doe'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="pln"> </span><span class="lit">42</span><span class="pun">])</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> json </span><span class="pun">==</span><span class="pln"> </span><span class="str">'{"name":"John Doe","age":42}'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">JsonOutput</span><span class="pun">.</span><span class="pln">prettyPrint</span><span class="pun">(</span><span class="pln">json</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'''\
{
    "name": "John Doe",
    "age": 42
}'''</span><span class="pun">.</span><span class="pln">stripIndent</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>prettyPrint</code> takes a <code>String</code> as single parameter; therefore, it can be applied on arbitrary JSON <code>String</code> instances, not only the result of
<code>JsonOutput.toJson</code>.</p>
</div>
<div class="paragraph">
<p>Another way to create JSON from Groovy is to use <code>JsonBuilder</code> or <code>StreamingJsonBuilder</code>. Both builders provide a
DSL which allows to formulate an object graph which is then converted to JSON.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more details on builders, have a look at the builders chapter which covers both <a href="#_jsonbuilder">JsonBuilder</a>
and <a href="#_streamingjsonbuilder">StreamingJsonBuilder</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interacting_with_a_sql_database"><a class="anchor" href="#_interacting_with_a_sql_database"></a>3.8. Interacting with a SQL database</h3>
<div class="paragraph">
<p>Groovy’s <code>groovy-sql</code> module provides a higher-level 
abstraction over Java’s JDBC technology. JDBC itself provides
a lower-level but fairly comprehensive API which provides uniform access
 to a whole variety of supported relational database systems.
We’ll use HSQLDB in our examples here but you can alternatively use 
Oracle, SQL Server, MySQL and a host of others.
The most frequently used class within the <code>groovy-sql</code> module is the <code>groovy.sql.Sql</code> class which raises the JDBC
abstractions up one level. We’ll cover that first.</p>
</div>
<div class="sect3">
<h4 id="_connecting_to_the_database"><a class="anchor" href="#_connecting_to_the_database"></a>3.8.1. Connecting to the database</h4>
<div class="paragraph">
<p>Connecting to a database with Groovy’s <code>Sql</code> class requires four pieces of information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The database uniform resource locator (URL)</p>
</li>
<li>
<p>Username</p>
</li>
<li>
<p>Password</p>
</li>
<li>
<p>The driver class name (which can be derived automatically in some situations)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For our HSQLDB database, the values will be something like that shown in the following table:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jdbc:hsqldb:mem:yourdb</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sa (or your <em>username</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>yourPassword</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">driver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.hsqldb.jdbcDriver</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Consult the documentation for the JDBC driver that you plan to use to determine the correct values for your situation.</p>
</div>
<div class="paragraph">
<p>The <code>Sql</code> class has a <code>newInstance</code> factory method which takes these parameters. You would typically use it as follows:</p>
</div>
<div class="listingblock">
<div class="title">Connecting to HSQLDB</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="typ">Sql</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> url </span><span class="pun">=</span><span class="pln"> </span><span class="str">'jdbc:hsqldb:mem:yourDB'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> user </span><span class="pun">=</span><span class="pln"> </span><span class="str">'sa'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> password </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> driver </span><span class="pun">=</span><span class="pln"> </span><span class="str">'org.hsqldb.jdbcDriver'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> sql </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Sql</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> user</span><span class="pun">,</span><span class="pln"> password</span><span class="pun">,</span><span class="pln"> driver</span><span class="pun">)</span><span class="pln">

</span><span class="com">// use 'sql' instance ...</span><span class="pln">

sql</span><span class="pun">.</span><span class="pln">close</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don’t want to have to handle resource handling yourself (i.e. call <code>close()</code> manually) then you can use the <code>withInstance</code> variation as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Connecting to HSQLDB (<code>withInstance</code> variation)</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Sql</span><span class="pun">.</span><span class="pln">withInstance</span><span class="pun">(</span><span class="pln">url</span><span class="pun">,</span><span class="pln"> user</span><span class="pun">,</span><span class="pln"> password</span><span class="pun">,</span><span class="pln"> driver</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> sql </span><span class="pun">-&gt;</span><span class="pln">
  </span><span class="com">// use 'sql' instance ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_connecting_with_a_datasource"><a class="anchor" href="#_connecting_with_a_datasource"></a>Connecting with a DataSource</h5>
<div class="paragraph">
<p>It is often preferred to use a DataSource. You may have one available to you from a connection pool.
Here we’ll use the one provided as part of the HSQLDB driver jar as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Connecting to HSQLDB with a DataSource</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="typ">Sql</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">hsqldb</span><span class="pun">.</span><span class="pln">jdbc</span><span class="pun">.</span><span class="typ">JDBCDataSource</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> dataSource </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JDBCDataSource</span><span class="pun">(</span><span class="pln">
    database</span><span class="pun">:</span><span class="pln"> </span><span class="str">'jdbc:hsqldb:mem:yourDB'</span><span class="pun">,</span><span class="pln"> user</span><span class="pun">:</span><span class="pln"> </span><span class="str">'sa'</span><span class="pun">,</span><span class="pln"> password</span><span class="pun">:</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> sql </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Sql</span><span class="pun">(</span><span class="pln">dataSource</span><span class="pun">)</span><span class="pln">

</span><span class="com">// use then close 'sql' instance ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have your own connection pooling, the details will be different, e.g. for Apache Commons DBCP:</p>
</div>
<div class="listingblock">
<div class="title">Connecting to HSQLDB with a DataSource using Apache Commons DBCP</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'commons-dbcp:commons-dbcp:1.4'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="typ">Sql</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">apache</span><span class="pun">.</span><span class="pln">commons</span><span class="pun">.</span><span class="pln">dbcp</span><span class="pun">.</span><span class="typ">BasicDataSource</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> ds </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BasicDataSource</span><span class="pun">(</span><span class="pln">driverClassName</span><span class="pun">:</span><span class="pln"> </span><span class="str">"org.hsqldb.jdbcDriver"</span><span class="pun">,</span><span class="pln">
    url</span><span class="pun">:</span><span class="pln"> </span><span class="str">'jdbc:hsqldb:mem:yourDB'</span><span class="pun">,</span><span class="pln"> username</span><span class="pun">:</span><span class="pln"> </span><span class="str">'sa'</span><span class="pun">,</span><span class="pln"> password</span><span class="pun">:</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> sql </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Sql</span><span class="pun">(</span><span class="pln">ds</span><span class="pun">)</span><span class="pln">
</span><span class="com">// use then close 'sql' instance ...</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_connecting_using_grab"><a class="anchor" href="#_connecting_using_grab"></a>Connecting using @Grab</h5>
<div class="paragraph">
<p>The previous examples assume that the necessary database driver jar is already on your classpath.
For a self-contained script you can add <code>@Grab</code> statements to the top of the script to automatically download the necessary jar as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Connecting to HSQLDB using @Grab</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'org.hsqldb:hsqldb:2.3.2'</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@GrabConfig</span><span class="pun">(</span><span class="pln">systemClassLoader</span><span class="pun">=</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="com">// create, use, and then close sql instance ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@GrabConfig</code> statement is necessary to make sure the system classloader is used. This ensures that the driver classes and
system classes like <code>java.sql.DriverManager</code> are in the same classloader.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_executing_sql"><a class="anchor" href="#_executing_sql"></a>3.8.2. Executing SQL</h4>
<div class="paragraph">
<p>You can execute arbitrary SQL commands using the <code>execute()</code> method. Let’s have a look at using it to create a table.</p>
</div>
<div class="sect4">
<h5 id="_creating_tables"><a class="anchor" href="#_creating_tables"></a>Creating tables</h5>
<div class="paragraph">
<p>The simplest way to execute SQL is to call the <code>execute()</code> method passing the SQL you wish to execute as a String as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Creating a table</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// ... create 'sql' instance</span><span class="pln">
sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">'''
  CREATE TABLE Author (
    id          INTEGER GENERATED BY DEFAULT AS IDENTITY,
    firstname   VARCHAR(64),
    lastname    VARCHAR(64)
  );
'''</span><span class="pln">
</span><span class="com">// close 'sql' instance ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a variant of this method which takes a GString and another 
with a list of parameters. There are also other variants with similar 
names: <code>executeInsert</code> and <code>executeUpdate</code>.
We’ll see examples of these variants in other examples in this section.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_basic_crud_operations"><a class="anchor" href="#_basic_crud_operations"></a>3.8.3. Basic CRUD operations</h4>
<div class="paragraph">
<p>The basic operations on a database are Create, Read, Update and 
Delete (the so-called CRUD operations). We’ll examine each of these in 
turn.</p>
</div>
<div class="sect4">
<h5 id="_creating_inserting_data"><a class="anchor" href="#_creating_inserting_data"></a>Creating/Inserting data</h5>
<div class="paragraph">
<p>You can use the same <code>execute()</code> statement we saw earlier but to insert a row by using a SQL insert statement as follows:</p>
</div>
<div class="listingblock">
<div class="title">Inserting a row</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES ('Dierk', 'Koenig')"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use a special <code>executeInsert</code> method instead of <code>execute</code>. This will return a list of all keys generated.
Both the <code>execute</code> and <code>executeInsert</code> methods allow you to place '?' placeholders into your SQL string and supply a list of parameters.
In this case a PreparedStatement is used which avoids any risk of SQL injection. The following example illustrates <code>executeInsert</code> using placeholders and parameters:</p>
</div>
<div class="listingblock">
<div class="title">Inserting a row using executeInsert with placeholders and parameters</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> insertSql </span><span class="pun">=</span><span class="pln"> </span><span class="str">'INSERT INTO Author (firstname, lastname) VALUES (?,?)'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Jon'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Skeet'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> keys </span><span class="pun">=</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">executeInsert insertSql</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">params</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> keys</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, both the <code>execute</code> and <code>executeInsert</code> methods allow you to use GStrings. Any '$' placeholders within the SQL are assumed
to be placeholders. An escaping mechanism exists if you want to supply part of the GString with a variable in a
position which isn’t where normal placeholders go within SQL. See the GroovyDoc for more details.
Also, <code>executeInsert</code> allows you to supply a list of key column names, when multiple keys are returned and you are only interested in some of them.
 Here is a fragment illustrating key name specification and GStrings:</p>
</div>
<div class="listingblock">
<div class="title">Inserting a row using executeInsert with a GString and specifying key names</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> first </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Guillaume'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Laforge'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> myKeyNames </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'ID'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> myKeys </span><span class="pun">=</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">executeInsert </span><span class="str">"""
  INSERT INTO Author (firstname, lastname)
  VALUES (${first}, ${last})
"""</span><span class="pun">,</span><span class="pln"> myKeyNames
</span><span class="kwd">assert</span><span class="pln"> myKeys</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="pln">ID</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reading_rows"><a class="anchor" href="#_reading_rows"></a>Reading rows</h5>
<div class="paragraph">
<p>Reading rows of data from the database is accomplished using one of several available methods: <code>query</code>, <code>eachRow</code>, <code>firstRow</code> and <code>rows</code>.</p>
</div>
<div class="paragraph">
<p>Use the <code>query</code> method if you want to iterate through the <code>ResultSet</code> returned by the underlying JDBC API as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Reading data using <code>query</code></div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> expected </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Dierk Koenig'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Jon Skeet'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Guillaume Laforge'</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> rowNum </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
sql</span><span class="pun">.</span><span class="pln">query</span><span class="pun">(</span><span class="str">'SELECT firstname, lastname FROM Author'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> resultSet </span><span class="pun">-&gt;</span><span class="pln">
  </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">resultSet</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> first </span><span class="pun">=</span><span class="pln"> resultSet</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> resultSet</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="str">'lastname'</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> expected</span><span class="pun">[</span><span class="pln">rowNum</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"$first $last"</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>eachRow</code> method if you want if you want a 
slightly higher-level abstraction which provides a Groovy friendly 
map-like abstraction for the <code>ResultSet</code> as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Reading data using <code>eachRow</code></div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">rowNum </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
sql</span><span class="pun">.</span><span class="pln">eachRow</span><span class="pun">(</span><span class="str">'SELECT firstname, lastname FROM Author'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> row </span><span class="pun">-&gt;</span><span class="pln">
  </span><span class="kwd">def</span><span class="pln"> first </span><span class="pun">=</span><span class="pln"> row</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
  </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> row</span><span class="pun">.</span><span class="pln">lastname
  </span><span class="kwd">assert</span><span class="pln"> expected</span><span class="pun">[</span><span class="pln">rowNum</span><span class="pun">++]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"$first $last"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can use Groovy list-style and map-style notations when accessing the row of data.</p>
</div>
<div class="paragraph">
<p>Use the <code>firstRow</code> method if you for similar functionality as <code>eachRow</code> but returning only one row of data as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Reading data using <code>firstRow</code></div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> first </span><span class="pun">=</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">firstRow</span><span class="pun">(</span><span class="str">'SELECT lastname, firstname FROM Author'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> first</span><span class="pun">.</span><span class="pln">values</span><span class="pun">().</span><span class="pln">sort</span><span class="pun">().</span><span class="pln">join</span><span class="pun">(</span><span class="str">','</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Dierk,Koenig'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>rows</code> method if you want to process a list of map-like data structures as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Reading data using <code>rows</code></div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">List</span><span class="pln"> authors </span><span class="pun">=</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">(</span><span class="str">'SELECT firstname, lastname FROM Author'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> authors</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> authors</span><span class="pun">.</span><span class="pln">collect </span><span class="pun">{</span><span class="pln"> </span><span class="str">"$it.FIRSTNAME ${it[-1]}"</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> expected</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the map-like abstraction has case-insensitive keys (hence we can use 'FIRSTNAME' or 'firstname' as the key) and
also that -ve indices (a standard Groovy feature) works when using an index value (to count column numbers from the right).</p>
</div>
<div class="paragraph">
<p>You can also use any of the above methods to return scalar values, though typically <code>firstRow</code> is all that is required in such cases. An example returning the count of rows is shown here:</p>
</div>
<div class="listingblock">
<div class="title">Reading scalar values</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">firstRow</span><span class="pun">(</span><span class="str">'SELECT COUNT(*) AS num FROM Author'</span><span class="pun">).</span><span class="pln">num </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_updating_rows"><a class="anchor" href="#_updating_rows"></a>Updating rows</h5>
<div class="paragraph">
<p>Updating rows can again be done using the <code>execute()</code> method. Just use a SQL update statement as the argument to the method.
You can insert an author with just a lastname and then update the row to also have a firstname as follows:</p>
</div>
<div class="listingblock">
<div class="title">Updating a row</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"INSERT INTO Author (lastname) VALUES ('Thorvaldsson')"</span><span class="pln">
sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"UPDATE Author SET firstname='Erik' where lastname='Thorvaldsson'"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a special <code>executeUpdate</code> variant which returns the number of rows updated as a result of executing the SQL.
For example, you can change the lastname of an author as follows:</p>
</div>
<div class="listingblock">
<div class="title">Using executeUpdate</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> updateSql </span><span class="pun">=</span><span class="pln"> </span><span class="str">"UPDATE Author SET lastname='Pragt' where lastname='Thorvaldsson'"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> updateCount </span><span class="pun">=</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">executeUpdate updateSql
</span><span class="kwd">assert</span><span class="pln"> updateCount </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> row </span><span class="pun">=</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">firstRow </span><span class="str">"SELECT * FROM Author where firstname = 'Erik'"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"${row.firstname} ${row.lastname}"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Erik Pragt'</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_deleting_rows"><a class="anchor" href="#_deleting_rows"></a>Deleting rows</h5>
<div class="paragraph">
<p>The <code>execute</code> method is also used for deleting rows as this example shows:</p>
</div>
<div class="listingblock">
<div class="title">Deleting rows</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">firstRow</span><span class="pun">(</span><span class="str">'SELECT COUNT(*) as num FROM Author'</span><span class="pun">).</span><span class="pln">num </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"DELETE FROM Author WHERE lastname = 'Skeet'"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">firstRow</span><span class="pun">(</span><span class="str">'SELECT COUNT(*) as num FROM Author'</span><span class="pun">).</span><span class="pln">num </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_advanced_sql_operations"><a class="anchor" href="#_advanced_sql_operations"></a>3.8.4. Advanced SQL operations</h4>
<div class="sect4">
<h5 id="_working_with_transactions"><a class="anchor" href="#_working_with_transactions"></a>Working with transactions</h5>
<div class="paragraph">
<p>The easiest way to perform database operations within a transaction is to include the database operation within a <code>withTransaction</code> closure as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">A successful transaction</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">firstRow</span><span class="pun">(</span><span class="str">'SELECT COUNT(*) as num FROM Author'</span><span class="pun">).</span><span class="pln">num </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
sql</span><span class="pun">.</span><span class="pln">withTransaction </span><span class="pun">{</span><span class="pln">
  sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES ('Dierk', 'Koenig')"</span><span class="pln">
  sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES ('Jon', 'Skeet')"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">firstRow</span><span class="pun">(</span><span class="str">'SELECT COUNT(*) as num FROM Author'</span><span class="pun">).</span><span class="pln">num </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the database starts empty and has two rows after successful completion of the operation. Outside the scope of the
transaction, the database is never seen as having just one row.</p>
</div>
<div class="paragraph">
<p>If something goes wrong, any earlier operations within the <code>withTransaction</code>
 block are rolled back.
We can see that in operation in the following example where we use 
database metadata (more details coming up shortly) to find the
maximum allowable size of the <code>firstname</code> column and then attempt to enter a firstname one larger than that maximum value as shown here:</p>
</div>
<div class="listingblock">
<div class="title">A failed transaction will cause a rollback</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> maxFirstnameLength
</span><span class="kwd">def</span><span class="pln"> metaClosure </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> meta </span><span class="pun">-&gt;</span><span class="pln"> maxFirstnameLength </span><span class="pun">=</span><span class="pln"> meta</span><span class="pun">.</span><span class="pln">getPrecision</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> rowClosure </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> rowCountBefore </span><span class="pun">=</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">firstRow</span><span class="pun">(</span><span class="str">'SELECT COUNT(*) as num FROM Author'</span><span class="pun">).</span><span class="pln">num
</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  sql</span><span class="pun">.</span><span class="pln">withTransaction </span><span class="pun">{</span><span class="pln">
    sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"INSERT INTO Author (firstname) VALUES ('Dierk')"</span><span class="pln">
    sql</span><span class="pun">.</span><span class="pln">eachRow </span><span class="str">"SELECT firstname FROM Author WHERE firstname = 'Dierk'"</span><span class="pun">,</span><span class="pln"> metaClosure</span><span class="pun">,</span><span class="pln"> rowClosure
    sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"INSERT INTO Author (firstname) VALUES (?)"</span><span class="pun">,</span><span class="pln"> </span><span class="str">'X'</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">maxFirstnameLength </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pun">(</span><span class="pln">ignore</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println ignore</span><span class="pun">.</span><span class="pln">message </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> rowCountAfter </span><span class="pun">=</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">firstRow</span><span class="pun">(</span><span class="str">'SELECT COUNT(*) as num FROM Author'</span><span class="pun">).</span><span class="pln">num
</span><span class="kwd">assert</span><span class="pln"> rowCountBefore </span><span class="pun">==</span><span class="pln"> rowCountAfter</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though the first sql execute succeeds initially, it will be rolled back and the number of rows will remain the same.</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_batches"><a class="anchor" href="#_using_batches"></a>Using batches</h5>
<div class="paragraph">
<p>When dealing with large volumes of data, particularly when inserting 
such data, it can be more efficient to chunk the data into batches. This
 is done
using the <code>withBatch</code> statement as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Batching SQL statements</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">withBatch</span><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> stmt </span><span class="pun">-&gt;</span><span class="pln">
  stmt</span><span class="pun">.</span><span class="pln">addBatch </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES ('Dierk', 'Koenig')"</span><span class="pln">
  stmt</span><span class="pun">.</span><span class="pln">addBatch </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES ('Paul', 'King')"</span><span class="pln">
  stmt</span><span class="pun">.</span><span class="pln">addBatch </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES ('Guillaume', 'Laforge')"</span><span class="pln">
  stmt</span><span class="pun">.</span><span class="pln">addBatch </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES ('Hamlet', 'D''Arcy')"</span><span class="pln">
  stmt</span><span class="pun">.</span><span class="pln">addBatch </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES ('Cedric', 'Champeau')"</span><span class="pln">
  stmt</span><span class="pun">.</span><span class="pln">addBatch </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES ('Erik', 'Pragt')"</span><span class="pln">
  stmt</span><span class="pun">.</span><span class="pln">addBatch </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES ('Jon', 'Skeet')"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After executing these statements, there will be 7 new rows in the database. In fact, they will have been added in batches
even though you can’t easily tell that after that fact. If you want to confirm what is going on under the covers, you can
add a little bit of extra logging into your program. Add the following lines before the <code>withBatch</code> statement:</p>
</div>
<div class="listingblock">
<div class="title">Logging additional SQL information</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.*</span><span class="pln">

</span><span class="com">// next line will add fine logging</span><span class="pln">
</span><span class="typ">Logger</span><span class="pun">.</span><span class="pln">getLogger</span><span class="pun">(</span><span class="str">'groovy.sql'</span><span class="pun">).</span><span class="pln">level </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Level</span><span class="pun">.</span><span class="pln">FINE
</span><span class="com">// also adjust logging.properties file in JRE_HOME/lib to have:</span><span class="pln">
</span><span class="com">// java.util.logging.ConsoleHandler.level = FINE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this extra logging turned on, and the changes made as per the above comment for the logging.properties file, you should see
output such as:</p>
</div>
<div class="listingblock">
<div class="title">SQL logging output with batching enable</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="pln">FINE</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Successfully</span><span class="pln"> executed batch </span><span class="kwd">with</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> command</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="typ">Apr</span><span class="pln"> </span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2015</span><span class="pln"> </span><span class="lit">8</span><span class="pun">:</span><span class="lit">38</span><span class="pun">:</span><span class="lit">42</span><span class="pln"> PM groovy</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="typ">BatchingStatementWrapper</span><span class="pln"> processResult

FINE</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Successfully</span><span class="pln"> executed batch </span><span class="kwd">with</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> command</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="typ">Apr</span><span class="pln"> </span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2015</span><span class="pln"> </span><span class="lit">8</span><span class="pun">:</span><span class="lit">38</span><span class="pun">:</span><span class="lit">42</span><span class="pln"> PM groovy</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="typ">BatchingStatementWrapper</span><span class="pln"> processResult

FINE</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Successfully</span><span class="pln"> executed batch </span><span class="kwd">with</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> command</span><span class="pun">(</span><span class="pln">s</span><span class="pun">)</span><span class="pln">
</span><span class="typ">Apr</span><span class="pln"> </span><span class="lit">19</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2015</span><span class="pln"> </span><span class="lit">8</span><span class="pun">:</span><span class="lit">38</span><span class="pun">:</span><span class="lit">42</span><span class="pln"> PM groovy</span><span class="pun">.</span><span class="pln">sql</span><span class="pun">.</span><span class="typ">Sql</span><span class="pln"> getStatement</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We should also note, that any combination of SQL statements can be added to the batch. They don’t all have to be
inserting a new row to the same table.</p>
</div>
<div class="paragraph">
<p>We noted earlier that to avoid SQL injection, we encourage you to use prepared statements, this is achieved using the
variants of methods which take GStrings or a list of extra parameters. Prepared statements can be used in combination
with batches as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Batching prepared statements</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> qry </span><span class="pun">=</span><span class="pln"> </span><span class="str">'INSERT INTO Author (firstname, lastname) VALUES (?,?)'</span><span class="pln">
sql</span><span class="pun">.</span><span class="pln">withBatch</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> qry</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> ps </span><span class="pun">-&gt;</span><span class="pln">
  ps</span><span class="pun">.</span><span class="pln">addBatch</span><span class="pun">(</span><span class="str">'Dierk'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Koenig'</span><span class="pun">)</span><span class="pln">
  ps</span><span class="pun">.</span><span class="pln">addBatch</span><span class="pun">(</span><span class="str">'Paul'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'King'</span><span class="pun">)</span><span class="pln">
  ps</span><span class="pun">.</span><span class="pln">addBatch</span><span class="pun">(</span><span class="str">'Guillaume'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Laforge'</span><span class="pun">)</span><span class="pln">
  ps</span><span class="pun">.</span><span class="pln">addBatch</span><span class="pun">(</span><span class="str">'Hamlet'</span><span class="pun">,</span><span class="pln"> </span><span class="str">"D'Arcy"</span><span class="pun">)</span><span class="pln">
  ps</span><span class="pun">.</span><span class="pln">addBatch</span><span class="pun">(</span><span class="str">'Cedric'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Champeau'</span><span class="pun">)</span><span class="pln">
  ps</span><span class="pun">.</span><span class="pln">addBatch</span><span class="pun">(</span><span class="str">'Erik'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Pragt'</span><span class="pun">)</span><span class="pln">
  ps</span><span class="pun">.</span><span class="pln">addBatch</span><span class="pun">(</span><span class="str">'Jon'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Skeet'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This provides a much safer option if the data could come from a user such as via a script or a web form. Of course, given
that a prepared statement is being used, you are limited to a batch of the same SQL operation (insert in our example)
to the one table.</p>
</div>
</div>
<div class="sect4">
<h5 id="_performing_pagination"><a class="anchor" href="#_performing_pagination"></a>Performing pagination</h5>
<div class="paragraph">
<p>When presenting large tables of data to a user, it is often convenient to present information a page at
a time. Many of Groovy’s SQL retrieval methods have extra parameters which can be used to select a particular
page of interest. The starting position and page size are specified as integers as shown in the following example
using <code>rows</code>:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving pages of data</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> qry </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SELECT * FROM Author'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">(</span><span class="pln">qry</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)*.</span><span class="pln">firstname </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Dierk'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Paul'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Guillaume'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">(</span><span class="pln">qry</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)*.</span><span class="pln">firstname </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Hamlet'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Cedric'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Erik'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">rows</span><span class="pun">(</span><span class="pln">qry</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)*.</span><span class="pln">firstname </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Jon'</span><span class="pun">]</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fetching_metadata"><a class="anchor" href="#_fetching_metadata"></a>Fetching metadata</h5>
<div class="paragraph">
<p>JDBC metadata can be retrieved in numerous ways. Perhaps the most basic approach is to extract the
metadata from any row as shown in the following example which examines the tablename, column names and column type names:</p>
</div>
<div class="listingblock">
<div class="title">Using row metadata</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">eachRow</span><span class="pun">(</span><span class="str">"SELECT * FROM Author WHERE firstname = 'Dierk'"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> row </span><span class="pun">-&gt;</span><span class="pln">
  </span><span class="kwd">def</span><span class="pln"> md </span><span class="pun">=</span><span class="pln"> row</span><span class="pun">.</span><span class="pln">getMetaData</span><span class="pun">()</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> md</span><span class="pun">.</span><span class="pln">getTableName</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'AUTHOR'</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1.</span><span class="pun">.</span><span class="pln">md</span><span class="pun">.</span><span class="pln">columnCount</span><span class="pun">).</span><span class="pln">collect</span><span class="pun">{</span><span class="pln"> md</span><span class="pun">.</span><span class="pln">getColumnName</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'ID'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'FIRSTNAME'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'LASTNAME'</span><span class="pun">]</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1.</span><span class="pun">.</span><span class="pln">md</span><span class="pun">.</span><span class="pln">columnCount</span><span class="pun">).</span><span class="pln">collect</span><span class="pun">{</span><span class="pln"> md</span><span class="pun">.</span><span class="pln">getColumnTypeName</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'INTEGER'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'VARCHAR'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'VARCHAR'</span><span class="pun">]</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And another slight variant to the previous example, this time also looking at the column label:</p>
</div>
<div class="listingblock">
<div class="title">Also using row metadata</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">eachRow</span><span class="pun">(</span><span class="str">"SELECT firstname AS first FROM Author WHERE firstname = 'Dierk'"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> row </span><span class="pun">-&gt;</span><span class="pln">
  </span><span class="kwd">def</span><span class="pln"> md </span><span class="pun">=</span><span class="pln"> row</span><span class="pun">.</span><span class="pln">getMetaData</span><span class="pun">()</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> md</span><span class="pun">.</span><span class="pln">getColumnName</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'FIRSTNAME'</span><span class="pln">
  </span><span class="kwd">assert</span><span class="pln"> md</span><span class="pun">.</span><span class="pln">getColumnLabel</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'FIRST'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Accessing metadata is quite common, so Groovy also provides variants to many of its methods that let you
supply a closure that will be called once with the row metadata in addition to the normal row closure
which is called for each row. The following example illustrates the two closure variant for <code>eachRow</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using row and metadata closures</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> metaClosure </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> meta </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">assert</span><span class="pln"> meta</span><span class="pun">.</span><span class="pln">getColumnName</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'FIRSTNAME'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> rowClosure </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> row </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">assert</span><span class="pln"> row</span><span class="pun">.</span><span class="pln">FIRSTNAME </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Dierk'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
sql</span><span class="pun">.</span><span class="pln">eachRow</span><span class="pun">(</span><span class="str">"SELECT firstname FROM Author WHERE firstname = 'Dierk'"</span><span class="pun">,</span><span class="pln"> metaClosure</span><span class="pun">,</span><span class="pln"> rowClosure</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that our SQL query will only return one row, so we could have equally used <code>firstRow</code> for the previous example.</p>
</div>
<div class="paragraph">
<p>Finally, JDBC also provides metadata per connection (not just for 
rows). You can also access such metadata from Groovy as shown in this 
example:</p>
</div>
<div class="listingblock">
<div class="title">Using connection metadata</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> md </span><span class="pun">=</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">connection</span><span class="pun">.</span><span class="pln">metaData
</span><span class="kwd">assert</span><span class="pln"> md</span><span class="pun">.</span><span class="pln">driverName </span><span class="pun">==</span><span class="pln"> </span><span class="str">'HSQL Database Engine Driver'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> md</span><span class="pun">.</span><span class="pln">databaseProductVersion </span><span class="pun">==</span><span class="pln"> </span><span class="str">'2.3.2'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'JDBCMajorVersion'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'JDBCMinorVersion'</span><span class="pun">].</span><span class="pln">collect</span><span class="pun">{</span><span class="pln"> md</span><span class="pun">[</span><span class="pln">it</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> md</span><span class="pun">.</span><span class="pln">stringFunctions</span><span class="pun">.</span><span class="pln">tokenize</span><span class="pun">(</span><span class="str">','</span><span class="pun">).</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'CONCAT'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> rs </span><span class="pun">=</span><span class="pln"> md</span><span class="pun">.</span><span class="pln">getTables</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="str">'AUTH%'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> rs</span><span class="pun">.</span><span class="kwd">next</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> rs</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="str">'TABLE_NAME'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'AUTHOR'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Consult the JavaDoc for your driver to find out what metadata information is available for you to access.</p>
</div>
</div>
<div class="sect4">
<h5 id="_named_and_named_ordinal_parameters"><a class="anchor" href="#_named_and_named_ordinal_parameters"></a>Named and named-ordinal parameters</h5>
<div class="paragraph">
<p>Groovy supports some additional alternative placeholder syntax variants. The GString variants
are typically preferred over these alternatives but the alternatives are useful for Java integration
purposes and sometimes in templating scenarios where GStrings might already be in heavy use as part
of a template. The named parameter variants are much like the String plus list of parameter variants but
instead of having a list of <code>?</code> placeholders followed by a list of parameters, you have one or more
placeholders having the form <code>:propName</code> or <code>?.propName</code> and a single map, named arguments or a
domain object as the parameter. The map or domain object should have a property named <code>propName</code>
corresponding to each supplied placeholder.</p>
</div>
<div class="paragraph">
<p>Here is an example using the colon form:</p>
</div>
<div class="listingblock">
<div class="title">Named parameters (colon form)</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES (:first, :last)"</span><span class="pun">,</span><span class="pln"> first</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Dierk'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Koenig'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And another example using the question mark form:</p>
</div>
<div class="listingblock">
<div class="title">Named parameters (question mark form)</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES (?.first, ?.last)"</span><span class="pun">,</span><span class="pln"> first</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jon'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Skeet'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the information you need to supply is spread across multiple maps or domain objects you can
use the question mark form with an additional ordinal index as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Named-ordinal parameters</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Rockstar</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> first</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> pogo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Rockstar</span><span class="pun">(</span><span class="pln">first</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Paul'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">last</span><span class="pun">:</span><span class="pln"> </span><span class="str">'McCartney'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> map </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">lion</span><span class="pun">:</span><span class="pln"> </span><span class="str">'King'</span><span class="pun">]</span><span class="pln">
sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"INSERT INTO Author (firstname, lastname) VALUES (?1.first, ?2.lion)"</span><span class="pun">,</span><span class="pln"> pogo</span><span class="pun">,</span><span class="pln"> map</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_stored_procedures"><a class="anchor" href="#_stored_procedures"></a>Stored procedures</h5>
<div class="paragraph">
<p>The exact syntax for creating a stored procedure or function varies slightly between different databases.
For the HSQLDB database we are using, we can create a stored function which returns the initials of all authors in a table
as follows:</p>
</div>
<div class="listingblock">
<div class="title">Creating a stored function</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"""
  CREATE FUNCTION SELECT_AUTHOR_INITIALS()
  RETURNS TABLE (firstInitial VARCHAR(1), lastInitial VARCHAR(1))
  READS SQL DATA
  RETURN TABLE (
    SELECT LEFT(Author.firstname, 1) as firstInitial, LEFT(Author.lastname, 1) as lastInitial
    FROM Author
  )
"""</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use a SQL <code>CALL</code> statement to invoke the function using Groovy’s normal SQL retrieval methods.
Here is an example using <code>eachRow</code>.</p>
</div>
<div class="listingblock">
<div class="title">Creating a stored procedure or function</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
sql</span><span class="pun">.</span><span class="pln">eachRow</span><span class="pun">(</span><span class="str">'CALL SELECT_AUTHOR_INITIALS()'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  result </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"$it.firstInitial$it.lastInitial"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="pun">[</span><span class="str">'DK'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'JS'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'GL'</span><span class="pun">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the code for creating another stored function, this one taking the lastname as a parameter:</p>
</div>
<div class="listingblock">
<div class="title">Creating a stored function with a parameter</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"""
  CREATE FUNCTION FULL_NAME (p_lastname VARCHAR(64))
  RETURNS VARCHAR(100)
  READS SQL DATA
  BEGIN ATOMIC
    DECLARE ans VARCHAR(100);
    SELECT CONCAT(firstname, ' ', lastname) INTO ans
    FROM Author WHERE lastname = p_lastname;
    RETURN ans;
  END
"""</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the placeholder syntax to specify where the parameter 
belongs and note the special placeholder position to indicate the 
result:</p>
</div>
<div class="listingblock">
<div class="title">Using a stored function with a parameter</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> sql</span><span class="pun">.</span><span class="pln">firstRow</span><span class="pun">(</span><span class="str">"{? = call FULL_NAME(?)}"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Koenig'</span><span class="pun">])</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> result</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Dierk Koenig'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, here is a stored procedure with input and output parameters:</p>
</div>
<div class="listingblock">
<div class="title">Creating a stored procedure with input and output parameters</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">execute </span><span class="str">"""
  CREATE PROCEDURE CONCAT_NAME (OUT fullname VARCHAR(100),
    IN first VARCHAR(50), IN last VARCHAR(50))
  BEGIN ATOMIC
    SET fullname = CONCAT(first, ' ', last);
  END
"""</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the <code>CONCAT_NAME</code> stored procedure parameter, we make use of a special <code>call</code> method. Any input parameters are simply provided
as parameters to the method call. For output parameters, the resulting type must be specified as shown here:</p>
</div>
<div class="listingblock">
<div class="title">Using a stored procedure with input and output parameters</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">sql</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="str">"{call CONCAT_NAME(?, ?, ?)}"</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Sql</span><span class="pun">.</span><span class="pln">VARCHAR</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Dierk'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Koenig'</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  fullname </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">assert</span><span class="pln"> fullname </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Dierk Koenig'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_datasets"><a class="anchor" href="#_using_datasets"></a>3.8.5. Using DataSets</h4>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processing_xml"><a class="anchor" href="#_processing_xml"></a>3.9. Processing XML</h3>
<div class="sect3">
<h4 id="_parsing_xml"><a class="anchor" href="#_parsing_xml"></a>3.9.1. Parsing XML</h4>
<div class="sect4">
<h5 id="_xmlparser_and_xmlslurper"><a class="anchor" href="#_xmlparser_and_xmlslurper"></a>XmlParser and XmlSlurper</h5>
<div class="paragraph">
<p>The most commonly used approach for parsing XML with Groovy is to use
one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>groovy.util.XmlParser</code></p>
</li>
<li>
<p><code>groovy.util.XmlSlurper</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both have the same approach to parse an xml. Both come with a bunch of
overloaded parse methods plus some special methods such as <code>parseText</code>,
parseFile and others. For the next example we will use the <code>parseText</code>
method. It parses a XML <code>String</code> and recursively converts it to a list
or map of objects.</p>
</div>
<div class="listingblock">
<div class="title">XmlSlurper</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> text </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''
    &lt;list&gt;
        &lt;technology&gt;
            &lt;name&gt;Groovy&lt;/name&gt;
        &lt;/technology&gt;
    &lt;/list&gt;
'''</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">text</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> list </span><span class="kwd">instanceof</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">slurpersupport</span><span class="pun">.</span><span class="typ">GPathResult</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">technology</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Groovy'</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parsing the XML an returning the root node as a GPathResult</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checking we’re using a GPathResult</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Traversing the tree in a GPath style</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">XmlParser</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> text </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''
    &lt;list&gt;
        &lt;technology&gt;
            &lt;name&gt;Groovy&lt;/name&gt;
        &lt;/technology&gt;
    &lt;/list&gt;
'''</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlParser</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">text</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> list </span><span class="kwd">instanceof</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Node</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">technology</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Groovy'</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parsing the XML an returning the root node as a Node</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checking we’re using a Node</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Traversing the tree in a GPath style</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Let’s see the <strong>similarities</strong> between <code>XMLParser</code> and <code>XMLSlurper</code> first:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Both are based on <code>SAX</code> so they both are low memory footprint</p>
</li>
<li>
<p>Both can update/transform the XML</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But they have key <strong>differences</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>XmlSlurper</code> evaluates the structure lazily. So if you update the xml
you’ll have to evaluate the whole tree again.</p>
</li>
<li>
<p><code>XmlSlurper</code> returns <code>GPathResult</code> instances when parsing XML</p>
</li>
<li>
<p><code>XmlParser</code> returns <code>Node</code> objects when parsing XML</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When to use one or the another?</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is a discussion at
<a href="http://stackoverflow.com/questions/7558019/groovy-xmlslurper-vs-xmlparser">StackOverflow</a>. The
conclusions written here are based partially on this entry.
</td>
</tr>
</tbody></table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>If you want to transform an existing document to another</strong> then
<code>XmlSlurper</code> will be the choice</p>
</li>
<li>
<p><strong>If you want to update and read at the same time</strong> then <code>XmlParser</code> is
the choice.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The rationale behind this is that every time you create a node with
<code>XmlSlurper</code> it won’t be available until you parse the document again
with another <code>XmlSlurper</code> instance.  Need to read just a few nodes
XmlSlurper is for you ".</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>If you just have to read a few nodes</strong> <code>XmlSlurper</code> should be your
choice, since it will not have to create a complete structure in
memory"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general both classes perform similar way. Even the way of using
GPath expressions with them are the same (both use <code>breadthFirst()</code> and
<code>depthFirst()</code> expressions). So I guess it depends on the write/read
frequency.</p>
</div>
</div>
<div class="sect4">
<h5 id="_domcategory"><a class="anchor" href="#_domcategory"></a>DOMCategory</h5>
<div class="paragraph">
<p>There is another way of parsing XML documents with Groovy with the
used of <code>groovy.xml.dom.DOMCategory</code> which is a category class which
adds GPath style operations to Java’s DOM classes.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java has in-built support for DOM processing of XML using classes
representing the various parts of XML documents, e.g. <code>Document</code>,
<code>Element</code>, <code>NodeList</code>, <code>Attr</code> etc. For more information about these classes,
refer to the respective JavaDocs.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Having a XML like the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">  </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> CAR_RECORDS </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''
  &lt;records&gt;
    &lt;car name='</span><span class="pln">HSV </span><span class="typ">Maloo</span><span class="str">' make='</span><span class="typ">Holden</span><span class="str">' year='</span><span class="lit">2006</span><span class="str">'&gt;
      &lt;country&gt;Australia&lt;/country&gt;
      &lt;record type='</span><span class="pln">speed</span><span class="str">'&gt;Production Pickup Truck with speed of 271kph&lt;/record&gt;
    &lt;/car&gt;
    &lt;car name='</span><span class="pln">P50</span><span class="str">' make='</span><span class="typ">Peel</span><span class="str">' year='</span><span class="lit">1962</span><span class="str">'&gt;
      &lt;country&gt;Isle of Man&lt;/country&gt;
      &lt;record type='</span><span class="pln">size</span><span class="str">'&gt;Smallest Street-Legal Car at 99cm wide and 59 kg in weight&lt;/record&gt;
    &lt;/car&gt;
    &lt;car name='</span><span class="typ">Royale</span><span class="str">' make='</span><span class="typ">Bugatti</span><span class="str">' year='</span><span class="lit">1931</span><span class="str">'&gt;
      &lt;country&gt;France&lt;/country&gt;
      &lt;record type='</span><span class="pln">price</span><span class="str">'&gt;Most Valuable Car at $15 million&lt;/record&gt;
    &lt;/car&gt;
  &lt;/records&gt;
'''</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can parse it using <code>groovy.xml.DOMBuilder</code> and
<code>groovy.xml.dom.DOMCategory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringReader</span><span class="pun">(</span><span class="pln">CAR_RECORDS</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> doc </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DOMBuilder</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">reader</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> records </span><span class="pun">=</span><span class="pln"> doc</span><span class="pun">.</span><span class="pln">documentElement

</span><span class="kwd">use</span><span class="pun">(</span><span class="typ">DOMCategory</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> records</span><span class="pun">.</span><span class="pln">car</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parsing the XML</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creating <code>DOMCategory</code> scope to be able to use helper method calls</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gpath"><a class="anchor" href="#_gpath"></a>3.9.2. GPath</h4>
<div class="paragraph">
<p>The most common way of querying XML in Groovy is using <code>GPath</code>:</p>
</div>
<div class="paragraph">
<p><em>GPath is a path expression language integrated into Groovy which
allows parts of nested structured data to be identified. In this
sense, it has similar aims and scope as XPath does for XML. The two
main places where you use GPath expressions is when dealing with
nested POJOs or when dealing with XML</em></p>
</div>
<div class="paragraph">
<p>It is similar to <a href="http://en.wikipedia.org/wiki/XPath">XPath</a>
expressions and you can use it not only with XML but also with POJO
classes. As an example, you can specify a path to an object or element
of interest:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>a.b.c</code> → for XML, yields all the <code>&lt;c&gt;</code> elements inside <code>&lt;b&gt;</code> inside <code>&lt;a&gt;</code></p>
</li>
<li>
<p><code>a.b.c</code> → all POJOs, yields the <code>&lt;c&gt;</code> properties for all the <code>&lt;b&gt;</code>
properties of <code>&lt;a&gt;</code> (sort of like a.getB().getC() in JavaBeans)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For XML, you can also specify attributes, e.g.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>a["@href"]</code> → the href attribute of all the a elements</p>
</li>
<li>
<p><code>a.'@href'</code> → an alternative way of expressing this</p>
</li>
<li>
<p><code>a.@href</code> → an alternative way of expressing this when using XmlSlurper</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let’s illustrate this with an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> books </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''
    &lt;response version-api="2.0"&gt;
        &lt;value&gt;
            &lt;books&gt;
                &lt;book available="20" id="1"&gt;
                    &lt;title&gt;Don Xijote&lt;/title&gt;
                    &lt;author id="1"&gt;Manuel De Cervantes&lt;/author&gt;
                &lt;/book&gt;
                &lt;book available="14" id="2"&gt;
                    &lt;title&gt;Catcher in the Rye&lt;/title&gt;
                   &lt;author id="2"&gt;JD Salinger&lt;/author&gt;
               &lt;/book&gt;
               &lt;book available="13" id="3"&gt;
                   &lt;title&gt;Alice in Wonderland&lt;/title&gt;
                   &lt;author id="3"&gt;Lewis Carroll&lt;/author&gt;
               &lt;/book&gt;
               &lt;book available="5" id="4"&gt;
                   &lt;title&gt;Don Xijote&lt;/title&gt;
                   &lt;author id="4"&gt;Manuel De Cervantes&lt;/author&gt;
               &lt;/book&gt;
           &lt;/books&gt;
       &lt;/value&gt;
    &lt;/response&gt;
'''</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_simply_traversing_the_tree"><a class="anchor" href="#_simply_traversing_the_tree"></a>Simply traversing the tree</h5>
<div class="paragraph">
<p>First thing we could do is to get a value using POJO’s notation. Let’s
get the first book’s author’s name</p>
</div>
<div class="listingblock">
<div class="title">Getting node value</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">books</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> authorResult </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">book</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">author

</span><span class="kwd">assert</span><span class="pln"> authorResult</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Manuel De Cervantes'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>First we parse the document with <code>XmlSlurper</code> and the we have to
consider the returning value as the root of the XML document, so in
this case is "response".</p>
</div>
<div class="paragraph">
<p>That’s why we start traversing the document from response and then
<code>value.books.book[0].author</code>. Note that in <code>XPath</code> the node arrays starts
in [1] instead of [0], but because <code>GPath</code> is Java-based it begins at
index 0.</p>
</div>
<div class="paragraph">
<p>In the end we’ll have the instance of the <code>author</code> node and because we
wanted the text inside that node we should be calling the <code>text()</code>
method.  The <code>author</code> node is an instance of <code>GPathResult</code> type and
<code>text()</code> a method giving us the content of that node as a String.</p>
</div>
<div class="paragraph">
<p>When using <code>GPath</code> with an xml parsed with <code>XmlSlurper</code> we’ll have as a
result a <code>GPathResult</code> object. <code>GPathResult</code> has many other convenient
methods to convert the text inside a node to any other type such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>toInteger()</code></p>
</li>
<li>
<p><code>toFloat()</code></p>
</li>
<li>
<p><code>toBigInteger()</code></p>
</li>
<li>
<p>…​</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All these methods try to convert a <code>String</code> to the appropriate type.</p>
</div>
<div class="paragraph">
<p>If we were using a XML parsed with <code>XmlParser</code> we could be dealing with
instances of type <code>Node</code>. But still all the actions applied to
<code>GPathResult</code> in these examples could be applied to a Node as
well. Creators of both parsers took into account <code>GPath</code> compatibility.</p>
</div>
<div class="paragraph">
<p>Next step is to get the some values from a given node’s attribute. In the following sample
we want to get the first book’s author’s id. We’ll be using two different approaches. Let’s see the code first:</p>
</div>
<div class="listingblock">
<div class="title">Getting an attribute’s value</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">books</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> book </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">book</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> bookAuthorId1 </span><span class="pun">=</span><span class="pln"> book</span><span class="pun">.</span><span class="lit">@id</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> bookAuthorId2 </span><span class="pun">=</span><span class="pln"> book</span><span class="pun">[</span><span class="str">'@id'</span><span class="pun">]</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> bookAuthorId1 </span><span class="pun">==</span><span class="pln"> </span><span class="str">'1'</span><span class="pln"> </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> bookAuthorId1</span><span class="pun">.</span><span class="pln">toInteger</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> bookAuthorId1 </span><span class="pun">==</span><span class="pln"> bookAuthorId2</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Getting the first book node</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Getting the book’s id attribute <code>@id</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Getting the book’s id attribute with <code>map notation</code> <code>['@id']</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Getting the value as a String</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Getting the value of the attribute as an <code>Integer</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As you can see there are two types of notations to get attributes,
the</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>direct notation</em> with <code>@nameoftheattribute</code></p>
</li>
<li>
<p><em>map notation</em> using <code>['@nameoftheattribute']</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both of them are equally valid.</p>
</div>
</div>
<div class="sect4">
<h5 id="_flexible_navigation_with_children_depthfirst_and_breadthfirst"><a class="anchor" href="#_flexible_navigation_with_children_depthfirst_and_breadthfirst"></a>Flexible navigation with children (*), depthFirst (**) and breadthFirst</h5>
<div class="paragraph">
<p>If you ever have used XPath, you may have used expressions like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/following-sibling::othernode</code> : Look for a node "othernode" in the same level</p>
</li>
<li>
<p><code>//</code> : Look everywhere</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More or less we have their counterparts in GPath with the shortcuts <code>*</code> (aka <code>children()</code>) and <code>**</code> (aka <code>depthFirst()</code>).</p>
</div>
<div class="paragraph">
<p>The first example shows a simple use of <code>*</code>, which only iterates over the direct children of the node.</p>
</div>
<div class="listingblock">
<div class="title">Using *</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">books</span><span class="pun">)</span><span class="pln">

</span><span class="com">// .'*' could be replaced by .children()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> catcherInTheRye </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="str">'*'</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> node</span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="com">// node.@id == 2 could be expressed as node['@id'] == 2</span><span class="pln">
    node</span><span class="pun">.</span><span class="pln">name</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'book'</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> node</span><span class="pun">.</span><span class="lit">@id</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'2'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> catcherInTheRye</span><span class="pun">.</span><span class="pln">title</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Catcher in the Rye'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This test searches for any child nodes of the "books" node matching the given
condition. In a bit more detail, the expression says: <em>Look for any node with
a tag name equal to 'book' having an id with a value of '2' directly under
the 'books' node</em>.</p>
</div>
<div class="paragraph">
<p>This operation roughly corresponds to the <code>breadthFirst()</code> method, except that
it only stops at <strong>one level</strong> instead of continuing to the inner levels.</p>
</div>
<div class="paragraph">
<p>What if we would like to look for a given value
without having to know exactly where it is. Let’s say that the
only thing we know is the id of the author "Lewis Carroll" . How are
we going to be able to find that book? Using <code>**</code> is the solution:</p>
</div>
<div class="listingblock">
<div class="title">Using **</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">books</span><span class="pun">)</span><span class="pln">

</span><span class="com">// .'**' could be replaced by .depthFirst()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> bookId </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="str">'**'</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> book</span><span class="pun">-&gt;</span><span class="pln">
    book</span><span class="pun">.</span><span class="pln">author</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Lewis Carroll'</span><span class="pln">
</span><span class="pun">}.</span><span class="lit">@id</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> bookId </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>**</code> is the same as looking for something <em>everywhere in the
tree from this point down</em>. In this case, we’ve used the method
<code>find(Closure cl)</code> to find just the first occurrence.</p>
</div>
<div class="paragraph">
<p>What if we want to collect all book’s titles? That’s easy, just use <code>findAll</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">books</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> titles </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="str">'**'</span><span class="pun">.</span><span class="pln">findAll</span><span class="pun">{</span><span class="pln"> node</span><span class="pun">-&gt;</span><span class="pln"> node</span><span class="pun">.</span><span class="pln">name</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'title'</span><span class="pln"> </span><span class="pun">}*.</span><span class="pln">text</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> titles</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the last two examples, <code>**</code> is used as a shortcut for the <code>depthFirst()</code>
method. It goes as far down the tree as it can while navigating down the
tree from a given node. The <code>breadthFirst()</code> method finishes off all nodes
on a given level before traversing down to the next level.</p>
</div>
<div class="paragraph">
<p>The following example shows the difference between these two methods:</p>
</div>
<div class="listingblock">
<div class="title">depthFirst() vs .breadthFirst</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">books</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> nodeName </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> node </span><span class="pun">-&gt;</span><span class="pln"> node</span><span class="pun">.</span><span class="pln">name</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> withId2or3 </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> node </span><span class="pun">-&gt;</span><span class="pln"> node</span><span class="pun">.</span><span class="lit">@id</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">]</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'book'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'author'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'book'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'author'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln">
        response</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">depthFirst</span><span class="pun">().</span><span class="pln">findAll</span><span class="pun">(</span><span class="pln">withId2or3</span><span class="pun">).</span><span class="pln">collect</span><span class="pun">(</span><span class="pln">nodeName</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">[</span><span class="str">'book'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'book'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'author'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'author'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln">
        response</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">breadthFirst</span><span class="pun">().</span><span class="pln">findAll</span><span class="pun">(</span><span class="pln">withId2or3</span><span class="pun">).</span><span class="pln">collect</span><span class="pun">(</span><span class="pln">nodeName</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we search for any nodes with an id attribute with value 2 or 3.
There are both <code>book</code> and <code>author</code> nodes that match that criteria. The different
traversal orders will find the same nodes in each case but in different orders
corresponding to how the tree was traversed.</p>
</div>
<div class="paragraph">
<p>It is worth mentioning again that there are some useful methods
converting a node’s value to an integer, float, etc. Those methods
could be convenient when doing comparisons like this:</p>
</div>
<div class="listingblock">
<div class="title">helpers</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">books</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> titles </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">book</span><span class="pun">.</span><span class="pln">findAll</span><span class="pun">{</span><span class="pln">book</span><span class="pun">-&gt;</span><span class="pln">
 </span><span class="com">/* You can use toInteger() over the GPathResult object */</span><span class="pln">
    book</span><span class="pun">.</span><span class="lit">@id</span><span class="pun">.</span><span class="pln">toInteger</span><span class="pun">()</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="pun">}*.</span><span class="pln">title

</span><span class="kwd">assert</span><span class="pln"> titles</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the number 2 has been hardcoded but imagine that value
could have come from any other source (database…​ etc.).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_xml"><a class="anchor" href="#_creating_xml"></a>3.9.3. Creating XML</h4>
<div class="paragraph">
<p>The most commonly used approach for creating XML with Groovy is to use
a builder, i.e. one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>groovy.xml.MarkupBuilder</code></p>
</li>
<li>
<p><code>groovy.xml.StreamingMarkupBuilder</code></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_markupbuilder"><a class="anchor" href="#_markupbuilder"></a>MarkupBuilder</h5>
<div class="paragraph">
<p>Here is an example of using Groovy’s MarkupBuilder to create a new XML file:</p>
</div>
<div class="listingblock">
<div class="title">Creating Xml with MarkupBuilder</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> writer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> xml </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">(</span><span class="pln">writer</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

xml</span><span class="pun">.</span><span class="pln">records</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    car</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'HSV Maloo'</span><span class="pun">,</span><span class="pln"> make</span><span class="pun">:</span><span class="str">'Holden'</span><span class="pun">,</span><span class="pln"> year</span><span class="pun">:</span><span class="lit">2006</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        country</span><span class="pun">(</span><span class="str">'Australia'</span><span class="pun">)</span><span class="pln">
        record</span><span class="pun">(</span><span class="pln">type</span><span class="pun">:</span><span class="str">'speed'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Production Pickup Truck with speed of 271kph'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    car</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Royale'</span><span class="pun">,</span><span class="pln"> make</span><span class="pun">:</span><span class="str">'Bugatti'</span><span class="pun">,</span><span class="pln"> year</span><span class="pun">:</span><span class="lit">1931</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        country</span><span class="pun">(</span><span class="str">'France'</span><span class="pun">)</span><span class="pln">
        record</span><span class="pun">(</span><span class="pln">type</span><span class="pun">:</span><span class="str">'price'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Most Valuable Car at $15 million'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> records </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">writer</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">())</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> records</span><span class="pun">.</span><span class="pln">car</span><span class="pun">.</span><span class="pln">first</span><span class="pun">().</span><span class="pln">name</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'HSV Maloo'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> records</span><span class="pun">.</span><span class="pln">car</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">().</span><span class="pln">name</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Royale'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create an instance of <code>MarkupBuilder</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start creating the XML tree</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create an instance of <code>XmlSlurper</code> to traverse and test the
generated XML</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Let’s take a look a little bit closer:</p>
</div>
<div class="listingblock">
<div class="title">Creating XML elements</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xmlString </span><span class="pun">=</span><span class="pln"> </span><span class="str">"&lt;movie&gt;the godfather&lt;/movie&gt;"</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> xmlWriter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> xmlMarkup </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">)</span><span class="pln">

xmlMarkup</span><span class="pun">.</span><span class="pln">movie</span><span class="pun">(</span><span class="str">"the godfather"</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> xmlString </span><span class="pun">==</span><span class="pln"> xmlWriter</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We’re creating a reference string to compare against</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>xmlWriter</code> instance is used by <code>MarkupBuilder</code> to convert the
xml representation to a String instance eventually</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>xmlMarkup.movie(…​)</code> call will create a XML node with a tag
called <code>movie</code> and with content <code>the godfather</code>.</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">Creating XML elements with attributes</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xmlString </span><span class="pun">=</span><span class="pln"> </span><span class="str">"&lt;movie id='2'&gt;the godfather&lt;/movie&gt;"</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> xmlWriter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> xmlMarkup </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">)</span><span class="pln">

xmlMarkup</span><span class="pun">.</span><span class="pln">movie</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"the godfather"</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> xmlString </span><span class="pun">==</span><span class="pln"> xmlWriter</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This time in order to create both attributes and node content you
can create as many map entries as you like and finally add a value
to set the node’s content</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The value could be any <code>Object</code>, the value will be serialized to its
<code>String</code> representation.
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="title">Creating XML nested elements</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xmlWriter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> xmlMarkup </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">)</span><span class="pln">

xmlMarkup</span><span class="pun">.</span><span class="pln">movie</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    name</span><span class="pun">(</span><span class="str">"the godfather"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> movie </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">())</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> movie</span><span class="pun">.</span><span class="lit">@id</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> movie</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'the godfather'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>A closure represents the children elements of a given node. Notice
this time instead of using a String for the attribute we’re using a
number.</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Sometimes you may want to use a specific namespace in your xml documents:</p>
</div>
<div class="listingblock">
<div class="title">Namespace aware</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xmlWriter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> xmlMarkup </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">)</span><span class="pln">

xmlMarkup
    </span><span class="pun">.</span><span class="str">'x:movies'</span><span class="pun">(</span><span class="str">'xmlns:x'</span><span class="pun">:</span><span class="str">'http://www.groovy-lang.org'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        </span><span class="str">'x:movie'</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'the godfather'</span><span class="pun">)</span><span class="pln">
        </span><span class="str">'x:movie'</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="str">'ronin'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> movies </span><span class="pun">=</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">()</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">.</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">())</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">declareNamespace</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="str">'http://www.groovy-lang.org'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> movies</span><span class="pun">.</span><span class="str">'x:movie'</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">().</span><span class="lit">@id</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> movies</span><span class="pun">.</span><span class="str">'x:movie'</span><span class="pun">.</span><span class="kwd">last</span><span class="pun">().</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ronin'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creating a node with a given namespace <code>xmlns:x</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Creating a <code>XmlSlurper</code> registering the namespace to be able to
test the XML we just created</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>What about having some more meaningful example. We may want to
generate more elements, to have some logic when creating our XML:</p>
</div>
<div class="listingblock">
<div class="title">Mix code</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xmlWriter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> xmlMarkup </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">)</span><span class="pln">

xmlMarkup
    </span><span class="pun">.</span><span class="str">'x:movies'</span><span class="pun">(</span><span class="str">'xmlns:x'</span><span class="pun">:</span><span class="str">'http://www.groovy-lang.org'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="pun">(</span><span class="lit">1.</span><span class="pun">.</span><span class="lit">3</span><span class="pun">).</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> n </span><span class="pun">-&gt;</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
            </span><span class="str">'x:movie'</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="str">"the godfather $n"</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
                </span><span class="str">'x:movie'</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="str">"the godfather $n (Extended)"</span><span class="pun">)</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> movies </span><span class="pun">=</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">())</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">declareNamespace</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="str">'http://www.groovy-lang.org'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> movies</span><span class="pun">.</span><span class="str">'x:movie'</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> movies</span><span class="pun">.</span><span class="str">'x:movie'</span><span class="pun">*.</span><span class="pln">text</span><span class="pun">().</span><span class="pln">every </span><span class="pun">{</span><span class="pln"> name </span><span class="pun">-&gt;</span><span class="pln"> name</span><span class="pun">.</span><span class="pln">startsWith</span><span class="pun">(</span><span class="str">'the'</span><span class="pun">)}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generating elements from a range</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using a conditional for creating a given element</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Of course the instance of a builder can be passed as a parameter to
refactor/modularize your code:</p>
</div>
<div class="listingblock">
<div class="title">Mix code</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xmlWriter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> xmlMarkup </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">)</span><span class="pln">

</span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">Closure</span><span class="pun">&lt;</span><span class="typ">MarkupBuilder</span><span class="pun">&gt;</span><span class="pln"> buildMovieList </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pln"> builder </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="pun">(</span><span class="lit">1.</span><span class="pun">.</span><span class="lit">3</span><span class="pun">).</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> n </span><span class="pun">-&gt;</span><span class="pln">
        builder</span><span class="pun">.</span><span class="str">'x:movie'</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="str">"the godfather $n"</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">n </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            builder</span><span class="pun">.</span><span class="str">'x:movie'</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> </span><span class="str">"the godfather $n (Extended)"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> builder
</span><span class="pun">}</span><span class="pln">

xmlMarkup</span><span class="pun">.</span><span class="str">'x:movies'</span><span class="pun">(</span><span class="str">'xmlns:x'</span><span class="pun">:</span><span class="str">'http://www.groovy-lang.org'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    buildMovieList</span><span class="pun">(</span><span class="pln">xmlMarkup</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> movies </span><span class="pun">=</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">())</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">declareNamespace</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="str">'http://www.groovy-lang.org'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> movies</span><span class="pun">.</span><span class="str">'x:movie'</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> movies</span><span class="pun">.</span><span class="str">'x:movie'</span><span class="pun">*.</span><span class="pln">text</span><span class="pun">().</span><span class="pln">every </span><span class="pun">{</span><span class="pln"> name </span><span class="pun">-&gt;</span><span class="pln"> name</span><span class="pun">.</span><span class="pln">startsWith</span><span class="pun">(</span><span class="str">'the'</span><span class="pun">)}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this case we’ve created a Closure to handle the creation of a list of movies</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Just using the <code>buildMovieList</code> function when necessary</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_streamingmarkupbuilder"><a class="anchor" href="#_streamingmarkupbuilder"></a>StreamingMarkupBuilder</h5>
<div class="paragraph">
<p>The class <code>groovy.xml.StreamingMarkupBuilder</code> is a builder class for
creating XML markup. This implementation uses a
<code>groovy.xml.streamingmarkupsupport.StreamingMarkupWriter</code> to handle
output.</p>
</div>
<div class="listingblock">
<div class="title">Using StreamingMarkupBuilder</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xml </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StreamingMarkupBuilder</span><span class="pun">().</span><span class="pln">bind </span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    records </span><span class="pun">{</span><span class="pln">
        car</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'HSV Maloo'</span><span class="pun">,</span><span class="pln"> make</span><span class="pun">:</span><span class="str">'Holden'</span><span class="pun">,</span><span class="pln"> year</span><span class="pun">:</span><span class="lit">2006</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
            country</span><span class="pun">(</span><span class="str">'Australia'</span><span class="pun">)</span><span class="pln">
            record</span><span class="pun">(</span><span class="pln">type</span><span class="pun">:</span><span class="str">'speed'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Production Pickup Truck with speed of 271kph'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        car</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'P50'</span><span class="pun">,</span><span class="pln"> make</span><span class="pun">:</span><span class="str">'Peel'</span><span class="pun">,</span><span class="pln"> year</span><span class="pun">:</span><span class="lit">1962</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            country</span><span class="pun">(</span><span class="str">'Isle of Man'</span><span class="pun">)</span><span class="pln">
            record</span><span class="pun">(</span><span class="pln">type</span><span class="pun">:</span><span class="str">'size'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Smallest Street-Legal Car at 99cm wide and 59 kg in weight'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        car</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Royale'</span><span class="pun">,</span><span class="pln"> make</span><span class="pun">:</span><span class="str">'Bugatti'</span><span class="pun">,</span><span class="pln"> year</span><span class="pun">:</span><span class="lit">1931</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            country</span><span class="pun">(</span><span class="str">'France'</span><span class="pun">)</span><span class="pln">
            record</span><span class="pun">(</span><span class="pln">type</span><span class="pun">:</span><span class="str">'price'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Most Valuable Car at $15 million'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> records </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xml</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">())</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> records</span><span class="pun">.</span><span class="pln">car</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> records</span><span class="pun">.</span><span class="pln">car</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="lit">@name</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'P50'</span><span class="pln"> </span><span class="pun">}.</span><span class="pln">country</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Isle of Man'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note that <code>StreamingMarkupBuilder.bind</code> returns a <code>Writable</code>
instance that may be used to stream the markup to a Writer</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We’re capturing the output in a String to parse it again an check
the structure of the generated XML with <code>XmlSlurper</code>.</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_markupbuilderhelper"><a class="anchor" href="#_markupbuilderhelper"></a>MarkupBuilderHelper</h5>
<div class="paragraph">
<p>The <code>groovy.xml.MarkupBuilderHelper</code> is, as its name reflects, a
helper for <code>groovy.xml.MarkupBuilder</code>.</p>
</div>
<div class="paragraph">
<p>This helper normally can be accessed from within an instance of class
<code>groovy.xml.MarkupBuilder</code> or an instance of
<code>groovy.xml.StreamingMarkupBuilder</code>.</p>
</div>
<div class="paragraph">
<p>This helper could be handy in situations when you may want to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Produce a comment in the output</p>
</li>
<li>
<p>Produce an XML processing instruction in the output</p>
</li>
<li>
<p>Produce an XML declaration in the output</p>
</li>
<li>
<p>Print data in the body of the current tag, escaping XML entities</p>
</li>
<li>
<p>Print data in the body of the current tag</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In both <code>MarkupBuilder</code> and <code>StreamingMarkupBuilder</code> this helper is
accessed by the property <code>mkp</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using MarkupBuilder’s 'mkp'</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xmlWriter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> xmlMarkup </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupBuilder</span><span class="pun">(</span><span class="pln">xmlWriter</span><span class="pun">).</span><span class="pln">rules </span><span class="pun">{</span><span class="pln">
    mkp</span><span class="pun">.</span><span class="pln">comment</span><span class="pun">(</span><span class="str">'THIS IS THE MAIN RULE'</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    rule</span><span class="pun">(</span><span class="pln">sentence</span><span class="pun">:</span><span class="pln"> mkp</span><span class="pun">.</span><span class="kwd">yield</span><span class="pun">(</span><span class="str">'3 &gt; n'</span><span class="pun">))</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xmlWriter</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">().</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'3 &amp;gt; n'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xmlWriter</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">().</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'&lt;!-- THIS IS THE MAIN RULE --&gt;'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using <code>mkp</code> to create a comment in the XML</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using <code>mkp</code> to generate an escaped value</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Checking both assumptions were true</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Here is another example to show the use of <code>mkp</code> property accessible
from within the <code>bind</code> method scope when using
<code>StreamingMarkupBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="title">Using StreamingMarkupBuilder’s 'mkp'</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xml </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StreamingMarkupBuilder</span><span class="pun">().</span><span class="pln">bind </span><span class="pun">{</span><span class="pln">
    records </span><span class="pun">{</span><span class="pln">
        car</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> mkp</span><span class="pun">.</span><span class="kwd">yield</span><span class="pun">(</span><span class="str">'3 &lt; 5'</span><span class="pun">))</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        car</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> mkp</span><span class="pun">.</span><span class="pln">yieldUnescaped</span><span class="pun">(</span><span class="str">'1 &lt; 3'</span><span class="pun">))</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> xml</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">().</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'3 &amp;lt; 5'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> xml</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">().</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'1 &lt; 3'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If we want to generate a escaped value for the name attribute with
<code>mkp.yield</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Checking the values later on with <code>XmlSlurper</code></td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_domtogroovy"><a class="anchor" href="#_domtogroovy"></a>DOMToGroovy</h5>
<div class="paragraph">
<p>Suppose we have an existing XML document and we want to automate
generation of the markup without having to type it all in? We just
need to use <code>org.codehaus.groovy.tools.xml.DOMToGroovy</code> as shown in
the following example:</p>
</div>
<div class="listingblock">
<div class="title">Building MarkupBuilder from DOMToGroovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> songs  </span><span class="pun">=</span><span class="pln"> </span><span class="str">"""
    &lt;songs&gt;
      &lt;song&gt;
        &lt;title&gt;Here I go&lt;/title&gt;
        &lt;band&gt;Whitesnake&lt;/band&gt;
      &lt;/song&gt;
    &lt;/songs&gt;
"""</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> builder     </span><span class="pun">=</span><span class="pln">
    javax</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="pln">parsers</span><span class="pun">.</span><span class="typ">DocumentBuilderFactory</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">().</span><span class="pln">newDocumentBuilder</span><span class="pun">()</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> inputStream </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ByteArrayInputStream</span><span class="pun">(</span><span class="pln">songs</span><span class="pun">.</span><span class="pln">bytes</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> document    </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">inputStream</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> output      </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> converter   </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DomToGroovy</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PrintWriter</span><span class="pun">(</span><span class="pln">output</span><span class="pun">))</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

    converter</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">(</span><span class="pln">document</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

    </span><span class="typ">String</span><span class="pln"> xmlRecovered  </span><span class="pun">=</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="str">"""
           def writer = new StringWriter()
           def builder = new groovy.xml.MarkupBuilder(writer)
           builder.${output}

           return writer.toString()
        """</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

    </span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xmlRecovered</span><span class="pun">).</span><span class="pln">song</span><span class="pun">.</span><span class="pln">title</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Here I go'</span><span class="pln"> </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creating <code>DOMToGroovy</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Converts the XML to <code>MarkupBuilder</code> calls which are available in the output <code>StringWriter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Using <code>output</code> variable to create the whole MarkupBuilder</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Back to XML string</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_manipulating_xml"><a class="anchor" href="#_manipulating_xml"></a>3.9.4. Manipulating XML</h4>
<div class="paragraph">
<p>In this chapter you’ll see the different ways of adding / modifying /
removing nodes using <code>XmlSlurper</code> or <code>XmlParser</code>. The xml we are going
to be handling is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> xml </span><span class="pun">=</span><span class="pln"> </span><span class="str">"""
&lt;response version-api="</span><span class="lit">2.0</span><span class="str">"&gt;
    &lt;value&gt;
        &lt;books&gt;
            &lt;book id="</span><span class="lit">2</span><span class="str">"&gt;
                &lt;title&gt;Don Xijote&lt;/title&gt;
                &lt;author id="</span><span class="lit">1</span><span class="str">"&gt;Manuel De Cervantes&lt;/author&gt;
            &lt;/book&gt;
        &lt;/books&gt;
    &lt;/value&gt;
&lt;/response&gt;
"""</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_adding_nodes"><a class="anchor" href="#_adding_nodes"></a>Adding nodes</h5>
<div class="paragraph">
<p>The main difference between <code>XmlSlurper</code> and <code>XmlParser</code> is that when
former creates the nodes they won’t be available until the document’s
been evaluated again, so you should parse the transformed document
again in order to be able to see the new nodes. So keep that in mind
when choosing any of both approaches.</p>
</div>
<div class="paragraph">
<p>If you needed to see a node right after creating it then <code>XmlParser</code>
should be your choice, but if you’re planning to do many changes to
the XML and send the result to another process maybe <code>XmlSlurper</code> would
be more efficient.</p>
</div>
<div class="paragraph">
<p>You can’t create a new node directly using the <code>XmlSlurper</code> instance,
but you can with <code>XmlParser</code>. The way of creating a new node from
XmlParser is through its method <code>createNode(..)</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> parser </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlParser</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> parser</span><span class="pun">.</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xml</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> numberOfResults </span><span class="pun">=</span><span class="pln"> parser</span><span class="pun">.</span><span class="pln">createNode</span><span class="pun">(</span><span class="pln">
    response</span><span class="pun">,</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">QName</span><span class="pun">(</span><span class="str">"numberOfResults"</span><span class="pun">),</span><span class="pln">
    </span><span class="pun">[:]</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

numberOfResults</span><span class="pun">.</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> </span><span class="str">"1"</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">numberOfResults</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"1"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>createNode()</code> method receives the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>parent node (could be null)</p>
</li>
<li>
<p>The qualified name for the tag (In this case we only use the local
part without any namespace). We’re using an instance of
<code>groovy.xml.QName</code></p>
</li>
<li>
<p>A map with the tag’s attributes (None in this particular case)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Anyway you won’t normally be creating a node from the parser instance
but from the parsed XML instance. That is from a <code>Node</code> or a
<code>GPathResult</code> instance.</p>
</div>
<div class="paragraph">
<p>Take a look at the next example. We are parsing the xml with <code>XmlParser</code>
and then creating a new node from the parsed document’s instance
(Notice the method here is slightly different in the way it receives
the parameters):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> parser </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlParser</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> parser</span><span class="pun">.</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xml</span><span class="pun">)</span><span class="pln">

response</span><span class="pun">.</span><span class="pln">appendNode</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">QName</span><span class="pun">(</span><span class="str">"numberOfResults"</span><span class="pun">),</span><span class="pln">
    </span><span class="pun">[:],</span><span class="pln">
    </span><span class="str">"1"</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

response</span><span class="pun">.</span><span class="pln">numberOfResults</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"1"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>XmlSlurper</code>, <code>GPathResult</code> instances don’t have <code>createNode()</code>
method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_modifying_removing_nodes"><a class="anchor" href="#_modifying_removing_nodes"></a>Modifying / Removing nodes</h5>
<div class="paragraph">
<p>We know how to parse the document, add new nodes, now I want to change
a given node’s content. Let’s start using <code>XmlParser</code> and <code>Node</code>. This
example changes the first book information to actually another book.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">   </span><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlParser</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xml</span><span class="pun">)</span><span class="pln">

</span><span class="com">/* Use the same syntax as groovy.xml.MarkupBuilder */</span><span class="pln">
   response</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">book</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">replaceNode</span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
       book</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="str">"3"</span><span class="pun">){</span><span class="pln">
           title</span><span class="pun">(</span><span class="str">"To Kill a Mockingbird"</span><span class="pun">)</span><span class="pln">
           author</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="str">"3"</span><span class="pun">,</span><span class="str">"Harper Lee"</span><span class="pun">)</span><span class="pln">
       </span><span class="pun">}</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">

   </span><span class="kwd">def</span><span class="pln"> newNode </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">book</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">

   </span><span class="kwd">assert</span><span class="pln"> newNode</span><span class="pun">.</span><span class="pln">name</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"book"</span><span class="pln">
   </span><span class="kwd">assert</span><span class="pln"> newNode</span><span class="pun">.</span><span class="lit">@id</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"3"</span><span class="pln">
   </span><span class="kwd">assert</span><span class="pln"> newNode</span><span class="pun">.</span><span class="pln">title</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"To Kill a Mockingbird"</span><span class="pln">
   </span><span class="kwd">assert</span><span class="pln"> newNode</span><span class="pun">.</span><span class="pln">author</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Harper Lee"</span><span class="pln">
   </span><span class="kwd">assert</span><span class="pln"> newNode</span><span class="pun">.</span><span class="pln">author</span><span class="pun">.</span><span class="lit">@id</span><span class="pun">.</span><span class="pln">first</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"3"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>replaceNode()</code> the closure we pass as parameter should
follow the same rules as if we were using <code>groovy.xml.MarkupBuilder</code>:</p>
</div>
<div class="paragraph">
<p>Here’s the same example using <code>XmlSlurper</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">books</span><span class="pun">)</span><span class="pln">

</span><span class="com">/* Use the same syntax as groovy.xml.MarkupBuilder */</span><span class="pln">
response</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">book</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">replaceNode</span><span class="pun">{</span><span class="pln">
    book</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="str">"3"</span><span class="pun">){</span><span class="pln">
        title</span><span class="pun">(</span><span class="str">"To Kill a Mockingbird"</span><span class="pun">)</span><span class="pln">
        author</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="str">"3"</span><span class="pun">,</span><span class="str">"Harper Lee"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">book</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">title</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"Don Xijote"</span><span class="pln">

</span><span class="com">/* That mkp is a special namespace used to escape away from the normal building mode
   of the builder and get access to helper markup methods
   'yield', 'pi', 'comment', 'out', 'namespaces', 'xmlDeclaration' and
   'yieldUnescaped' */</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StreamingMarkupBuilder</span><span class="pun">().</span><span class="pln">bind </span><span class="pun">{</span><span class="pln"> mkp</span><span class="pun">.</span><span class="kwd">yield</span><span class="pln"> response </span><span class="pun">}.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> changedResponse </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">result</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> changedResponse</span><span class="pun">.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">books</span><span class="pun">.</span><span class="pln">book</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">title</span><span class="pun">.</span><span class="pln">text</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"To Kill a Mockingbird"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how using <code>XmlSlurper</code> we have to parse the transformed document
again in order to find the created nodes. In this particular example
could be a little bit annoying isn’t it?</p>
</div>
<div class="paragraph">
<p>Finally both parsers also use the same approach for adding a new
attribute to a given attribute. This time again the difference is
whether you want the new nodes to be available right away or
not. First <code>XmlParser</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> parser </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlParser</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> parser</span><span class="pun">.</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xml</span><span class="pun">)</span><span class="pln">

response</span><span class="pun">.</span><span class="lit">@numberOfResults</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"1"</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> response</span><span class="pun">.</span><span class="lit">@numberOfResults</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"1"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And <code>XmlSlurper</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlSlurper</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">books</span><span class="pun">)</span><span class="pln">
response</span><span class="pun">.</span><span class="lit">@numberOfResults</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"2"</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> response</span><span class="pun">.</span><span class="lit">@numberOfResults</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">"2"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <code>XmlSlurper</code>, adding a new attribute does <strong>not</strong> require you to perform a new evaluation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_printing_xml"><a class="anchor" href="#_printing_xml"></a>Printing XML</h5>
<div class="sect5">
<h6 id="_xmlutil"><a class="anchor" href="#_xmlutil"></a>XmlUtil</h6>
<div class="paragraph">
<p>Sometimes is useful to get not only the value of a given node but the
node itself (for instance to add this node to another XML).</p>
</div>
<div class="paragraph">
<p>For that you can use <code>groovy.xml.XmlUtil</code> class. It has several static
methods to serialize the xml fragment from several type of sources
(Node, GPathResult, String…​)</p>
</div>
<div class="listingblock">
<div class="title">Getting a node as a string</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XmlParser</span><span class="pun">().</span><span class="pln">parseText</span><span class="pun">(</span><span class="pln">xml</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> nodeToSerialize </span><span class="pun">=</span><span class="pln"> response</span><span class="pun">.</span><span class="str">'**'</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln">it</span><span class="pun">.</span><span class="pln">name</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'author'</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> nodeAsText </span><span class="pun">=</span><span class="pln"> </span><span class="typ">XmlUtil</span><span class="pun">.</span><span class="pln">serialize</span><span class="pun">(</span><span class="pln">nodeToSerialize</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> nodeAsText </span><span class="pun">==</span><span class="pln">
    </span><span class="typ">XmlUtil</span><span class="pun">.</span><span class="pln">serialize</span><span class="pun">(</span><span class="str">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;author id="1"&gt;Manuel De Cervantes&lt;/author&gt;'</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scripting_ant_tasks"><a class="anchor" href="#_scripting_ant_tasks"></a>3.10. Scripting Ant tasks</h3>
<div class="paragraph">
<p>Groovy integrates very well with <a href="http://ant.apache.org/">Apache Ant</a> thanks to <a href="#_antbuilder">AntBuilder</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_groovy_ant_task"><a class="anchor" href="#_the_groovy_ant_task"></a>3.11. The &lt;groovy&gt; Ant Task</h3>
<div class="paragraph">
<p>Executes a series of Groovy statements from <a href="http://ant.apache.org/">Apache Ant</a>.
Statements can either be read in from a text file using the <code>src</code> attribute or from between the enclosing Groovy tags.</p>
</div>
<div class="sect3">
<h4 id="_required_taskdef"><a class="anchor" href="#_required_taskdef"></a>3.11.1. Required taskdef</h4>
<div class="paragraph">
<p>Assuming <code>groovy-all-VERSION.jar</code> is in <code>my.classpath</code> you will need to declare this task in the <code>build.xml</code> prior to using it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;taskdef</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"groovy"</span><span class="pln">
         </span><span class="atn">classname</span><span class="pun">=</span><span class="atv">"org.codehaus.groovy.ant.Groovy"</span><span class="pln">
         </span><span class="atn">classpathref</span><span class="pun">=</span><span class="atv">"my.classpath"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;groovy&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__groovy_attributes"><a class="anchor" href="#__groovy_attributes"></a>3.11.2. &lt;groovy&gt; attributes</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">indy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled the script will be executed with <code>invokedynamic</code> (disabled by default).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">src</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File containing Groovy statements. The directory containing the file is added to the classpath.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes, unless statements enclosed within tags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classpathref</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath to use, given as reference to a PATH defined elsewhere.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the output file; defaults to the Ant log.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fork</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If enabled the script will be executed in another JVM (disabled by default).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptBaseClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the base class for scripts.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_parameters_specified_as_nested_elements"><a class="anchor" href="#_parameters_specified_as_nested_elements"></a>3.11.3. Parameters specified as nested elements</h4>
<div class="sect4">
<h5 id="__classpath"><a class="anchor" href="#__classpath"></a>&lt;classpath&gt;</h5>
<div class="paragraph">
<p>Groovy’s classpath attribute is a PATH like structure and can also be set via a nested classpath element.</p>
</div>
</div>
<div class="sect4">
<h5 id="__arg"><a class="anchor" href="#__arg"></a>&lt;arg&gt;</h5>
<div class="paragraph">
<p>Arguments can be set via one or more nested &lt;arg&gt; elements using the standard Ant <a href="http://ant.apache.org/manual/using.html#arg">command line conventions</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_available_bindings"><a class="anchor" href="#_available_bindings"></a>3.11.4. Available bindings</h4>
<div class="paragraph">
<p>A number of bindings are in scope for use within your Groovy statements.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 83%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">args</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">command line arguments, if any</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an instance of <code>AntBuilder</code> that knows about the current ant project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">project</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the current ant project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a <code>Map</code> of ant properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">target</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the owning target that invoked this groovy script</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">task</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the wrapping task, can access anything needed in <code>org.apache.tools.ant.Task</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_examples_2"><a class="anchor" href="#_examples_2"></a>3.11.5. Examples</h4>
<div class="paragraph">
<p>Hello world, version 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;groovy&gt;</span><span class="pln">
println "Hello World"
</span><span class="tag">&lt;/groovy&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Hello world, version 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;groovy&gt;</span><span class="pln">
ant.echo "Hello World"
</span><span class="tag">&lt;/groovy&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>List all xml files in the current directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;groovy&gt;</span><span class="pln">
xmlfiles = new File(".").listFiles().findAll{ it =~ "\.xml$" }
xmlfiles.sort().each { println it.toString() }
</span><span class="tag">&lt;/groovy&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>List all xml files within a jar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;zipfileset</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"found"</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"foobar.jar"</span><span class="pln">
            </span><span class="atn">includes</span><span class="pun">=</span><span class="atv">"**/*.xml"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;groovy&gt;</span><span class="pln">
    project.references.found.each {
        println it.name
    }
</span><span class="tag">&lt;/groovy&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;groovy</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"/some/directory/some/file.groovy"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;classpath&gt;</span><span class="pln">
    </span><span class="tag">&lt;pathelement</span><span class="pln"> </span><span class="atn">location</span><span class="pun">=</span><span class="atv">"/my/groovy/classes/directory"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/classpath&gt;</span><span class="pln">
</span><span class="tag">&lt;/groovy&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Find all <code>Builder</code> classes having an <code>org.*</code> package within a directory of jars:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"local.target"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"C:/Projects/GroovyExamples"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;groovy&gt;</span><span class="pln">
import java.util.jar.JarFile
def classes = []
def resourceNamePattern = /org\/.*\/.*Builder.class/
def jarNamePattern = /.*(beta|commons).*jar$/

def libdir = new File("${properties['local.target']}/lib")
libdir.listFiles().grep(~jarNamePattern).each { candidate -&gt;
    new JarFile(candidate).entries().each { entry -&gt;
        if (entry.name ==~ resourceNamePattern) classes += entry.name
    }
}
properties["builder-classes"] = classes.join(' ')
</span><span class="tag">&lt;/groovy&gt;</span><span class="pln">
</span><span class="tag">&lt;echo</span><span class="pln"> </span><span class="atn">message</span><span class="pun">=</span><span class="atv">'${builder-classes}'</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which might result in something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="pln">org</span><span class="pun">/</span><span class="pln">apache</span><span class="pun">/</span><span class="pln">commons</span><span class="pun">/</span><span class="pln">cli</span><span class="pun">/</span><span class="typ">PatternOptionBuilder</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> org</span><span class="pun">/</span><span class="pln">apache</span><span class="pun">/</span><span class="pln">commons</span><span class="pun">/</span><span class="pln">cli</span><span class="pun">/</span><span class="typ">OptionBuilder</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> org</span><span class="pun">/</span><span class="pln">codehaus</span><span class="pun">/</span><span class="pln">groovy</span><span class="pun">/</span><span class="pln">tools</span><span class="pun">/</span><span class="pln">groovydoc</span><span class="pun">/</span><span class="typ">GroovyRootDocBuilder</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> org</span><span class="pun">/</span><span class="pln">custommonkey</span><span class="pun">/</span><span class="pln">xmlunit</span><span class="pun">/</span><span class="typ">HTMLDocumentBuilder</span><span class="pun">.</span><span class="kwd">class</span><span class="pln"> org</span><span class="pun">/</span><span class="pln">custommonkey</span><span class="pun">/</span><span class="pln">xmlunit</span><span class="pun">/</span><span class="typ">TolerantSaxDocumentBuilder</span><span class="pun">.</span><span class="kwd">class</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>FileScanner version of above (with a slight variation on collecting the names):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;groovy&gt;</span><span class="pln">
import java.util.jar.JarFile
def resourceNamePattern = /org\/.*\/.*Builder.class/
def candidates = ant.fileScanner {
    fileset(dir: '${local.target}/lib') {
        include(name: '*beta*.jar')
        include(name: '*commons*.jar')
    }
}
def classes = candidates.collect {
    new JarFile(it).entries().collect { it.name }.findAll {
        it ==~ resourceNamePattern
    }
}.flatten()
properties["builder-classes"] = classes.join(' ')
</span><span class="tag">&lt;/groovy&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling out to a web service from your Ant script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;project</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"SOAP example"</span><span class="pln"> </span><span class="atn">default</span><span class="pun">=</span><span class="atv">"main"</span><span class="pln"> </span><span class="atn">basedir</span><span class="pun">=</span><span class="atv">"."</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">environment</span><span class="pun">=</span><span class="atv">"env"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"celsius"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;target</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"main"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;taskdef</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"groovy"</span><span class="pln"> </span><span class="atn">classname</span><span class="pun">=</span><span class="atv">"org.codehaus.groovy.ant.Groovy"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;classpath&gt;</span><span class="pln">
                </span><span class="tag">&lt;fileset</span><span class="pln"> </span><span class="atn">dir</span><span class="pun">=</span><span class="atv">"${env.GROOVY_HOME}"</span><span class="pln"> </span><span class="atn">includes</span><span class="pun">=</span><span class="atv">"embeddable/groovy-all-*.jar,lib/ivy*.jar"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;/classpath&gt;</span><span class="pln">
        </span><span class="tag">&lt;/taskdef&gt;</span><span class="pln">
        </span><span class="tag">&lt;groovy&gt;</span><span class="pln">
            @Grab('org.codehaus.groovy.modules:groovyws:0.5.1')
            import groovyx.net.ws.WSClient
            def url = 'http://www.w3schools.com/webservices/tempconvert.asmx?WSDL'
            def proxy = new WSClient(url, this.class.classLoader)
            proxy.initialize()
            ant.echo "I'm freezing at ${properties.celsius} degrees Celsius"
            properties.result = proxy.CelsiusToFahrenheit(properties.celsius)
        </span><span class="tag">&lt;/groovy&gt;</span><span class="pln">
        </span><span class="tag">&lt;antcall</span><span class="pln"> </span><span class="atn">target</span><span class="pun">=</span><span class="atv">"results"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/target&gt;</span><span class="pln">
    </span><span class="tag">&lt;target</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"results"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;echo</span><span class="pln"> </span><span class="atn">message</span><span class="pun">=</span><span class="atv">"I'm freezing at ${result} degrees Fahrenheit"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/target&gt;</span><span class="pln">
</span><span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will output the following (along with some informational messages):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="pln">main</span><span class="pun">:</span><span class="pln">
     </span><span class="pun">...</span><span class="pln">
     </span><span class="pun">[</span><span class="pln">echo</span><span class="pun">]</span><span class="pln"> I</span><span class="str">'m freezing at 0 degrees Celsius
results:
     [echo] I'</span><span class="pln">m freezing at </span><span class="lit">32</span><span class="pln"> degrees </span><span class="typ">Fahrenheit</span><span class="pln">

BUILD SUCCESSFUL</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;target</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"run"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;groovy&gt;</span><span class="pln">
        </span><span class="tag">&lt;arg</span><span class="pln"> </span><span class="atn">line</span><span class="pun">=</span><span class="atv">"1 2 3"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;arg</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"4 5"</span><span class="tag">/&gt;</span><span class="pln">
        println args.size()
        println args[2]
        args.each{ ant.echo(message:it) }
    </span><span class="tag">&lt;/groovy&gt;</span><span class="pln">
</span><span class="tag">&lt;/target&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code><span class="typ">Buildfile</span><span class="pun">:</span><span class="pln"> build</span><span class="pun">.</span><span class="pln">xml

run</span><span class="pun">:</span><span class="pln">
   </span><span class="pun">[</span><span class="pln">groovy</span><span class="pun">]</span><span class="pln"> </span><span class="lit">4</span><span class="pln">
   </span><span class="pun">[</span><span class="pln">groovy</span><span class="pun">]</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
     </span><span class="pun">[</span><span class="pln">echo</span><span class="pun">]</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
     </span><span class="pun">[</span><span class="pln">echo</span><span class="pun">]</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
     </span><span class="pun">[</span><span class="pln">echo</span><span class="pun">]</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
     </span><span class="pun">[</span><span class="pln">echo</span><span class="pun">]</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="lit">5</span><span class="pln">

BUILD SUCCESSFUL</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_template_engines"><a class="anchor" href="#_template_engines"></a>3.12. Template engines</h3>
<div class="sect3">
<h4 id="_introduction_3"><a class="anchor" href="#_introduction_3"></a>3.12.1. Introduction</h4>
<div class="paragraph">
<p>Groovy supports multiple ways to generate text dynamically including <code>GStrings</code>, <code>printf</code> and <a href="#_markupbuilder">MarkupBuilder</a>
 just to name a few. In addition to these, there is a dedicated template
 framework which is well-suited to applications where the text to be 
generated follows the form of a static template.</p>
</div>
</div>
<div class="sect3">
<h4 id="_template_framework"><a class="anchor" href="#_template_framework"></a>3.12.2. Template framework</h4>
<div class="paragraph">
<p>The template framework in Groovy consists of a <code>TemplateEngine</code> abstract base class that engines must implement and a <code>Template</code> interface that the resulting templates they generate must implement.</p>
</div>
<div class="paragraph">
<p>Included with Groovy are several template engines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SimpleTemplateEngine</code> - for basic templates</p>
</li>
<li>
<p><code>StreamingTemplateEngine</code> - functionally equivalent to <code>SimpleTemplateEngine</code>, but can handle strings larger than 64k</p>
</li>
<li>
<p><code>GStringTemplateEngine</code> - stores the template as writeable closures (useful for streaming scenarios)</p>
</li>
<li>
<p><code>XmlTemplateEngine</code> - works well when the template and output are valid XML</p>
</li>
<li>
<p><code>MarkupTemplateEngine</code> - a very complete, optimized, template engine</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_simpletemplateengine"><a class="anchor" href="#_simpletemplateengine"></a>3.12.3. SimpleTemplateEngine</h4>
<div class="paragraph">
<p>Shown here is the <code>SimpleTemplateEngine</code> that allows you 
to use JSP-like scriptlets (see example below), script, and EL 
expressions in your template in order to generate parametrized text. 
Here is an example of using the system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> text </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Dear "$firstname $lastname",\nSo nice to meet you in &lt;% print city %&gt;.\nSee you in ${month},\n${signed}'</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> binding </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">"firstname"</span><span class="pun">:</span><span class="str">"Sam"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"lastname"</span><span class="pun">:</span><span class="str">"Pullara"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"city"</span><span class="pun">:</span><span class="str">"San Francisco"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"month"</span><span class="pun">:</span><span class="str">"December"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"signed"</span><span class="pun">:</span><span class="str">"Groovy-Dev"</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> engine </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">text</span><span class="pun">.</span><span class="typ">SimpleTemplateEngine</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">template</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> engine</span><span class="pun">.</span><span class="pln">createTemplate</span><span class="pun">(</span><span class="pln">text</span><span class="pun">).</span><span class="pln">make</span><span class="pun">(</span><span class="pln">binding</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Dear "Sam Pullara",\nSo nice to meet you in San Francisco.\nSee you in December,\nGroovy-Dev'</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">template</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While it is generally not deemed good practice to mix processing 
logic in your template (or view), sometimes very simple logic can be 
useful. E.g. in the example above, we could change this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">$firstname</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>to this (assuming we have set up a static import for capitalize <strong>inside</strong> the template):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">$</span><span class="pun">{</span><span class="pln">firstname</span><span class="pun">.</span><span class="pln">capitalize</span><span class="pun">()}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pun">&lt;%</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> city %&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pun">&lt;%</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> city </span><span class="pun">==</span><span class="pln"> </span><span class="str">"New York"</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">"The Big Apple"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> city %&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_advanced_usage_note"><a class="anchor" href="#_advanced_usage_note"></a>Advanced Usage Note</h5>
<div class="paragraph">
<p>If you happen to be embedding your template directly in your script 
(as we did above) you have to be careful about backslash escaping. 
Because the template string itself will be parsed by Groovy before it is
 passed to the the templating framework, you have to escape any 
backslashes inside GString expressions or scriptlet 'code' that are 
entered as part of a Groovy program. E.g. if we wanted quotes around <em>The Big Apple</em> above, we would use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pun">&lt;%</span><span class="pln"> </span><span class="kwd">print</span><span class="pln"> city </span><span class="pun">==</span><span class="pln"> </span><span class="str">"New York"</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">"\\"</span><span class="typ">The</span><span class="pln"> </span><span class="typ">Big</span><span class="pln"> </span><span class="typ">Apple</span><span class="pln">\\</span><span class="str">""</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> city %&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, if we wanted a newline, we would use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">\\n</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>in any GString expression or scriptlet 'code' that appears inside a 
Groovy script. A normal “\n” is fine within the static template text 
itself or if the entire template itself is in an external template file.
 Similarly, to represent an actual backslash in your text you would need</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">\\\\</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>in an external file or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">\\\\</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>in any GString expression or scriptlet 'code'. (Note: the necessity 
to have this extra slash may go away in a future version of Groovy if we
 can find an easy way to support such a change.)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_streamingtemplateengine"><a class="anchor" href="#_streamingtemplateengine"></a>3.12.4. StreamingTemplateEngine</h4>
<div class="paragraph">
<p>The <code>StreamingTemplateEngine</code> engine is functionally equivalent to the <code>SimpleTemplateEngine</code>,
 but creates the template using writable closures making it more 
scalable for large templates. Specifically this template engine can 
handle strings larger than 64k.</p>
</div>
<div class="paragraph">
<p>It uses JSP style &lt;% %&gt; script and &lt;%= %&gt; expression 
syntax or GString style expressions. The variable 'out' is bound to the 
writer that the template is being written to.</p>
</div>
<div class="paragraph">
<p>Frequently, the template source will be a file but here we show a simple example providing the template as a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> text </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''\
Dear &lt;% out.print firstname %&gt; ${lastname},

We &lt;% if (accepted) out.print '</span><span class="pln">are pleased</span><span class="str">' else out.print '</span><span class="pln">regret</span><span class="str">' %&gt; \
to inform you that your paper entitled
'</span><span class="pln">$title</span><span class="str">' was ${ accepted ? '</span><span class="pln">accepted</span><span class="str">' : '</span><span class="pln">rejected</span><span class="str">' }.

The conference committee.'''</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">template</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">text</span><span class="pun">.</span><span class="typ">StreamingTemplateEngine</span><span class="pun">().</span><span class="pln">createTemplate</span><span class="pun">(</span><span class="pln">text</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> binding </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    firstname </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Grace"</span><span class="pun">,</span><span class="pln">
    lastname  </span><span class="pun">:</span><span class="pln"> </span><span class="str">"Hopper"</span><span class="pun">,</span><span class="pln">
    accepted  </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">
    title     </span><span class="pun">:</span><span class="pln"> </span><span class="str">'Groovy for COBOL programmers'</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

</span><span class="typ">String</span><span class="pln"> response </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">template</span><span class="pun">.</span><span class="pln">make</span><span class="pun">(</span><span class="pln">binding</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> response </span><span class="pun">==</span><span class="pln"> </span><span class="str">'''Dear Grace Hopper,

We are pleased to inform you that your paper entitled
'</span><span class="typ">Groovy</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> COBOL programmers</span><span class="str">' was accepted.

The conference committee.'''</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gstringtemplateengine"><a class="anchor" href="#_gstringtemplateengine"></a>3.12.5. GStringTemplateEngine</h4>
<div class="paragraph">
<p>As an example of using the <code>GStringTemplateEngine</code>, here 
is the example above done again (with a few changes to show some other 
options). First we will store the template in a file this time:</p>
</div>
<div class="listingblock">
<div class="title">test.template</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Dear</span><span class="pln"> </span><span class="str">"$firstname $lastname"</span><span class="pun">,</span><span class="pln">
</span><span class="typ">So</span><span class="pln"> nice to meet you </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">&lt;%</span><span class="pln"> </span><span class="kwd">out</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">city </span><span class="pun">==</span><span class="pln"> </span><span class="str">"New York"</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">"\\"</span><span class="typ">The</span><span class="pln"> </span><span class="typ">Big</span><span class="pln"> </span><span class="typ">Apple</span><span class="pln">\\</span><span class="str">""</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> city</span><span class="pun">)</span><span class="pln"> </span><span class="pun">%&gt;.</span><span class="pln">
</span><span class="typ">See</span><span class="pln"> you </span><span class="kwd">in</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">month</span><span class="pun">},</span><span class="pln">
$</span><span class="pun">{</span><span class="kwd">signed</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we used <code>out</code> instead of <code>print</code> to support the streaming nature of <code>GStringTemplateEngine</code>. Because we have the template in a separate file, there is no need to escape the backslashes. Here is how we call it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="str">'test.template'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> engine </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">text</span><span class="pun">.</span><span class="typ">GStringTemplateEngine</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">template</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> engine</span><span class="pun">.</span><span class="pln">createTemplate</span><span class="pun">(</span><span class="pln">f</span><span class="pun">).</span><span class="pln">make</span><span class="pun">(</span><span class="pln">binding</span><span class="pun">)</span><span class="pln">
println </span><span class="kwd">template</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Dear "Sam Pullara",
So nice to meet you in "The Big Apple".
See you in December,
Groovy-Dev</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xmltemplateengine"><a class="anchor" href="#_xmltemplateengine"></a>3.12.6. XmlTemplateEngine</h4>
<div class="paragraph">
<p><code>XmlTemplateEngine</code> for use in templating scenarios where 
both the template source and the expected output are intended to be XML.
 Templates may use the normal <code>${expression}</code> and <code>$variable</code> notations to insert an arbitrary expression into the template. In addition, support is also provided for special tags: <code>&lt;gsp:scriptlet&gt;</code> (for inserting code fragments) and <code>&lt;gsp:expression&gt;</code> (for code fragments which produce output).</p>
</div>
<div class="paragraph">
<p>Comments and processing instructions will be removed as part of processing and special XML characters such as <code>&lt;</code>, <code>&gt;</code>, <code>"</code> and <code>'</code> will be escaped using the respective XML notation. The output will also be indented using standard XML pretty printing.</p>
</div>
<div class="paragraph">
<p>The xmlns namespace definition for gsp: tags will be removed but 
other namespace definitions will be preserved (but may change to an 
equivalent position within the XML tree).</p>
</div>
<div class="paragraph">
<p>Normally, the template source will be in a file but here is a simple example providing the XML template as a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> binding </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">firstname</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Jochen'</span><span class="pun">,</span><span class="pln"> lastname</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Theodorou'</span><span class="pun">,</span><span class="pln"> nickname</span><span class="pun">:</span><span class="pln"> </span><span class="str">'blackdrag'</span><span class="pun">,</span><span class="pln"> salutation</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Dear'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> engine </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">text</span><span class="pun">.</span><span class="typ">XmlTemplateEngine</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> text </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''\
    &lt;document xmlns:gsp='</span><span class="pln">http</span><span class="pun">:</span><span class="com">//groovy.codehaus.org/2005/gsp' xmlns:foo='baz' type='letter'&gt;</span><span class="pln">
        </span><span class="pun">&lt;</span><span class="pln">gsp</span><span class="pun">:</span><span class="pln">scriptlet</span><span class="pun">&gt;</span><span class="kwd">def</span><span class="pln"> greeting </span><span class="pun">=</span><span class="pln"> </span><span class="str">"${salutation}est"</span><span class="pun">&lt;/</span><span class="pln">gsp</span><span class="pun">:</span><span class="pln">scriptlet</span><span class="pun">&gt;</span><span class="pln">
        </span><span class="pun">&lt;</span><span class="pln">gsp</span><span class="pun">:</span><span class="pln">expression</span><span class="pun">&gt;</span><span class="pln">greeting</span><span class="pun">&lt;/</span><span class="pln">gsp</span><span class="pun">:</span><span class="pln">expression</span><span class="pun">&gt;</span><span class="pln">
        </span><span class="pun">&lt;</span><span class="pln">foo</span><span class="pun">:</span><span class="pln">to</span><span class="pun">&gt;</span><span class="pln">$firstname </span><span class="str">"$nickname"</span><span class="pln"> $lastname</span><span class="pun">&lt;/</span><span class="pln">foo</span><span class="pun">:</span><span class="pln">to</span><span class="pun">&gt;</span><span class="pln">
        </span><span class="typ">How</span><span class="pln"> are you today</span><span class="pun">?</span><span class="pln">
    </span><span class="pun">&lt;/</span><span class="pln">document</span><span class="pun">&gt;</span><span class="pln">
</span><span class="str">'''
def template = engine.createTemplate(text).make(binding)
println template.toString()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example will produce this output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;document</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">'letter'</span><span class="tag">&gt;</span><span class="pln">
  Dearest
  </span><span class="tag">&lt;foo:to</span><span class="pln"> </span><span class="atn">xmlns:foo</span><span class="pun">=</span><span class="atv">'baz'</span><span class="tag">&gt;</span><span class="pln">
    Jochen &amp;quot;blackdrag&amp;quot; Theodorou
  </span><span class="tag">&lt;/foo:to&gt;</span><span class="pln">
  How are you today?
</span><span class="tag">&lt;/document&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_markuptemplateengine"><a class="anchor" href="#_the_markuptemplateengine"></a>3.12.7. The MarkupTemplateEngine</h4>
<div class="paragraph">
<p>This template engine is a template engine primarily aimed at generating XML-like markup (XML, XHTML, HTML5, …​), but that
can be used to generate any text based content. Unlike traditional template engines, this one relies on a DSL that uses the
builder syntax. Here is a sample template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">xmlDeclaration</span><span class="pun">()</span><span class="pln">
cars </span><span class="pun">{</span><span class="pln">
   cars</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln">
       car</span><span class="pun">(</span><span class="pln">make</span><span class="pun">:</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">make</span><span class="pun">,</span><span class="pln"> model</span><span class="pun">:</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">model</span><span class="pun">)</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you feed it with the following model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">model </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">cars</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln">make</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Peugeot'</span><span class="pun">,</span><span class="pln"> model</span><span class="pun">:</span><span class="pln"> </span><span class="str">'508'</span><span class="pun">),</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Car</span><span class="pun">(</span><span class="pln">make</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Toyota'</span><span class="pun">,</span><span class="pln"> model</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Prius'</span><span class="pun">)]]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It would be rendered as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">'1.0'</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;cars&gt;&lt;car</span><span class="pln"> </span><span class="atn">make</span><span class="pun">=</span><span class="atv">'Peugeot'</span><span class="pln"> </span><span class="atn">model</span><span class="pun">=</span><span class="atv">'508'</span><span class="tag">/&gt;&lt;car</span><span class="pln"> </span><span class="atn">make</span><span class="pun">=</span><span class="atv">'Toyota'</span><span class="pln"> </span><span class="atn">model</span><span class="pun">=</span><span class="atv">'Prius'</span><span class="tag">/&gt;&lt;/cars&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The key features of this template engine are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <em>markup builder like</em> syntax</p>
</li>
<li>
<p>templates are compiled into bytecode</p>
</li>
<li>
<p>fast rendering</p>
</li>
<li>
<p>optional type checking of the model</p>
</li>
<li>
<p>includes</p>
</li>
<li>
<p>internationalization support</p>
</li>
<li>
<p>fragments/layouts</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_the_template_format"><a class="anchor" href="#_the_template_format"></a>The template format</h5>
<div class="sect5">
<h6 id="_basics"><a class="anchor" href="#_basics"></a>Basics</h6>
<div class="paragraph">
<p>Templates consist of Groovy code. Let’s explore the first example more thoroughly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">xmlDeclaration</span><span class="pun">()</span><span class="pln">                                </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
cars </span><span class="pun">{</span><span class="pln">                                          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
   cars</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln">                                  </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
       car</span><span class="pun">(</span><span class="pln">make</span><span class="pun">:</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">make</span><span class="pun">,</span><span class="pln"> model</span><span class="pun">:</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">model</span><span class="pun">)</span><span class="pln">      </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
   </span><span class="pun">}</span><span class="pln">                                            </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>renders the XML declaration string.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>opens a <code>cars</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>cars</code> is a variable found in the <em>template model</em>, which is a list of <code>Car</code> instances</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>for each item, we create a <code>car</code> tag with the attributes from the <code>Car</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>closes the <code>cars</code> tag</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As you can see, regular Groovy code can be used in the template. Here, we are calling <code>each</code> on a list (retrieved from the model), allowing us to
render one <code>car</code> tag per entry.</p>
</div>
<div class="paragraph">
<p>In a similar fashion, rendering HTML code is as simple as this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">yieldUnescaped </span><span class="str">'&lt;!DOCTYPE html&gt;'</span><span class="pln">                                                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
html</span><span class="pun">(</span><span class="pln">lang</span><span class="pun">:</span><span class="str">'en'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                                                                   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    head </span><span class="pun">{</span><span class="pln">                                                                          </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        meta</span><span class="pun">(</span><span class="str">'http-equiv'</span><span class="pun">:</span><span class="str">'"Content-Type" content="text/html; charset=utf-8"'</span><span class="pun">)</span><span class="pln">      </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
        title</span><span class="pun">(</span><span class="str">'My page'</span><span class="pun">)</span><span class="pln">                                                            </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">                                                                               </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
    body </span><span class="pun">{</span><span class="pln">                                                                          </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
        p</span><span class="pun">(</span><span class="str">'This is an example of HTML contents'</span><span class="pun">)</span><span class="pln">                                    </span><i class="conum" data-value="8"></i><b><span class="pun">(</span><span class="lit">8</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">                                                                               </span><i class="conum" data-value="9"></i><b><span class="pun">(</span><span class="lit">9</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">                                                                                   </span><i class="conum" data-value="10"></i><b><span class="pun">(</span><span class="lit">10</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>renders the HTML doctype special tag</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>opens the <code>html</code> tag with an attribute</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>opens the <code>head</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>renders a <code>meta</code> tag with one <code>http-equiv</code> attribute</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>renders the <code>title</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>closes the <code>head</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>opens the <code>body</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>renders a <code>p</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>closes the <code>body</code> tag</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>closes the <code>html</code> tag</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The output is straightforward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="dec">&lt;!DOCTYPE html&gt;</span><span class="tag">&lt;html</span><span class="pln"> </span><span class="atn">lang</span><span class="pun">=</span><span class="atv">'en'</span><span class="tag">&gt;&lt;head&gt;&lt;meta</span><span class="pln"> </span><span class="atn">http-equiv</span><span class="pun">=</span><span class="atv">'"Content-Type" content="text/html; charset=utf-8"'</span><span class="tag">/&gt;&lt;title&gt;</span><span class="pln">My page</span><span class="tag">&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;</span><span class="pln">This is an example of HTML contents</span><span class="tag">&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
With some <a href="#markuptemplate-config">configuration</a>, you can have the output pretty printed, with newlines and indent automatically added.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_support_methods"><a class="anchor" href="#_support_methods"></a>Support methods</h6>
<div class="paragraph">
<p>In the previous example, the doctype declaration was rendered using the <code>yieldUnescaped</code> method. We have also seen the <code>xmlDeclaration</code> method.
The template engine provides several support methods that will help you render contents appropriately:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16%;">
<col style="width: 33%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yield</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders contents, but escapes it before rendering</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">yield</span><span class="pln"> </span><span class="str">'Some text with &lt;angle brackets&gt;'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pln">Some text with &amp;lt;angle brackets&amp;gt;</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yieldUnescaped</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders raw contents. The argument is rendered as is, without escaping.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">yieldUnescaped </span><span class="str">'Some text with &lt;angle brackets&gt;'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pln">Some text with </span><span class="tag">&lt;angle</span><span class="pln"> </span><span class="atn">brackets</span><span class="tag">&gt;</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xmlDeclaration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders an XML declaration String. If the encoding is specified in the configuration, it is written in the declaration.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">xmlDeclaration</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">'1.0'</span><span class="pun">?&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>TemplateConfiguration#getDeclarationEncoding</code> is not null:</p>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">'1.0'</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">'UTF-8'</span><span class="pun">?&gt;</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">comment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders raw contents inside an XML comment</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">comment </span><span class="str">'This is &lt;a href="foo.html"&gt;commented out&lt;/a&gt;'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="com">&lt;!--This is &lt;a href="foo.html"&gt;commented out&lt;/a&gt;--&gt;</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">newLine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders a new line. See also <code>TemplateConfiguration#setAutoNewLine</code> and <code>TemplateConfiguration#setNewLineString</code>.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">p</span><span class="pun">(</span><span class="str">'text'</span><span class="pun">)</span><span class="pln">
newLine</span><span class="pun">()</span><span class="pln">
p</span><span class="pun">(</span><span class="str">'text on new line'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;p&gt;</span><span class="pln">text</span><span class="tag">&lt;/p&gt;</span><span class="pln">
</span><span class="tag">&lt;p&gt;</span><span class="pln">text on new line</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Renders an XML processing instruction.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">pi</span><span class="pun">(</span><span class="str">"xml-stylesheet"</span><span class="pun">:[</span><span class="pln">href</span><span class="pun">:</span><span class="str">"mystyle.css"</span><span class="pun">,</span><span class="pln"> type</span><span class="pun">:</span><span class="str">"text/css"</span><span class="pun">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span class="pln">xml</span><span class="pun">-</span><span class="pln">stylesheet href</span><span class="pun">=</span><span class="str">'mystyle.css'</span><span class="pln"> type</span><span class="pun">=</span><span class="str">'text/css'</span><span class="pun">?&gt;</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tryEscape</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns an escaped string for an object, if it is a <code>String</code> (or any type derived from <code>CharSequence</code>). Otherwise returns the object itself.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">yieldUnescaped tryEscape</span><span class="pun">(</span><span class="str">'Some text with &lt;angle brackets&gt;'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pln">Some text with &amp;lt;angle brackets&amp;gt;</span></code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="_includes"><a class="anchor" href="#_includes"></a>Includes</h6>
<div class="paragraph">
<p>The <code>MarkupTemplateEngine</code> supports inclusion of contents from another file. Included contents may be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>another template</p>
</li>
<li>
<p>raw contents</p>
</li>
<li>
<p>contents to be escaped</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Including another template can be done using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">include </span><span class="kwd">template</span><span class="pun">:</span><span class="pln"> </span><span class="str">'other_template.tpl'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Including a file as raw contents, without escaping it, can be done like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">include unescaped</span><span class="pun">:</span><span class="pln"> </span><span class="str">'raw.txt'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Eventually, inclusion of text that should be escaped before rendering can be done using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">include escaped</span><span class="pun">:</span><span class="pln"> </span><span class="str">'to_be_escaped.txt'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can use the following helper methods instead:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>includeGroovy(&lt;name&gt;)</code> to include another template</p>
</li>
<li>
<p><code>includeEscaped(&lt;name&gt;)</code> to include another file with escaping</p>
</li>
<li>
<p><code>includeUnescaped(&lt;name&gt;)</code> to include another file without escaping</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Calling those methods instead of the <code>include xxx:</code> syntax can be useful if the name of the file to be included is dynamic (stored in a variable for example).
Files to be included (independently of their type, template or text) are found on <strong>classpath</strong>. This is one of the reasons why the <code>MarkupTemplateEngine</code> takes
an optional <code>ClassLoader</code> as constructor argument (the other reason being that you can include code referencing other classes in a template).</p>
</div>
<div class="paragraph">
<p>If you don’t want your templates to be on classpath, the <code>MarkupTemplateEngine</code> accepts a convenient constructor that lets you define the directory where
templates are to be found.</p>
</div>
</div>
<div class="sect5">
<h6 id="_fragments"><a class="anchor" href="#_fragments"></a>Fragments</h6>
<div class="paragraph">
<p>Fragments are nested templates. They can be used to provide improved composition in a single template. A fragment consists of
a string, the inner template, and a model, used to render this template. Consider the following template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">ul </span><span class="pun">{</span><span class="pln">
    pages</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln">
        fragment </span><span class="str">"li(line)"</span><span class="pun">,</span><span class="pln"> line</span><span class="pun">:</span><span class="pln">it
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>fragment</code> element creates a nested template, and renders it with a model which is specific to this template. Here,
we have the <code>li(line)</code> fragment, where <code>line</code> is bound to <code>it</code>. Since <code>it</code> corresponds to the iteration of <code>pages</code>,
we will generate a single <code>li</code> element for each page in our model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;ul&gt;&lt;li&gt;</span><span class="pln">Page 1</span><span class="tag">&lt;/li&gt;&lt;li&gt;</span><span class="pln">Page 2</span><span class="tag">&lt;/li&gt;&lt;/ul&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Fragments are interesting to factorize template elements. They come 
at the price of the compilation of a fragment per template, and they 
cannot
be externalized.</p>
</div>
</div>
<div class="sect5">
<h6 id="_layouts"><a class="anchor" href="#_layouts"></a>Layouts</h6>
<div class="paragraph">
<p>Layouts, unlike fragments, refer to other templates. They can be used
 to compose templates and share common structures. This is often
interesting if you have, for example, a common HTML page setup, and that
 you only want to replace the body. This can be done easily
with a <em>layout</em>. First of all, you need to create a layout template:</p>
</div>
<div class="listingblock">
<div class="title">layout-main.tpl</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">html </span><span class="pun">{</span><span class="pln">
    head </span><span class="pun">{</span><span class="pln">
        title</span><span class="pun">(</span><span class="pln">title</span><span class="pun">)</span><span class="pln">                </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    body </span><span class="pun">{</span><span class="pln">
        bodyContents</span><span class="pun">()</span><span class="pln">              </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>title</code> variable (inside the title tag) is a layout variable</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>bodyContents</code> call will render the body</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Then what you need is a template that includes the layout:</p>
</div>
<div id="example-layout-simple" class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">layout </span><span class="str">'layout-main.tpl'</span><span class="pun">,</span><span class="pln">                                   </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    title</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Layout example'</span><span class="pun">,</span><span class="pln">                                </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    bodyContents</span><span class="pun">:</span><span class="pln"> contents </span><span class="pun">{</span><span class="pln"> p</span><span class="pun">(</span><span class="str">'This is the body'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">        </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use the <code>main-layout.tpl</code> layout file</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set the <code>title</code> variable</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>set the <code>bodyContents</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As you can see, <code>bodyContents</code> will be rendered inside the layout, thanks to the <code>bodyContents()</code> call in the layout file. As
a result, the template will be rendered as this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;html&gt;&lt;head&gt;&lt;title&gt;</span><span class="pln">Layout example</span><span class="tag">&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;</span><span class="pln">This is the body</span><span class="tag">&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The call to the <code>contents</code> method is used to tell the template engine that the block of code is in fact a specification of a
template, instead of a helper function to be rendered directly. If you don’t add <code>contents</code>
 before your specification, then
the contents would be rendered, but you would also see a random string 
generated, corresponding to the result value of the block.</p>
</div>
<div class="paragraph">
<p>Layouts are a powerful way to share common elements across multiple
templates, without having to rewrite everything or use includes.</p>
</div>
<div class="paragraph">
<p>Layouts use, by default, a model which is independent from the model of the page where they are used. It is however possible
to make them inherit from the parent model. Imagine that the model is defined like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">model </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">Object</span><span class="pun">&gt;();</span><span class="pln">
model</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">'title'</span><span class="pun">,</span><span class="str">'Title from main model'</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and the following template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">layout </span><span class="str">'layout-main.tpl'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">                             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    bodyContents</span><span class="pun">:</span><span class="pln"> contents </span><span class="pun">{</span><span class="pln"> p</span><span class="pun">(</span><span class="str">'This is the body'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>note the use of <code>true</code> to enable model inheritance</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>then it is not necessary to pass the <code>title</code> value to the layout as in the <a href="#example-layout-simple">previous example</a>. The result will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;html&gt;&lt;head&gt;&lt;title&gt;</span><span class="pln">Title from main model</span><span class="tag">&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;</span><span class="pln">This is the body</span><span class="tag">&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But it is also possible to override a value from the parent model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">layout </span><span class="str">'layout-main.tpl'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">                             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    title</span><span class="pun">:</span><span class="pln"> </span><span class="str">'overridden title'</span><span class="pun">,</span><span class="pln">                               </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    bodyContents</span><span class="pun">:</span><span class="pln"> contents </span><span class="pun">{</span><span class="pln"> p</span><span class="pun">(</span><span class="str">'This is the body'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>true</code> means inherit from the parent model</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>but <code>title</code> is overridden</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>then the output will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;html&gt;&lt;head&gt;&lt;title&gt;</span><span class="pln">overridden title</span><span class="tag">&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;</span><span class="pln">This is the body</span><span class="tag">&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rendering_contents"><a class="anchor" href="#_rendering_contents"></a>Rendering contents</h5>
<div class="sect5">
<h6 id="_creation_of_a_template_engine"><a class="anchor" href="#_creation_of_a_template_engine"></a>Creation of a template engine</h6>
<div class="paragraph">
<p>On the server side, rendering templates require an instance of <code>groovy.text.markup.MarkupTemplateEngine</code> and a
<code>groovy.text.markup.TemplateConfiguration</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">TemplateConfiguration</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TemplateConfiguration</span><span class="pun">();</span><span class="pln">         </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">MarkupTemplateEngine</span><span class="pln"> engine </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MarkupTemplateEngine</span><span class="pun">(</span><span class="pln">config</span><span class="pun">);</span><span class="pln">     </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">Template</span><span class="pln"> template </span><span class="pun">=</span><span class="pln"> engine</span><span class="pun">.</span><span class="pln">createTemplate</span><span class="pun">(</span><span class="str">"p('test template')"</span><span class="pun">);</span><span class="pln">    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">&gt;</span><span class="pln"> model </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;&gt;();</span><span class="pln">                        </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">Writable</span><span class="pln"> output </span><span class="pun">=</span><span class="pln"> template</span><span class="pun">.</span><span class="pln">make</span><span class="pun">(</span><span class="pln">model</span><span class="pun">);</span><span class="pln">                             </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
output</span><span class="pun">.</span><span class="pln">writeTo</span><span class="pun">(</span><span class="pln">writer</span><span class="pun">);</span><span class="pln">                                             </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>creates a template configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>creates a template engine with this configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>creates a template instance from a <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>creates a model to be used in the template</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>bind the model to the template instance</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>render output</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>There are several possible options to parse templates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>from a <code>String</code>, using <code>createTemplate(String)</code></p>
</li>
<li>
<p>from a <code>Reader</code>, using <code>createTemplate(Reader)</code></p>
</li>
<li>
<p>from a <code>URL</code>, using <code>createTemplate(URL)</code></p>
</li>
<li>
<p>given a template name, using <code>createTemplateByPath(String)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The last version should in general be preferred:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Template</span><span class="pln"> </span><span class="kwd">template</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> engine</span><span class="pun">.</span><span class="pln">createTemplateByPath</span><span class="pun">(</span><span class="str">"main.tpl"</span><span class="pun">);</span><span class="pln">
</span><span class="typ">Writable</span><span class="pln"> output </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">template</span><span class="pun">.</span><span class="pln">make</span><span class="pun">(</span><span class="pln">model</span><span class="pun">);</span><span class="pln">
output</span><span class="pun">.</span><span class="pln">writeTo</span><span class="pun">(</span><span class="pln">writer</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-config"><a class="anchor" href="#markuptemplate-config"></a>Configuration options</h6>
<div class="paragraph">
<p>The behavior of the engine can be tweaked with several configuration options accessible through the <code>TemplateConfiguration</code> class:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 28%;">
<col style="width: 42%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">declarationEncoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the value of the encoding to be written when <code>xmlDeclaration</code> is called. It does <strong>not</strong> influence the writer you are using as output.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">xmlDeclaration</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">'1.0'</span><span class="pun">?&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>TemplateConfiguration#getDeclarationEncoding</code> is not null:</p>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">'1.0'</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">'UTF-8'</span><span class="pun">?&gt;</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">expandEmptyElements</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, empty tags are rendered in their expanded form.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">p</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;p/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>expandEmptyElements</code> is true:</p>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;p&gt;&lt;/p&gt;</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useDoubleQuotes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, use double quotes for attributes instead of simple quotes</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">tag</span><span class="pun">(</span><span class="pln">attr</span><span class="pun">:</span><span class="str">'value'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;tag</span><span class="pln"> </span><span class="atn">attr</span><span class="pun">=</span><span class="atv">'value'</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>useDoubleQuotes</code> is true:</p>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;tag</span><span class="pln"> </span><span class="atn">attr</span><span class="pun">=</span><span class="atv">"value"</span><span class="tag">/&gt;</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">newLineString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System default (system property <code>line.separator</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows to choose what string is used when a new line is rendered</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><strong>Template</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">p</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">)</span><span class="pln">
newLine</span><span class="pun">()</span><span class="pln">
p</span><span class="pun">(</span><span class="str">'baz'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>newLineString='BAR'</code>:</p>
</div>
<div class="paragraph">
<p><strong>Output</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;p&gt;</span><span class="pln">foo</span><span class="tag">&lt;/p&gt;</span><span class="pln">BAR</span><span class="tag">&lt;p&gt;</span><span class="pln">baz</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoEscape</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, variables from models are automatically escaped before rendering.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>See <a href="#markuptemplate-autoescape">the auto escape section</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoIndent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, performs automatic indentation after new lines</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>See <a href="#markuptemplate-autoformat">the auto formatting section</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoIndentString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">four (4) spaces</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The string to be used as indent.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>See <a href="#markuptemplate-autoformat">the auto formatting section</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoNewLine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, performs automatic insertion of new lines</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>See <a href="#markuptemplate-autoformat">the auto formatting section</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">baseTemplateClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>groovy.text.markup.BaseTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the super class of compiled templates. This can be used to provide application specific templates.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>See <a href="#markuptemplate-basetemplate">the custom templates section</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default locale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the default locale for templates.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>See <a href="#markuptemplate-i18n">the internationalization section</a></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Once the template engine has been created, it is <strong>unsafe</strong> to change the configuration.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-autoformat"><a class="anchor" href="#markuptemplate-autoformat"></a>Automatic formatting</h6>
<div class="paragraph">
<p>By default, the template engine will render output without any specific formatting. Some <a href="#markuptemplate-config">configuration options</a> can improve the situation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>autoIndent</code> is responsible for auto-indenting after a new line is inserted</p>
</li>
<li>
<p><code>autoNewLine</code> is responsible for automatically inserting new lines based on the original formatting of the template source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In general, it is recommended to set both <code>autoIndent</code> and <code>autoNewLine</code> to true if you want human-readable, pretty printed, output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">config</span><span class="pun">.</span><span class="pln">setAutoNewLine</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">setAutoIndent</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the following template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">html </span><span class="pun">{</span><span class="pln">
    head </span><span class="pun">{</span><span class="pln">
        title</span><span class="pun">(</span><span class="str">'Title'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will now be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;html&gt;</span><span class="pln">
    </span><span class="tag">&lt;head&gt;</span><span class="pln">
        </span><span class="tag">&lt;title&gt;</span><span class="pln">Title</span><span class="tag">&lt;/title&gt;</span><span class="pln">
    </span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can slightly change the template so that the <code>title</code> instruction is found on the same line as the <code>head</code> one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">html </span><span class="pun">{</span><span class="pln">
    head </span><span class="pun">{</span><span class="pln"> title</span><span class="pun">(</span><span class="str">'Title'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the output will reflect that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;html&gt;</span><span class="pln">
    </span><span class="tag">&lt;head&gt;&lt;title&gt;</span><span class="pln">Title</span><span class="tag">&lt;/title&gt;</span><span class="pln">
    </span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>New lines are <strong>only</strong> inserted where curly braces for 
tags are found, and the insertion corresponds to where the nested 
content is found. This means that
tags in the body of another tag will <strong>not</strong> trigger new lines unless they use curly braces themselves:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">html </span><span class="pun">{</span><span class="pln">
    head </span><span class="pun">{</span><span class="pln">
        meta</span><span class="pun">(</span><span class="pln">attr</span><span class="pun">:</span><span class="str">'value'</span><span class="pun">)</span><span class="pln">          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        title</span><span class="pun">(</span><span class="str">'Title'</span><span class="pun">)</span><span class="pln">              </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        newLine</span><span class="pun">()</span><span class="pln">                   </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        meta</span><span class="pun">(</span><span class="pln">attr</span><span class="pun">:</span><span class="str">'value2'</span><span class="pun">)</span><span class="pln">         </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a new line is inserted because <code>meta</code> is not on the same line as <code>head</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>no new line is inserted, because we’re on the same depth as the previous tag</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we can force rendering of a new line by explicitly calling <code>newLine</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and this tag will be rendered on a separate line</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This time, the output will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;html&gt;</span><span class="pln">
    </span><span class="tag">&lt;head&gt;</span><span class="pln">
        </span><span class="tag">&lt;meta</span><span class="pln"> </span><span class="atn">attr</span><span class="pun">=</span><span class="atv">'value'</span><span class="tag">/&gt;&lt;title&gt;</span><span class="pln">Title</span><span class="tag">&lt;/title&gt;</span><span class="pln">
        </span><span class="tag">&lt;meta</span><span class="pln"> </span><span class="atn">attr</span><span class="pun">=</span><span class="atv">'value2'</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/head&gt;</span><span class="pln">
</span><span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the renderer uses four(4) spaces as indent, but you can change it by setting the <code>TemplateConfiguration#autoIndentString</code> property.</p>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-autoescape"><a class="anchor" href="#markuptemplate-autoescape"></a>Automatic escaping</h6>
<div class="paragraph">
<p>By default, contents which is read from the model is rendered <strong>as is</strong>.
 If this contents comes from user input, it can be sensible, and you 
might
want to escape it by default, for example to avoid XSS injection. For 
that, the template configuration provides an option which will 
automatically
escape objects from the model, as long as they inherit from <code>CharSequence</code> (typically, `String`s).</p>
</div>
<div class="paragraph">
<p>Let’s imagine the following setup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">config</span><span class="pun">.</span><span class="pln">setAutoEscape</span><span class="pun">(</span><span class="kwd">false</span><span class="pun">);</span><span class="pln">
model </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">Object</span><span class="pun">&gt;();</span><span class="pln">
model</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"unsafeContents"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"I am an &lt;html&gt; hacker."</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and the following template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">html </span><span class="pun">{</span><span class="pln">
    body </span><span class="pun">{</span><span class="pln">
        div</span><span class="pun">(</span><span class="pln">unsafeContents</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you wouldn’t want the HTML from <code>unsafeContents</code> to be rendered as is, because of potential security issues:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;html&gt;&lt;body&gt;&lt;div&gt;</span><span class="pln">I am an </span><span class="tag">&lt;html&gt;</span><span class="pln"> hacker.</span><span class="tag">&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Automatic escaping will fix this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">config</span><span class="pun">.</span><span class="pln">setAutoEscape</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And now the output is properly escaped:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;html&gt;&lt;body&gt;&lt;div&gt;</span><span class="pln">I am an &amp;lt;html&amp;gt; hacker.</span><span class="tag">&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that using automatic escaping doesn’t prevent you from including
 unescaped contents from the model. To do this, your template should 
then explicitly
mention that a model variable should not be escaped by prefixing it with
 <code>unescaped.</code>, like in this example:</p>
</div>
<div class="listingblock">
<div class="title">Explicit bypass of automatic escaping</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pln">html {
    body {
        div(unescaped.unsafeContents)
    }
}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-gotchas"><a class="anchor" href="#markuptemplate-gotchas"></a>Common gotchas</h6>
<div class="sect6">
<h7 id="_strings_containing_markup"><a class="anchor" href="#_strings_containing_markup"></a>Strings containing markup</h7>
<div class="paragraph">
<p>Say that you want to generate a <code>&lt;p&gt;</code> tag which contains a string containing markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">p </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">yield</span><span class="pln"> </span><span class="str">"This is a "</span><span class="pln">
    a</span><span class="pun">(</span><span class="pln">href</span><span class="pun">:</span><span class="str">'target.html'</span><span class="pun">,</span><span class="pln"> </span><span class="str">"link"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">yield</span><span class="pln"> </span><span class="str">" to another page"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and generates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="tag">&lt;p&gt;</span><span class="pln">This is a </span><span class="tag">&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">'target.html'</span><span class="tag">&gt;</span><span class="pln">link</span><span class="tag">&lt;/a&gt;</span><span class="pln"> to another page</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Can’t this be written shorter? A naive alternative would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">p </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">yield</span><span class="pln"> </span><span class="str">"This is a ${a(href:'target.html', "</span><span class="pln">link</span><span class="str">")} to another page"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>but the result will not look as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="tag">&lt;p&gt;&lt;a</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">'target.html'</span><span class="tag">&gt;</span><span class="pln">link</span><span class="tag">&lt;/a&gt;</span><span class="pln">This is a  to another page</span><span class="tag">&lt;/p&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The reason is that the markup template engine is a <em>streaming</em> engine. In the original version, the first <code>yield</code> call
generates a string which is streamed to the output, then the <code>a</code> link is generated and streamed, and then the last <code>yield</code>
call is streamed, leading in an execution <strong>in order</strong>. But with the string version above, the order of execution is different:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>yield</code> call requires an argument, a <em>string</em></p>
</li>
<li>
<p>that arguments needs to be evaluated <em>before</em> the <em>yield</em> call is generated</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>so evaluating the string leads to an execution of the <code>a(href:…​)</code> call <strong>before</strong> <code>yield</code> is itself called. This is not
what you want to do. Instead, you want to generate a <em>string</em> which contains markup, which is then passed to the <code>yield</code>
call. This can be done this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">p</span><span class="pun">(</span><span class="str">"This is a ${stringOf {a(href:'target.html', "</span><span class="pln">link</span><span class="str">")}} to another page"</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>stringOf</code> call, which basically tells the markup template engine that the underlying markup needs to be rendered
separately and exported as a string. Note that for simple expressions, <code>stringOf</code> can be replaced by an alternate tag
notation that starts with a <em>dollar</em> sign:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">p</span><span class="pun">(</span><span class="str">"This is a ${$a(href:'target.html', "</span><span class="pln">link</span><span class="str">")} to another page"</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is worth noting that using <code>stringOf</code> or the special <code>$tag</code> notation triggers the creation of a distinct string writer
which is then used to render the markup. It is slower than using the version with calls to <code>yield</code> which perform direct
streaming of the markup instead.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-i18n"><a class="anchor" href="#markuptemplate-i18n"></a>Internationalization</h6>
<div class="paragraph">
<p>The template engine has native support for internationalization. For that, when you create the <code>TemplateConfiguration</code>, you can provide
a <code>Locale</code> which is the default locale to be used for templates. Each template may have different versions, one for each locale. The
name of the template makes the difference:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>file.tpl</code>: default template file</p>
</li>
<li>
<p><code>file_fr_FR.tpl</code>: french version of the template</p>
</li>
<li>
<p><code>file_en_US.tpl</code>: american english version of the template</p>
</li>
<li>
<p>…​</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a template is rendered or included, then:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the template name or include name <strong>explicitly</strong> sets a locale, the <strong>specific</strong> version is included, or the default version if not found</p>
</li>
<li>
<p>if the template name doesn’t include a locale, the version for the <code>TemplateConfiguration</code> locale is used, or the default version if not found</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, imagine the default locale is set to <code>Locale.ENGLISH</code> and that the main template includes:</p>
</div>
<div class="listingblock">
<div class="title">Use an explicit locale in include</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">include </span><span class="kwd">template</span><span class="pun">:</span><span class="pln"> </span><span class="str">'locale_include_fr_FR.tpl'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>then the template is rendered using the specific template:</p>
</div>
<div class="listingblock">
<div class="title">Bypass the template configuration</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pln">Texte en français</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using an include without specifying a locale will make the template 
engine look for a template with the configured locale, and if not, 
fallback to the default, like here:</p>
</div>
<div class="listingblock">
<div class="title">Don’t use a locale in include</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">include </span><span class="kwd">template</span><span class="pun">:</span><span class="pln"> </span><span class="str">'locale_include.tpl'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Fallback to the default template</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pln">Default text</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, changing the default locale of the template engine to <code>Locale.FRANCE</code> will change the output, because the template engine will now look for a file
with the <code>fr_FR</code> locale:</p>
</div>
<div class="listingblock">
<div class="title">Don’t fallback to the default template because a locale specific template was found</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-html" data-lang="html"><span class="pln">Texte en français</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This strategy lets you translate your templates one by one, by 
relying on default templates, for which no locale is set in the file 
name.</p>
</div>
</div>
<div class="sect5">
<h6 id="markuptemplate-basetemplate"><a class="anchor" href="#markuptemplate-basetemplate"></a>Custom template classes</h6>
<div class="paragraph">
<p>By default, templates created inherit the <code>groovy.text.markup.BaseTemplate</code>
 class. It may be interesting for an application to provide a different
template class, for example to provide additional helper methods which 
are aware of the application, or customized rendering primitives (for 
HTML,
for example).</p>
</div>
<div class="paragraph">
<p>The template engine provides this ability by setting an alternative <code>baseTemplateClass</code> in the <code>TemplateConfiguration</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">config</span><span class="pun">.</span><span class="pln">setBaseTemplateClass</span><span class="pun">(</span><span class="typ">MyTemplate</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom base class has to extend <code>BaseClass</code> like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyTemplate</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">BaseTemplate</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Module</span><span class="pun">&gt;</span><span class="pln"> modules
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">MyTemplate</span><span class="pun">(</span><span class="pln">
            </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">MarkupTemplateEngine</span><span class="pln"> templateEngine</span><span class="pun">,</span><span class="pln">
            </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Map</span><span class="pln"> model</span><span class="pun">,</span><span class="pln">
            </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> modelTypes</span><span class="pun">,</span><span class="pln">
            </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">TemplateConfiguration</span><span class="pln"> configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">templateEngine</span><span class="pun">,</span><span class="pln"> model</span><span class="pun">,</span><span class="pln"> modelTypes</span><span class="pun">,</span><span class="pln"> configuration</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Module</span><span class="pun">&gt;</span><span class="pln"> getModules</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> modules
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> setModules</span><span class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Module</span><span class="pun">&gt;</span><span class="pln"> modules</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">modules </span><span class="pun">=</span><span class="pln"> modules
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">boolean</span><span class="pln"> hasModule</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        modules</span><span class="pun">?.</span><span class="pln">any </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> name </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows a class which provides an additional method named <code>hasModule</code>, which can then be used directly in the template:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">hasModule</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    p </span><span class="str">'Found module [foo]'</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    p </span><span class="str">'Module [foo] not found'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_type_checked_templates"><a class="anchor" href="#_type_checked_templates"></a>Type checked templates</h5>
<div class="sect5">
<h6 id="_optional_type_checking"><a class="anchor" href="#_optional_type_checking"></a>Optional type checking</h6>
<div class="paragraph">
<p>Even if templates are not type checked, they are statically compiled.
 This means that once the templates are compiled, performance should be 
very good. For some
applications, it might be good to make sure that templates are valid 
before they are actually rendered. This means failing template 
compilation, for example, if
a method on a model variable doesn’t exist.</p>
</div>
<div class="paragraph">
<p>The <code>MarkupTemplateEngine</code> provides such a facility. 
Templates can be optionally type checked. For that, the developer must 
provide additional information at
template creation time, which is the types of the variables found in the
 model. Imagine a model exposing a list of pages, where a page is 
defined as:</p>
</div>
<div class="listingblock">
<div class="title">Page.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Page</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">Long</span><span class="pln"> id
    </span><span class="typ">String</span><span class="pln"> title
    </span><span class="typ">String</span><span class="pln"> body
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then a list of pages can be exposed in the model, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Page</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Page</span><span class="pun">();</span><span class="pln">
p</span><span class="pun">.</span><span class="pln">setTitle</span><span class="pun">(</span><span class="str">"Sample page"</span><span class="pun">);</span><span class="pln">
p</span><span class="pun">.</span><span class="pln">setBody</span><span class="pun">(</span><span class="str">"Page body"</span><span class="pun">);</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Page</span><span class="pun">&gt;</span><span class="pln"> pages </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LinkedList</span><span class="pun">&lt;&gt;();</span><span class="pln">
pages</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">p</span><span class="pun">);</span><span class="pln">
model </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">Object</span><span class="pun">&gt;();</span><span class="pln">
model</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"pages"</span><span class="pun">,</span><span class="pln"> pages</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A template can use it easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">pages</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> page </span><span class="pun">-&gt;</span><span class="pln">                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    p</span><span class="pun">(</span><span class="str">"Page title: $page.title"</span><span class="pun">)</span><span class="pln">        </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    p</span><span class="pun">(</span><span class="pln">page</span><span class="pun">.</span><span class="pln">text</span><span class="pun">)</span><span class="pln">                        </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>iterate on pages from the model</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>page.title</code> is valid</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>page.text</code> is <strong>not</strong> (should be <code>page.body</code>)</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Without type checking, the compilation of the template succeeds, 
because the template engine doesn’t know about the model until a page
is actually rendered. This means that the problem would only surface at 
runtime, once the page is rendered:</p>
</div>
<div class="listingblock">
<div class="title">Runtime error</div>
<div class="content">
<pre>No such property: text</pre>
</div>
</div>
<div class="paragraph">
<p>In some situations, this can be complicated to sort out or even notice. By declaring the type of the <code>pages</code> to the template engine, we’re now capable of failing at compile time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">modelTypes </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">HashMap</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">String</span><span class="pun">&gt;();</span><span class="pln">                                          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
modelTypes</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"pages"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"List&lt;Page&gt;"</span><span class="pun">);</span><span class="pln">                                              </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="typ">Template</span><span class="pln"> </span><span class="kwd">template</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> engine</span><span class="pun">.</span><span class="pln">createTypeCheckedModelTemplate</span><span class="pun">(</span><span class="str">"main.tpl"</span><span class="pun">,</span><span class="pln"> modelTypes</span><span class="pun">)</span><span class="pln">   </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a map which will hold the model types</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare the type of the <code>pages</code> variables (note the use of a string for the type)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>use <code>createTypeCheckedModelTemplate</code> instead of <code>createTemplate</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This time, when the template is compiled at the last line, an error occurs:</p>
</div>
<div class="listingblock">
<div class="title">Template compilation time error</div>
<div class="content">
<pre>[Static type checking] - No such property: text for class: Page</pre>
</div>
</div>
<div class="paragraph">
<p>This means that you don’t need to wait for the page to be rendered to see an error. The use of <code>createTypeCheckedModelTemplate</code> is mandatory.</p>
</div>
</div>
<div class="sect5">
<h6 id="_alternative_declaration_of_types"><a class="anchor" href="#_alternative_declaration_of_types"></a>Alternative declaration of types</h6>
<div class="paragraph">
<p>Alternatively, if the developer is also the one who writes the 
templates, it is possible to declare the types of the expected variables
directly in the template. In this case, even if you call <code>createTemplate</code>, it will be type checked:</p>
</div>
<div class="listingblock">
<div class="title">Inline declaration of types</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">modelTypes </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Page</span><span class="pun">&gt;</span><span class="pln"> pages                    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">

pages</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> page </span><span class="pun">-&gt;</span><span class="pln">
    p</span><span class="pun">(</span><span class="str">"Page title: $page.title"</span><span class="pun">)</span><span class="pln">
    p</span><span class="pun">(</span><span class="pln">page</span><span class="pun">.</span><span class="pln">text</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>types need to be declared in the <code>modelTypes</code> header</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>declare one variable per object in the model</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_performance_of_type_checked_templates"><a class="anchor" href="#_performance_of_type_checked_templates"></a>Performance of type checked templates</h6>
<div class="paragraph">
<p>An additional interest of using type checked models is that 
performance should improve. By telling the type checker what are the 
expected types,
you also let the compiler generate optimized code for that, so if you 
are looking for the best performance, consider using type checked 
templates.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_solutions"><a class="anchor" href="#_other_solutions"></a>3.12.8. Other solutions</h4>
<div class="paragraph">
<p>Also, there are other templating solutions that can be used along with Groovy, such as <a href="http://freemarker.org/">FreeMarker</a>, <a href="http://velocity.apache.org/">Velocity</a>, <a href="http://stringtemplate.org/">StringTemplate</a> and others.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_servlet_support"><a class="anchor" href="#_servlet_support"></a>3.13. Servlet support</h3>
<div class="paragraph">
<p>You can write (Java) Servlets in Groovy (called Groovlets).</p>
</div>
<div class="paragraph">
<p>There is also a <code>GroovyServlet</code>.</p>
</div>
<div class="paragraph">
<p>This feature will automatically compile your .groovy source files, 
turn them into bytecode, load the Class and cache it until you change 
the source file.</p>
</div>
<div class="paragraph">
<p>Here’s a simple example to show you the kind of things you can do from a Groovlet.</p>
</div>
<div class="paragraph">
<p>Notice the use of implicit variables to access the session, output 
and request. Also notice that this is more like a script as it does not 
have a class wrapper.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">session</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  session </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="pln">getSession</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">session</span><span class="pun">.</span><span class="pln">counter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  session</span><span class="pun">.</span><span class="pln">counter </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

println </span><span class="str">"""
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Groovy Servlet&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;p&gt;
Hello, ${request.remoteHost}: ${session.counter}! ${new Date()}
        &lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
"""</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">counter </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">counter </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, do the same thing using MarkupBuilder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">session</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    session </span><span class="pun">=</span><span class="pln"> request</span><span class="pun">.</span><span class="pln">getSession</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">session</span><span class="pun">.</span><span class="pln">counter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    session</span><span class="pun">.</span><span class="pln">counter </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

html</span><span class="pun">.</span><span class="pln">html </span><span class="pun">{</span><span class="pln"> </span><span class="com">// html is implicitly bound to new MarkupBuilder(out)</span><span class="pln">
  head </span><span class="pun">{</span><span class="pln">
      title</span><span class="pun">(</span><span class="str">'Groovy Servlet'</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
  body </span><span class="pun">{</span><span class="pln">
    p</span><span class="pun">(</span><span class="str">"Hello, ${request.remoteHost}: ${session.counter}! ${new Date()}"</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
session</span><span class="pun">.</span><span class="pln">counter </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">counter </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_implicit_variables"><a class="anchor" href="#_implicit_variables"></a>3.13.1. Implicit variables</h4>
<div class="paragraph">
<p>The following variables are ready for use in Groovlets:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">variable name</th>
<th class="tableblock halign-left valign-top">bound to</th>
<th class="tableblock halign-left valign-top">note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletRequest</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletResponse</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletContext</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletContext</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>-</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">getSession(false)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>can be null! see &lt;1&gt;</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">params</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>a Map object</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headers</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>a Map object</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">response.getWriter()</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>see &lt;2&gt;</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">response.getOutputStream()</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>see &lt;2&gt;</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">new MarkupBuilder(out)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>see &lt;2&gt;</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">new StreamingJsonBuilder(out)</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>see &lt;2&gt;</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The session variable is only set, if there was already a session object. See the <code>if (session == null)</code> checks in the examples above.</p>
</li>
<li>
<p>These variables cannot be re-assigned inside a <code>Groovlet</code>. They are bound on first access, allowing to e.g. calling methods on the <code>response</code> object before using <code>out</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_groovylets"><a class="anchor" href="#_setting_up_groovylets"></a>3.13.2. Setting up groovylets</h4>
<div class="paragraph">
<p>Add the following to your <code>web.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;servlet&gt;</span><span class="pln">
    </span><span class="tag">&lt;servlet-name&gt;</span><span class="pln">Groovy</span><span class="tag">&lt;/servlet-name&gt;</span><span class="pln">
    </span><span class="tag">&lt;servlet-class&gt;</span><span class="pln">groovy.servlet.GroovyServlet</span><span class="tag">&lt;/servlet-class&gt;</span><span class="pln">
</span><span class="tag">&lt;/servlet&gt;</span><span class="pln">

</span><span class="tag">&lt;servlet-mapping&gt;</span><span class="pln">
    </span><span class="tag">&lt;servlet-name&gt;</span><span class="pln">Groovy</span><span class="tag">&lt;/servlet-name&gt;</span><span class="pln">
    </span><span class="tag">&lt;url-pattern&gt;</span><span class="pln">*.groovy</span><span class="tag">&lt;/url-pattern&gt;</span><span class="pln">
</span><span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then put the required groovy jar files into <code>WEB-INF/lib</code>.</p>
</div>
<div class="paragraph">
<p>Now put the .groovy files in, say, the root directory (i.e. where you would put your html files). The <code>GroovyServlet</code> takes care of compiling the .groovy files.</p>
</div>
<div class="paragraph">
<p>So for example using tomcat you could edit <code>tomcat/conf/server.xml</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="tag">&lt;Context</span><span class="pln"> </span><span class="atn">path</span><span class="pun">=</span><span class="atv">"/groovy"</span><span class="pln"> </span><span class="atn">docBase</span><span class="pun">=</span><span class="atv">"c:/groovy-servlet"</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then access it with <a href="http://localhost:8080/groovy/hello.groovy" class="bare">http://localhost:8080/groovy/hello.groovy</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integrating_groovy_in_a_java_application"><a class="anchor" href="#_integrating_groovy_in_a_java_application"></a>3.14. Integrating Groovy in a Java application</h3>
<div class="sect3">
<h4 id="_groovy_integration_mechanisms"><a class="anchor" href="#_groovy_integration_mechanisms"></a>3.14.1. Groovy integration mechanisms</h4>
<div class="paragraph">
<p>The Groovy language proposes several ways to integrate itself into applications (Java or even Groovy) at runtime, from
the most basic, simple code execution to the most complete, integrating caching and compiler customization.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
All the examples written in this section are using Groovy, but the same integration mechanisms can be used from
Java.
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="integ-eval"><a class="anchor" href="#integ-eval"></a>Eval</h5>
<div class="paragraph">
<p>The <code>groovy.util.Eval</code> class is the simplest way to execute Groovy dynamically at runtime. This can be done by calling the <code>me</code>
method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="typ">Eval</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Eval</span><span class="pun">.</span><span class="pln">me</span><span class="pun">(</span><span class="str">'33*3'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">99</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Eval</span><span class="pun">.</span><span class="pln">me</span><span class="pun">(</span><span class="str">'"foo".toUpperCase()'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'FOO'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Eval</code> supports multiple variants that accept parameters for simple evaluation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Eval</span><span class="pun">.</span><span class="pln">x</span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="str">'2*x'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">8</span><span class="pln">                </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Eval</span><span class="pun">.</span><span class="pln">me</span><span class="pun">(</span><span class="str">'k'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="str">'2*k'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">8</span><span class="pln">          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Eval</span><span class="pun">.</span><span class="pln">xy</span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="str">'x*y'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">20</span><span class="pln">           </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="typ">Eval</span><span class="pun">.</span><span class="pln">xyz</span><span class="pun">(</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="str">'x*y+z'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">26</span><span class="pln">     </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Simple evaluation with one bound parameter named <code>x</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Same evaluation, with a custom bound parameter named <code>k</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Simple evaluation with two bound parameters named <code>x</code> and <code>y</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Simple evaluation with three bound parameters named <code>x</code>, <code>y</code> and <code>z</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <code>Eval</code> class makes it very easy to evaluate simple scripts, but doesn’t scale: there is no caching of the script, and
it isn’t meant to evaluate more than one liners.</p>
</div>
</div>
<div class="sect4">
<h5 id="integ-groovyshell"><a class="anchor" href="#integ-groovyshell"></a>GroovyShell</h5>
<div class="sect5">
<h6 id="_multiple_sources"><a class="anchor" href="#_multiple_sources"></a>Multiple sources</h6>
<div class="paragraph">
<p>The <code>groovy.lang.GroovyShell</code> class is the preferred way to evaluate scripts with the ability to cache the resulting
script instance. Although the <code>Eval</code> class returns the result of the execution of the compiled script, the <code>GroovyShell</code>
class offers more options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">()</span><span class="pln">                           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">evaluate </span><span class="str">'3*5'</span><span class="pln">                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> result2 </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringReader</span><span class="pun">(</span><span class="str">'3*5'</span><span class="pun">))</span><span class="pln">   </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> result2
</span><span class="kwd">def</span><span class="pln"> script </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">parse </span><span class="str">'3*5'</span><span class="pln">                          </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> script </span><span class="kwd">instanceof</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">Script</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> script</span><span class="pun">.</span><span class="pln">run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">15</span><span class="pln">                               </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>GroovyShell</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>can be used as <code>Eval</code> with direct execution of the code</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>can read from multiple sources (<code>String</code>, <code>Reader</code>, <code>File</code>, <code>InputStream</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>can defer execution of the script. <code>parse</code> returns a <code>Script</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>Script</code> defines a <code>run</code> method</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_sharing_data_between_a_script_and_the_application"><a class="anchor" href="#_sharing_data_between_a_script_and_the_application"></a>Sharing data between a script and the application</h6>
<div class="paragraph">
<p>It is possible to share data between the application and the script using a <code>groovy.lang.Binding</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> sharedData </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">()</span><span class="pln">                          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">sharedData</span><span class="pun">)</span><span class="pln">                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> now </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln">
sharedData</span><span class="pun">.</span><span class="pln">setProperty</span><span class="pun">(</span><span class="str">'text'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'I am shared data!'</span><span class="pun">)</span><span class="pln">     </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
sharedData</span><span class="pun">.</span><span class="pln">setProperty</span><span class="pun">(</span><span class="str">'date'</span><span class="pun">,</span><span class="pln"> now</span><span class="pun">)</span><span class="pln">                     </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">

</span><span class="typ">String</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="str">'"At $date, $text"'</span><span class="pun">)</span><span class="pln">     </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="str">"At $now, I am shared data!"</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>Binding</code> that will contain shared data</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create a <code>GroovyShell</code> using this shared data</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>add a string to the binding</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>add a date to the binding (you are not limited to simple types)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>evaluate the script</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Note that it is also possible to write from the script into the binding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> sharedData </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">()</span><span class="pln">                          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">sharedData</span><span class="pun">)</span><span class="pln">                 </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="str">'foo=123'</span><span class="pun">)</span><span class="pln">                               </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> sharedData</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">123</span><span class="pln">             </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>Binding</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create a new <code>GroovyShell</code> using that shared data</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>use an <strong>undeclared</strong> variable to store the result into the binding</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>read the result from the caller</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is important to understand that you need to use an undeclared variable if you want to write into the binding. Using
<code>def</code> or an <code>explicit</code> type like in the example below would fail because you would then create a <em>local variable</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> sharedData </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">sharedData</span><span class="pun">)</span><span class="pln">

shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="str">'int foo=123'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> sharedData</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="typ">MissingPropertyException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println </span><span class="str">"foo is defined as a local variable"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You must be very careful when using shared data in a multithreaded environment. The <code>Binding</code> instance that
you pass to <code>GroovyShell</code> is <strong>not</strong> thread safe, and shared by all scripts.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>It is possible to work around the shared instance of <code>Binding</code> by leveraging the <code>Script</code> instance which is returned
by <code>parse</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> b1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="lit">3</span><span class="pun">)</span><span class="pln">                       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> b2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="lit">4</span><span class="pun">)</span><span class="pln">                       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> script </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'x = 2*x'</span><span class="pun">)</span><span class="pln">
script</span><span class="pun">.</span><span class="pln">binding </span><span class="pun">=</span><span class="pln"> b1
script</span><span class="pun">.</span><span class="pln">run</span><span class="pun">()</span><span class="pln">
script</span><span class="pun">.</span><span class="pln">binding </span><span class="pun">=</span><span class="pln"> b2
script</span><span class="pun">.</span><span class="pln">run</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b1</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="str">'x'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">6</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b2</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="str">'x'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">8</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b1 </span><span class="pun">!=</span><span class="pln"> b2</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>will store the <code>x</code> variable inside <code>b1</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>will store the <code>x</code> variable inside <code>b2</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>However, you must be aware that you are still sharing the <strong>same instance</strong> of a script. So this technique cannot be
used if you have two threads working on the same script. In that case, you must make sure of creating two distinct
script instances:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> b1 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="lit">3</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> b2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="lit">4</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> script1 </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'x = 2*x'</span><span class="pun">)</span><span class="pln">            </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> script2 </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'x = 2*x'</span><span class="pun">)</span><span class="pln">            </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> script1 </span><span class="pun">!=</span><span class="pln"> script2
script1</span><span class="pun">.</span><span class="pln">binding </span><span class="pun">=</span><span class="pln"> b1                            </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
script2</span><span class="pun">.</span><span class="pln">binding </span><span class="pun">=</span><span class="pln"> b2                            </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> t1 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln"> script1</span><span class="pun">.</span><span class="pln">run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">         </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> t2 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln"> script2</span><span class="pun">.</span><span class="pln">run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">         </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">[</span><span class="pln">t1</span><span class="pun">,</span><span class="pln">t2</span><span class="pun">]*.</span><span class="pln">join</span><span class="pun">()</span><span class="pln">                                 </span><i class="conum" data-value="7"></i><b><span class="pun">(</span><span class="lit">7</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b1</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="str">'x'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">6</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b2</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="str">'x'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">8</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> b1 </span><span class="pun">!=</span><span class="pln"> b2</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create an instance of script for thread 1</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create an instance of script for thread 2</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>assign first binding to script 1</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>assign second binding to script 2</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>start first script in a separate thread</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>start second script in a separate thread</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>wait for completion</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In case you need thread safety like here, it is more advisable to use the <a href="#groovyclassloader">GroovyClassLoader</a>
directly instead.</p>
</div>
</div>
<div class="sect5">
<h6 id="_custom_script_class"><a class="anchor" href="#_custom_script_class"></a>Custom script class</h6>
<div class="paragraph">
<p>We have seen that the <code>parse</code> method returns an instance of <code>groovy.lang.Script</code>, but it is possible to use a custom
class, given that it extends <code>Script</code> itself. It can be used to provide additional behavior to the script like in
the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyScript</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Script</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name

    </span><span class="typ">String</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"Hello, $name!"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom class defines a property called <code>name</code> and a new method called <code>greet</code>. This class can be used as the script
base class by using a custom configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="typ">CompilerConfiguration</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">                                    </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
config</span><span class="pun">.</span><span class="pln">scriptBaseClass </span><span class="pun">=</span><span class="pln"> </span><span class="str">'MyScript'</span><span class="pln">                                         </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">classLoader</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">(),</span><span class="pln"> config</span><span class="pun">)</span><span class="pln">  </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> script </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="str">'greet()'</span><span class="pun">)</span><span class="pln">                                         </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> script </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">MyScript</span><span class="pln">
script</span><span class="pun">.</span><span class="pln">setName</span><span class="pun">(</span><span class="str">'Michel'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> script</span><span class="pun">.</span><span class="pln">run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Hello, Michel!'</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a <code>CompilerConfiguration</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>instruct it to use <code>MyScript</code> as the base class for scripts</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then use the compiler configuration when you create the shell</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the script now has access to the new method <code>greet</code></td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You are not limited to the sole <em>scriptBaseClass</em> configuration. You can use any of the compiler configuration
tweaks, including the <a href="#compilation-customizers">compilation customizers</a>.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="groovyclassloader"><a class="anchor" href="#groovyclassloader"></a>GroovyClassLoader</h5>
<div class="paragraph">
<p>In the <a href="#integ-groovyshell">previous section</a>, we have shown that <code>GroovyShell</code> was an easy tool to execute scripts, but
it makes it complicated to compile anything but scripts. Internally, it makes use of the <code>groovy.lang.GroovyClassLoader</code>,
which is at the heart of the compilation and loading of classes at runtime.</p>
</div>
<div class="paragraph">
<p>By leveraging the <code>GroovyClassLoader</code> instead of <code>GroovyShell</code>, you will be able to load classes, instead of instances
of scripts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">GroovyClassLoader</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> gcl </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyClassLoader</span><span class="pun">()</span><span class="pln">                                           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> clazz </span><span class="pun">=</span><span class="pln"> gcl</span><span class="pun">.</span><span class="pln">parseClass</span><span class="pun">(</span><span class="str">'class Foo { void doIt() { println "ok" } }'</span><span class="pun">)</span><span class="pln">    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> clazz</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Foo'</span><span class="pln">                                                  </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> o </span><span class="pun">=</span><span class="pln"> clazz</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">()</span><span class="pln">                                                 </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
o</span><span class="pun">.</span><span class="pln">doIt</span><span class="pun">()</span><span class="pln">                                                                    </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a new <code>GroovyClassLoader</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>parseClass</code> will return an instance of <code>Class</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>you can check that the class which is returns is really the one defined in the script</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>and you can create a new instance of the class, which is not a script</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>then call any method on it</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A GroovyClassLoader keeps a reference of all the classes it created, so it is easy to create a memory leak. In
particular, if you execute the same script twice, if it is a String, then you obtain two distinct classes!
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="typ">GroovyClassLoader</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> gcl </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyClassLoader</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> clazz1 </span><span class="pun">=</span><span class="pln"> gcl</span><span class="pun">.</span><span class="pln">parseClass</span><span class="pun">(</span><span class="str">'class Foo { }'</span><span class="pun">)</span><span class="pln">                                </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> clazz2 </span><span class="pun">=</span><span class="pln"> gcl</span><span class="pun">.</span><span class="pln">parseClass</span><span class="pun">(</span><span class="str">'class Foo { }'</span><span class="pun">)</span><span class="pln">                                </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> clazz1</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Foo'</span><span class="pln">                                                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> clazz2</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Foo'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> clazz1 </span><span class="pun">!=</span><span class="pln"> clazz2                                                     </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>dynamically create a class named "Foo"</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>create an identical looking class, using a separate <code>parseClass</code> call</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>make sure both classes have the same name</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but they are actually different!</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The reason is that a <code>GroovyClassLoader</code> doesn’t keep track of the source text. If you want to have the same instance,
then the source <strong>must</strong> be a file, like in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> gcl </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyClassLoader</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> clazz1 </span><span class="pun">=</span><span class="pln"> gcl</span><span class="pun">.</span><span class="pln">parseClass</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="pln">                                           </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> clazz2 </span><span class="pun">=</span><span class="pln"> gcl</span><span class="pun">.</span><span class="pln">parseClass</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">file</span><span class="pun">.</span><span class="pln">absolutePath</span><span class="pun">))</span><span class="pln">                    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> clazz1</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Foo'</span><span class="pln">                                                 </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> clazz2</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Foo'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> clazz1 </span><span class="pun">==</span><span class="pln"> clazz2                                                     </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>parse a class from a <code>File</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>parse a class from a distinct file instance, but pointing to the same physical file</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>make sure our classes have the same name</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>but now, they are the same instance</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Using a <code>File</code> as input, the <code>GroovyClassLoader</code> is capable of <strong>caching</strong> the generated class file, which avoids
creating multiple classes at runtime for the same source.</p>
</div>
</div>
<div class="sect4">
<h5 id="_groovyscriptengine"><a class="anchor" href="#_groovyscriptengine"></a>GroovyScriptEngine</h5>
<div class="paragraph">
<p>The <code>groovy.util.GroovyScriptEngine</code> class provides a flexible foundation for applications which rely on script
reloading and script dependencies. While <code>GroovyShell</code> focuses on standalone <code>Script`s and `GroovyClassLoader</code> handles
dynamic compilation and loading of any Groovy class, the <code>GroovyScriptEngine</code> will add a layer on top of <code>GroovyClassLoader</code>
to handle both script dependencies and reloading.</p>
</div>
<div class="paragraph">
<p>To illustrate this, we will create a script engine and execute code in an infinite loop. First of all, you need to create
a directory with the following script inside:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> sayHello</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> greet </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Hello, world!"</span><span class="pln">
        greet
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>then you can execute this code using a <code>GroovyScriptEngine</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> binding </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> engine </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyScriptEngine</span><span class="pun">([</span><span class="pln">tmpDir</span><span class="pun">.</span><span class="pln">toURI</span><span class="pun">().</span><span class="pln">toURL</span><span class="pun">()]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> URL</span><span class="pun">[])</span><span class="pln">          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> greeter </span><span class="pun">=</span><span class="pln"> engine</span><span class="pun">.</span><span class="pln">run</span><span class="pun">(</span><span class="str">'ReloadingTest.groovy'</span><span class="pun">,</span><span class="pln"> binding</span><span class="pun">)</span><span class="pln">                   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    println greeter</span><span class="pun">.</span><span class="pln">sayHello</span><span class="pun">()</span><span class="pln">                                                  </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">sleep</span><span class="pun">(</span><span class="lit">1000</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a script engine which will look for sources into our source directory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>execute the script, which will return an instance of <code>Greeter</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>print the greeting message</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>At this point, you should see a message printed every second:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, world!
Hello, world!
...</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Without</strong> interrupting the script execution, now replace the contents of the <code>ReloadingTest</code> file with:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> sayHello</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> greet </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Hello, Groovy!"</span><span class="pln">
        greet
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the message should change to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, world!
...
Hello, Groovy!
Hello, Groovy!
...</pre>
</div>
</div>
<div class="paragraph">
<p>But it is also possible to have a dependency on another script. To illustrate this, create the following file into
the same directory, without interrupting the executing script:</p>
</div>
<div class="listingblock">
<div class="title">Depencency.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Dependency</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> message </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Hello, dependency 1'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and update the <code>ReloadingTest</code> script like this:</p>
</div>
<div class="listingblock">
<div class="title">ReloadingTest.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> </span><span class="typ">Dependency</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> sayHello</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> greet </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Dependency</span><span class="pun">().</span><span class="pln">message
        greet
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And this time, the message should change to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, Groovy!
...
Hello, dependency 1!
Hello, dependency 1!
...</pre>
</div>
</div>
<div class="paragraph">
<p>And as a last test, you can update the <code>Dependency.groovy</code> file without touching the <code>ReloadingTest</code> file:</p>
</div>
<div class="listingblock">
<div class="title">Depencency.groovy</div>
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Dependency</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> message </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Hello, dependency 2'</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And you should observe that the dependent file was reloaded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Hello, dependency 1!
...
Hello, dependency 2!
Hello, dependency 2!</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_compilationunit"><a class="anchor" href="#_compilationunit"></a>CompilationUnit</h5>
<div class="paragraph">
<p>Ultimately, it is possible to perform more operations during compilation by relying directly on the
<code>org.codehaus.groovy.control.CompilationUnit</code> class. This class is responsible for determining the various steps of
compilation and would let you introduce new steps or even stop compilation at various phases. This is for example how
stub generation is done, for the joint compiler.</p>
</div>
<div class="paragraph">
<p>However, overriding <code>CompilationUnit</code> is not recommended and should only be done if no other standard solution works.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bean_scripting_framework"><a class="anchor" href="#_bean_scripting_framework"></a>3.14.2. Bean Scripting Framework</h4>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <a href="http://commons.apache.org/proper/commons-bsf/">Bean Scripting Framework</a> is an attempt to create an API
to allow calling scripting languages from Java. It hasn’t been updated for long and abandoned in favor of the
standard <a href="#jsr223">JSR-223</a> API.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The BSF engine for Groovy is implemented by the <code>org.codehaus.groovy.bsf.GroovyEngine</code> class. However, that fact is
normally hidden away by the BSF APIs. You just treat Groovy like any of the other scripting languages via the BSF
API.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since Groovy has its own native support for integration with Java, you only need to worry about BSF if you also
want to also be able to call other languages, e.g. <a href="http://jruby.org/">JRuby</a> or if you want to remain very
loosely coupled from your scripting language.
</td>
</tr>
</tbody></table>
</div>
<div class="sect4">
<h5 id="_getting_started_2"><a class="anchor" href="#_getting_started_2"></a>Getting started</h5>
<div class="paragraph">
<p>Provided you have Groovy and BSF jars in your classpath, you can use the
following Java code to run a sample Groovy script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">String</span><span class="pln"> myScript </span><span class="pun">=</span><span class="pln"> </span><span class="str">"println('Hello World')\n  return [1, 2, 3]"</span><span class="pun">;</span><span class="pln">
</span><span class="typ">BSFManager</span><span class="pln"> manager </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BSFManager</span><span class="pun">();</span><span class="pln">
</span><span class="typ">List</span><span class="pln"> answer </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">List</span><span class="pun">)</span><span class="pln"> manager</span><span class="pun">.</span><span class="pln">eval</span><span class="pun">(</span><span class="str">"groovy"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"myScript.groovy"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> myScript</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> answer</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_passing_in_variables"><a class="anchor" href="#_passing_in_variables"></a>Passing in variables</h5>
<div class="paragraph">
<p>BSF lets you pass beans between Java and your scripting language. You
can <em>register</em>/<em>unregister</em> beans which makes them known to BSF. You can
then use BSF methods to <em>lookup</em> beans as required. Alternatively, you
can <em>declare</em>/<em>undeclare</em> beans. This will register them but also make
them available for use directly in your scripting language. This second
approach is the normal approach used with Groovy. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">BSFManager</span><span class="pln"> manager </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BSFManager</span><span class="pun">();</span><span class="pln">
manager</span><span class="pun">.</span><span class="pln">declareBean</span><span class="pun">(</span><span class="str">"xyz"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">);</span><span class="pln">
</span><span class="typ">Object</span><span class="pln"> answer </span><span class="pun">=</span><span class="pln"> manager</span><span class="pun">.</span><span class="pln">eval</span><span class="pun">(</span><span class="str">"groovy"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"test.groovy"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">"xyz + 1"</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> answer</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_calling_options"><a class="anchor" href="#_other_calling_options"></a>Other calling options</h5>
<div class="paragraph">
<p>The previous examples used the <em>eval</em> method. BSF makes multiple methods
available for your use (see the
<a href="http://commons.apache.org/proper/commons-bsf/manual.html">BSF documentation</a> for more
details). One of the other available methods is <em>apply</em>. It allows you
to define an anonymous function in your scripting language and apply
that function to arguments. Groovy supports this function using
closures. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">BSFManager</span><span class="pln"> manager </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BSFManager</span><span class="pun">();</span><span class="pln">
</span><span class="typ">Vector</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> ignoreParamNames </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln">
</span><span class="typ">Vector</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;</span><span class="pln"> args </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Vector</span><span class="pun">&lt;</span><span class="typ">Integer</span><span class="pun">&gt;();</span><span class="pln">
args</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">2</span><span class="pun">);</span><span class="pln">
args</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">5</span><span class="pun">);</span><span class="pln">
args</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">1</span><span class="pun">);</span><span class="pln">
</span><span class="typ">Integer</span><span class="pln"> actual </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">)</span><span class="pln"> manager</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="str">"groovy"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"applyTest"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"def summer = { a, b, c -&gt; a * 100 + b * 10 + c }"</span><span class="pun">,</span><span class="pln"> ignoreParamNames</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="lit">251</span><span class="pun">,</span><span class="pln"> actual</span><span class="pun">.</span><span class="pln">intValue</span><span class="pun">());</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_access_to_the_scripting_engine"><a class="anchor" href="#_access_to_the_scripting_engine"></a>Access to the scripting engine</h5>
<div class="paragraph">
<p>Although you don’t normally need it, BSF does provide a hook that lets
you get directly to the scripting engine. One of the functions which the
engine can perform is to invoke a single method call on an object. Here
is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">BSFManager</span><span class="pln"> manager </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BSFManager</span><span class="pun">();</span><span class="pln">
</span><span class="typ">BSFEngine</span><span class="pln"> bsfEngine </span><span class="pun">=</span><span class="pln"> manager</span><span class="pun">.</span><span class="pln">loadScriptingEngine</span><span class="pun">(</span><span class="str">"groovy"</span><span class="pun">);</span><span class="pln">
manager</span><span class="pun">.</span><span class="pln">declareBean</span><span class="pun">(</span><span class="str">"myvar"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"hello"</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">);</span><span class="pln">
</span><span class="typ">Object</span><span class="pln"> myvar </span><span class="pun">=</span><span class="pln"> manager</span><span class="pun">.</span><span class="pln">lookupBean</span><span class="pun">(</span><span class="str">"myvar"</span><span class="pun">);</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> bsfEngine</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">myvar</span><span class="pun">,</span><span class="pln"> </span><span class="str">"reverse"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="str">"olleh"</span><span class="pun">,</span><span class="pln"> result</span><span class="pun">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jsr223"><a class="anchor" href="#jsr223"></a>3.14.3. JSR 223 javax.script API</h4>
<div class="admonitionblock warning">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
JSR-223 is a standard API for calling scripting frameworks in Java. It is available since Java 6 and aims at
providing a common framework for calling multiple languages from Java. Groovy provides its own richer integration mechanisms,
and if you don’t plan to use multiple languages in the same application, it is recommended that you use the Groovy
integration mechanisms instead of the limited JSR-223 API.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Here is how you need to initialize the JSR-223 engine to talk to Groovy from Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">script</span><span class="pun">.</span><span class="typ">ScriptEngine</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">script</span><span class="pun">.</span><span class="typ">ScriptEngineManager</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">script</span><span class="pun">.</span><span class="typ">ScriptException</span><span class="pun">;</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="typ">ScriptEngineManager</span><span class="pln"> factory </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ScriptEngineManager</span><span class="pun">();</span><span class="pln">
</span><span class="typ">ScriptEngine</span><span class="pln"> engine </span><span class="pun">=</span><span class="pln"> factory</span><span class="pun">.</span><span class="pln">getEngineByName</span><span class="pun">(</span><span class="str">"groovy"</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can execute Groovy scripts easily:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="typ">Integer</span><span class="pln"> sum </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">)</span><span class="pln"> engine</span><span class="pun">.</span><span class="pln">eval</span><span class="pun">(</span><span class="str">"(1..10).sum()"</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">55</span><span class="pun">),</span><span class="pln"> sum</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to share variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="pln">engine</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"first"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"HELLO"</span><span class="pun">);</span><span class="pln">
engine</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"second"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"world"</span><span class="pun">);</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">)</span><span class="pln"> engine</span><span class="pun">.</span><span class="pln">eval</span><span class="pun">(</span><span class="str">"first.toLowerCase() + ' ' + second.toUpperCase()"</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="str">"hello WORLD"</span><span class="pun">,</span><span class="pln"> result</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This next example illustrates calling an invokable function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-java" data-lang="java"><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">script</span><span class="pun">.</span><span class="typ">Invocable</span><span class="pun">;</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="typ">ScriptEngineManager</span><span class="pln"> factory </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ScriptEngineManager</span><span class="pun">();</span><span class="pln">
</span><span class="typ">ScriptEngine</span><span class="pln"> engine </span><span class="pun">=</span><span class="pln"> factory</span><span class="pun">.</span><span class="pln">getEngineByName</span><span class="pun">(</span><span class="str">"groovy"</span><span class="pun">);</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> fact </span><span class="pun">=</span><span class="pln"> </span><span class="str">"def factorial(n) { n == 1 ? 1 : n * factorial(n - 1) }"</span><span class="pun">;</span><span class="pln">
engine</span><span class="pun">.</span><span class="pln">eval</span><span class="pun">(</span><span class="pln">fact</span><span class="pun">);</span><span class="pln">
</span><span class="typ">Invocable</span><span class="pln"> inv </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Invocable</span><span class="pun">)</span><span class="pln"> engine</span><span class="pun">;</span><span class="pln">
</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> params </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="lit">5</span><span class="pun">};</span><span class="pln">
</span><span class="typ">Object</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> inv</span><span class="pun">.</span><span class="pln">invokeFunction</span><span class="pun">(</span><span class="str">"factorial"</span><span class="pun">,</span><span class="pln"> params</span><span class="pun">);</span><span class="pln">
assertEquals</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">(</span><span class="lit">120</span><span class="pun">),</span><span class="pln"> result</span><span class="pun">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The engine keeps per default hard references to the script functions. To
change this you should set a engine level scoped attribute to the script
context of the name <code>#jsr223.groovy.engine.keep.globals</code> with a
String being <code>phantom</code> to use phantom references, <code>weak</code> to use weak
references or <code>soft</code> to use soft references - casing is ignored. Any
other string will cause the use of hard references.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_domain_specific_languages"><a class="anchor" href="#_domain_specific_languages"></a>3.15. Domain-Specific Languages</h3>
<div class="sect3">
<h4 id="_command_chains"><a class="anchor" href="#_command_chains"></a>3.15.1. Command chains</h4>
<div class="paragraph">
<p>Groovy lets you omit parentheses around the arguments of a
method call for top-level statements. "command chain" feature extends this by allowing us to chain such
parentheses-free method calls, requiring neither parentheses around arguments, nor dots between the chained calls.
The general idea is that a call like <code>a b c d</code> will actually be equivalent to <code>a(b).c(d)</code>. This
also works with multiple arguments, closure arguments, and even named arguments. Furthermore, such command chains can
also appear on the right-hand side of assignments. Let’s have a look at some examples
supported by this new syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// equivalent to: turn(left).then(right)</span><span class="pln">
turn left </span><span class="kwd">then</span><span class="pln"> right

</span><span class="com">// equivalent to: take(2.pills).of(chloroquinine).after(6.hours)</span><span class="pln">
take </span><span class="lit">2.pills</span><span class="pln"> of chloroquinine after </span><span class="lit">6.hours</span><span class="pln">

</span><span class="com">// equivalent to: paint(wall).with(red, green).and(yellow)</span><span class="pln">
paint wall </span><span class="kwd">with</span><span class="pln"> red</span><span class="pun">,</span><span class="pln"> green </span><span class="kwd">and</span><span class="pln"> yellow

</span><span class="com">// with named parameters too</span><span class="pln">
</span><span class="com">// equivalent to: check(that: margarita).tastes(good)</span><span class="pln">
check that</span><span class="pun">:</span><span class="pln"> margarita tastes good

</span><span class="com">// with closures as parameters</span><span class="pln">
</span><span class="com">// equivalent to: given({}).when({}).then({})</span><span class="pln">
given </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">when</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">then</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to use methods in the chain which take no arguments,
but in that case, the parentheses are needed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// equivalent to: select(all).unique().from(names)</span><span class="pln">
</span><span class="kwd">select</span><span class="pln"> all unique</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">from</span><span class="pln"> names</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If your command chain contains an odd number of elements, the chain will
be composed of method / arguments, and will finish by a final property
access:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// equivalent to: take(3).cookies</span><span class="pln">
</span><span class="com">// and also this: take(3).getCookies()</span><span class="pln">
take </span><span class="lit">3</span><span class="pln"> cookies</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This command chain approach opens up interesting possibilities in terms of the much wider range of DSLs which
can now be written in Groovy.</p>
</div>
<div class="paragraph">
<p>The above examples illustrate using a command chain based DSL but not how to create one. There are various strategies
that you can use, but to illustrate creating such a DSL, we will show a couple of examples - first using maps and Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">show </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println it </span><span class="pun">}</span><span class="pln">
square_root </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sqrt</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> please</span><span class="pun">(</span><span class="pln">action</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">[</span><span class="pln">the</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> what </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="pun">[</span><span class="pln">of</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> n </span><span class="pun">-&gt;</span><span class="pln"> action</span><span class="pun">(</span><span class="pln">what</span><span class="pun">(</span><span class="pln">n</span><span class="pun">))</span><span class="pln"> </span><span class="pun">}]</span><span class="pln">
  </span><span class="pun">}]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// equivalent to: please(show).the(square_root).of(100)</span><span class="pln">
please show the square_root of </span><span class="lit">100</span><span class="pln">
</span><span class="com">// ==&gt; 10.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As a second example, consider how you might write a DSL for simplifying
one of your existing APIs. Maybe you need to put this code in front of
customers, business analysts or testers who might be not hard-core Java
developers. We’ll use the <code>Splitter</code> from the Google
<a href="https://github.com/google/guava">Guava libraries</a> project as it
already has a nice Fluent API. Here is how we might use it out of the
box:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'com.google.guava:guava:r09'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">google</span><span class="pun">.</span><span class="pln">common</span><span class="pun">.</span><span class="kwd">base</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Splitter</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">','</span><span class="pun">).</span><span class="pln">trimResults</span><span class="pun">(</span><span class="typ">CharMatcher</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">'_'</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">)).</span><span class="pln">split</span><span class="pun">(</span><span class="str">"_a ,_b_ ,c__"</span><span class="pun">).</span><span class="pln">iterator</span><span class="pun">().</span><span class="pln">toList</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It reads fairly well for a Java developer but if that is not your target
audience or you have many such statements to write, it could be
considered a little verbose. Again, there are many options for writing a
DSL. We’ll keep it simple with Maps and Closures. We’ll first write a
helper method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'com.google.guava:guava:r09'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">google</span><span class="pun">.</span><span class="pln">common</span><span class="pun">.</span><span class="kwd">base</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> split</span><span class="pun">(</span><span class="kwd">string</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="pun">[</span><span class="pln">on</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> sep </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="pun">[</span><span class="pln">trimming</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> trimChar </span><span class="pun">-&gt;</span><span class="pln">
      </span><span class="typ">Splitter</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="pln">sep</span><span class="pun">).</span><span class="pln">trimResults</span><span class="pun">(</span><span class="typ">CharMatcher</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="pln">trimChar </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">)).</span><span class="pln">split</span><span class="pun">(</span><span class="kwd">string</span><span class="pun">).</span><span class="pln">iterator</span><span class="pun">().</span><span class="pln">toList</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}]</span><span class="pln">
  </span><span class="pun">}]</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>now instead of this line from our original example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Splitter</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">','</span><span class="pun">).</span><span class="pln">trimResults</span><span class="pun">(</span><span class="typ">CharMatcher</span><span class="pun">.</span><span class="kwd">is</span><span class="pun">(</span><span class="str">'_'</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="kwd">char</span><span class="pun">)).</span><span class="pln">split</span><span class="pun">(</span><span class="str">"_a ,_b_ ,c__"</span><span class="pun">).</span><span class="pln">iterator</span><span class="pun">().</span><span class="pln">toList</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>we can write this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> split </span><span class="str">"_a ,_b_ ,c__"</span><span class="pln"> on </span><span class="str">','</span><span class="pln"> trimming </span><span class="str">'_\'</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_operator_overloading"><a class="anchor" href="#_operator_overloading"></a>3.15.2. Operator overloading</h4>
<div class="paragraph">
<p>Various operators in Groovy are mapped onto regular method calls on objects.</p>
</div>
<div class="paragraph">
<p>This allows you to provide your own Java or Groovy objects which can 
take advantage of operator overloading. The following table describes 
the operators supported in Groovy and the methods they map to.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Method</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a + b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.plus(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a - b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.minus(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a * b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.multiply(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a ** b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.power(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a / b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.div(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a % b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.mod(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a | b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.or(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &amp; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.and(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a ^ b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.xor(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a++</code> or <code>++a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.next()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a--</code> or <code>--a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.previous()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.getAt(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a[b] = c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.putAt(b, c)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &lt;&lt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.leftShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt;&gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShift(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt;&gt;&gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.rightShiftUnsigned(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>switch(a) { case(b) : }</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">b.isCase(a)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>if(a)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.asBoolean()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.bitwiseNegate()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.negative()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.positive()</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a as b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.asType(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a == b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.equals(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a != b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">! a.equals(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &lt;=&gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &gt; 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &gt;= b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &gt;= 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &lt; b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &lt; 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>a &lt;= b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a.compareTo(b) &lt;= 0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_script_base_classes"><a class="anchor" href="#_script_base_classes"></a>3.15.3. Script base classes</h4>
<div class="sect4">
<h5 id="_the_script_class"><a class="anchor" href="#_the_script_class"></a>The Script class</h5>
<div class="paragraph">
<p>Groovy scripts are always compiled to classes. For example, a script as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">println </span><span class="str">'Hello from Groovy'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is compiled to a class extending the abstract <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/Script.html">groovy.lang.Script</a> class. This class contains a single abstract
method called <em>run</em>. When a script is compiled, then its body will become the <em>run</em> method, while the other methods
found in the script are found in the implementing class. The <code>Script</code> class provides base support for integration
with your application through the <code>Binding</code> object, as illustrated in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> binding </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Binding</span><span class="pun">()</span><span class="pln">             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">binding</span><span class="pun">)</span><span class="pln">    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
binding</span><span class="pun">.</span><span class="pln">setVariable</span><span class="pun">(</span><span class="str">'x'</span><span class="pun">,</span><span class="lit">1</span><span class="pun">)</span><span class="pln">              </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
binding</span><span class="pun">.</span><span class="pln">setVariable</span><span class="pun">(</span><span class="str">'y'</span><span class="pun">,</span><span class="lit">3</span><span class="pun">)</span><span class="pln">
shell</span><span class="pun">.</span><span class="pln">evaluate </span><span class="str">'z=2*x+y'</span><span class="pln">                </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> binding</span><span class="pun">.</span><span class="pln">getVariable</span><span class="pun">(</span><span class="str">'z'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span><span class="pln">    </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>a binding is used to share data between the script and the calling class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a <code>GroovyShell</code> can be used with this binding</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>input variables are set from the calling class inside the binding</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then the script is evaluated</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>and the <code>z</code> variable has been "exported" into the binding</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This is a very practical way to share data between the caller and the script, however it may be insufficient or not
practical in some cases. For that purpose, Groovy allows you to set your own base script class. A base script class
has to extend <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/Script.html">groovy.lang.Script</a> and be a single abstract method type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyBaseClass</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Script</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> greet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Hello, $name!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the custom script base class can be declared in the compiler configuration, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">                                </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
config</span><span class="pun">.</span><span class="pln">scriptBaseClass </span><span class="pun">=</span><span class="pln"> </span><span class="str">'MyBaseClass'</span><span class="pln">                                  </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">classLoader</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">)</span><span class="pln">             </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
shell</span><span class="pun">.</span><span class="pln">evaluate </span><span class="str">"""
    setName 'Judith'                                                    </span><i class="conum" data-value="4"></i><b><span class="str">(4)</span></b><span class="str">
    greet()
"""</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>create a custom compiler configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set the base script class to our custom base script class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>then create a <code>GroovyShell</code> using that configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the script will then extend the base script class, giving direct access to the <code>name</code> property and <code>greet</code> method</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect4">
<h5 id="_the_basescript_annotation"><a class="anchor" href="#_the_basescript_annotation"></a>The @BaseScript annotation</h5>
<div class="paragraph">
<p>As an alternative, it is also possible to use the <code>@BaseScript</code> annotation directly into a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">BaseScript</span><span class="pln">

</span><span class="lit">@BaseScript</span><span class="pln"> </span><span class="typ">MyBaseClass</span><span class="pln"> baseScript
setName </span><span class="str">'Judith'</span><span class="pln">
greet</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>@BaseScript</code> should annotate a variable which type is the class of the base script. Alternatively, you can set
the base script class as a member of the <code>@BaseScript</code> annotation itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@BaseScript</span><span class="pun">(</span><span class="typ">MyBaseClass</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">BaseScript</span><span class="pln">

setName </span><span class="str">'Judith'</span><span class="pln">
greet</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_alternate_abstract_method"><a class="anchor" href="#_alternate_abstract_method"></a>Alternate abstract method</h5>
<div class="paragraph">
<p>We have seen that the base script class is a single abstract method type that needs to implement the <code>run</code> method. The
<code>run</code> method is executed by the script engine automatically. In some circumstances it may be interesting to have a base
class which implements the <code>run</code> method, but provides an alternative abstract method to be used for the script body.
For example, the base script <code>run</code> method might perform some initialization before the <code>run</code> method is executed. This
is possible by doing this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyBaseClass</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Script</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> count
    </span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> scriptBody</span><span class="pun">()</span><span class="pln">                              </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        count</span><span class="pun">++</span><span class="pln">                                             </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
        scriptBody</span><span class="pun">()</span><span class="pln">                                        </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        count                                               </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the base script class should define one (and only one) abstract method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>run</code> method can be overridden and perform a task before executing the script body</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>run</code> calls the abstract <code>scriptBody</code> method which will delegate to the user script</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>then it can return something else than the value from the script</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you execute this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">evaluate </span><span class="str">"""
    println 'Ok'
"""</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> result </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you will see that the script is executed, but the result of the evaluation is <code>1</code> as returned by the <code>run</code>
method of the base class. It is even clearer if you use <code>parse</code> instead of <code>evaluate</code>, because it would allow you to
execute the <code>run</code> method several times on the same script instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> script </span><span class="pun">=</span><span class="pln"> shell</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="str">"println 'Ok'"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> script</span><span class="pun">.</span><span class="pln">run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> script</span><span class="pun">.</span><span class="pln">run</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_properties_to_numbers"><a class="anchor" href="#_adding_properties_to_numbers"></a>3.15.4. Adding properties to numbers</h4>
<div class="paragraph">
<p>In Groovy number types are considered equal to any other types. As such, it is possible to enhance numbers by adding
properties or methods to them. This can be very handy when dealing with measurable quantities for example. Details about
how existing classes can be enhanced in Groovy are found in the <a href="http://docs.groovy-lang.org/latest/html/documentation/core-metaprogramming.html#_extension_modules">extension
modules</a> section or the <a href="http://docs.groovy-lang.org/latest/html/documentation/core-metaprogramming.html#categories">categories</a> section.</p>
</div>
<div class="paragraph">
<p>An illustration of this can be found in Groovy using the <code>TimeCategory</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">use</span><span class="pun">(</span><span class="typ">TimeCategory</span><span class="pun">)</span><span class="pln">  </span><span class="pun">{</span><span class="pln">
    println </span><span class="lit">1.minute</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">.</span><span class="pln">now       </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    println </span><span class="lit">10.hours</span><span class="pun">.</span><span class="pln">ago

    </span><span class="kwd">def</span><span class="pln"> someDate </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">()</span><span class="pln">       </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    println someDate </span><span class="pun">-</span><span class="pln"> </span><span class="lit">3.months</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>using the <code>TimeCategory</code>, a property <code>minute</code> is added to the <code>Integer</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>similarily, the <code>months</code> method returns a <code>groovy.time.DatumDependentDuration</code> which can be used in calculus</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Categories are lexically bound, making them a great fit for internal DSLs.</p>
</div>
</div>
<div class="sect3">
<h4 id="section-delegatesto"><a class="anchor" href="#section-delegatesto"></a>3.15.5. @DelegatesTo</h4>
<div class="sect4">
<h5 id="TheDelegatesToannotation-DSLsmadeeasy"><a class="anchor" href="#TheDelegatesToannotation-DSLsmadeeasy"></a>Explaining delegation strategy at compile time</h5>
<div class="paragraph">
<p><code>@groovy.lang.DelegatesTo</code> is a documentation and compile-time annotation aimed at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>documenting APIs that use closures as arguments</p>
</li>
<li>
<p>providing type information for the static type checker and compiler</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Groovy language is a platform of choice for building DSLs. Using
closures, it’s quite easy to create custom control structures, as well
as it is simple to create builders. Imagine that you have the following
code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">email </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'dsl-guru@mycompany.com'</span><span class="pln">
    to </span><span class="str">'john.doe@waitaminute.com'</span><span class="pln">
    subject </span><span class="str">'The pope has resigned!'</span><span class="pln">
    body </span><span class="pun">{</span><span class="pln">
        p </span><span class="str">'Really, the pope has resigned!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One way of implementing this is using the builder strategy, which
implies a method, named <code>email</code>&nbsp;which accepts a closure as an argument.
The method may delegate subsequent calls to an object that implements
the&nbsp;<code>from</code>,&nbsp;<code>to</code>,&nbsp;<code>subject</code> and&nbsp;<code>body</code> methods. Again,&nbsp;<code>body</code> is a
method which accepts a closure as an argument and that uses the builder
strategy.</p>
</div>
<div class="paragraph">
<p>Implementing such a builder is usually done the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> email</span><span class="pun">(</span><span class="typ">Closure</span><span class="pln"> cl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">EmailSpec</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> code </span><span class="pun">=</span><span class="pln"> cl</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">email</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
    code</span><span class="pun">.</span><span class="pln">resolveStrategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_ONLY
    code</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>the <code>EmailSpec</code> class implements the&nbsp;<code>from</code>,&nbsp;<code>to</code>, … methods. By
calling&nbsp;<code>rehydrate</code>, we’re creating a copy of the closure for which we
set the&nbsp;<code>delegate</code>,&nbsp;<code>owner</code> and&nbsp;<code>thisObject</code> values. Setting the owner
and the <code>this</code> object is not very important here since we will use the
<code>DELEGATE_ONLY</code> strategy which says that the method calls will be
resolved only against the delegate of the closure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">EmailSpec</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> </span><span class="kwd">from</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> </span><span class="kwd">from</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"From: $from"</span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> to</span><span class="pun">(</span><span class="typ">String</span><span class="pun">...</span><span class="pln"> to</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"To: $to"</span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> subject</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> subject</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Subject: $subject"</span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> body</span><span class="pun">(</span><span class="typ">Closure</span><span class="pln"> body</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> bodySpec </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BodySpec</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> code </span><span class="pun">=</span><span class="pln"> body</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">bodySpec</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
        code</span><span class="pun">.</span><span class="pln">resolveStrategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_ONLY
        code</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>EmailSpec</code> class has itself a <code>body</code> method accepting a closure that is cloned and executed. This is what
we call the builder pattern in Groovy.</p>
</div>
<div class="paragraph">
<p>One of the problems with the code that we’ve shown is that the user of
the <code>email</code> method doesn’t have any information about the methods that
he’s allowed to call inside the closure. The only possible information
is from the method documentation. There are two issues with this: first
of all, documentation is not always written, and if it is, it’s not
always available (javadoc not downloaded, for example). Second, it
doesn’t help IDEs. What would be really interesting, here, is for IDEs
to help the developer by suggesting, once they are in the closure body,
methods that exist on the <code>email</code> class.</p>
</div>
<div class="paragraph">
<p>Moreover, if the user calls a method in the closure which is not defined
by the&nbsp;<code>EmailSpec</code> class, the IDE should at least issue a warning (because
it’s very likely that it will break at runtime).</p>
</div>
<div class="paragraph">
<p>One more problem with the code above is that it is not compatible with static type checking. Type checking would let
the user know if a method call is authorized at compile time instead of runtime, but if you try to perform type
checking on this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">email </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'dsl-guru@mycompany.com'</span><span class="pln">
    to </span><span class="str">'john.doe@waitaminute.com'</span><span class="pln">
    subject </span><span class="str">'The pope has resigned!'</span><span class="pln">
    body </span><span class="pun">{</span><span class="pln">
        p </span><span class="str">'Really, the pope has resigned!'</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the type checker will know that there’s an&nbsp;<code>email</code> method accepting
a&nbsp;<code>Closure</code>, but it will complain for every method call&nbsp;<strong>inside</strong> the
closure, because&nbsp;<code>from</code>, for example, is not a method which is defined
in the class. Indeed, it’s defined in the&nbsp;<code>EmailSpec</code> class and it has
absolutely no hint to help it knowing that the closure delegate will, at
runtime, be of type&nbsp;<code>EmailSpec</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">TypeChecked</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> sendEmail</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    email </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'dsl-guru@mycompany.com'</span><span class="pln">
        to </span><span class="str">'john.doe@waitaminute.com'</span><span class="pln">
        subject </span><span class="str">'The pope has resigned!'</span><span class="pln">
        body </span><span class="pun">{</span><span class="pln">
            p </span><span class="str">'Really, the pope has resigned!'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>will fail compilation with errors like this one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[Static type checking] - Cannot find matching method MyScript#from(java.lang.String). Please check if the declared type is right and if the method exists.
 @ line 31, column 21.
                       from 'dsl-guru@mycompany.com'</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="TheDelegatesToannotation-DelegatesTo"><a class="anchor" href="#TheDelegatesToannotation-DelegatesTo"></a>@DelegatesTo</h5>
<div class="paragraph">
<p>For those reasons, Groovy 2.1 introduced a new annotation
named&nbsp;<code>@DelegatesTo</code>. The goal of this annotation is to solve both the
documentation issue, that will let your IDE know about the expected
methods in the closure body, and it will also solve the type checking
issue, by giving hints to the compiler about what are the potential
receivers of method calls in the closure body.</p>
</div>
<div class="paragraph">
<p>The idea is to annotate the&nbsp;<code>Closure</code> parameter of the&nbsp;<code>email</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> email</span><span class="pun">(</span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="typ">EmailSpec</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">EmailSpec</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> code </span><span class="pun">=</span><span class="pln"> cl</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">email</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
    code</span><span class="pun">.</span><span class="pln">resolveStrategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_ONLY
    code</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What we’ve done here is telling the compiler (or the IDE) that when the
method will be called with a closure, the delegate of this closure will
be set to an object of type&nbsp;<code>email</code>. But there is still a problem: the
default delegation strategy is not the one which is used in our method.
So we will give more information and tell the compiler (or the IDE) that
the delegation strategy is also changed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> email</span><span class="pun">(</span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="pln">strategy</span><span class="pun">=</span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_ONLY</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="typ">EmailSpec</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">EmailSpec</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> code </span><span class="pun">=</span><span class="pln"> cl</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">email</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
    code</span><span class="pun">.</span><span class="pln">resolveStrategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_ONLY
    code</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, both the IDE and the type checker (if you are using <code>@TypeChecked</code>)
will be aware of the delegate and the delegation strategy. This is very
nice because it will both allow the IDE to provide smart completion, but
it will also remove errors at compile time that exist only because the
behaviour of the program is normally only known at runtime!</p>
</div>
<div class="paragraph">
<p>The following code will now pass compilation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@TypeChecked</span><span class="pln">
</span><span class="kwd">void</span><span class="pln"> doEmail</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    email </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'dsl-guru@mycompany.com'</span><span class="pln">
        to </span><span class="str">'john.doe@waitaminute.com'</span><span class="pln">
        subject </span><span class="str">'The pope has resigned!'</span><span class="pln">
        body </span><span class="pun">{</span><span class="pln">
            p </span><span class="str">'Really, the pope has resigned!'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="TheDelegatesToannotation-DelegatesTomodes"><a class="anchor" href="#TheDelegatesToannotation-DelegatesTomodes"></a>DelegatesTo modes</h5>
<div class="paragraph">
<p><code>@DelegatesTo</code> supports multiple modes that we will describe with examples
in this section.</p>
</div>
<div class="sect5">
<h6 id="TheDelegatesToannotation-Simpledelegation"><a class="anchor" href="#TheDelegatesToannotation-Simpledelegation"></a>Simple delegation</h6>
<div class="paragraph">
<p>In this mode, the only mandatory parameter is the&nbsp;<em>value</em> which says to
which class we delegate calls. Nothing more. We’re telling the compiler
that the type of the delegate will&nbsp;<strong>always</strong> be of the type documented
by&nbsp;<code>@DelegatesTo</code> (note that it can be a subclass, but if it is, the
methods defined by the subclass will not be visible to the type
checker).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> body</span><span class="pun">(</span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="typ">BodySpec</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="TheDelegatesToannotation-Delegationstrategy"><a class="anchor" href="#TheDelegatesToannotation-Delegationstrategy"></a>Delegation strategy</h6>
<div class="paragraph">
<p>In this mode, you must specify both the delegate class&nbsp;<strong>and</strong> a
delegation strategy. This must be used if the closure will not be called
with the default delegation strategy, which is&nbsp;<code>Closure.OWNER_FIRST</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> body</span><span class="pun">(</span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="pln">strategy</span><span class="pun">=</span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_ONLY</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">=</span><span class="typ">BodySpec</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="TheDelegatesToannotation-Delegatetoparameter"><a class="anchor" href="#TheDelegatesToannotation-Delegatetoparameter"></a>Delegate to parameter</h6>
<div class="paragraph">
<p>In this variant, we will tell the compiler that we are delegating to
another parameter of the method. Take the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="kwd">exec</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> target</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> code</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> clone </span><span class="pun">=</span><span class="pln"> code</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">target</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
   clone</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, the delegate which will be used is&nbsp;<strong>not</strong> created inside the&nbsp;<code>exec</code>
method. In fact, we take an argument of the method and delegate to it.
Usage may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> email </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Email</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">exec</span><span class="pun">(</span><span class="pln">email</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">from</span><span class="pln"> </span><span class="str">'...'</span><span class="pln">
   to </span><span class="str">'...'</span><span class="pln">
   send</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of the method calls are delegated to the&nbsp;<code>email</code> parameter. This is
a widely used pattern which is also supported by&nbsp;<code>@DelegatesTo</code> using a
companion annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> </span><span class="kwd">exec</span><span class="pun">(</span><span class="lit">@DelegatesTo</span><span class="pun">.</span><span class="typ">Target</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> target</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@DelegatesTo</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> code</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> clone </span><span class="pun">=</span><span class="pln"> code</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">target</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
   clone</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A closure is annotated with&nbsp;<code>@DelegatesTo</code>, but this time, without
specifying any class. Instead, we’re annotating another parameter
with&nbsp;<code>@DelegatesTo.Target</code>. The type of the delegate is then determined
at compile time. One could think that we are using the parameter type,
which in this case is&nbsp;<code>Object</code> but this is not true. Take this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">void</span><span class="pln"> sayHello</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">'Hello'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> greeter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Greeter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">exec</span><span class="pun">(</span><span class="pln">greeter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   sayHello</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that this works out of the box&nbsp;<strong>without</strong> having to annotate
with&nbsp;<code>@DelegatesTo</code>. However, to make the IDE aware of the delegate
type, or the&nbsp;<strong>type checker</strong> aware of it, we need to add&nbsp;<code>@DelegatesTo</code>.
And in this case, it will know that the&nbsp;<code>Greeter</code> variable is of
type&nbsp;<code>Greeter</code>, so it will not report errors on the&nbsp;<em>sayHello</em>
method&nbsp;<strong>even if the exec method doesn’t explicitly define the target as
of type Greeter</strong>. This is a very powerful feature, because it prevents
you from writing multiple versions of the same&nbsp;<code>exec</code> method for
different receiver types!</p>
</div>
<div class="paragraph">
<p>In this mode, the&nbsp;<code>@DelegatesTo</code> annotation also supports the&nbsp;<code>strategy</code>
parameter that we’ve described upper.</p>
</div>
</div>
<div class="sect5">
<h6 id="TheDelegatesToannotation-Multipleclosures"><a class="anchor" href="#TheDelegatesToannotation-Multipleclosures"></a>Multiple closures</h6>
<div class="paragraph">
<p>In the previous example, the&nbsp;<code>exec</code> method accepted only one closure,
but you may have methods that take multiple closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> fooBarBaz</span><span class="pun">(</span><span class="typ">Closure</span><span class="pln"> foo</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> bar</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> baz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then nothing prevents you from annotating each closure
with&nbsp;<code>@DelegatesTo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> foo</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> msg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Foo ${msg}!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Bar</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> bar</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Bar ${x}!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Baz</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> baz</span><span class="pun">(</span><span class="typ">Date</span><span class="pln"> d</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Baz ${d}!"</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> fooBarBaz</span><span class="pun">(</span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="typ">Foo</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> foo</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="typ">Bar</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> bar</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="typ">Baz</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> baz</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="pun">...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But more importantly, if you have multiple closures&nbsp;<strong>and</strong> multiple
arguments, you can use several targets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> fooBarBaz</span><span class="pun">(</span><span class="pln">
    </span><span class="lit">@DelegatesTo</span><span class="pun">.</span><span class="typ">Target</span><span class="pun">(</span><span class="str">'foo'</span><span class="pun">)</span><span class="pln"> foo</span><span class="pun">,</span><span class="pln">
    </span><span class="lit">@DelegatesTo</span><span class="pun">.</span><span class="typ">Target</span><span class="pun">(</span><span class="str">'bar'</span><span class="pun">)</span><span class="pln"> bar</span><span class="pun">,</span><span class="pln">
    </span><span class="lit">@DelegatesTo</span><span class="pun">.</span><span class="typ">Target</span><span class="pun">(</span><span class="str">'baz'</span><span class="pun">)</span><span class="pln"> baz</span><span class="pun">,</span><span class="pln">

    </span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="pln">target</span><span class="pun">=</span><span class="str">'foo'</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl1</span><span class="pun">,</span><span class="pln">
    </span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="pln">target</span><span class="pun">=</span><span class="str">'bar'</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl2</span><span class="pun">,</span><span class="pln">
    </span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="pln">target</span><span class="pun">=</span><span class="str">'baz'</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> cl3</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    cl1</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">foo</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">).</span><span class="pln">call</span><span class="pun">()</span><span class="pln">
    cl2</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">bar</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">).</span><span class="pln">call</span><span class="pun">()</span><span class="pln">
    cl3</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">baz</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">).</span><span class="pln">call</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> a </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> b </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> c </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Baz</span><span class="pun">()</span><span class="pln">
fooBarBaz</span><span class="pun">(</span><span class="pln">
    a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">,</span><span class="pln">
    </span><span class="pun">{</span><span class="pln"> foo</span><span class="pun">(</span><span class="str">'Hello'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">},</span><span class="pln">
    </span><span class="pun">{</span><span class="pln"> bar</span><span class="pun">(</span><span class="lit">123</span><span class="pun">)</span><span class="pln"> </span><span class="pun">},</span><span class="pln">
    </span><span class="pun">{</span><span class="pln"> baz</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">())</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At this point, you may wonder why we don’t use the parameter names as
references. The reason is that the information (the parameter name) is
not always available (it’s a debug-only information), so it’s a
limitation of the JVM.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_delegating_to_a_generic_type"><a class="anchor" href="#_delegating_to_a_generic_type"></a>Delegating to a generic type</h6>
<div class="paragraph">
<p>In some situations, it is interesting to instruct the IDE or the compiler that the delegate type will not be a parameter
but a generic type. Imagine a configurator that runs on a list of elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> configure</span><span class="pun">(</span><span class="typ">List</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> elements</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   elements</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> e</span><span class="pun">-&gt;</span><span class="pln">
      </span><span class="kwd">def</span><span class="pln"> clone </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">e</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
      clone</span><span class="pun">.</span><span class="pln">resolveStrategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_FIRST
      clone</span><span class="pun">.</span><span class="pln">call</span><span class="pun">()</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then this method can be called with any list like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">ToString</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Realm</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">List</span><span class="pun">&lt;</span><span class="typ">Realm</span><span class="pun">&gt;</span><span class="pln"> list </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="lit">3.times</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> list </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Realm</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
configure</span><span class="pun">(</span><span class="pln">list</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   name </span><span class="pun">=</span><span class="pln"> </span><span class="str">'My Realm'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> list</span><span class="pun">.</span><span class="pln">every </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'My Realm'</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To let the type checker and the IDE know that the <code>configure</code> method calls the closure on each element of the list, you
 need to use <code>@DelegatesTo</code> differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">public</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> configure</span><span class="pun">(</span><span class="pln">
    </span><span class="lit">@DelegatesTo</span><span class="pun">.</span><span class="typ">Target</span><span class="pln"> </span><span class="typ">List</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> elements</span><span class="pun">,</span><span class="pln">
    </span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="pln">strategy</span><span class="pun">=</span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_FIRST</span><span class="pun">,</span><span class="pln"> genericTypeIndex</span><span class="pun">=</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="kwd">def</span><span class="pln"> clone </span><span class="pun">=</span><span class="pln"> configuration</span><span class="pun">.</span><span class="pln">rehydrate</span><span class="pun">(</span><span class="pln">e</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
   clone</span><span class="pun">.</span><span class="pln">resolveStrategy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">.</span><span class="pln">DELEGATE_FIRST
   clone</span><span class="pun">.</span><span class="pln">call</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@DelegatesTo</code> takes an optional <code>genericTypeIndex</code> argument that tells what is the index of the generic type that will
be used as the delegate type. This <strong>must</strong> be used in conjunction with <code>@DelegatesTo.Target</code> and the index starts at 0. In
the example above, that means that the delegate type is resolved against <code>List&lt;T&gt;</code>, and since the generic type at index
0 is <code>T</code> and inferred as a <code>Realm</code>, the type checker infers that the delegate type will be of type <code>Realm</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We’re using a <code>genericTypeIndex</code> instead of a placeholder (<code>T</code>) because of JVM limitations.
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_delegating_to_an_arbitrary_type"><a class="anchor" href="#_delegating_to_an_arbitrary_type"></a>Delegating to an arbitrary type</h6>
<div class="paragraph">
<p>It is possible that none of the options above can represent the type you want to delegate to. For example, let’s define
a mapper class which is parametrized with an object and defines a map method which returns an object of another type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Mapper</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">,</span><span class="pln">U</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                             </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> T value                               </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="typ">Mapper</span><span class="pun">(</span><span class="pln">T value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> value </span><span class="pun">}</span><span class="pln">
    U map</span><span class="pun">(</span><span class="typ">Closure</span><span class="pun">&lt;</span><span class="pln">U</span><span class="pun">&gt;</span><span class="pln"> producer</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
        producer</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value
        producer</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The mapper class takes two generic type arguments: the source type and the target type</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The source object is stored in a final field</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>map</code> method asks to convert the source object to a target object</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>As you can see, the method signature from <code>map</code> does not give any information about what object will
be manipulated by the closure. Reading the method body, we know that it will be the <code>value</code> which is
of type <code>T</code>, but <code>T</code> is not found in the method signature, so we are facing a case where none of the
available options for <code>@DelegatesTo</code> is suitable. For example, if we try to statically compile this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> mapper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Mapper</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="typ">Integer</span><span class="pun">&gt;(</span><span class="str">'Hello'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> mapper</span><span class="pun">.</span><span class="pln">map </span><span class="pun">{</span><span class="pln"> length</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">5</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the compiler will fail with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Static type checking] - Cannot find matching method TestScript0#length()</pre>
</div>
</div>
<div class="paragraph">
<p>In that case, you can use the <code>type</code> member of the <code>@DelegatesTo</code> annotation to reference <code>T</code> as a type token:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Mapper</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">,</span><span class="pln">U</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> T value
    </span><span class="typ">Mapper</span><span class="pun">(</span><span class="pln">T value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> value </span><span class="pun">}</span><span class="pln">
    U map</span><span class="pun">(</span><span class="lit">@DelegatesTo</span><span class="pun">(</span><span class="pln">type</span><span class="pun">=</span><span class="str">"T"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">Closure</span><span class="pun">&lt;</span><span class="pln">U</span><span class="pun">&gt;</span><span class="pln"> producer</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        producer</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value
        producer</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@DelegatesTo</code> annotation references a generic type which is not found in the method signature</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Note that you are not limited to generic type tokens. The <code>type</code> member can be used to represent complex types, such
as <code>List&lt;T&gt;</code> or <code>Map&lt;T,List&lt;U&gt;&gt;</code>. The reason why you should use that in last resort is that the type is only checked
when the type checker finds usage of <code>@DelegatesTo</code>, not when the annotated method itself is compiled. This means that
type safety is only ensured at the call site. Additionally, compilation will be slower (though probably unnoticeable for
most cases).</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="compilation-customizers"><a class="anchor" href="#compilation-customizers"></a>3.15.6. Compilation customizers</h4>
<div class="sect4">
<h5 id="_introduction_4"><a class="anchor" href="#_introduction_4"></a>Introduction</h5>
<div class="paragraph">
<p>Whether you are using&nbsp;<code>groovyc</code> to compile classes or a&nbsp;<code>GroovyShell</code>,
for example, to execute scripts, under the hood, a <em>compiler configuration</em> is used. This configuration holds information
like the source encoding or the classpath but it can also be used to perform more operations like adding imports by
default, applying AST transformations transparently or disabling global AST transformations.</p>
</div>
<div class="paragraph">
<p>The goal of compilation customizers is to make those common tasks easy to implement. For that, the&nbsp;<code>CompilerConfiguration</code>
class is the entry point. The general schema will always be based on the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="typ">CompilerConfiguration</span><span class="pln">
</span><span class="com">// create a configuration</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
</span><span class="com">// tweak the configuration</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(...)</span><span class="pln">
</span><span class="com">// run your script</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">config</span><span class="pun">)</span><span class="pln">
shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="pln">script</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Compilation customizers must extend the&nbsp;<em>org.codehaus.groovy.control.customizers.CompilationCustomizer</em> class. A customizer works:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on a specific compilation phase</p>
</li>
<li>
<p>on&nbsp;<em>every</em> class node being compiled</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can implement your own compilation customizer but Groovy includes some of the most common operations.</p>
</div>
</div>
<div class="sect4">
<h5 id="_import_customizer"><a class="anchor" href="#_import_customizer"></a>Import customizer</h5>
<div class="paragraph">
<p>Using this compilation customizer, your code will have imports added
transparently. This is in particular useful for scripts implementing a
DSL where you want to avoid users from having to write imports. The
import customizer will let you add all the variants of imports the
Groovy language allows, that is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>class imports, optionally aliased</p>
</li>
<li>
<p>star imports</p>
</li>
<li>
<p>static imports, optionally aliased</p>
</li>
<li>
<p>static star imports</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="pln">customizers</span><span class="pun">.</span><span class="typ">ImportCustomizer</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> icz </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ImportCustomizer</span><span class="pun">()</span><span class="pln">
</span><span class="com">// "normal" import</span><span class="pln">
icz</span><span class="pun">.</span><span class="pln">addImports</span><span class="pun">(</span><span class="str">'java.util.concurrent.atomic.AtomicInteger'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'java.util.concurrent.ConcurrentHashMap'</span><span class="pun">)</span><span class="pln">
</span><span class="com">// "aliases" import</span><span class="pln">
icz</span><span class="pun">.</span><span class="pln">addImport</span><span class="pun">(</span><span class="str">'CHM'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'java.util.concurrent.ConcurrentHashMap'</span><span class="pun">)</span><span class="pln">
</span><span class="com">// "static" import</span><span class="pln">
icz</span><span class="pun">.</span><span class="pln">addStaticImport</span><span class="pun">(</span><span class="str">'java.lang.Math'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'PI'</span><span class="pun">)</span><span class="pln"> </span><span class="com">// import static java.lang.Math.PI</span><span class="pln">
</span><span class="com">// "aliased static" import</span><span class="pln">
icz</span><span class="pun">.</span><span class="pln">addStaticImport</span><span class="pun">(</span><span class="str">'pi'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'java.lang.Math'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'PI'</span><span class="pun">)</span><span class="pln"> </span><span class="com">// import static java.lang.Math.PI as pi</span><span class="pln">
</span><span class="com">// "star" import</span><span class="pln">
icz</span><span class="pun">.</span><span class="pln">addStarImports </span><span class="str">'java.util.concurrent'</span><span class="pln"> </span><span class="com">// import java.util.concurrent.*</span><span class="pln">
</span><span class="com">// "static star" import</span><span class="pln">
icz</span><span class="pun">.</span><span class="pln">addStaticStars </span><span class="str">'java.lang.Math'</span><span class="pln"> </span><span class="com">// import static java.lang.Math.*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A detailed description of all shortcuts can be found in <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/control/customizers/ImportCustomizer.html">org.codehaus.groovy.control.customizers.ImportCustomizer</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_ast_transformation_customizer"><a class="anchor" href="#_ast_transformation_customizer"></a>AST transformation customizer</h5>
<div class="paragraph">
<p>The AST transformation customizer is meant to apply AST transformations
transparently. Unlike global AST transformations that apply on every
class beeing compiled as long as the transform is found on classpath
(which has drawbacks like increasing the compilation time or side
effects due to transformations applied where they should not), the
customizer will allow you to selectively apply a transform only for
specific scripts or classes.</p>
</div>
<div class="paragraph">
<p>As an example, let’s say you want to be able to use&nbsp;<code>@Log</code> in a script.
The problem is that&nbsp;<code>@Log</code> is normally applied on a class node and a
script, by definition, doesn’t require one. But implementation wise,
scripts are classes, it’s just that you cannot annotate this implicit
class node with&nbsp;<code>@Log</code>. Using the AST customizer, you have a workaround
to do it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="pln">customizers</span><span class="pun">.</span><span class="typ">ASTTransformationCustomizer</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">logging</span><span class="pun">.</span><span class="typ">Log</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> acz </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="typ">Log</span><span class="pun">)</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">acz</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That’s all! Internally, the&nbsp;<code>@Log</code> AST transformation is applied to
every class node in the compilation unit. This means that it will be
applied to the script, but also to classes defined within the script.</p>
</div>
<div class="paragraph">
<p>If the AST transformation that you are using accepts parameters, you can
use parameters in the constructor too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> acz </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="typ">Log</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">:</span><span class="pln"> </span><span class="str">'LOGGER'</span><span class="pun">)</span><span class="pln">
</span><span class="com">// use name 'LOGGER' instead of the default 'log'</span><span class="pln">
config</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">acz</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As the AST transformation customizers works with objects instead of AST
nodes, not all values can be converted to AST transformation parameters.
For example, primitive types are converted to&nbsp;<code>ConstantExpression</code> (that
is <code>LOGGER</code> is converted to&nbsp;<code>new ConstantExpression('LOGGER')</code>, but if
your AST transformation takes a closure as an argument, then you have to
give it a&nbsp;<code>ClosureExpression</code>, like in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> configuration </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> expression </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AstBuilder</span><span class="pun">().</span><span class="pln">buildFromCode</span><span class="pun">(</span><span class="typ">CompilePhase</span><span class="pun">.</span><span class="pln">CONVERSION</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">}.</span><span class="pln">expression</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> customizer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ASTTransformationCustomizer</span><span class="pun">(</span><span class="typ">ConditionalInterrupt</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">:</span><span class="pln"> expression</span><span class="pun">,</span><span class="pln"> thrown</span><span class="pun">:</span><span class="pln"> </span><span class="typ">SecurityException</span><span class="pun">)</span><span class="pln">
configuration</span><span class="pun">.</span><span class="pln">addCompilationCustomizers</span><span class="pun">(</span><span class="pln">customizer</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> shell </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">)</span><span class="pln">
shouldFail</span><span class="pun">(</span><span class="typ">SecurityException</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    shell</span><span class="pun">.</span><span class="pln">evaluate</span><span class="pun">(</span><span class="str">"""
        // equivalent to adding @ConditionalInterrupt(value={true}, thrown: SecurityException)
        class MyClass {
            void doIt() { }
        }
        new MyClass().doIt()
    """</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a complete list of options, please refer to <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/control/customizers/ASTTransformationCustomizer.html">org.codehaus.groovy.control.customizers.ASTTransformationCustomizer</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_secure_ast_customizer"><a class="anchor" href="#_secure_ast_customizer"></a>Secure AST customizer</h5>
<div class="paragraph">
<p>This customizer will allow the developer of a DSL to restrict the
<strong>grammar</strong> of the language, to prevent users from using some constructs,
for example. It is only ``secure'' in that sense only and it is very
important to understand that it does&nbsp;<strong>not</strong> replace a security manager.
The only reason for it to exist is to limit the expressiveness of the
language. This customizer only works at the AST (abstract syntax tree)
level, not at runtime! It can be strange at first glance, but it makes
much more sense if you think of Groovy as a platform to build DSLs. You
may not want a user to have a complete language at hand. In the example
below, we will demonstrate it using an example of language that only
allows arithmetic operations, but this customizer allows you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>allow/disallow creation of closures</p>
</li>
<li>
<p>allow/disallow imports</p>
</li>
<li>
<p>allow/disallow package definition</p>
</li>
<li>
<p>allow/disallow definition of methods</p>
</li>
<li>
<p>restrict the receivers of method calls</p>
</li>
<li>
<p>restrict the kind of AST expressions a user can use</p>
</li>
<li>
<p>restrict the tokens (grammar-wise) a user can use</p>
</li>
<li>
<p>restrict the types of the constants that can be used in code</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For all those features, the secure AST customizer works using either a
whitelist (list of elements that are allowed)&nbsp;<strong>or</strong> a blacklist (list of
elements that are disallowed). For each type of feature (imports,
tokens, …) you have the choice to use either a whitelist or a blacklist,
but you can mix whitelists and blacklists for distinct features. In
general, you will choose whitelists (disallow all, allow selected).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="pln">customizers</span><span class="pun">.</span><span class="typ">SecureASTCustomizer</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">syntax</span><span class="pun">.</span><span class="typ">Types</span><span class="pun">.*</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> scz </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SecureASTCustomizer</span><span class="pun">()</span><span class="pln">
scz</span><span class="pun">.</span><span class="kwd">with</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    closuresAllowed </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="com">// user will not be able to write closures</span><span class="pln">
    methodDefinitionAllowed </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"> </span><span class="com">// user will not be able to define methods</span><span class="pln">
    importsWhitelist </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln"> </span><span class="com">// empty whitelist means imports are disallowed</span><span class="pln">
    staticImportsWhitelist </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln"> </span><span class="com">// same for static imports</span><span class="pln">
    staticStarImportsWhitelist </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'java.lang.Math'</span><span class="pun">]</span><span class="pln"> </span><span class="com">// only java.lang.Math is allowed</span><span class="pln">
    </span><span class="com">// the list of tokens the user can find</span><span class="pln">
    </span><span class="com">// constants are defined in org.codehaus.groovy.syntax.Types</span><span class="pln">
    tokensWhitelist </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
            PLUS</span><span class="pun">,</span><span class="pln">
            MINUS</span><span class="pun">,</span><span class="pln">
            MULTIPLY</span><span class="pun">,</span><span class="pln">
            DIVIDE</span><span class="pun">,</span><span class="pln">
            MOD</span><span class="pun">,</span><span class="pln">
            POWER</span><span class="pun">,</span><span class="pln">
            PLUS_PLUS</span><span class="pun">,</span><span class="pln">
            MINUS_MINUS</span><span class="pun">,</span><span class="pln">
            COMPARE_EQUAL</span><span class="pun">,</span><span class="pln">
            COMPARE_NOT_EQUAL</span><span class="pun">,</span><span class="pln">
            COMPARE_LESS_THAN</span><span class="pun">,</span><span class="pln">
            COMPARE_LESS_THAN_EQUAL</span><span class="pun">,</span><span class="pln">
            COMPARE_GREATER_THAN</span><span class="pun">,</span><span class="pln">
            COMPARE_GREATER_THAN_EQUAL</span><span class="pun">,</span><span class="pln">
    </span><span class="pun">].</span><span class="pln">asImmutable</span><span class="pun">()</span><span class="pln">
    </span><span class="com">// limit the types of constants that a user can define to number types only</span><span class="pln">
    constantTypesClassesWhiteList </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
            </span><span class="typ">Integer</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Float</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Long</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Double</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">BigDecimal</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">TYPE</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Long</span><span class="pun">.</span><span class="pln">TYPE</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Float</span><span class="pun">.</span><span class="pln">TYPE</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Double</span><span class="pun">.</span><span class="pln">TYPE
    </span><span class="pun">].</span><span class="pln">asImmutable</span><span class="pun">()</span><span class="pln">
    </span><span class="com">// method calls are only allowed if the receiver is of one of those types</span><span class="pln">
    </span><span class="com">// be careful, it's not a runtime type!</span><span class="pln">
    receiversClassesWhiteList </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
            </span><span class="typ">Math</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Integer</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Float</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Double</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">Long</span><span class="pun">,</span><span class="pln">
            </span><span class="typ">BigDecimal</span><span class="pln">
    </span><span class="pun">].</span><span class="pln">asImmutable</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>use for token types from <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/syntax/Types.html">org.codehaus.groovy.syntax.Types</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>you can use class literals here</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If what the secure AST customizer provides out of the box isn’t enough
for your needs, before creating your own compilation customizer, you
might be interested in the expression and statement checkers that the
AST customizer supports. Basically, it allows you to add custom checks
on the AST tree, on expressions (expression checkers) or statements
(statement checkers). For this, you must
implement&nbsp;<code>org.codehaus.groovy.control.customizers.SecureASTCustomizer.StatementChecker</code>
or&nbsp;<code>org.codehaus.groovy.control.customizers.SecureASTCustomizer.ExpressionChecker</code>.</p>
</div>
<div class="paragraph">
<p>Those interfaces define a single method called&nbsp;<code>isAuthorized</code>, returning
a boolean, and taking a&nbsp;<code>Statement</code> (or&nbsp;<code>Expression</code>) as a parameter. It
allows you to perform complex logic over expressions or statements to
tell if a user is allowed to do it or not.</p>
</div>
<div class="paragraph">
<p>For example, there’s no predefined configuration flag in the customizer which
will let you prevent people from using an attribute expression. Using a custom
checker, it is trivial:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> scz </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SecureASTCustomizer</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> checker </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> expr </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="pun">!(</span><span class="pln">expr </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">AttributeExpression</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">SecureASTCustomizer</span><span class="pun">.</span><span class="typ">ExpressionChecker</span><span class="pln">
scz</span><span class="pun">.</span><span class="pln">addExpressionCheckers</span><span class="pun">(</span><span class="pln">checker</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we can make sure that this works by evaluating a simple script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyShell</span><span class="pun">(</span><span class="pln">config</span><span class="pun">).</span><span class="pln">evaluate </span><span class="str">'''
    class A {
        int val
    }
    
    def a = new A(val: 123)
    a.@val </span><i class="conum" data-value="1"></i><b><span class="str">(1)</span></b><span class="str">
'''</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>will fail compilation</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Statements can be checked using <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/control/customizers/SecureASTCustomizer/StatementChecker.html">org.codehaus.groovy.control.customizers.SecureASTCustomizer.StatementChecker</a>
Expressions can be checked using <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?org/codehaus/groovy/control/customizers/SecureASTCustomizer/ExpressionChecker.html">org.codehaus.groovy.control.customizers.SecureASTCustomizer.ExpressionChecker</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_source_aware_customizer"><a class="anchor" href="#_source_aware_customizer"></a>Source aware customizer</h5>
<div class="paragraph">
<p>This customizer may be used as a filter on other customizers. The
filter, in that case, is the&nbsp;<code>org.codehaus.groovy.control.SourceUnit</code>.
For this, the source aware customizer takes another customizer as a
delegate, and it will apply customization of that delegate only and only
if predicates on the source unit match.</p>
</div>
<div class="paragraph">
<p><code>SourceUnit</code> gives you access to multiple things but in particular the
file being compiled (if compiling from a file, of course). It gives
you the potential to perform operation based on the file name, for
example. Here is how you would create a source aware customizer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="pln">customizers</span><span class="pun">.</span><span class="typ">SourceAwareCustomizer</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="pln">customizers</span><span class="pun">.</span><span class="typ">ImportCustomizer</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ImportCustomizer</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> sac </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SourceAwareCustomizer</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can use predicates on the source aware customizer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// the customizer will only be applied to classes contained in a file name ending with 'Bean'</span><span class="pln">
sac</span><span class="pun">.</span><span class="pln">baseNameValidator </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> baseName </span><span class="pun">-&gt;</span><span class="pln">
    baseName</span><span class="pun">.</span><span class="pln">endsWith </span><span class="str">'Bean'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// the customizer will only be applied to files which extension is '.spec'</span><span class="pln">
sac</span><span class="pun">.</span><span class="pln">extensionValidator </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> ext </span><span class="pun">-&gt;</span><span class="pln"> ext </span><span class="pun">==</span><span class="pln"> </span><span class="str">'spec'</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="com">// source unit validation</span><span class="pln">
</span><span class="com">// allow compilation only if the file contains at most 1 class</span><span class="pln">
sac</span><span class="pun">.</span><span class="pln">sourceUnitValidator </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">SourceUnit</span><span class="pln"> sourceUnit </span><span class="pun">-&gt;</span><span class="pln"> sourceUnit</span><span class="pun">.</span><span class="pln">AST</span><span class="pun">.</span><span class="pln">classes</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="com">// class validation</span><span class="pln">
</span><span class="com">// the customizer will only be applied to classes ending with 'Bean'</span><span class="pln">
sac</span><span class="pun">.</span><span class="pln">classValidator </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">ClassNode</span><span class="pln"> cn </span><span class="pun">-&gt;</span><span class="pln"> cn</span><span class="pun">.</span><span class="pln">endsWith</span><span class="pun">(</span><span class="str">'Bean'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_customizer_builder"><a class="anchor" href="#_customizer_builder"></a>Customizer builder</h5>
<div class="paragraph">
<p>If you are using compilation customizers in Groovy code (like the
examples above) then you can use an alternative syntax to customize compilation.
A builder&nbsp;(<code>org.codehaus.groovy.control.customizers.builder.CompilerCustomizationBuilder</code>)
simplifies the creation of customizers using a hierarchical DSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="typ">CompilerConfiguration</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="pln">customizers</span><span class="pun">.</span><span class="pln">builder</span><span class="pun">.</span><span class="typ">CompilerCustomizationBuilder</span><span class="pun">.</span><span class="pln">withConfig </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> conf </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CompilerConfiguration</span><span class="pun">()</span><span class="pln">
withConfig</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ... </span><i class="conum" data-value="2"></i><b><span class="com">(2)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>static import of the builder method</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>configuration goes here</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The code sample above shows how to use the builder. A static
method,&nbsp;<em>withConfig</em>, takes a closure corresponding to the builder code,
and automatically registers compilation customizers to the
configuration. Every compilation customizer available in the distribution
can be configured this way:</p>
</div>
<div class="sect5">
<h6 id="_import_customizer_2"><a class="anchor" href="#_import_customizer_2"></a>Import customizer</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   imports </span><span class="pun">{</span><span class="pln"> </span><span class="com">// imports customizer</span><span class="pln">
      normal </span><span class="str">'my.package.MyClass'</span><span class="pln"> </span><span class="com">// a normal import</span><span class="pln">
      </span><span class="kwd">alias</span><span class="pln"> </span><span class="str">'AI'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'java.util.concurrent.atomic.AtomicInteger'</span><span class="pln"> </span><span class="com">// an aliased import</span><span class="pln">
      star </span><span class="str">'java.util.concurrent'</span><span class="pln"> </span><span class="com">// star imports</span><span class="pln">
      staticMember </span><span class="str">'java.lang.Math'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'PI'</span><span class="pln"> </span><span class="com">// static import</span><span class="pln">
      staticMember </span><span class="str">'pi'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'java.lang.Math'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'PI'</span><span class="pln"> </span><span class="com">// aliased static import</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_ast_transformation_customizer_2"><a class="anchor" href="#_ast_transformation_customizer_2"></a>AST transformation customizer</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">withConfig</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   ast</span><span class="pun">(</span><span class="typ">Log</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span><span class="pln">

withConfig</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   ast</span><span class="pun">(</span><span class="typ">Log</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">:</span><span class="pln"> </span><span class="str">'LOGGER'</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>apply @Log transparently</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>apply @Log with a different name for the logger</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_secure_ast_customizer_2"><a class="anchor" href="#_secure_ast_customizer_2"></a>Secure AST customizer</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">withConfig</span><span class="pun">(</span><span class="pln">conf</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   secureAst </span><span class="pun">{</span><span class="pln">
       closuresAllowed </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
       methodDefinitionAllowed </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
   </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_source_aware_customizer_2"><a class="anchor" href="#_source_aware_customizer_2"></a>Source aware customizer</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">){</span><span class="pln">
    source</span><span class="pun">(</span><span class="pln">extension</span><span class="pun">:</span><span class="pln"> </span><span class="str">'sgroovy'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ast</span><span class="pun">(</span><span class="typ">CompileStatic</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">){</span><span class="pln">
    source</span><span class="pun">(</span><span class="pln">extensions</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'sgroovy'</span><span class="pun">,</span><span class="str">'sg'</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ast</span><span class="pun">(</span><span class="typ">CompileStatic</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    source</span><span class="pun">(</span><span class="pln">extensionValidator</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">name </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="str">'sgroovy'</span><span class="pun">,</span><span class="str">'sg'</span><span class="pun">]})</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ast</span><span class="pun">(</span><span class="typ">CompileStatic</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    source</span><span class="pun">(</span><span class="pln">basename</span><span class="pun">:</span><span class="pln"> </span><span class="str">'foo'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ast</span><span class="pun">(</span><span class="typ">CompileStatic</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    source</span><span class="pun">(</span><span class="pln">basenames</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'foo'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'bar'</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ast</span><span class="pun">(</span><span class="typ">CompileStatic</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    source</span><span class="pun">(</span><span class="pln">basenameValidator</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> it </span><span class="kwd">in</span><span class="pln"> </span><span class="pun">[</span><span class="str">'foo'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'bar'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">})</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ast</span><span class="pun">(</span><span class="typ">CompileStatic</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    source</span><span class="pun">(</span><span class="pln">unitValidator</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> unit </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">unit</span><span class="pun">.</span><span class="pln">AST</span><span class="pun">.</span><span class="pln">classes</span><span class="pun">.</span><span class="pln">any </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Baz'</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">})</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        ast</span><span class="pun">(</span><span class="typ">CompileStatic</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>apply CompileStatic AST annotation on .sgroovy files</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>apply CompileStatic AST annotation on .sgroovy or .sg files</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>apply CompileStatic AST annotation on files whose name is 'foo'</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>apply CompileStatic AST annotation on files whose name is 'foo' or 'bar'</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>apply CompileStatic AST annotation on files that do not contain a class named 'Baz'</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_inlining_a_customizer"><a class="anchor" href="#_inlining_a_customizer"></a>Inlining a customizer</h6>
<div class="paragraph">
<p>Inlined customizer allows you to write a compilation customizer
directly, without having to create a class for it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">inline</span><span class="pun">(</span><span class="pln">phase</span><span class="pun">:</span><span class="str">'CONVERSION'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> source</span><span class="pun">,</span><span class="pln"> context</span><span class="pun">,</span><span class="pln"> classNode </span><span class="pun">-&gt;</span><span class="pln">  </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
        println </span><span class="str">"visiting $classNode"</span><span class="pln">                           </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define an inlined customizer which will execute at the CONVERSION phase</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>prints the name of the class node being compiled</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect5">
<h6 id="_multiple_customizers"><a class="anchor" href="#_multiple_customizers"></a>Multiple customizers</h6>
<div class="paragraph">
<p>Of course, the builder allows you to define multiple customizers at
once:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   ast</span><span class="pun">(</span><span class="typ">ToString</span><span class="pun">)</span><span class="pln">
   ast</span><span class="pun">(</span><span class="typ">EqualsAndHashCode</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_config_script_flag"><a class="anchor" href="#_config_script_flag"></a>Config script flag</h5>
<div class="paragraph">
<p>So far, we have described how you can customize compilation using
a&nbsp;<code>CompilationConfiguration</code> class, but this is only possible if you
embed Groovy and that you create your own instances
of&nbsp;<code>CompilerConfiguration</code> (then use it to create a
<code>GroovyShell</code>,&nbsp;<code>GroovyScriptEngine</code>, …).</p>
</div>
<div class="paragraph">
<p>If you want it to be applied on the classes you compile with the normal
Groovy compiler (that is to say with &nbsp;<code>groovyc</code>,&nbsp;<code>ant</code> or&nbsp;<code>gradle</code>,
for example), it is possible to use a compilation flag named&nbsp;<code>configscript</code>
that takes a Groovy configuration script as argument.</p>
</div>
<div class="paragraph">
<p>This script gives you access to the&nbsp;<code>CompilerConfiguration</code> instance&nbsp;<strong>before</strong>
the files are compiled (exposed into the configuration script as a variable named <code>configuration</code>),
so that you can tweak it.</p>
</div>
<div class="paragraph">
<p>It also transparently integrates the compiler configuration builder above. As an example, let’s see
how you would activate static compilation by default on all classes.</p>
</div>
<div class="sect5">
<h6 id="_static_compilation_by_default"><a class="anchor" href="#_static_compilation_by_default"></a>Static compilation by default</h6>
<div class="paragraph">
<p>Normally, classes in Groovy are compiled with a dynamic runtime. You can activate static compilation
by placing an annotation named <code>@CompileStatic</code> on any class. Some people would like to have this
mode activated by default, that is to say not having to annotated classes. Using <code>configscript</code>,
this is possible. First of all, you need to create a file named <code>config.groovy</code> into <code>src/conf</code> with
the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">withConfig</span><span class="pun">(</span><span class="pln">configuration</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
   ast</span><span class="pun">(</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">transform</span><span class="pun">.</span><span class="typ">CompileStatic</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>configuration</em> references a <code>CompilerConfiguration</code> instance</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>That is actually all you need. You don’t have to import the builder, it’s automatically
exposed in the script. Then, compile your files using the following command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>groovyc -configscript src/conf/config.groovy src/main/groovy/MyClass.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>We strongly recommend you to separate configuration files from classes,
hence why we suggest using the <code>src/main</code> and <code>src/conf</code> directories above.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ast_transformations"><a class="anchor" href="#_ast_transformations"></a>AST transformations</h5>
<div class="paragraph">
<p>If:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>runtime metaprogramming doesn’t allow you do do what you want</p>
</li>
<li>
<p>you need to improve the performance of the execution of your DSLs</p>
</li>
<li>
<p>you want to leverage the same syntax as Groovy but with different semantics</p>
</li>
<li>
<p>you want to improve support for type checking in your DSLs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then AST transformations are the way to go. Unlike the techniques used so far, AST transformations are meant to
change or generate code before it is compiled to bytecode. AST transformations are capable of adding new methods at
compile time for example, or totally changing the body of a method based on your needs. They are a very powerful tool
but also come at the price of not being easy to write. For more information about AST transformations, please take
a look at the <a href="http://docs.groovy-lang.org/latest/html/documentation/index.html#_compile_time_metaprogramming">compile-time
metaprogramming</a> section of this manual.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_type_checking_extensions"><a class="anchor" href="#_custom_type_checking_extensions"></a>3.15.7. Custom type checking extensions</h4>
<div class="paragraph">
<p>It may be interesting, in some circumstances, to provide feedback about wrong code to the user as soon as possible,
that is to say when the DSL script is compiled, rather than having to wait for the execution of the script. However,
this is not often possible with dynamic code. Groovy actually provides a practical answer to this known as
<a href="http://docs.groovy-lang.org/latest/html/documentation/type-checking-extensions.html">type checking extensions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_builders"><a class="anchor" href="#_builders"></a>3.15.8. Builders</h4>
<div class="paragraph">
<p>(TBD)</p>
</div>
<div class="sect4">
<h5 id="_creating_a_builder"><a class="anchor" href="#_creating_a_builder"></a>Creating a builder</h5>
<div class="paragraph">
<p>(TBD)</p>
</div>
<div class="sect5">
<h6 id="_buildersupport"><a class="anchor" href="#_buildersupport"></a>BuilderSupport</h6>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
<div class="sect5">
<h6 id="_factorybuildersupport"><a class="anchor" href="#_factorybuildersupport"></a>FactoryBuilderSupport</h6>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_existing_builders"><a class="anchor" href="#_existing_builders"></a>Existing builders</h5>
<div class="paragraph">
<p>(TBD)</p>
</div>
<div class="sect5">
<h6 id="_markupbuilder_2"><a class="anchor" href="#_markupbuilder_2"></a>MarkupBuilder</h6>
<div class="paragraph">
<p>See <a href="#_markupbuilder">Creating Xml - MarkupBuilder</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_streamingmarkupbuilder_2"><a class="anchor" href="#_streamingmarkupbuilder_2"></a>StreamingMarkupBuilder</h6>
<div class="paragraph">
<p>See <a href="#_streamingmarkupbuilder">Creating Xml - StreamingMarkupBuilder</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_saxbuilder"><a class="anchor" href="#_saxbuilder"></a>SaxBuilder</h6>
<div class="paragraph">
<p>A builder for generating <a href="https://en.wikipedia.org/wiki/Simple_API_for_XML">Simple API for XML (SAX)</a> events.</p>
</div>
<div class="paragraph">
<p>If you have the following SAX handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">LogHandler</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="pln">sax</span><span class="pun">.</span><span class="pln">helpers</span><span class="pun">.</span><span class="typ">DefaultHandler</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="typ">String</span><span class="pln"> log </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> startElement</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> uri</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> localName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> qName</span><span class="pun">,</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="pln">sax</span><span class="pun">.</span><span class="typ">Attributes</span><span class="pln"> attributes</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        log </span><span class="pun">+=</span><span class="pln"> </span><span class="str">"Start Element: $localName, "</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> endElement</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> uri</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> localName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> qName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        log </span><span class="pun">+=</span><span class="pln"> </span><span class="str">"End Element: $localName, "</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use <code>SaxBuilder</code> to generate SAX events for the handler like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> handler </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">LogHandler</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="typ">SAXBuilder</span><span class="pun">(</span><span class="pln">handler</span><span class="pun">)</span><span class="pln">

builder</span><span class="pun">.</span><span class="pln">root</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    helloWorld</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And then check that everything worked as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> handler</span><span class="pun">.</span><span class="pln">log </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Start Element: root, Start Element: helloWorld, End Element: helloWorld, End Element: root, '</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_staxbuilder"><a class="anchor" href="#_staxbuilder"></a>StaxBuilder</h6>
<div class="paragraph">
<p>A Groovy builder that works with <a href="http://en.wikipedia.org/wiki/StAX">Streaming API for XML (StAX)</a> processors.</p>
</div>
<div class="paragraph">
<p>Here is a simple example using the StAX implementation of Java to generate XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> factory </span><span class="pun">=</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="pln">stream</span><span class="pun">.</span><span class="typ">XMLOutputFactory</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> writer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="typ">StaxBuilder</span><span class="pun">(</span><span class="pln">factory</span><span class="pun">.</span><span class="pln">createXMLStreamWriter</span><span class="pun">(</span><span class="pln">writer</span><span class="pun">))</span><span class="pln">

builder</span><span class="pun">.</span><span class="pln">root</span><span class="pun">(</span><span class="pln">attribute</span><span class="pun">:</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    elem1</span><span class="pun">(</span><span class="str">'hello'</span><span class="pun">)</span><span class="pln">
    elem2</span><span class="pun">(</span><span class="str">'world'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> writer</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'&lt;?xml version="1.0" ?&gt;&lt;root attribute="1"&gt;&lt;elem1&gt;hello&lt;/elem1&gt;&lt;elem2&gt;world&lt;/elem2&gt;&lt;/root&gt;'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An external library such as <a href="http://jettison.codehaus.org/">Jettison</a> can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'org.codehaus.jettison:jettison:1.3.3'</span><span class="pun">)</span><span class="pln">
</span><span class="lit">@GrabExclude</span><span class="pun">(</span><span class="str">'stax:stax-api'</span><span class="pun">)</span><span class="pln"> </span><span class="com">// part of Java 6 and later</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">codehaus</span><span class="pun">.</span><span class="pln">jettison</span><span class="pun">.</span><span class="pln">mapped</span><span class="pun">.*</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> writer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> mappedWriter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MappedXMLStreamWriter</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MappedNamespaceConvention</span><span class="pun">(),</span><span class="pln"> writer</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="typ">StaxBuilder</span><span class="pun">(</span><span class="pln">mappedWriter</span><span class="pun">)</span><span class="pln">

builder</span><span class="pun">.</span><span class="pln">root</span><span class="pun">(</span><span class="pln">attribute</span><span class="pun">:</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
     elem1</span><span class="pun">(</span><span class="str">'hello'</span><span class="pun">)</span><span class="pln">
     elem2</span><span class="pun">(</span><span class="str">'world'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> writer</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'{"root":{"@attribute":"1","elem1":"hello","elem2":"world"}}'</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_dombuilder"><a class="anchor" href="#_dombuilder"></a>DOMBuilder</h6>
<div class="paragraph">
<p>A builder for parsing HTML, XHTML and XML into a <a href="https://en.wikipedia.org/wiki/Document_Object_Model">W3C DOM</a> tree.</p>
</div>
<div class="paragraph">
<p>For example this XML <code>String</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> recordsXML </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''
    &lt;records&gt;
      &lt;car name='</span><span class="pln">HSV </span><span class="typ">Maloo</span><span class="str">' make='</span><span class="typ">Holden</span><span class="str">' year='</span><span class="lit">2006</span><span class="str">'&gt;
        &lt;country&gt;Australia&lt;/country&gt;
        &lt;record type='</span><span class="pln">speed</span><span class="str">'&gt;Production Pickup Truck with speed of 271kph&lt;/record&gt;
      &lt;/car&gt;
      &lt;car name='</span><span class="pln">P50</span><span class="str">' make='</span><span class="typ">Peel</span><span class="str">' year='</span><span class="lit">1962</span><span class="str">'&gt;
        &lt;country&gt;Isle of Man&lt;/country&gt;
        &lt;record type='</span><span class="pln">size</span><span class="str">'&gt;Smallest Street-Legal Car at 99cm wide and 59 kg in weight&lt;/record&gt;
      &lt;/car&gt;
      &lt;car name='</span><span class="typ">Royale</span><span class="str">' make='</span><span class="typ">Bugatti</span><span class="str">' year='</span><span class="lit">1931</span><span class="str">'&gt;
        &lt;country&gt;France&lt;/country&gt;
        &lt;record type='</span><span class="pln">price</span><span class="str">'&gt;Most Valuable Car at $15 million&lt;/record&gt;
      &lt;/car&gt;
    &lt;/records&gt;'''</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Can be parsed into a DOM tree with a <code>DOMBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringReader</span><span class="pun">(</span><span class="pln">recordsXML</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> doc </span><span class="pun">=</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="typ">DOMBuilder</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">reader</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And then processed further e.g. by using <a href="#_domcategory">DOMCategory</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> records </span><span class="pun">=</span><span class="pln"> doc</span><span class="pun">.</span><span class="pln">documentElement
</span><span class="kwd">use</span><span class="pun">(</span><span class="pln">groovy</span><span class="pun">.</span><span class="pln">xml</span><span class="pun">.</span><span class="pln">dom</span><span class="pun">.</span><span class="typ">DOMCategory</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> records</span><span class="pun">.</span><span class="pln">car</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_nodebuilder"><a class="anchor" href="#_nodebuilder"></a>NodeBuilder</h6>
<div class="paragraph">
<p><code>NodeBuilder</code> is used for creating nested trees of <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/util/Node.html">Node</a> objects for handling arbitrary data.
To create a simple user list you use a <code>NodeBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> nodeBuilder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NodeBuilder</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> userlist </span><span class="pun">=</span><span class="pln"> nodeBuilder</span><span class="pun">.</span><span class="pln">userlist </span><span class="pun">{</span><span class="pln">
    user</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">,</span><span class="pln"> firstname</span><span class="pun">:</span><span class="pln"> </span><span class="str">'John'</span><span class="pun">,</span><span class="pln"> lastname</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Smith'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        address</span><span class="pun">(</span><span class="pln">type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'home'</span><span class="pun">,</span><span class="pln"> street</span><span class="pun">:</span><span class="pln"> </span><span class="str">'1 Main St.'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Springfield'</span><span class="pun">,</span><span class="pln"> state</span><span class="pun">:</span><span class="pln"> </span><span class="str">'MA'</span><span class="pun">,</span><span class="pln"> zip</span><span class="pun">:</span><span class="pln"> </span><span class="str">'12345'</span><span class="pun">)</span><span class="pln">
        address</span><span class="pun">(</span><span class="pln">type</span><span class="pun">:</span><span class="pln"> </span><span class="str">'work'</span><span class="pun">,</span><span class="pln"> street</span><span class="pun">:</span><span class="pln"> </span><span class="str">'2 South St.'</span><span class="pun">,</span><span class="pln"> city</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Boston'</span><span class="pun">,</span><span class="pln"> state</span><span class="pun">:</span><span class="pln"> </span><span class="str">'MA'</span><span class="pun">,</span><span class="pln"> zip</span><span class="pun">:</span><span class="pln"> </span><span class="str">'98765'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    user</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="str">'2'</span><span class="pun">,</span><span class="pln"> firstname</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Alice'</span><span class="pun">,</span><span class="pln"> lastname</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Doe'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can process the data further, e.g. by using <a href="#gpath_expressions">GPath expressions</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> userlist</span><span class="pun">.</span><span class="pln">user</span><span class="pun">.</span><span class="lit">@firstname</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="str">', '</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'John, Alice'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> userlist</span><span class="pun">.</span><span class="pln">user</span><span class="pun">.</span><span class="pln">find </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="lit">@lastname</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Smith'</span><span class="pln"> </span><span class="pun">}.</span><span class="pln">address</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">2</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_jsonbuilder"><a class="anchor" href="#_jsonbuilder"></a>JsonBuilder</h6>
<div class="paragraph">
<p>Groovy’s <code>JsonBuilder</code> makes it easy to create Json. For example to create this Json string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> carRecords </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''
    {
        "records": {
        "car": {
            "name": "HSV Maloo",
            "make": "Holden",
            "year": 2006,
            "country": "Australia",
            "record": {
              "type": "speed",
              "description": "production pickup truck with speed of 271kph"
            }
          }
      }
    }
'''</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>you can use a <code>JsonBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">JsonBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JsonBuilder</span><span class="pun">()</span><span class="pln">
builder</span><span class="pun">.</span><span class="pln">records </span><span class="pun">{</span><span class="pln">
  car </span><span class="pun">{</span><span class="pln">
        name </span><span class="str">'HSV Maloo'</span><span class="pln">
        make </span><span class="str">'Holden'</span><span class="pln">
        year </span><span class="lit">2006</span><span class="pln">
        country </span><span class="str">'Australia'</span><span class="pln">
        record </span><span class="pun">{</span><span class="pln">
            type </span><span class="str">'speed'</span><span class="pln">
            description </span><span class="str">'production pickup truck with speed of 271kph'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> json </span><span class="pun">=</span><span class="pln"> </span><span class="typ">JsonOutput</span><span class="pun">.</span><span class="pln">prettyPrint</span><span class="pun">(</span><span class="pln">builder</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use <a href="https://github.com/lukas-krecan/JsonUnit">JsonUnit</a> to check that the builder produced the expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">JsonAssert</span><span class="pun">.</span><span class="pln">assertJsonEquals</span><span class="pun">(</span><span class="pln">json</span><span class="pun">,</span><span class="pln"> carRecords</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_streamingjsonbuilder"><a class="anchor" href="#_streamingjsonbuilder"></a>StreamingJsonBuilder</h6>
<div class="paragraph">
<p>Unlike <code>JsonBuilder</code> which creates a data structure in 
memory, which is handy in those situations where you want to alter the 
structure programmatically before output,
<code>StreamingJsonBuilder</code> directly streams to a writer without any intermediate memory data structure.
If you do not need to modify the structure and want a more memory-efficient approach, use <code>StreamingJsonBuilder</code>.</p>
</div>
<div class="paragraph">
<p>The usage of <code>StreamingJsonBuilder</code> is similar to <code>JsonBuilder</code>. In order to create this Json string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">String</span><span class="pln"> carRecords </span><span class="pun">=</span><span class="pln"> </span><span class="str">'''
    {
        "records": {
        "car": {
            "name": "HSV Maloo",
            "make": "Holden",
            "year": 2006,
            "country": "Australia",
            "record": {
              "type": "speed",
              "description": "production pickup truck with speed of 271kph"
            }
          }
      }
    }
'''</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>you use a <code>StreamingJsonBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">StringWriter</span><span class="pln"> writer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StringWriter</span><span class="pun">()</span><span class="pln">
</span><span class="typ">StreamingJsonBuilder</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">StreamingJsonBuilder</span><span class="pun">(</span><span class="pln">writer</span><span class="pun">)</span><span class="pln">
builder</span><span class="pun">.</span><span class="pln">records </span><span class="pun">{</span><span class="pln">
  car </span><span class="pun">{</span><span class="pln">
        name </span><span class="str">'HSV Maloo'</span><span class="pln">
        make </span><span class="str">'Holden'</span><span class="pln">
        year </span><span class="lit">2006</span><span class="pln">
        country </span><span class="str">'Australia'</span><span class="pln">
        record </span><span class="pun">{</span><span class="pln">
            type </span><span class="str">'speed'</span><span class="pln">
            description </span><span class="str">'production pickup truck with speed of 271kph'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="typ">String</span><span class="pln"> json </span><span class="pun">=</span><span class="pln"> </span><span class="typ">JsonOutput</span><span class="pun">.</span><span class="pln">prettyPrint</span><span class="pun">(</span><span class="pln">writer</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use <a href="https://github.com/lukas-krecan/JsonUnit">JsonUnit</a> to check the expected result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">JsonAssert</span><span class="pun">.</span><span class="pln">assertJsonEquals</span><span class="pun">(</span><span class="pln">json</span><span class="pun">,</span><span class="pln"> carRecords</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="swingbuilder"><a class="anchor" href="#swingbuilder"></a>SwingBuilder</h6>
<div class="paragraph">
<p><code>SwingBuilder</code> allows you to create full-fledged Swing 
GUIs in a declarative and concise fashion. It accomplishes this by 
employing a common idiom in Groovy, builders.
Builders handle the busywork of creating complex objects for you, such 
as instantiating children, calling Swing methods, and attaching these 
children to their parents.
As a consequence, your code is much more readable and maintainable, 
while still allowing you access to the full range of Swing components.</p>
</div>
<div class="paragraph">
<p>Here’s a simple example of using <code>SwingBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.</span><span class="typ">SwingBuilder</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">awt</span><span class="pun">.</span><span class="typ">BorderLayout</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> BL

count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SwingBuilder</span><span class="pun">().</span><span class="pln">edt </span><span class="pun">{</span><span class="pln">
  frame</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Frame'</span><span class="pun">,</span><span class="pln"> size</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="lit">300</span><span class="pun">,</span><span class="pln"> </span><span class="lit">300</span><span class="pun">],</span><span class="pln"> show</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    borderLayout</span><span class="pun">()</span><span class="pln">
    textlabel </span><span class="pun">=</span><span class="pln"> label</span><span class="pun">(</span><span class="pln">text</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Click the button!'</span><span class="pun">,</span><span class="pln"> constraints</span><span class="pun">:</span><span class="pln"> BL</span><span class="pun">.</span><span class="pln">NORTH</span><span class="pun">)</span><span class="pln">
    button</span><span class="pun">(</span><span class="pln">text</span><span class="pun">:</span><span class="str">'Click Me'</span><span class="pun">,</span><span class="pln">
         actionPerformed</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">count</span><span class="pun">++;</span><span class="pln"> textlabel</span><span class="pun">.</span><span class="pln">text </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Clicked ${count} time(s)."</span><span class="pun">;</span><span class="pln"> println </span><span class="str">"clicked"</span><span class="pun">},</span><span class="pln"> constraints</span><span class="pun">:</span><span class="pln">BL</span><span class="pun">.</span><span class="pln">SOUTH</span><span class="pun">)</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what it will look like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHMAAABDCAMAAACY58p5AAABFFBMVEUAAAAKJGoOKW4TLnIYM3YdOHoiPX4zM2ZAQEAnQ4MsSIcxTYs1Uo86V5M/XZgxcsheTYtEYpxJZ6BObKRTcahYd61Xd7xcfLFoXZhJZ8JmZswUg9VhgbVmhrlri71omt9wkMF1lsZ6m8p/oM5uuvFyvPGtOzGuPTPXW1PYXFSLXZiPZ6DfnnjfoHfhnXbgn3fgnnvjnXninHrinnnkm3iAgIC5nbmPhdKZmf+DpdKIqtaNsNuStd+XuuOcv+eIyPSP0v+Tz/aa1/+e1vmhxOumyvC16//irp7mvrj/x6vU0MjMzP/M///oxMLrzdDs1Nnu3OT/5cf/58z//93o6//j///k///m////5+7//+D///L///8yHcd9AAACkUlEQVRYw+2ZCVfUMBDHpwq2igrL4RFUFKSKF1ZcKd54cOyK4IEK+f7fwybbtJM0bdNuSdeHs/v6Mvum+9v/ZJLM6wK1b0B7ds3jTKsauzHTpsx2mU7WzpwdGz93/sLExUuXO9Mzs3NXb9y8dfvO4tLGy1ev37z99LmWaZlBC0zfnKkUh6f62Qg986nvPDJmqvOk+NkILTNCrgRDMEGYOfOJ7zy7l+R2nuXj29SQTDYeXPVM//ljfxUxdyvrjB2sk+E4WM8M/LX7gcKcPPy+cLT+O5K8V4/ZG+jWMgkJnWDFD5yQOK4rcrs9efjn19HDmdkrW8cv6jHj9OqYLgn7kYUhiYjRO9H540FnejnC12UW6HSFgcs8lNtrnbt0Z+5DTWbhfLphn1Kuk4mWmO/pDsvtO/p1k+5/pAcJU1RpPrO4bhOhLkNKzOtf6PFPE2bl9cmE9plMptTKPhRJI0wk4UMTZlcyT/WzESqTcBqzeFTK9EosG6FZn2I6CbF7llk8s09LP9QiEzIDrVtgUHYDZvLdA3LuwZ/G+w53IAdZAEVMMNAJgFFQINOImQiBgRDoiVF6FklbuAjjVxDyUSKgChNSuBgoGce5jX9cbmwVphCo+R7kIGYaC3WZQmcvw8QJlnVm5t2whhJmXr6kKtHlNo0D87WSJlSpoUGZIBcx08oBubxPfh+qtD4bhsKI7reeJZOYVp5fqEwraR0NJpzkC0ZJZwNrvuDO6jr1jQSgo6RxnTmNhDGzhk59I5HWXdImNahTe8BKtV6epyF0AnpGoPQJtnTiPqHhutU1EtLH5eun+vrUNRKonMtS+2/tQ0M1EP/PFYs6uxZMYbbRg7XAPBXPMLpWjTM9y8aYbfznat/+As9I95cGPCFHAAAAAElFTkSuQmCC" alt="SwingBuilder001" data-pagespeed-url-hash="38721800" onload="pagespeed.CriticalImages.checkImageForCriticality(this);">
</div>
</div>
<div class="paragraph">
<p>This hierarchy of components would normally be created through a 
series of repetitive instantiations, setters, and finally attaching this
 child to its respective parent.
Using <code>SwingBuilder</code>, however, allows you to define this 
hierarchy in its native form, which makes the interface design 
understandable simply by reading the code.</p>
</div>
<div class="paragraph">
<p>The flexibility shown here is made possible by leveraging the many 
programming features built-in to Groovy, such as closures, implicit 
constructor calling, import aliasing, and string interpolation.
Of course, these do not have to be fully understood in order to use <code>SwingBuilder</code>; as you can see from the code above, their uses are intuitive.</p>
</div>
<div class="paragraph">
<p>Here is a slightly more involved example, with an example of <code>SwingBuilder</code> code re-use via a closure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.</span><span class="typ">SwingBuilder</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">awt</span><span class="pun">.*</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> swing </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SwingBuilder</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> sharedPanel </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
     swing</span><span class="pun">.</span><span class="pln">panel</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        label</span><span class="pun">(</span><span class="str">"Shared Panel"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
swing</span><span class="pun">.</span><span class="pln">edt </span><span class="pun">{</span><span class="pln">
    frame</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Frame'</span><span class="pun">,</span><span class="pln"> defaultCloseOperation</span><span class="pun">:</span><span class="pln"> </span><span class="typ">JFrame</span><span class="pun">.</span><span class="pln">EXIT_ON_CLOSE</span><span class="pun">,</span><span class="pln"> pack</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> show</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        vbox </span><span class="pun">{</span><span class="pln">
            textlabel </span><span class="pun">=</span><span class="pln"> label</span><span class="pun">(</span><span class="str">'Click the button!'</span><span class="pun">)</span><span class="pln">
            button</span><span class="pun">(</span><span class="pln">
                text</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Click Me'</span><span class="pun">,</span><span class="pln">
                actionPerformed</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    count</span><span class="pun">++</span><span class="pln">
                    textlabel</span><span class="pun">.</span><span class="pln">text </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Clicked ${count} time(s)."</span><span class="pln">
                    println </span><span class="str">"Clicked!"</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">)</span><span class="pln">
            widget</span><span class="pun">(</span><span class="pln">sharedPanel</span><span class="pun">())</span><span class="pln">
            widget</span><span class="pun">(</span><span class="pln">sharedPanel</span><span class="pun">())</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here’s another variation that relies on observable beans and binding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.</span><span class="typ">SwingBuilder</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="typ">Bindable</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyModel</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   </span><span class="lit">@Bindable</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> model </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyModel</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SwingBuilder</span><span class="pun">().</span><span class="pln">edt </span><span class="pun">{</span><span class="pln">
  frame</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Java Frame'</span><span class="pun">,</span><span class="pln"> size</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="lit">100</span><span class="pun">,</span><span class="pln"> </span><span class="lit">100</span><span class="pun">],</span><span class="pln"> locationRelativeTo</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> show</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    gridLayout</span><span class="pun">(</span><span class="pln">cols</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> rows</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    label</span><span class="pun">(</span><span class="pln">text</span><span class="pun">:</span><span class="pln"> bind</span><span class="pun">(</span><span class="pln">source</span><span class="pun">:</span><span class="pln"> model</span><span class="pun">,</span><span class="pln"> sourceProperty</span><span class="pun">:</span><span class="pln"> </span><span class="str">'count'</span><span class="pun">,</span><span class="pln"> converter</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">-&gt;</span><span class="pln">  v</span><span class="pun">?</span><span class="pln"> </span><span class="str">"Clicked $v times"</span><span class="pun">:</span><span class="pln"> </span><span class="str">''</span><span class="pun">}))</span><span class="pln">
    button</span><span class="pun">(</span><span class="str">'Click me!'</span><span class="pun">,</span><span class="pln"> actionPerformed</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> model</span><span class="pun">.</span><span class="pln">count</span><span class="pun">++</span><span class="pln"> </span><span class="pun">})</span><span class="pln">
  </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#xform-Bindable">@Bindable</a> is one of the core AST 
Transformations. It generates all the required boilerplate code to turn a
 simple bean into an observable one. The <code>bind()</code> node creates appropriate <code>PropertyChangeListeners</code> that will update the interested parties whenever a <code>PropertyChangeEvent</code> is fired.</p>
</div>
</div>
<div class="sect5">
<h6 id="_antbuilder"><a class="anchor" href="#_antbuilder"></a>AntBuilder</h6>
<div class="paragraph">
<p>Despite being primarily a build tool, <a href="http://ant.apache.org/">Apache Ant</a> is
a very practical tool for manipulating files including zip files, copy, resource processing, …​
But if ever you’ve been working with a <code>build.xml</code> file or some <em>Jelly script</em>
and found yourself a little restricted by all those pointy brackets, or
found it a bit weird using XML as a scripting language and wanted
something a little cleaner and more straight forward, then maybe Ant
scripting with Groovy might be what you’re after.</p>
</div>
<div class="paragraph">
<p>Groovy has a helper class called <code>AntBuilder</code> which makes the scripting
of Ant tasks really easy; allowing a real scripting language to be used
for programming constructs (variables, methods, loops, logical
branching, classes etc). It still looks like a neat concise version of
Ant’s XML without all those pointy brackets; though you can mix and
match this markup inside your script. Ant itself is a collection of jar
files. By adding them to your classpath, you can easily use them within
Groovy as is. We believe using <code>AntBuilder</code> leads to more concise and
readily understood syntax.</p>
</div>
<div class="paragraph">
<p><code>AntBuilder</code> exposes Ant tasks directly using the convenient builder notation that
we are used to in Groovy. Here is the most basic example, which is printing a message
on the standard output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> ant </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AntBuilder</span><span class="pun">()</span><span class="pln">          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
ant</span><span class="pun">.</span><span class="pln">echo</span><span class="pun">(</span><span class="str">'hello from Ant!'</span><span class="pun">)</span><span class="pln">         </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>creates an instance of <code>AntBuilder</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>executes the <code>echo</code> task with the message in parameter</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Imagine that you need to create a ZIP file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> ant </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AntBuilder</span><span class="pun">()</span><span class="pln">
ant</span><span class="pun">.</span><span class="pln">zip</span><span class="pun">(</span><span class="pln">destfile</span><span class="pun">:</span><span class="pln"> </span><span class="str">'sources.zip'</span><span class="pun">,</span><span class="pln"> basedir</span><span class="pun">:</span><span class="pln"> </span><span class="str">'src'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the next example, we demonstrate the use of <code>AntBuilder</code> to copy a list of files
using a classical Ant pattern directly in Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// lets just call one task</span><span class="pln">
ant</span><span class="pun">.</span><span class="pln">echo</span><span class="pun">(</span><span class="str">"hello"</span><span class="pun">)</span><span class="pln">

</span><span class="com">// here is an example of a block of Ant inside GroovyMarkup</span><span class="pln">
ant</span><span class="pun">.</span><span class="pln">sequential </span><span class="pun">{</span><span class="pln">
    echo</span><span class="pun">(</span><span class="str">"inside sequential"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> myDir </span><span class="pun">=</span><span class="pln"> </span><span class="str">"target/AntTest/"</span><span class="pln">
    mkdir</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">:</span><span class="pln"> myDir</span><span class="pun">)</span><span class="pln">
    copy</span><span class="pun">(</span><span class="pln">todir</span><span class="pun">:</span><span class="pln"> myDir</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        fileset</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">:</span><span class="pln"> </span><span class="str">"src/test"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            include</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"**/*.groovy"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    echo</span><span class="pun">(</span><span class="str">"done"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// now lets do some normal Groovy again</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> file </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">ant</span><span class="pun">.</span><span class="pln">project</span><span class="pun">.</span><span class="pln">baseDir</span><span class="pun">,</span><span class="str">"target/AntTest/groovy/util/AntTest.groovy"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> file</span><span class="pun">.</span><span class="pln">exists</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example would be iterating over a list of files matching a specific pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// lets create a scanner of filesets</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> scanner </span><span class="pun">=</span><span class="pln"> ant</span><span class="pun">.</span><span class="pln">fileScanner </span><span class="pun">{</span><span class="pln">
    fileset</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">:</span><span class="str">"src/test"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        include</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">"**/Ant*.groovy"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// now lets iterate over</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> found </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">false</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">f </span><span class="kwd">in</span><span class="pln"> scanner</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println</span><span class="pun">(</span><span class="str">"Found file $f"</span><span class="pun">)</span><span class="pln">
    found </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> f </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">File</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">endsWith</span><span class="pun">(</span><span class="str">".groovy"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> found</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or execute a JUnit test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// lets create a scanner of filesets</span><span class="pln">
ant</span><span class="pun">.</span><span class="pln">junit </span><span class="pun">{</span><span class="pln">
    test</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'groovy.util.SomethingThatDoesNotExist'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can even go further by compiling and executing a Java file directly from Groovy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">ant</span><span class="pun">.</span><span class="pln">echo</span><span class="pun">(</span><span class="pln">file</span><span class="pun">:</span><span class="str">'Temp.java'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'''
    class Temp {
        public static void main(String[] args) {
            System.out.println("Hello");
        }
    }
'''</span><span class="pun">)</span><span class="pln">
ant</span><span class="pun">.</span><span class="pln">javac</span><span class="pun">(</span><span class="pln">srcdir</span><span class="pun">:</span><span class="str">'.'</span><span class="pun">,</span><span class="pln"> includes</span><span class="pun">:</span><span class="str">'Temp.java'</span><span class="pun">,</span><span class="pln"> fork</span><span class="pun">:</span><span class="str">'true'</span><span class="pun">)</span><span class="pln">
ant</span><span class="pun">.</span><span class="pln">java</span><span class="pun">(</span><span class="pln">classpath</span><span class="pun">:</span><span class="str">'.'</span><span class="pun">,</span><span class="pln"> classname</span><span class="pun">:</span><span class="str">'Temp'</span><span class="pun">,</span><span class="pln"> fork</span><span class="pun">:</span><span class="str">'true'</span><span class="pun">)</span><span class="pln">
ant</span><span class="pun">.</span><span class="pln">echo</span><span class="pun">(</span><span class="str">'Done'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is worth mentioning that <code>AntBuilder</code> is included in <a href="http://gradle.org/">Gradle</a>, so you can use it in Gradle
just like you would in Groovy. Additional documentation can be found in the
<a href="http://gradle.org/docs/current/userguide/ant.html">Gradle manual</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_clibuilder"><a class="anchor" href="#_clibuilder"></a>CliBuilder</h6>
<div class="paragraph">
<p><code>CliBuilder</code> provides a compact way to specify the available parameters for a command-line application and then
automatically parse the application’s parameters according to that specification. Here is a simple example
<code>Greeter.groovy</code> script illustrating usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// specify parameters</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> cli </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CliBuilder</span><span class="pun">(</span><span class="pln">usage</span><span class="pun">:</span><span class="pln"> </span><span class="str">'groovy Greeter [option]'</span><span class="pun">)</span><span class="pln"> </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
cli</span><span class="pun">.</span><span class="pln">a</span><span class="pun">(</span><span class="pln">longOpt</span><span class="pun">:</span><span class="pln"> </span><span class="str">'audience'</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="str">'greeting audience'</span><span class="pun">)</span><span class="pln">   </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
cli</span><span class="pun">.</span><span class="pln">h</span><span class="pun">(</span><span class="pln">longOpt</span><span class="pun">:</span><span class="pln"> </span><span class="str">'help'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'display usage'</span><span class="pun">)</span><span class="pln">                    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="com">// parse and process parameters</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> options </span><span class="pun">=</span><span class="pln"> cli</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">args</span><span class="pun">)</span><span class="pln">                              </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">options</span><span class="pun">.</span><span class="pln">h</span><span class="pun">)</span><span class="pln"> cli</span><span class="pun">.</span><span class="pln">usage</span><span class="pun">()</span><span class="pln">                                 </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
</span><span class="kwd">else</span><span class="pln"> println </span><span class="str">"Hello ${options.a ? options.a : 'World'}"</span><span class="pln">    </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>define a new <code>CliBuilder</code> instance specifying an optional usage string</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>specify a <code>-a</code> parameter taking a single argument with an optional long variant <code>--audience</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>specify a <code>-h</code> parameter taking no arguments with an optional long variant <code>--help</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>parse the arguments supplied to the script</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>if the <code>h</code> argument is found display a usage message</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>display a standard greeting or if the <code>a</code> argument is found a customized greeting</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Running this script with no arguments, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pun">&gt;</span><span class="pln"> groovy </span><span class="typ">Greeter</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="typ">Hello</span><span class="pln"> </span><span class="typ">World</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Running this script with <code>-h</code> as the arguments, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pun">&gt;</span><span class="pln"> groovy </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">-</span><span class="pln">h</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pln">usage</span><span class="pun">:</span><span class="pln"> groovy </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">[</span><span class="pln">option</span><span class="pun">]</span><span class="pln">
 </span><span class="pun">-</span><span class="pln">a</span><span class="pun">,--</span><span class="pln">audience </span><span class="str">&lt;arg&gt;</span><span class="pln">   greeting audience
 </span><span class="pun">-</span><span class="pln">h</span><span class="pun">,--</span><span class="pln">help             display usage</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Running this script with <code>--audience Groovologist</code> as the arguments, i.e.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="pun">&gt;</span><span class="pln"> groovy </span><span class="typ">Greeter</span><span class="pln"> </span><span class="pun">--</span><span class="pln">audience </span><span class="typ">Groovologist</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="typ">Hello</span><span class="pln"> </span><span class="typ">Groovologist</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_objectgraphbuilder"><a class="anchor" href="#_objectgraphbuilder"></a>ObjectGraphBuilder</h6>
<div class="paragraph">
<p><code>ObjectGraphBuilder</code> is a builder for an arbitrary graph of beans that
follow the JavaBean convention. It is in particular useful for creating test data.</p>
</div>
<div class="paragraph">
<p>Let’s start with a list of classes that belong to your domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">package</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">acme

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Company</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="typ">Address</span><span class="pln"> address
    </span><span class="typ">List</span><span class="pln"> employees </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Address</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> line1
    </span><span class="typ">String</span><span class="pln"> line2
    </span><span class="kwd">int</span><span class="pln"> zip
    </span><span class="typ">String</span><span class="pln"> state
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Employee</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">int</span><span class="pln"> employeeId
    </span><span class="typ">Address</span><span class="pln"> address
    </span><span class="typ">Company</span><span class="pln"> company
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then using <code>ObjectGraphBuilder</code> building a <code>Company</code> with three employees is as
easy as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> builder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectGraphBuilder</span><span class="pun">()</span><span class="pln">                          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
builder</span><span class="pun">.</span><span class="pln">classLoader </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">classLoader                    </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
builder</span><span class="pun">.</span><span class="pln">classNameResolver </span><span class="pun">=</span><span class="pln"> </span><span class="str">"com.acme"</span><span class="pln">                          </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">

</span><span class="kwd">def</span><span class="pln"> acme </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">company</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'ACME'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">                      </span><i class="conum" data-value="4"></i><b><span class="pun">(</span><span class="lit">4</span><span class="pun">)</span></b><span class="pln">
    </span><span class="lit">3.times</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        employee</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">(),</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Drone $it"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">        </span><i class="conum" data-value="5"></i><b><span class="pun">(</span><span class="lit">5</span><span class="pun">)</span></b><span class="pln">
            address</span><span class="pun">(</span><span class="pln">line1</span><span class="pun">:</span><span class="str">"Post street"</span><span class="pun">)</span><span class="pln">                        </span><i class="conum" data-value="6"></i><b><span class="pun">(</span><span class="lit">6</span><span class="pun">)</span></b><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> acme </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> acme </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Company</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> acme</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'ACME'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> acme</span><span class="pun">.</span><span class="pln">employees</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">3</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> employee </span><span class="pun">=</span><span class="pln"> acme</span><span class="pun">.</span><span class="pln">employees</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> employee </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Employee</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> employee</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Drone 0'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> employee</span><span class="pun">.</span><span class="pln">address </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Address</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>creates a new object graph builder</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>sets the classloader where the classes will be resolved</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>sets the base package name for classes to be resolved</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>creates a <code>Company</code> instance</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>with 3 <code>Employee</code> instances</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>each of them having a distinct <code>Address</code></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Behind the scenes, the object graph builder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>will try to match a node name into a <code>Class</code>, using a default <code>ClassNameResolver</code> strategy that requires a package name</p>
</li>
<li>
<p>then will create an instance of the appropriate class using a default <code>NewInstanceResolver</code> strategy that calls a no-arg constructor</p>
</li>
<li>
<p>resolves the parent/child relationship for nested nodes, involving two other strategies:</p>
<div class="ulist">
<ul>
<li>
<p><code>RelationNameResolver</code> will yield the name of the child property in the parent, and the name of the parent property
in the child (if any, in this case, <code>Employee</code> has a parent property aptly named <code>company</code>)</p>
</li>
<li>
<p><code>ChildPropertySetter</code> will insert the child into the parent taking into account if the child belongs to a <code>Collection</code>
or not (in this case <code>employees</code> should be a list of <code>Employee</code> instances in <code>Company</code>).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All 4 strategies have a default implementation that work as expected if
the code follows the usual conventions for writing JavaBeans. In case any of your beans or objects do not follow the convention
you may plug your own implementation of each strategy. For example imagine that you need to build a class which is
immutable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Immutable</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
    </span><span class="kwd">int</span><span class="pln"> age
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then if you try to create a <code>Person</code> with the builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> person </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Jon'</span><span class="pun">,</span><span class="pln"> age</span><span class="pun">:</span><span class="lit">17</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It will fail at runtime with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cannot set readonly property: name for class: com.acme.Person</pre>
</div>
</div>
<div class="paragraph">
<p>Fixing this can be done by changing the new instance strategy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">builder</span><span class="pun">.</span><span class="pln">newInstanceResolver </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Class</span><span class="pln"> klazz</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Map</span><span class="pln"> attributes </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">klazz</span><span class="pun">.</span><span class="pln">isAnnotationPresent</span><span class="pun">(</span><span class="typ">Immutable</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> o </span><span class="pun">=</span><span class="pln"> klazz</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">(</span><span class="pln">attributes</span><span class="pun">)</span><span class="pln">
        attributes</span><span class="pun">.</span><span class="pln">clear</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> o
    </span><span class="pun">}</span><span class="pln">
    klazz</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ObjectGraphBuilder</code> supports ids per node, meaning
that you can store a reference to a node in the builder. This is
useful when multiple objects reference the same instance. Because a
property named <code>id</code> may be of business meaning in some domain models
<code>ObjectGraphBuilder</code> has a strategy named <code>IdentifierResolver</code> that you
may configure to change the default name value. The same may
happen with the property used for referencing a previously saved
instance, a strategy named <code>ReferenceResolver</code> will yield the
appropriate value (default is `refId'):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> company </span><span class="pun">=</span><span class="pln"> builder</span><span class="pun">.</span><span class="pln">company</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'ACME'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    address</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="str">'a1'</span><span class="pun">,</span><span class="pln"> line1</span><span class="pun">:</span><span class="pln"> </span><span class="str">'123 Groovy Rd'</span><span class="pun">,</span><span class="pln"> zip</span><span class="pun">:</span><span class="pln"> </span><span class="lit">12345</span><span class="pun">,</span><span class="pln"> state</span><span class="pun">:</span><span class="pln"> </span><span class="str">'JV'</span><span class="pun">)</span><span class="pln">          </span><i class="conum" data-value="1"></i><b><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span></b><span class="pln">
    employee</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Duke'</span><span class="pun">,</span><span class="pln"> employeeId</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> address</span><span class="pun">:</span><span class="pln"> a1</span><span class="pun">)</span><span class="pln">                          </span><i class="conum" data-value="2"></i><b><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span></b><span class="pln">
    employee</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'John'</span><span class="pun">,</span><span class="pln"> employeeId</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">){</span><span class="pln">
      address</span><span class="pun">(</span><span class="pln"> refId</span><span class="pun">:</span><span class="pln"> </span><span class="str">'a1'</span><span class="pln"> </span><span class="pun">)</span><span class="pln">                                                    </span><i class="conum" data-value="3"></i><b><span class="pun">(</span><span class="lit">3</span><span class="pun">)</span></b><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>an address can be created with an <code>id</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>an employee can reference the address directly with its id</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>or use the <code>refId</code> attribute corresponding to the <code>id</code> of the corresponding address</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Its worth mentioning that you cannot modify the properties of a
referenced bean.</p>
</div>
</div>
<div class="sect5">
<h6 id="_jmxbuilder"><a class="anchor" href="#_jmxbuilder"></a>JmxBuilder</h6>
<div class="paragraph">
<p>See <a href="#jmx_jmxbuilder">Working with JMX - JmxBuilder</a> for details.</p>
</div>
</div>
<div class="sect5">
<h6 id="_filetreebuilder"><a class="anchor" href="#_filetreebuilder"></a>FileTreeBuilder</h6>
<div class="paragraph">
<p><a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/util/FileTreeBuilder.html">FileTreeBuilder</a> is a builder for generating a file directory structure from a specification. For example, to create the following tree:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> src/
  |--- main
  |     |--- groovy
  |            |--- Foo.groovy
  |--- test
        |--- groovy
               |--- FooTest.groovy</pre>
</div>
</div>
<div class="paragraph">
<p>You can use a <code>FileTreeBuilder</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">tmpDir </span><span class="pun">=</span><span class="pln"> </span><span class="typ">File</span><span class="pun">.</span><span class="pln">createTempDir</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> fileTreeBuilder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">FileTreeBuilder</span><span class="pun">(</span><span class="pln">tmpDir</span><span class="pun">)</span><span class="pln">
fileTreeBuilder</span><span class="pun">.</span><span class="pln">dir</span><span class="pun">(</span><span class="str">'src'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    dir</span><span class="pun">(</span><span class="str">'main'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       dir</span><span class="pun">(</span><span class="str">'groovy'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          file</span><span class="pun">(</span><span class="str">'Foo.groovy'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'println "Hello"'</span><span class="pun">)</span><span class="pln">
       </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    dir</span><span class="pun">(</span><span class="str">'test'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       dir</span><span class="pun">(</span><span class="str">'groovy'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          file</span><span class="pun">(</span><span class="str">'FooTest.groovy'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'class FooTest extends GroovyTestCase {}'</span><span class="pun">)</span><span class="pln">
       </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To check that everything worked as expected we use the following `assert`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">tmpDir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/src/main/groovy/Foo.groovy'</span><span class="pun">).</span><span class="pln">text </span><span class="pun">==</span><span class="pln"> </span><span class="str">'println "Hello"'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">tmpDir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/src/test/groovy/FooTest.groovy'</span><span class="pun">).</span><span class="pln">text </span><span class="pun">==</span><span class="pln"> </span><span class="str">'class FooTest extends GroovyTestCase {}'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>FileTreeBuilder</code> also supports a shorthand syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">tmpDir </span><span class="pun">=</span><span class="pln"> </span><span class="typ">File</span><span class="pun">.</span><span class="pln">createTempDir</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> fileTreeBuilder </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">FileTreeBuilder</span><span class="pun">(</span><span class="pln">tmpDir</span><span class="pun">)</span><span class="pln">
fileTreeBuilder</span><span class="pun">.</span><span class="pln">src </span><span class="pun">{</span><span class="pln">
    main </span><span class="pun">{</span><span class="pln">
       groovy </span><span class="pun">{</span><span class="pln">
          </span><span class="str">'Foo.groovy'</span><span class="pun">(</span><span class="str">'println "Hello"'</span><span class="pun">)</span><span class="pln">
       </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    test </span><span class="pun">{</span><span class="pln">
       groovy </span><span class="pun">{</span><span class="pln">
          </span><span class="str">'FooTest.groovy'</span><span class="pun">(</span><span class="str">'class FooTest extends GroovyTestCase {}'</span><span class="pun">)</span><span class="pln">
       </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
 </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces the same directory structure as above, as shown by these `assert`s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">tmpDir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/src/main/groovy/Foo.groovy'</span><span class="pun">).</span><span class="pln">text </span><span class="pun">==</span><span class="pln"> </span><span class="str">'println "Hello"'</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">tmpDir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/src/test/groovy/FooTest.groovy'</span><span class="pun">).</span><span class="pln">text </span><span class="pun">==</span><span class="pln"> </span><span class="str">'class FooTest extends GroovyTestCase {}'</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_jmx"><a class="anchor" href="#_working_with_jmx"></a>3.16. Working with JMX</h3>
<div class="sect3">
<h4 id="_introduction_5"><a class="anchor" href="#_introduction_5"></a>3.16.1. Introduction</h4>
<div class="paragraph">
<p>Given that Groovy sits directly on top of Java, Groovy can leverage the tremendous amount of work already done for <a href="http://www.oracle.com/technetwork/java/javase/tech/javamanagement-140525.html">JMX</a> with Java. In addition, Groovy provides a <code>GroovyMBean</code> class which makes an MBean look like a normal Groovy object. This simplifies Groovy code for interacting with <em>MBeans</em>. For example, the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">println server</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="pln">beanName</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Age'</span><span class="pun">)</span><span class="pln">
server</span><span class="pun">.</span><span class="pln">setAttribute</span><span class="pun">(</span><span class="pln">beanName</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Attribute</span><span class="pun">(</span><span class="str">'Name'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'New name'</span><span class="pun">))</span><span class="pln">
</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> </span><span class="kwd">params</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span class="pun">]</span><span class="pln">
</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> signature </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">TYPE</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">TYPE</span><span class="pun">]</span><span class="pln">
println server</span><span class="pun">.</span><span class="pln">invoke</span><span class="pun">(</span><span class="pln">beanName</span><span class="pun">,</span><span class="pln"> </span><span class="str">'add'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">params</span><span class="pun">,</span><span class="pln"> signature</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>can be simplified to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> mbean </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyMBean</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> beanName</span><span class="pun">)</span><span class="pln">
println mbean</span><span class="pun">.</span><span class="typ">Age</span><span class="pln">
mbean</span><span class="pun">.</span><span class="typ">Name</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'New name'</span><span class="pln">
println mbean</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">20</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The remainder of this page shows you how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Monitor the JVM using MXBeans</p>
</li>
<li>
<p>Monitor Apache Tomcat and display statistics</p>
</li>
<li>
<p>Monitor Oracle OC4J and display information</p>
</li>
<li>
<p>Monitor BEA WebLogic and display information</p>
</li>
<li>
<p>Leverage Spring’s MBean annotation support to export your Groovy beans as MBeans</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_the_jvm"><a class="anchor" href="#_monitoring_the_jvm"></a>3.16.2. Monitoring the JVM</h4>
<div class="paragraph">
<p>MBeans are not accessed directly by an application but are managed by a repository called an <em>MBean server</em>. Java includes a special MBean server called the <em>platform MBean server</em>, which is built into the JVM. Platform MBeans are registered in this server using unique names.</p>
</div>
<div class="paragraph">
<p>You can monitor the JVM through its platform MBeans with the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.*</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> os </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ManagementFactory</span><span class="pun">.</span><span class="pln">operatingSystemMXBean
println </span><span class="str">"""OPERATING SYSTEM:
\tarchitecture = $os.arch
\tname = $os.name
\tversion = $os.version
\tprocessors = $os.availableProcessors
"""</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> rt </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ManagementFactory</span><span class="pun">.</span><span class="pln">runtimeMXBean
println </span><span class="str">"""RUNTIME:
\tname = $rt.name
\tspec name = $rt.specName
\tvendor = $rt.specVendor
\tspec version = $rt.specVersion
\tmanagement spec version = $rt.managementSpecVersion
"""</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> cl </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ManagementFactory</span><span class="pun">.</span><span class="pln">classLoadingMXBean
println </span><span class="str">"""CLASS LOADING SYSTEM:
\tisVerbose = ${cl.isVerbose()}
\tloadedClassCount = $cl.loadedClassCount
\ttotalLoadedClassCount = $cl.totalLoadedClassCount
\tunloadedClassCount = $cl.unloadedClassCount
"""</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> comp </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ManagementFactory</span><span class="pun">.</span><span class="pln">compilationMXBean
println </span><span class="str">"""COMPILATION:
\ttotalCompilationTime = $comp.totalCompilationTime
"""</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> mem </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ManagementFactory</span><span class="pun">.</span><span class="pln">memoryMXBean
</span><span class="kwd">def</span><span class="pln"> heapUsage </span><span class="pun">=</span><span class="pln"> mem</span><span class="pun">.</span><span class="pln">heapMemoryUsage
</span><span class="kwd">def</span><span class="pln"> nonHeapUsage </span><span class="pun">=</span><span class="pln"> mem</span><span class="pun">.</span><span class="pln">nonHeapMemoryUsage
println </span><span class="str">"""MEMORY:
HEAP STORAGE:
\tcommitted = $heapUsage.committed
\tinit = $heapUsage.init
\tmax = $heapUsage.max
\tused = $heapUsage.used
NON-HEAP STORAGE:
\tcommitted = $nonHeapUsage.committed
\tinit = $nonHeapUsage.init
\tmax = $nonHeapUsage.max
\tused = $nonHeapUsage.used
"""</span><span class="pln">

</span><span class="typ">ManagementFactory</span><span class="pun">.</span><span class="pln">memoryPoolMXBeans</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> mp </span><span class="pun">-&gt;</span><span class="pln">
    println </span><span class="str">"\tname: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mp</span><span class="pun">.</span><span class="pln">name
    </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> mmnames </span><span class="pun">=</span><span class="pln"> mp</span><span class="pun">.</span><span class="pln">memoryManagerNames
    mmnames</span><span class="pun">.</span><span class="pln">each</span><span class="pun">{</span><span class="pln"> mmname </span><span class="pun">-&gt;</span><span class="pln">
        println </span><span class="str">"\t\tManager Name: $mmname"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    println </span><span class="str">"\t\tmtype = $mp.type"</span><span class="pln">
    println </span><span class="str">"\t\tUsage threshold supported = "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mp</span><span class="pun">.</span><span class="pln">isUsageThresholdSupported</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
println</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> td </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ManagementFactory</span><span class="pun">.</span><span class="pln">threadMXBean
println </span><span class="str">"THREADS:"</span><span class="pln">
td</span><span class="pun">.</span><span class="pln">allThreadIds</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> tid </span><span class="pun">-&gt;</span><span class="pln">
    println </span><span class="str">"\tThread name = ${td.getThreadInfo(tid).threadName}"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
println</span><span class="pun">()</span><span class="pln">

println </span><span class="str">"GARBAGE COLLECTION:"</span><span class="pln">
</span><span class="typ">ManagementFactory</span><span class="pun">.</span><span class="pln">garbageCollectorMXBeans</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> gc </span><span class="pun">-&gt;</span><span class="pln">
    println </span><span class="str">"\tname = $gc.name"</span><span class="pln">
    println </span><span class="str">"\t\tcollection count = $gc.collectionCount"</span><span class="pln">
    println </span><span class="str">"\t\tcollection time = $gc.collectionTime"</span><span class="pln">
    </span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> mpoolNames </span><span class="pun">=</span><span class="pln"> gc</span><span class="pun">.</span><span class="pln">memoryPoolNames
    mpoolNames</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> mpoolName </span><span class="pun">-&gt;</span><span class="pln">
        println </span><span class="str">"\t\tmpool name = $mpoolName"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When run, you will see something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>OPERATING SYSTEM:
	architecture = x86
	name = Windows XP
	version = 5.1
	processors = 2

RUNTIME:
	name = 620@LYREBIRD
	spec name = Java Virtual Machine Specification
	vendor = Sun Microsystems Inc.
	spec version = 1.0
	management spec version = 1.0

CLASS LOADING SYSTEM:
	isVerbose = false
	loadedClassCount = 919
	totalLoadedClassCount = 919
	unloadedClassCount = 0

COMPILATION:
	totalCompilationTime = 91

MEMORY:
HEAP STORAGE:
	committed = 3108864
	init = 0
	max = 66650112
	used = 1994728
NON-HEAP STORAGE:
	committed = 9240576
	init = 8585216
	max = 100663296
	used = 5897880

	name: Code Cache
		Manager Name: CodeCacheManager
		mtype = Non-heap memory
		Usage threshold supported = true
	name: Eden Space
		Manager Name: MarkSweepCompact
		Manager Name: Copy
		mtype = Heap memory
		Usage threshold supported = false
	name: Survivor Space
		Manager Name: MarkSweepCompact
		Manager Name: Copy
		mtype = Heap memory
		Usage threshold supported = false
	name: Tenured Gen
		Manager Name: MarkSweepCompact
		mtype = Heap memory
		Usage threshold supported = true
	name: Perm Gen
		Manager Name: MarkSweepCompact
		mtype = Non-heap memory
		Usage threshold supported = true

THREADS:
	Thread name = Monitor Ctrl-Break
	Thread name = Signal Dispatcher
	Thread name = Finalizer
	Thread name = Reference Handler
	Thread name = main

GARBAGE COLLECTION:
	name = Copy
		collection count = 60
		collection time = 141
		mpool name = Eden Space
		mpool name = Survivor Space
	name = MarkSweepCompact
		collection count = 0
		collection time = 0
		mpool name = Eden Space
		mpool name = Survivor Space
		mpool name = Tenured Gen
		mpool name = Perm Gen</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_monitoring_tomcat"><a class="anchor" href="#_monitoring_tomcat"></a>3.16.3. Monitoring Tomcat</h4>
<div class="paragraph">
<p>First start up <a href="http://tomcat.apache.org/">Tomcat</a> with JMX monitoring enabled by setting the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-shell" data-lang="shell"><span class="kwd">set</span><span class="pln"> JAVA_OPTS</span><span class="pun">=-</span><span class="typ">Dcom</span><span class="pun">.</span><span class="pln">sun</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="pln">jmxremote </span><span class="pun">-</span><span class="typ">Dcom</span><span class="pun">.</span><span class="pln">sun</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="pln">jmxremote</span><span class="pun">.</span><span class="pln">port</span><span class="pun">=</span><span class="lit">9004</span><span class="pln">\
 </span><span class="pun">-</span><span class="typ">Dcom</span><span class="pun">.</span><span class="pln">sun</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="pln">jmxremote</span><span class="pun">.</span><span class="pln">authenticate</span><span class="pun">=</span><span class="kwd">false</span><span class="pln"> </span><span class="pun">-</span><span class="typ">Dcom</span><span class="pun">.</span><span class="pln">sun</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="pln">jmxremote</span><span class="pun">.</span><span class="pln">ssl</span><span class="pun">=</span><span class="kwd">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can do this in your startup script and may choose any available port, we used 9004.</p>
</div>
<div class="paragraph">
<p>The following code uses JMX to discover the available MBeans in the 
running Tomcat, determine which are web modules, extract the processing 
time for each web module and displays the result in a graph using 
JFreeChart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.</span><span class="typ">SwingBuilder</span><span class="pln">

</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="typ">ObjectName</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="pln">remote</span><span class="pun">.</span><span class="typ">JMXConnectorFactory</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">JmxFactory</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="pln">remote</span><span class="pun">.</span><span class="typ">JMXServiceURL</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">JmxUrl</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.</span><span class="typ">WindowConstants</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> WC

</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">jfree</span><span class="pun">.</span><span class="pln">chart</span><span class="pun">.</span><span class="typ">ChartFactory</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">jfree</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">category</span><span class="pun">.</span><span class="typ">DefaultCategoryDataset</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Dataset</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">jfree</span><span class="pun">.</span><span class="pln">chart</span><span class="pun">.</span><span class="pln">plot</span><span class="pun">.</span><span class="typ">PlotOrientation</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Orientation</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> serverUrl </span><span class="pun">=</span><span class="pln"> </span><span class="str">'service:jmx:rmi:///jndi/rmi://localhost:9004/jmxrmi'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> server </span><span class="pun">=</span><span class="pln"> </span><span class="typ">JmxFactory</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JmxUrl</span><span class="pun">(</span><span class="pln">serverUrl</span><span class="pun">)).</span><span class="typ">MBeanServerConnection</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> serverInfo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyMBean</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Catalina:type=Server'</span><span class="pun">).</span><span class="pln">serverInfo
println </span><span class="str">"Connected to: $serverInfo"</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">'Catalina:*'</span><span class="pun">)</span><span class="pln">
</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> allNames </span><span class="pun">=</span><span class="pln"> server</span><span class="pun">.</span><span class="pln">queryNames</span><span class="pun">(</span><span class="pln">query</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> modules </span><span class="pun">=</span><span class="pln"> allNames</span><span class="pun">.</span><span class="pln">findAll </span><span class="pun">{</span><span class="pln"> name </span><span class="pun">-&gt;</span><span class="pln">
    name</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'j2eeType=WebModule'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}.</span><span class="pln">collect</span><span class="pun">{</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyMBean</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

println </span><span class="str">"Found ${modules.size()} web modules. Processing ..."</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> dataset </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Dataset</span><span class="pun">()</span><span class="pln">

modules</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> m </span><span class="pun">-&gt;</span><span class="pln">
    println m</span><span class="pun">.</span><span class="pln">name</span><span class="pun">()</span><span class="pln">
    dataset</span><span class="pun">.</span><span class="pln">addValue m</span><span class="pun">.</span><span class="pln">processingTime</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">.</span><span class="pln">path
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> labels </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'Time per Module'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Module'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Time'</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> options </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">false</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> chart </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ChartFactory</span><span class="pun">.</span><span class="pln">createBarChart</span><span class="pun">(*</span><span class="pln">labels</span><span class="pun">,</span><span class="pln"> dataset</span><span class="pun">,</span><span class="pln">
                </span><span class="typ">Orientation</span><span class="pun">.</span><span class="pln">VERTICAL</span><span class="pun">,</span><span class="pln"> </span><span class="pun">*</span><span class="pln">options</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> swing </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SwingBuilder</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> frame </span><span class="pun">=</span><span class="pln"> swing</span><span class="pun">.</span><span class="pln">frame</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="str">'Catalina Module Processing Time'</span><span class="pun">,</span><span class="pln"> defaultCloseOperation</span><span class="pun">:</span><span class="pln">WC</span><span class="pun">.</span><span class="pln">EXIT_ON_CLOSE</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    panel</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="str">'canvas'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> rigidArea</span><span class="pun">(</span><span class="pln">width</span><span class="pun">:</span><span class="lit">600</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">:</span><span class="lit">250</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
frame</span><span class="pun">.</span><span class="pln">pack</span><span class="pun">()</span><span class="pln">
frame</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span><span class="pln">
chart</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">(</span><span class="pln">swing</span><span class="pun">.</span><span class="pln">canvas</span><span class="pun">.</span><span class="pln">graphics</span><span class="pun">,</span><span class="pln"> swing</span><span class="pun">.</span><span class="pln">canvas</span><span class="pun">.</span><span class="pln">bounds</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When run, we will see a trace of progress being made:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Connected to: Apache Tomcat/6.0.13
Found 5 web modules. Processing ...
Catalina:j2eeType=WebModule,name=//localhost/,J2EEApplication=none,J2EEServer=none
Catalina:j2eeType=WebModule,name=//localhost/host-manager,J2EEApplication=none,J2EEServer=none
Catalina:j2eeType=WebModule,name=//localhost/docs,J2EEApplication=none,J2EEServer=none
Catalina:j2eeType=WebModule,name=//localhost/examples,J2EEApplication=none,J2EEServer=none
Catalina:j2eeType=WebModule,name=//localhost/manager,J2EEApplication=none,J2EEServer=none</pre>
</div>
</div>
<div class="paragraph">
<p>The output will look like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="Groovy-Language-Documentation_files/xcatalina.png" alt="catalina" data-pagespeed-url-hash="606147983" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"></span></p>
</div>
<div class="paragraph">
<p>Note: if you get errors running this script, see the <strong>Troubleshooting</strong> section below.</p>
</div>
</div>
<div class="sect3">
<h4 id="_oc4j_example"><a class="anchor" href="#_oc4j_example"></a>3.16.4. OC4J Example</h4>
<div class="paragraph">
<p>Here is a script to access OC4J and print out some information about 
the server, its runtime and (as an example) the configured JMS 
destinations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="pln">remote</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> oracle</span><span class="pun">.</span><span class="pln">oc4j</span><span class="pun">.</span><span class="pln">admin</span><span class="pun">.</span><span class="pln">jmx</span><span class="pun">.</span><span class="pln">remote</span><span class="pun">.</span><span class="pln">api</span><span class="pun">.</span><span class="typ">JMXConnectorConstant</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> serverUrl </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JMXServiceURL</span><span class="pun">(</span><span class="str">'service:jmx:rmi://localhost:23791'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> serverPath </span><span class="pun">=</span><span class="pln"> </span><span class="str">'oc4j:j2eeType=J2EEServer,name=standalone'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> jvmPath </span><span class="pun">=</span><span class="pln"> </span><span class="str">'oc4j:j2eeType=JVM,name=single,J2EEServer=standalone'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> provider </span><span class="pun">=</span><span class="pln"> </span><span class="str">'oracle.oc4j.admin.jmx.remote'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> credentials </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="pun">(</span><span class="typ">JMXConnectorConstant</span><span class="pun">.</span><span class="pln">CREDENTIALS_LOGIN_KEY</span><span class="pun">):</span><span class="pln"> </span><span class="str">'oc4jadmin'</span><span class="pun">,</span><span class="pln">
    </span><span class="pun">(</span><span class="typ">JMXConnectorConstant</span><span class="pun">.</span><span class="pln">CREDENTIALS_PASSWORD_KEY</span><span class="pun">):</span><span class="pln"> </span><span class="str">'admin'</span><span class="pln">
</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> env </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="pun">(</span><span class="typ">JMXConnectorFactory</span><span class="pun">.</span><span class="pln">PROTOCOL_PROVIDER_PACKAGES</span><span class="pun">):</span><span class="pln"> provider</span><span class="pun">,</span><span class="pln">
    </span><span class="pun">(</span><span class="typ">JMXConnector</span><span class="pun">.</span><span class="pln">CREDENTIALS</span><span class="pun">):</span><span class="pln"> credentials
</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> server </span><span class="pun">=</span><span class="pln"> </span><span class="typ">JmxFactory</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">(</span><span class="pln">serverUrl</span><span class="pun">,</span><span class="pln"> env</span><span class="pun">).</span><span class="typ">MBeanServerConnection</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> serverInfo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyMBean</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> serverPath</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> jvmInfo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyMBean</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> jvmPath</span><span class="pun">)</span><span class="pln">
println </span><span class="str">"""Connected to $serverInfo.node. \
Server started ${new Date(serverInfo.startTime)}.
OC4J version:  $serverInfo.serverVersion from $serverInfo.serverVendor
JVM version:   $jvmInfo.javaVersion from $jvmInfo.javaVendor
Memory usage:  $jvmInfo.freeMemory bytes free, \
$jvmInfo.totalMemory bytes total
"""</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> query </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">'oc4j:*'</span><span class="pun">)</span><span class="pln">
</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> allNames </span><span class="pun">=</span><span class="pln"> server</span><span class="pun">.</span><span class="pln">queryNames</span><span class="pun">(</span><span class="pln">query</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> dests </span><span class="pun">=</span><span class="pln"> allNames</span><span class="pun">.</span><span class="pln">findAll </span><span class="pun">{</span><span class="pln"> name </span><span class="pun">-&gt;</span><span class="pln">
    name</span><span class="pun">.</span><span class="pln">contains</span><span class="pun">(</span><span class="str">'j2eeType=JMSDestinationResource'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}.</span><span class="pln">collect </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyMBean</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

println </span><span class="str">"Found ${dests.size()} JMS destinations. Listing ..."</span><span class="pln">
dests</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> d </span><span class="pun">-&gt;</span><span class="pln"> println </span><span class="str">"$d.name: $d.location"</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the result of running this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Connected to LYREBIRD. Server started Thu May 31 21:04:54 EST 2007.
OC4J version:  11.1.1.0.0 from Oracle Corp.
JVM version:   1.6.0_01 from Sun Microsystems Inc.
Memory usage:  8709976 bytes free, 25153536 bytes total

Found 5 JMS destinations. Listing ...
Demo Queue: jms/demoQueue
Demo Topic: jms/demoTopic
jms/Oc4jJmsExceptionQueue: jms/Oc4jJmsExceptionQueue
jms/RAExceptionQueue: jms/RAExceptionQueue
OracleASRouter_store: OracleASRouter_store</pre>
</div>
</div>
<div class="paragraph">
<p>As a slight variation, this script displays a pie chart of memory usage using JFreeChart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">jfree</span><span class="pun">.</span><span class="pln">chart</span><span class="pun">.</span><span class="typ">ChartFactory</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.</span><span class="typ">WindowConstants</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> WC
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="pln">remote</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> oracle</span><span class="pun">.</span><span class="pln">oc4j</span><span class="pun">.</span><span class="pln">admin</span><span class="pun">.</span><span class="pln">jmx</span><span class="pun">.</span><span class="pln">remote</span><span class="pun">.</span><span class="pln">api</span><span class="pun">.</span><span class="typ">JMXConnectorConstant</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> url </span><span class="pun">=</span><span class="pln"> </span><span class="str">'service:jmx:rmi://localhost:23791'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> credentials </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span><span class="pln">
credentials</span><span class="pun">[</span><span class="typ">JMXConnectorConstant</span><span class="pun">.</span><span class="pln">CREDENTIALS_LOGIN_KEY</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"oc4jadmin"</span><span class="pln">
credentials</span><span class="pun">[</span><span class="typ">JMXConnectorConstant</span><span class="pun">.</span><span class="pln">CREDENTIALS_PASSWORD_KEY</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"password"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> env </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span><span class="pln">
env</span><span class="pun">[</span><span class="typ">JMXConnectorFactory</span><span class="pun">.</span><span class="pln">PROTOCOL_PROVIDER_PACKAGES</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">"oracle.oc4j.admin.jmx.remote"</span><span class="pln">
env</span><span class="pun">[</span><span class="typ">JMXConnector</span><span class="pun">.</span><span class="pln">CREDENTIALS</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> credentials
</span><span class="kwd">def</span><span class="pln"> server </span><span class="pun">=</span><span class="pln"> </span><span class="typ">JMXConnectorFactory</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JMXServiceURL</span><span class="pun">(</span><span class="pln">url</span><span class="pun">),</span><span class="pln"> env</span><span class="pun">).</span><span class="typ">MBeanServerConnection</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> jvmInfo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyMBean</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> </span><span class="str">'oc4j:j2eeType=JVM,name=single,J2EEServer=standalone'</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> piedata </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">jfree</span><span class="pun">.</span><span class="pln">data</span><span class="pun">.</span><span class="pln">general</span><span class="pun">.</span><span class="typ">DefaultPieDataset</span><span class="pun">()</span><span class="pln">
piedata</span><span class="pun">.</span><span class="pln">setValue </span><span class="str">"Free"</span><span class="pun">,</span><span class="pln"> jvmInfo</span><span class="pun">.</span><span class="pln">freeMemory
piedata</span><span class="pun">.</span><span class="pln">setValue </span><span class="str">"Used"</span><span class="pun">,</span><span class="pln"> jvmInfo</span><span class="pun">.</span><span class="pln">totalMemory </span><span class="pun">-</span><span class="pln"> jvmInfo</span><span class="pun">.</span><span class="pln">freeMemory

</span><span class="kwd">def</span><span class="pln"> options </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> chart </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ChartFactory</span><span class="pun">.</span><span class="pln">createPieChart</span><span class="pun">(</span><span class="str">'OC4J Memory Usage'</span><span class="pun">,</span><span class="pln"> piedata</span><span class="pun">,</span><span class="pln"> </span><span class="pun">*</span><span class="pln">options</span><span class="pun">)</span><span class="pln">
chart</span><span class="pun">.</span><span class="pln">backgroundPaint </span><span class="pun">=</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">awt</span><span class="pun">.</span><span class="typ">Color</span><span class="pun">.</span><span class="pln">white
</span><span class="kwd">def</span><span class="pln"> swing </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> groovy</span><span class="pun">.</span><span class="pln">swing</span><span class="pun">.</span><span class="typ">SwingBuilder</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> frame </span><span class="pun">=</span><span class="pln"> swing</span><span class="pun">.</span><span class="pln">frame</span><span class="pun">(</span><span class="pln">title</span><span class="pun">:</span><span class="str">'OC4J Memory Usage'</span><span class="pun">,</span><span class="pln"> defaultCloseOperation</span><span class="pun">:</span><span class="pln">WC</span><span class="pun">.</span><span class="pln">EXIT_ON_CLOSE</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    panel</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="str">'canvas'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> rigidArea</span><span class="pun">(</span><span class="pln">width</span><span class="pun">:</span><span class="lit">350</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">:</span><span class="lit">250</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
frame</span><span class="pun">.</span><span class="pln">pack</span><span class="pun">()</span><span class="pln">
frame</span><span class="pun">.</span><span class="pln">show</span><span class="pun">()</span><span class="pln">
chart</span><span class="pun">.</span><span class="pln">draw</span><span class="pun">(</span><span class="pln">swing</span><span class="pun">.</span><span class="pln">canvas</span><span class="pun">.</span><span class="pln">graphics</span><span class="pun">,</span><span class="pln"> swing</span><span class="pun">.</span><span class="pln">canvas</span><span class="pun">.</span><span class="pln">bounds</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which looks like:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="Groovy-Language-Documentation_files/xoc4jpie.png" alt="oc4jpie" data-pagespeed-url-hash="3765971302" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_weblogic_example"><a class="anchor" href="#_weblogic_example"></a>3.16.5. WebLogic Example</h4>
<div class="paragraph">
<p>This script prints out information about the server followed by 
information about JMS Destinations (as an example). Many other mbeans 
are <a href="http://docs.oracle.com/cd/E13222_01/wls/docs90/wlsmbeanref/core/index.html">available</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="pln">remote</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.*</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">naming</span><span class="pun">.</span><span class="typ">Context</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> urlRuntime </span><span class="pun">=</span><span class="pln"> </span><span class="str">'/jndi/weblogic.management.mbeanservers.runtime'</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> urlBase </span><span class="pun">=</span><span class="pln"> </span><span class="str">'service:jmx:t3://localhost:7001'</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> serviceURL </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JMXServiceURL</span><span class="pun">(</span><span class="pln">urlBase </span><span class="pun">+</span><span class="pln"> urlRuntime</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> h </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Hashtable</span><span class="pun">()</span><span class="pln">
h</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="typ">Context</span><span class="pun">.</span><span class="pln">SECURITY_PRINCIPAL</span><span class="pun">,</span><span class="pln"> </span><span class="str">'weblogic'</span><span class="pun">)</span><span class="pln">
h</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="typ">Context</span><span class="pun">.</span><span class="pln">SECURITY_CREDENTIALS</span><span class="pun">,</span><span class="pln"> </span><span class="str">'weblogic'</span><span class="pun">)</span><span class="pln">
h</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="typ">JMXConnectorFactory</span><span class="pun">.</span><span class="pln">PROTOCOL_PROVIDER_PACKAGES</span><span class="pun">,</span><span class="pln"> </span><span class="str">'weblogic.management.remote'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> server </span><span class="pun">=</span><span class="pln"> </span><span class="typ">JMXConnectorFactory</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">(</span><span class="pln">serviceURL</span><span class="pun">,</span><span class="pln"> h</span><span class="pun">).</span><span class="typ">MBeanServerConnection</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> domainName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">'com.bea:Name=RuntimeService,Type=weblogic.management.mbeanservers.runtime.RuntimeServiceMBean'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> rtName </span><span class="pun">=</span><span class="pln"> server</span><span class="pun">.</span><span class="pln">getAttribute</span><span class="pun">(</span><span class="pln">domainName</span><span class="pun">,</span><span class="pln"> </span><span class="str">'ServerRuntime'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> rt </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyMBean</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> rtName</span><span class="pun">)</span><span class="pln">
println </span><span class="str">"Server: name=$rt.Name, state=$rt.State, version=$rt.WeblogicVersion"</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> destFilter </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Query</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="typ">Query</span><span class="pun">.</span><span class="pln">attr</span><span class="pun">(</span><span class="str">'Type'</span><span class="pun">),</span><span class="pln"> </span><span class="typ">Query</span><span class="pun">.</span><span class="pln">value</span><span class="pun">(</span><span class="str">'JMSDestinationRuntime'</span><span class="pun">))</span><span class="pln">
server</span><span class="pun">.</span><span class="pln">queryNames</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">'com.bea:*'</span><span class="pun">),</span><span class="pln"> destFilter</span><span class="pun">).</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> name </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> jms </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyMBean</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">)</span><span class="pln">
    println </span><span class="str">"JMS Destination: name=$jms.Name, type=$jms.DestinationType, messages=$jms.MessagesReceivedCount"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Server: name=examplesServer, state=RUNNING, version=WebLogic Server 10.0  Wed May 9 18:10:27 EDT 2007 933139
JMS Destination: name=examples-jms!exampleTopic, type=Topic, messages=0
JMS Destination: name=examples-jms!exampleQueue, type=Queue, messages=0
JMS Destination: name=examples-jms!jms/MULTIDATASOURCE_MDB_QUEUE, type=Queue, messages=0
JMS Destination: name=examplesJMSServer!examplesJMSServer.TemporaryQueue0, type=Queue, messages=68
JMS Destination: name=examples-jms!quotes, type=Topic, messages=0
JMS Destination: name=examples-jms!weblogic.wsee.wseeExamplesDestinationQueue, type=Queue, messages=0
JMS Destination: name=examples-jms!weblogic.examples.ejb30.ExampleQueue, type=Queue, messages=0</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_spring_example"><a class="anchor" href="#_spring_example"></a>3.16.6. Spring Example</h4>
<div class="paragraph">
<p>You can also use Spring to automatically register beans as JMX aware.</p>
</div>
<div class="paragraph">
<p>Here is an example class (Calculator.groovy):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@ManagedResource</span><span class="pun">(</span><span class="pln">objectName</span><span class="pun">=</span><span class="str">"bean:name=calcMBean"</span><span class="pun">,</span><span class="pln"> description</span><span class="pun">=</span><span class="str">"Calculator MBean"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> invocations

    </span><span class="lit">@ManagedAttribute</span><span class="pun">(</span><span class="pln">description</span><span class="pun">=</span><span class="str">"The Invocation Attribute"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> getInvocations</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> invocations
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">base</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pln">

    </span><span class="lit">@ManagedAttribute</span><span class="pun">(</span><span class="pln">description</span><span class="pun">=</span><span class="str">"The Base to use when adding strings"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> getBase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">base</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@ManagedAttribute</span><span class="pun">(</span><span class="pln">description</span><span class="pun">=</span><span class="str">"The Base to use when adding strings"</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setBase</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> </span><span class="kwd">base</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">base</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">base</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@ManagedOperation</span><span class="pun">(</span><span class="pln">description</span><span class="pun">=</span><span class="str">"Add two numbers"</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@ManagedOperationParameters</span><span class="pun">([</span><span class="pln">
        </span><span class="lit">@ManagedOperationParameter</span><span class="pun">(</span><span class="pln">name</span><span class="pun">=</span><span class="str">"x"</span><span class="pun">,</span><span class="pln"> description</span><span class="pun">=</span><span class="str">"The first number"</span><span class="pun">),</span><span class="pln">
        </span><span class="lit">@ManagedOperationParameter</span><span class="pun">(</span><span class="pln">name</span><span class="pun">=</span><span class="str">"y"</span><span class="pun">,</span><span class="pln"> description</span><span class="pun">=</span><span class="str">"The second number"</span><span class="pun">)])</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> add</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        invocations</span><span class="pun">++</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> x </span><span class="pun">+</span><span class="pln"> y
    </span><span class="pun">}</span><span class="pln">

    </span><span class="lit">@ManagedOperation</span><span class="pun">(</span><span class="pln">description</span><span class="pun">=</span><span class="str">"Add two strings representing numbers of a particular base"</span><span class="pun">)</span><span class="pln">
    </span><span class="lit">@ManagedOperationParameters</span><span class="pun">([</span><span class="pln">
        </span><span class="lit">@ManagedOperationParameter</span><span class="pun">(</span><span class="pln">name</span><span class="pun">=</span><span class="str">"x"</span><span class="pun">,</span><span class="pln"> description</span><span class="pun">=</span><span class="str">"The first number"</span><span class="pun">),</span><span class="pln">
        </span><span class="lit">@ManagedOperationParameter</span><span class="pun">(</span><span class="pln">name</span><span class="pun">=</span><span class="str">"y"</span><span class="pun">,</span><span class="pln"> description</span><span class="pun">=</span><span class="str">"The second number"</span><span class="pun">)])</span><span class="pln">
    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> addStrings</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        invocations</span><span class="pun">++</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">base</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">valueOf</span><span class="pun">(</span><span class="pln">y</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">base</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Integer</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">(</span><span class="pln">result</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">base</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the Spring configuration file (beans.xml):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;beans</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans"</span><span class="pln">
       </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
       </span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"mbeanServer"</span><span class="pln">
          </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.springframework.jmx.support.MBeanServerFactoryBean"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"locateExistingServerIfPossible"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">

    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"exporter"</span><span class="pln">
          </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.springframework.jmx.export.MBeanExporter"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"assembler"</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"assembler"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"namingStrategy"</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"namingStrategy"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"beans"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;map&gt;</span><span class="pln">
                </span><span class="tag">&lt;entry</span><span class="pln"> </span><span class="atn">key</span><span class="pun">=</span><span class="atv">"bean:name=defaultCalcName"</span><span class="pln"> </span><span class="atn">value-ref</span><span class="pun">=</span><span class="atv">"calcBean"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;/map&gt;</span><span class="pln">
        </span><span class="tag">&lt;/property&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"server"</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"mbeanServer"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"autodetect"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">

    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"jmxAttributeSource"</span><span class="pln">
          </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource"</span><span class="tag">/&gt;</span><span class="pln">

    </span><span class="com">&lt;!-- will create management interface using annotation metadata --&gt;</span><span class="pln">
    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"assembler"</span><span class="pln">
          </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"attributeSource"</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"jmxAttributeSource"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">

    </span><span class="com">&lt;!-- will pick up the ObjectName from the annotation --&gt;</span><span class="pln">
    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"namingStrategy"</span><span class="pln">
          </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.springframework.jmx.export.naming.MetadataNamingStrategy"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"attributeSource"</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"jmxAttributeSource"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">

    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"calcBean"</span><span class="pln">
          </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"Calculator"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"base"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"10"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">
</span><span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a script which uses this bean and configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">context</span><span class="pun">.</span><span class="pln">support</span><span class="pun">.</span><span class="typ">ClassPathXmlApplicationContext</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">lang</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="typ">ManagementFactory</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="typ">ObjectName</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> javax</span><span class="pun">.</span><span class="pln">management</span><span class="pun">.</span><span class="typ">Attribute</span><span class="pln">

</span><span class="com">// get normal bean</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> ctx </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ClassPathXmlApplicationContext</span><span class="pun">(</span><span class="str">"beans.xml"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> calc </span><span class="pun">=</span><span class="pln"> ctx</span><span class="pun">.</span><span class="pln">getBean</span><span class="pun">(</span><span class="str">"calcBean"</span><span class="pun">)</span><span class="pln">

</span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// access bean via JMX, use a separate thread just to</span><span class="pln">
    </span><span class="com">// show that we could access remotely if we wanted</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> server </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ManagementFactory</span><span class="pun">.</span><span class="pln">platformMBeanServer
    </span><span class="kwd">def</span><span class="pln"> mbean </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GroovyMBean</span><span class="pun">(</span><span class="pln">server</span><span class="pun">,</span><span class="pln"> </span><span class="str">'bean:name=calcMBean'</span><span class="pun">)</span><span class="pln">
    sleep </span><span class="lit">1000</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">8</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> mbean</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    mbean</span><span class="pun">.</span><span class="typ">Base</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">8</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="str">'10'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> mbean</span><span class="pun">.</span><span class="pln">addStrings</span><span class="pun">(</span><span class="str">'7'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">)</span><span class="pln">
    mbean</span><span class="pun">.</span><span class="typ">Base</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">16</span><span class="pln">
    sleep </span><span class="lit">2000</span><span class="pln">
    println </span><span class="str">"Number of invocations: $mbean.Invocations"</span><span class="pln">
    println mbean
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> calc</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">'11'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> calc</span><span class="pun">.</span><span class="pln">addStrings</span><span class="pun">(</span><span class="str">'10'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">)</span><span class="pln">
sleep </span><span class="lit">2000</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">'20'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> calc</span><span class="pun">.</span><span class="pln">addStrings</span><span class="pun">(</span><span class="str">'1f'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'1'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the resulting output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Number of invocations: 5
MBean Name:
  bean:name=calcMBean

Attributes:
  (rw) int Base
  (r) int Invocations
Operations:
  int add(int x, int y)
  java.lang.String addStrings(java.lang.String x, java.lang.String y)
  int getInvocations()
  int getBase()
  void setBase(int p1)</pre>
</div>
</div>
<div class="paragraph">
<p>You can even attach to the process while it is running with <a href="http://docs.oracle.com/javase/1.5.0/docs/guide/management/jconsole.html">jconsole</a>. It will look something like:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="Groovy-Language-Documentation_files/xjconsole.png" alt="jconsole" data-pagespeed-url-hash="991683389" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"></span></p>
</div>
<div class="paragraph">
<p>We started the Groovy application with the <code>-Dcom.sun.management.jmxremote</code> JVM argument.</p>
</div>
<div class="paragraph">
<p>See also:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_dynamic-language-beans-in-spring">Dynamic language beans in Spring</a></p>
</li>
<li>
<p><a href="#_using-spring-factories-with-groovy">Using Spring Factories with Groovy</a></p>
</li>
<li>
<p><a href="http://static.springsource.org/spring/docs/3.2.x/spring-framework-reference/html/jmx.html">Spring JMX Documentation</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting"><a class="anchor" href="#_troubleshooting"></a>3.16.7. Troubleshooting</h4>
<div class="sect4">
<h5 id="_java_lang_securityexception"><a class="anchor" href="#_java_lang_securityexception"></a>java.lang.SecurityException</h5>
<div class="paragraph">
<p>If you get the following error, your container’s JMX access is password protected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.SecurityException: Authentication failed! Credentials required</pre>
</div>
</div>
<div class="paragraph">
<p>To fix that, add an environment with the credentials when connecting, like this (password has to be set before that):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> jmxEnv </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">password </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    jmxEnv </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[(</span><span class="typ">JMXConnector</span><span class="pun">.</span><span class="pln">CREDENTIALS</span><span class="pun">):</span><span class="pln"> </span><span class="pun">(</span><span class="typ">String</span><span class="pun">[])[</span><span class="str">"monitor"</span><span class="pun">,</span><span class="pln"> password</span><span class="pun">]]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> connector </span><span class="pun">=</span><span class="pln"> </span><span class="typ">JMXConnectorFactory</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JMXServiceURL</span><span class="pun">(</span><span class="pln">serverUrl</span><span class="pun">),</span><span class="pln"> jmxEnv</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Details for the software you are trying to monitor/manage may differ 
slightly. Check out the other examples using credentials above if 
appropriate (e.g. OC4J and WebLogic). If you still have troubles, you 
will have to consult the documentation for the software you are trying 
to monitor/manage for details on how to provide credentials.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="jmx_jmxbuilder"><a class="anchor" href="#jmx_jmxbuilder"></a>3.16.8. JmxBuilder</h4>
<div class="paragraph">
<p><strong>JmxBuilder is a Groovy-based domain specific language for the Java Management Extension (JMX) API</strong>.
 It uses the builder pattern (FactoryBuilder) to create an internal DSL 
that facilitates the exposure of POJO’s and Groovy beans as management 
components via the MBean server. JmxBuilder hides the complexity of 
creating and exporting management beans via the JMX API and provides a 
set of natural Groovy constructs to interact with the JMX 
infrastructure.</p>
</div>
<div class="sect4">
<h5 id="_instantiating_jmxbuilder"><a class="anchor" href="#_instantiating_jmxbuilder"></a>Instantiating JmxBuilder</h5>
<div class="paragraph">
<p>To start using JmxBuilder, simply make sure the jar file is on your class path. Then you can do the following in your code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> jmx </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">JmxBuilder</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>That’s it!</strong> You are now ready to use the JmxBuilder.</p>
</div>
<div class="paragraph">
<p><strong>NOTE</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can pass in an instance of <strong>your own MBeanServer</strong> to the builder (<strong>JmxBuilder(MBeanServer)</strong>)</p>
</li>
<li>
<p>If no MBeanServer is specified, the builder instance will default to the underlying platform MBeanServer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you have an instance of JmxBuilder, you are now ready to invoke any of its builder nodes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_jmx_connectors"><a class="anchor" href="#_jmx_connectors"></a>JMX Connectors</h5>
<div class="paragraph">
<p>Remote connectivity is a crucial part of the JMX architecture. 
JmxBuilder facilitates the creation of connector servers and connector 
clients with a minimal amount of coding.</p>
</div>
<div class="sect5">
<h6 id="_connector_server"><a class="anchor" href="#_connector_server"></a>Connector Server</h6>
<div class="paragraph">
<p>JmxBuilder.connectorServer() supports the full Connector api syntax 
and will let you specify properties, override the URL, specify your own 
host, etc.</p>
</div>
<div class="paragraph">
<p><strong>Syntax</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>jmx.connectorServer(
    protocol:"rmi",
    host:"...",
    port:1099,
    url:"...",
    properties:[
        "authenticate":true|false,
        "passwordFile":"...",
        "accessFile":"...",
        "sslEnabled" : true | false
        // any valid connector property
    ]
)</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the serverConnector node will accept four ServerConnector 
property aliases (authenticate, passwordFile,accessFile, and 
sslEnabled). You can use these aliases or provided any of the 
RMI-supported properties.</p>
</div>
<div class="paragraph">
<p><strong>Example - Connector Server (see correction below)</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">jmx</span><span class="pun">.</span><span class="pln">connectorServer</span><span class="pun">(</span><span class="pln">port</span><span class="pun">:</span><span class="pln"> </span><span class="lit">9000</span><span class="pun">).</span><span class="pln">start</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet above returns an RMI connector that will start listening 
on port 9000. By default, the builder will internally generate URL <strong>"service:jmx:rmi:///jndi/rmi://localhost:9000/jmxrmi"</strong>.</p>
</div>
<div class="paragraph">
<p><em>NOTE: Sadly you are as likely to get something like the following
 when attempting to run the previous snippet of code (example is 
incomplete, see below):</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre>Caught: java.io.IOException: Cannot bind to URL [rmi://localhost:9000/jmxrmi]: javax.naming.ServiceUnavailableException [Root exception is java.rmi.ConnectException: Connection refused to host: localhost; nested exception is:
?????? java.net.ConnectException: Connection refused]
??</pre>
</div>
</div>
<div class="paragraph">
<p><em>This occurs on Mac and Linux (CentOS 5) with Groovy 1.6 
installed. Perhaps there were assumptions made about the configuration 
of the /etc/hosts file?</em></p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>The correct example is shown below.</em>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><strong>Connector Example (Corrected) - Connector Server</strong></p>
</div>
<div class="paragraph">
<p>The example above does not create the RMI registry. So, in order to 
export, you have to first export the RMI object registry (make sure to 
import <code>java.rmi.registry.LocateRegistry</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">rmi</span><span class="pun">.</span><span class="pln">registry</span><span class="pun">.</span><span class="typ">LocateRegistry</span><span class="pln">
</span><span class="com">//...</span><span class="pln">

</span><span class="typ">LocateRegistry</span><span class="pun">.</span><span class="pln">createRegistry</span><span class="pun">(</span><span class="lit">9000</span><span class="pun">)</span><span class="pln">
jmx</span><span class="pun">.</span><span class="pln">connectorServer</span><span class="pun">(</span><span class="pln">port</span><span class="pun">:</span><span class="pln"> </span><span class="lit">9000</span><span class="pun">).</span><span class="pln">start</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_connector_client"><a class="anchor" href="#_connector_client"></a>Connector Client</h6>
<div class="paragraph">
<p>JmxBuilder.connectorClient() node lets you create JMX connector client object to connect to a JMX MBean Server.</p>
</div>
<div class="paragraph">
<p><strong>Syntax</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>jmx.connectorClient (
    protocol:"rmi",
    host:"...",
    port:1099,
    url:"...",
)</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example - Client Connector</strong></p>
</div>
<div class="paragraph">
<p>Creating a connector client can be done just as easily. With one line
 of code, you can create an instance of a JMX Connector Client as shown 
below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="pln">connectorClient</span><span class="pun">(</span><span class="pln">port</span><span class="pun">:</span><span class="pln"> </span><span class="lit">9000</span><span class="pun">)</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then access the MBeanServerConnection associated with the connector using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">client</span><span class="pun">.</span><span class="pln">getMBeanServerConnection</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jmxbuilder_mbean_export"><a class="anchor" href="#_jmxbuilder_mbean_export"></a>JmxBuilder MBean Export</h5>
<div class="paragraph">
<p>You can <strong>export a Java object or a Groovy object</strong> with minimal coding. JmxBuilder will even find and <strong>export dynamic Groovy methods</strong> injected at runtime.</p>
</div>
<div class="sect5">
<h6 id="_implicit_vs_explicit_descriptors"><a class="anchor" href="#_implicit_vs_explicit_descriptors"></a>Implicit vs Explicit Descriptors</h6>
<div class="paragraph">
<p>When using the builder, you can <strong>let JmxBuilder implicitly generate</strong>
 all of your MBean descriptor info. This is useful when you want to 
write minimal code to quickly export your beans. You can also explicitly
 declare all descriptor info for the bean. This gives you total control 
on how you want to describe every piece of information that you want to 
export for the underlying bean.</p>
</div>
</div>
<div class="sect5">
<h6 id="_the_jmxbuilder_export_node"><a class="anchor" href="#_the_jmxbuilder_export_node"></a>The JmxBuilder.export() Node</h6>
<div class="paragraph">
<p>The <strong>JmxBuilder.export() node provides a container</strong> 
where all management entities to be exported to the MBeanServer are 
placed. You can place one or more bean() or timer() nodes as children of
 the export() node. JmxBuilder will <strong>automatically batch export the entities described</strong> by the nodes to the MBean server for management (see example below).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">())</span><span class="pln">
    bean</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Bar</span><span class="pun">())</span><span class="pln">
    bean</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SomeBar</span><span class="pun">())</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code snippet above, <strong>JmxBuilder.export() will export three management beans</strong> to the MBean server.</p>
</div>
</div>
<div class="sect5">
<h6 id="_jmxbuilder_export_syntax"><a class="anchor" href="#_jmxbuilder_export_syntax"></a>JmxBuilder.export() Syntax</h6>
<div class="paragraph">
<p>JmxBuilder.export() node supports the <strong>registrationPolicy</strong> parameter to specify how JmxBuilder will behave to resolve bean name collision during MBean registration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jmx.export(policy:"replace|ignore|error")
or
jmx.export(regPolicy:"replace|ignore|error")</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>replace</strong> - JmxBuilder.export() will replace any bean already registered with the MBean during export.</p>
</li>
<li>
<p><strong>ignore</strong> - The bean being exported will be ignored if the same bean is already registered.</p>
</li>
<li>
<p><strong>error</strong> - JmxBuilder.export() throws an error upon bean name collision during registration.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_integration_with_groovymbean_class"><a class="anchor" href="#_integration_with_groovymbean_class"></a>Integration with GroovyMBean Class</h6>
<div class="paragraph">
<p>When you export an MBean to the MBeanServer, <strong>JmxBuilder will return an instance of GroovyMBean</strong> representing the management bean that have been exported by the builder. Nodes such as <strong>bean()</strong> and <strong>timer()</strong> will return an instances of GroovyMBean when they are invoked. The <strong>export()</strong> node returns an <strong>array of all of GroovyMBean[]</strong> representing all managed objects exported to the MBean server.</p>
</div>
</div>
<div class="sect5">
<h6 id="_mbean_registration_with_jmxbuilder_bean"><a class="anchor" href="#_mbean_registration_with_jmxbuilder_bean"></a>MBean Registration with JmxBuilder.bean()</h6>
<div class="paragraph">
<p>This portion of this reference uses class <strong>RequestController</strong>
 to illustrate how to use JmxBuilder to export runtime management beans.
 The class is for illustration purpose and can be a POJO or a Groovy 
bean.</p>
</div>
<div class="paragraph">
<p><strong>RequestController</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// constructors</span><span class="pln">
    </span><span class="typ">RequestController</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">super</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">RequestController</span><span class="pun">(</span><span class="typ">Map</span><span class="pln"> resource</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    </span><span class="com">// attributes</span><span class="pln">
    </span><span class="kwd">boolean</span><span class="pln"> isStarted</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">true</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> getRequestCount</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> getResourceCount</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> setRequestLimit</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> limit</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> getRequestLimit</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    </span><span class="com">// operations</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> start</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> stop</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> putResource</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> resource</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> makeRequest</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> res</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> makeRequest</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="sect6">
<h7 id="_implicit_export"><a class="anchor" href="#_implicit_export"></a>Implicit Export</h7>
<div class="paragraph">
<p>As mentioned earlier, you can use JmxBuilder’s flexible syntax to 
export any POJO/POGO with no descriptor. The builder can automatically 
describe all aspects of the management beans using implicit defaults. 
These default values can easily be overridden as we’ll see in this in 
the next section.</p>
</div>
<div class="paragraph">
<p>The simplest way to export a POJO or POGO is listed below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(</span><span class="pln">resource</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Hello World"</span><span class="pun">))</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>What this does:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, the <strong>JmxBuilder.export() node will export</strong> an MBean to the MBeanServer representing <strong>the declared POJO</strong> instance.</p>
</li>
<li>
<p>The builder will <strong>generate a default ObjectName</strong> for the MBean and all other MBean descriptor information.</p>
</li>
<li>
<p><strong>JmxBuilder will automatically export</strong> all declared <strong>attributes</strong> (MBean getter/setters), <strong>constructors</strong>, and <strong>operations</strong> on the instance.</p>
</li>
<li>
<p>The exported <strong>attributes</strong> will have <strong>read-only</strong> visibility.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Remember, <strong>JmxBuilder.export() returns an array of GroovyMBean[] objects</strong> for all exported instances. So, once you call JmxBuilder.export(), <strong>you have immediate access to the underlying MBean proxy</strong> (via GroovyMBean).</p>
</div>
<div class="sect7">
<h8 id="_jconsole_view_of_exported_bean"><a class="anchor" href="#_jconsole_view_of_exported_bean"></a>JConsole view of Exported Bean</h8>
<div class="paragraph">
<p><span class="image"><img src="Groovy-Language-Documentation_files/xjconsole-implicit-export.png" alt="jconsole-implicit-export" data-pagespeed-url-hash="739375941" onload="pagespeed.CriticalImages.checkImageForCriticality(this);"></span></p>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_jmxbuilder_bean_syntax"><a class="anchor" href="#_jmxbuilder_bean_syntax"></a>JmxBuilder.bean() Syntax</h6>
<div class="paragraph">
<p>The JmxBuilder.bean() node supports an extensive set of descriptors 
to describe your bean for management. The JMX MBeanServer uses these 
descriptors to expose meta data about the bean exposed for management.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jmx.export {
    bean(
        target:bean instance,
        name:ObjectName,
        desc:"...",
        attributes:"*",
        attributes:[]
        attributes:[ "AttrubuteName1","AttributeName2",...,"AttributeName_n" ]
        attributes:[
            "AttributeName":"*",
            "AttributeName":[
                desc:"...",
                defaultValue:value,
                writable:true|false,
                editable:true|false,
                onChange:{event-&gt; // event handler}
            ]
        ],

        constructors:"*",
        constructors:[
            "Constructor Name":[],
            "Constructor Name":[ "ParamType1","ParamType2,...,ParamType_n" ],
            "Constructor Name":[
                desc:"...",
                params:[
                    "ParamType1":"*",
                    "ParamType2":[desc:"...", name:"..."],...,
                    "ParamType_n":[desc:"...", name:"..."]
                ]
            ]
        ],

        operations:"*",
        operations:[ "OperationName1", "OperationName2",...,"OperationNameN" ],
        operations:[
            "OperationName1":"*",
            "OperationName2":[ "type1","type2,"type3" ]
            "OperationName3":[
                desc:"...",
                params:[
                    "ParamType1":"*"
                    "ParamType2":[desc:"...", name:"..."],...,
                    "ParamType_n":[desc:"...", name:"..."]
                ],
                onInvoked:{event-&gt; JmxBuilder.send(event:"", to:"")}
            ]
        ],

        listeners:[
            "ListenerName1":[event: "...", from:ObjectName, call:{event-&gt;}],
            "ListenerName2":[event: "...", from:ObjectName, call:&amp;methodPointer]
        ]

    )
}</pre>
</div>
</div>
<div class="paragraph">
<p>Instead of describing the entire node, the following section explore each attribute separately.</p>
</div>
</div>
<div class="sect5">
<h6 id="_bean_node_specifying_mbean_objectname"><a class="anchor" href="#_bean_node_specifying_mbean_objectname"></a>Bean() Node - Specifying MBean ObjectName</h6>
<div class="paragraph">
<p>Using the bean() node descriptors, you can specify your own MBean ObjectName.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> ctrl </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(</span><span class="pln">resource</span><span class="pun">:</span><span class="str">"Hello World"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">target</span><span class="pun">:</span><span class="pln"> ctrl</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ObjectName can be specified as a String or an instance of the ObjectName.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bean_node_attribute_export"><a class="anchor" href="#_bean_node_attribute_export"></a>Bean() Node - Attribute Export</h5>
<div class="paragraph">
<p>JMX attributes are the setters and getters on the underlying bean. 
The JmxBuilder.bean() node provides several ways to flexibly describe 
and export MBean attributes. You can combine them however you want to 
achieve any level of attribute visibility. Let’s take a look.</p>
</div>
<div class="sect5">
<h6 id="_export_all_attributes_with_wildcard"><a class="anchor" href="#_export_all_attributes_with_wildcard"></a>Export All Attributes with Wildcard "*"</h6>
<div class="paragraph">
<p>The following code snippet <strong>will describe and export all attributes</strong> on the bean as read-only. <strong>JmxBuilder will use default values</strong> to describe the attributes that exported for management.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> objName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln">
    name</span><span class="pun">:</span><span class="pln"> objName</span><span class="pun">,</span><span class="pln">
    attributes</span><span class="pun">:</span><span class="pln"> </span><span class="str">"*"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_export_attribute_list"><a class="anchor" href="#_export_attribute_list"></a>Export Attribute List</h6>
<div class="paragraph">
<p>JmxBuilder will let you specify a list of attributes to export.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> objName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">
        target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln">
        name</span><span class="pun">:</span><span class="pln"> objName</span><span class="pun">,</span><span class="pln">
        attributes</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"Resource"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"RequestCount"</span><span class="pun">]</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, <strong>only the "Resource" and "RequestCount" attributes will be exported</strong>. Again, since no descriptors are provided, <strong>JmxBuilder will use sensible defaults</strong> to describe the exported attributes.</p>
</div>
</div>
<div class="sect5">
<h6 id="_export_attribute_with_explicit_descriptors"><a class="anchor" href="#_export_attribute_with_explicit_descriptors"></a>Export Attribute with Explicit Descriptors</h6>
<div class="paragraph">
<p>One of the strengths of JmxBuilder is its flexibility in describing 
MBean. With the builder you can describe all aspects of the MBeans 
attribute that you want to export to the MBeanServer (see syntax above).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> objName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">
        target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln">
        name</span><span class="pun">:</span><span class="pln"> objName</span><span class="pun">,</span><span class="pln">
        attributes</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
            </span><span class="str">"Resource"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">desc</span><span class="pun">:</span><span class="pln"> </span><span class="str">"The resource to request."</span><span class="pun">,</span><span class="pln"> readable</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> writable</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> defaultValue</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Hello"</span><span class="pun">],</span><span class="pln">
            </span><span class="str">"RequestCount"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"*"</span><span class="pln">
        </span><span class="pun">]</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, attribute <strong>"Resource" is fully-described</strong>
 using all supported descriptors (i.e. desc, readable, writable, 
defaultValue) for a JMX attribute. However, we use the wildcard to 
describe attribute <strong>RequestCount</strong> and it will be exported and described using defaults.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bean_node_constructor_export"><a class="anchor" href="#_bean_node_constructor_export"></a>Bean() Node - Constructor Export</h5>
<div class="paragraph">
<p>JmxBuilder <strong>supports the explicit description and export of constructors</strong>
 defined in the underlying bean. There are several options available 
when exporting constructors. You can combine them however you want to 
achieve the desired level of manageability.</p>
</div>
<div class="sect5">
<h6 id="_export_all_constructors_with"><a class="anchor" href="#_export_all_constructors_with"></a>Export all Constructors with "*"</h6>
<div class="paragraph">
<p>You can use the builder’s special '""' <strong>notation to *export all constructors</strong> declared on the underlying bean. The builder will use default values to describe the MBean constructors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> objName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">
        target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln">
        name</span><span class="pun">:</span><span class="pln"> objName</span><span class="pun">,</span><span class="pln">
        constructors</span><span class="pun">:</span><span class="pln"> </span><span class="str">"*"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_export_constructors_using_parameter_descriptor"><a class="anchor" href="#_export_constructors_using_parameter_descriptor"></a>Export Constructors using Parameter Descriptor</h6>
<div class="paragraph">
<p>JmxBuilder lets you <strong>target specific constructor</strong> to export <strong>by describing the parameter signature</strong>.
 This is useful when you have several constructors with different 
parameter signature and you want to export specific constructors.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> objName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">
        target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln">
        name</span><span class="pun">:</span><span class="pln"> objName</span><span class="pun">,</span><span class="pln">
        constructors</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
            </span><span class="str">"RequestController"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"Object"</span><span class="pun">]</span><span class="pln">
        </span><span class="pun">]</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, JmxBuilder will <strong>export a constructor that takes one parameter of type "Object"</strong>. Again, JmxBuilder will use default values to fill in the description of the constructor and the parameters.</p>
</div>
</div>
<div class="sect5">
<h6 id="_export_constructor_with_explicit_descriptors"><a class="anchor" href="#_export_constructor_with_explicit_descriptors"></a>Export Constructor with Explicit Descriptors</h6>
<div class="paragraph">
<p>JmxBuilder allows you to <strong>fully-describe</strong> the constructor that you want to target for export (see syntax above).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> objName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> objName</span><span class="pun">,</span><span class="pln">
        constructors</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
            </span><span class="str">"RequestController"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
                desc</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Constructor takes param"</span><span class="pun">,</span><span class="pln">
                </span><span class="kwd">params</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"Object"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Resource"</span><span class="pun">,</span><span class="pln"> desc</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Resource for controller"</span><span class="pun">]]</span><span class="pln">
            </span><span class="pun">]</span><span class="pln">
        </span><span class="pun">]</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above, JmxBuilder will target a constructor that takes 
one parameter for export to the MBeanServer. Notice how the constructor 
can be fully-described using all optional descriptor keys including 
parameter descriptors.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bean_node_operation_export"><a class="anchor" href="#_bean_node_operation_export"></a>Bean() Node - Operation Export</h5>
<div class="paragraph">
<p>Similar to constructors, JmxBuilder supports the description and 
export of MBean operations using a flexible notation (see above for 
syntax). You can combine these notations however you want to achieve the
 level of operation manageability desired.</p>
</div>
<div class="sect5">
<h6 id="_export_all_operations_with"><a class="anchor" href="#_export_all_operations_with"></a>Export All Operations with "*"</h6>
<div class="paragraph">
<p>You can use the builder’s special '""'' <strong>notation to *export all operations</strong>
 defined on the bean to be exposed for management. The builder will use 
default descriptor values for the operations being exported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> objName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">
        target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln">
        name</span><span class="pun">:</span><span class="pln"> objName</span><span class="pun">,</span><span class="pln">
        operations</span><span class="pun">:</span><span class="pln"> </span><span class="str">"*"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this snippet, JmxBuilder will <strong>export all bean operations</strong> and will use default values to describe them in the MBeanServer.</p>
</div>
</div>
<div class="sect5">
<h6 id="_export_operation_list"><a class="anchor" href="#_export_operation_list"></a>Export Operation List</h6>
<div class="paragraph">
<p>JmxBuilder has a shorthand notation that lets you quickly target 
operations to be exported by providing a list of methods to export.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> objName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">
        target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln">
        name</span><span class="pun">:</span><span class="pln"> objName</span><span class="pun">,</span><span class="pln">
        operations</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"start"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"stop"</span><span class="pun">]</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, the <strong>builder will only export methods start() and stop()</strong>. All other methods will be ignored. JmxBuilder will use default descriptor values to describe the operations being exported.</p>
</div>
</div>
<div class="sect5">
<h6 id="_export_operations_by_signature"><a class="anchor" href="#_export_operations_by_signature"></a>Export Operations by Signature</h6>
<div class="paragraph">
<p>Using JmxBuilder, you can target methods to export for management 
using the methods’s parameter signature. This is useful when you want to
 distinguish methods with the same name that you want to export (i.e. 
stop() instead of stop(boolean)).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> objName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">
        target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln">
        name</span><span class="pun">:</span><span class="pln"> objName</span><span class="pun">,</span><span class="pln">
        operations</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
            </span><span class="str">"makeRequest"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"String"</span><span class="pun">]</span><span class="pln">
        </span><span class="pun">]</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the snippet above, JmxBuilder would <strong>select method makeRequest(String)</strong>
 to be exported instead of the other version makeRequest() which takes 
no parameter. In this shorthand context, the signature is specified as a
 list of type (i.e. "String").</p>
</div>
</div>
<div class="sect5">
<h6 id="_export_operations_with_explicit_descriptors"><a class="anchor" href="#_export_operations_with_explicit_descriptors"></a>Export Operations with Explicit Descriptors</h6>
<div class="paragraph">
<p>JmxBuilder supports detailed descriptors for bean operations. You can
 supply deep descriptor info about any operation on your bean including a
 name, description, method parameters, parameter type, and parameter 
description.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> objName </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ObjectName</span><span class="pun">(</span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> objName</span><span class="pun">,</span><span class="pln">
        operations</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
            </span><span class="str">"start"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">desc</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Starts request controller"</span><span class="pun">],</span><span class="pln">
            </span><span class="str">"stop"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">desc</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Stops the request controller"</span><span class="pun">],</span><span class="pln">
            </span><span class="str">"setResource"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="kwd">params</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"Object"</span><span class="pun">]],</span><span class="pln">
            </span><span class="str">"makeRequest"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
                desc</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Executes the request."</span><span class="pun">,</span><span class="pln">
                </span><span class="kwd">params</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
                    </span><span class="str">"String"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Resource"</span><span class="pun">,</span><span class="pln"> desc</span><span class="pun">:</span><span class="pln"> </span><span class="str">"The resource to request"</span><span class="pun">]</span><span class="pln">
                </span><span class="pun">]</span><span class="pln">
            </span><span class="pun">]</span><span class="pln">
        </span><span class="pun">]</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet above shows all of the ways JmxBuilder allows you to describe an operation targeted for management:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operations <strong>start() and stop()</strong> are described by the "desc" key (this is enough since there are no params).</p>
</li>
<li>
<p>In operation <strong>setResource()</strong> uses of a shorthand version of <strong>params</strong>: to describe the parameters for the method.</p>
</li>
<li>
<p><strong>makeRequest()</strong> uses the the extended descriptor syntax to describe all aspects of the operation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_embedding_descriptor"><a class="anchor" href="#_embedding_descriptor"></a>Embedding Descriptor</h5>
<div class="paragraph">
<p>JmxBuilder supports the ability to <strong>embed descriptors directly in your Groovy class</strong>.
 So, instead of wrapping your description around the declared object (as
 we’ve seen here), you can embed your JMX descriptors directly in your 
class.</p>
</div>
<div class="paragraph">
<p><strong>RequestControllerGroovy</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">RequestControllerGroovy</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// attributes</span><span class="pln">
    </span><span class="kwd">boolean</span><span class="pln"> started
    </span><span class="kwd">int</span><span class="pln"> requestCount
    </span><span class="kwd">int</span><span class="pln"> resourceCount
    </span><span class="kwd">int</span><span class="pln"> requestLimit
    </span><span class="typ">Map</span><span class="pln"> resources

    </span><span class="com">// operations</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> start</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> stop</span><span class="pun">(){</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> putResource</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> resource</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> makeRequest</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> res</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> makeRequest</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">static</span><span class="pln"> descriptor </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
        name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.builder:type=EmbeddedObject"</span><span class="pun">,</span><span class="pln">
        operations</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">"start"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"stop"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"putResource"</span><span class="pun">],</span><span class="pln">
        attributes</span><span class="pun">:</span><span class="pln"> </span><span class="str">"*"</span><span class="pln">
    </span><span class="pun">]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// export</span><span class="pln">
jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pun">(</span><span class="pln">
    bean</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestControllerGroovy</span><span class="pun">())</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two things going on in the code above:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Groovy class RequestControllerGroovy is defined and includes a <strong>static descriptor</strong> member. That member is used to declare a JmxBuilder descriptor to describe member of the class targeted for JMX export.</p>
</li>
<li>
<p>The second part of the code shows how to use JmxBuilder to export that class for management.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_timer_export"><a class="anchor" href="#_timer_export"></a>Timer Export</h5>
<div class="paragraph">
<p>JMX standards mandate that the implementation of the API makes 
available a timer service. Since JMX is a component-based architecture, 
timers provide an excellent signalling mechanism to communicate to 
registered listener components in the MBeanServer. JmxBuilder supports 
the creation and export of timers using the same easy syntax we’ve seen 
so far.</p>
</div>
<div class="sect5">
<h6 id="_timer_node_syntax"><a class="anchor" href="#_timer_node_syntax"></a>Timer Node Syntax</h6>
<div class="listingblock">
<div class="content">
<pre>timer(
    name:ObjectName,
    event:"...",
    message:"...",
    data:dataValue
    startDate:"now"|dateValue
    period:"99d"|"99h"|"99m"|"99s"|99
    occurrences:long
)</pre>
</div>
</div>
<div class="paragraph">
<p>The timer() node supports several attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: - Required The qualified JMX ObjectName instance (or String) for the timer.</p>
</li>
<li>
<p><strong>event</strong>: - The JMX event type string that will be broadcast with every timing signal (default <strong>"jmx.builder.event"</strong>).</p>
</li>
<li>
<p><strong>message</strong>: - An optional string value that can be sent to listeners.</p>
</li>
<li>
<p><strong>data</strong>: - An optional object that can be sent to listeners of timing signal.</p>
</li>
<li>
<p><strong>startDate</strong>: - When to start timer. Set of valid values [ "now", date object ]. Default is "now"</p>
</li>
<li>
<p><strong>period</strong>: - A timer’s period expressed as either a 
number of millisecond or time unit (day, hour, minute, second). See 
description below.</p>
</li>
<li>
<p><strong>occurrences</strong>: - A number indicating the number of time to repeat timer. Default is forever.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_exporting_a_timer"><a class="anchor" href="#_exporting_a_timer"></a>Exporting a Timer</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> timer </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="pln">timer</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.builder:type=Timer"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">event</span><span class="pun">:</span><span class="pln"> </span><span class="str">"heartbeat"</span><span class="pun">,</span><span class="pln"> period</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1s"</span><span class="pun">)</span><span class="pln">
timer</span><span class="pun">.</span><span class="pln">start</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This snippet above <strong>describes, creates, and exports a standard JMX Timer</strong> component. Here, the <strong>timer()</strong> node <strong>returns a GroovyMBean</strong> that represents the registered timer MBean in the MBeanServer.</p>
</div>
<div class="paragraph">
<p>An <strong>alternative way of exporting timers</strong> is within the JmxBuilder.export() node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    timer</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.builder:type=Timer1"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">event</span><span class="pun">:</span><span class="pln"> </span><span class="str">"event.signal"</span><span class="pun">,</span><span class="pln"> period</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1s"</span><span class="pun">)</span><span class="pln">
    timer</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.builder:type=Timer2"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">event</span><span class="pun">:</span><span class="pln"> </span><span class="str">"event.log"</span><span class="pun">,</span><span class="pln"> period</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1s"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
beans</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">start</span><span class="pun">()</span><span class="pln">
beans</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="pln">start</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_timer_period"><a class="anchor" href="#_timer_period"></a>Timer Period</h6>
<div class="paragraph">
<p>The <strong>timer() node supports a flexible notation</strong> for specifying the <strong>timer period values</strong>. You can specify the time in second, minutes, hour, and day. The default is millisecond.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>timer(<strong>period: 100</strong>) = 100 millisecond</p>
</li>
<li>
<p>timer(<strong>period: "1s"</strong>) = 1 second</p>
</li>
<li>
<p>timer(<strong>period: "1m"</strong>) = 1 minute</p>
</li>
<li>
<p>timer(<strong>period: "1h"</strong>) = 1 hour</p>
</li>
<li>
<p>timer(<strong>period: "1d"</strong>) = 1 day</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The node will automatically translate.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jmxbuilder_and_events"><a class="anchor" href="#_jmxbuilder_and_events"></a>JmxBuilder and Events</h5>
<div class="paragraph">
<p>An integral part of <strong>JMX</strong> is its <strong>event model</strong>. Registered management beans can <strong>communicate with each other by broadcasting events</strong> on the MBeanServer’s event bus. <strong>JmxBuilder provides several ways to easily listen and react to events</strong> broadcasted on the MBeanServer’s event bus. Developers can <strong>capture any event on the bus or throw their own</strong> to be consumed by other components registered on the MBeanServer.</p>
</div>
<div class="sect5">
<h6 id="_event_handling_closures"><a class="anchor" href="#_event_handling_closures"></a>Event Handling Closures</h6>
<div class="paragraph">
<p>JmxBuilder leverages Groovy’s use of closures to provide simple, yet 
elegant, mean of reacting to JMX events. JmxBuilder supports two closure
 signatures:</p>
</div>
<div class="sect6">
<h7 id="_parameterless"><a class="anchor" href="#_parameterless"></a>Parameterless</h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">callback </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="com">// event handling code here.</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>JmxBuilder executes the closure and passes no information about the event that was captured on the bus.</p>
</div>
</div>
<div class="sect6">
<h7 id="_with_event_parameter"><a class="anchor" href="#_with_event_parameter"></a>With Event Parameter</h7>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">callback </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="com">// event handling code</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>JmxBuilder will pass an <strong>"event" object to the closure</strong>
 using this format. The event object contains information about the 
event was intercepted so that it can be handled by the handler. The 
parameter will contain different set of info depending on the event that
 was captured.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_handling_attribute_onchange_event"><a class="anchor" href="#_handling_attribute_onchange_event"></a>Handling Attribute onChange Event</h6>
<div class="paragraph">
<p>When describing attributes (see bean() node section above), you can <strong>provide a closure (or method pointer) for callback to be executed when the value of the attribute is updated</strong> on the exported MBean. This gives developers an opportunity to listen to and react to state changes on the MBean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">
        target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">,</span><span class="pln">
        attributes</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
            </span><span class="str">"Resource"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
                readable</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"> writable</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">
                onChange</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> e </span><span class="pun">-&gt;</span><span class="pln">
                    println e</span><span class="pun">.</span><span class="pln">oldValue
                    println e</span><span class="pun">.</span><span class="pln">newValue
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">]</span><span class="pln">
        </span><span class="pun">]</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample snippet above shows how to <strong>specify an "onChange" callback closure</strong> when describing MBean attributes. In this sample code, whenever attribute "Resource" is updated via the exported MBean, the <strong>onChange event will be executed</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_attribute_onchange_event_object"><a class="anchor" href="#_attribute_onchange_event_object"></a>Attribute onChange Event Object</h6>
<div class="paragraph">
<p>When handling the attribute onChange event, the handler closure will receive an event object with the following info:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>event.<strong>oldValue</strong> - the previous attribute value before the change event.</p>
</li>
<li>
<p>event.<strong>newValue</strong> - the new value of the attribute after the change.</p>
</li>
<li>
<p>event.<strong>attribute</strong> - the name of the attribute on which the event occurred.</p>
</li>
<li>
<p>event.<strong>attributeType</strong> - the data type of the attribute that causes the event.</p>
</li>
<li>
<p>event.<strong>sequenceNumber</strong> - a numeric value representing the sequence number of event.</p>
</li>
<li>
<p>event.<strong>timeStamp</strong> - a time stamp for the event occurrence.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_handling_operation_oncall_event"><a class="anchor" href="#_handling_operation_oncall_event"></a>Handling Operation onCall Event</h6>
<div class="paragraph">
<p>Similar to mbean attributes, JmxBuilder affords developers the <strong>ability to listen for operation invocation</strong> on an MBean registered in the MBeaServer. JmxBuilder accepts a <strong>callback closure that will be executed after the MBean method has invoked</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">EventHandler</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> handleStart</span><span class="pun">(</span><span class="pln">e</span><span class="pun">){</span><span class="pln">
        println e
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> handler </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">EventHandler</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">,</span><span class="pln">
        operations</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
            </span><span class="str">"start"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
                desc</span><span class="pun">:</span><span class="str">"Starts request controller"</span><span class="pun">,</span><span class="pln">
                onCall</span><span class="pun">:</span><span class="pln">handler</span><span class="pun">.&amp;</span><span class="pln">handleStart
            </span><span class="pun">]</span><span class="pln">
        </span><span class="pun">]</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet above <strong>shows how to declare an "onCall" closure to be used as listener</strong> when operation "start()" is invoked on the MBean. This sample <strong>uses the method pointer syntax</strong> to illustrate the versatility of JmxBuilder.</p>
</div>
</div>
<div class="sect5">
<h6 id="_operation_oncall_event_object"><a class="anchor" href="#_operation_oncall_event_object"></a>Operation onCall Event Object</h6>
<div class="paragraph">
<p>When handling the operation onCall event, the callback closure will receive an event object with the following info:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>event.<strong>event</strong> - the event type string that was broadcasted.</p>
</li>
<li>
<p>event.<strong>source</strong> - The object on which the method was invoked.</p>
</li>
<li>
<p>event.<strong>data</strong> - the data type of the attribute that causes the event.</p>
</li>
<li>
<p>event.<strong>sequenceNumber</strong> - a numeric value representing the sequence number of event.</p>
</li>
<li>
<p>event.<strong>timeStamp</strong> - a time stamp for the event occurrence.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_listener_mbean"><a class="anchor" href="#_listener_mbean"></a>Listener MBean</h5>
<div class="paragraph">
<p>When you export an MBean with the bean() node, you can define events 
the MBean can listen and react to. The bean() node provides a 
"listeners:" attribute that lets you define event listeners that your 
bean can react to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> beans </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="kwd">export</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    timer</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.builder:type=Timer"</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">event</span><span class="pun">:</span><span class="pln"> </span><span class="str">"heartbeat"</span><span class="pun">,</span><span class="pln"> period</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1s"</span><span class="pun">).</span><span class="pln">start</span><span class="pun">()</span><span class="pln">
    bean</span><span class="pun">(</span><span class="pln">target</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RequestController</span><span class="pun">(),</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.tutorial:type=Object"</span><span class="pun">,</span><span class="pln">
        operations</span><span class="pun">:</span><span class="pln"> </span><span class="str">"*"</span><span class="pun">,</span><span class="pln">
        listeners</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
            heartbeat</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
                </span><span class="kwd">from</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.builder:type=Timer"</span><span class="pun">,</span><span class="pln">
                call</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> e </span><span class="pun">-&gt;</span><span class="pln">
                    println e
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">]</span><span class="pln">
        </span><span class="pun">]</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the sample above, we see the <strong>syntax for adding listeners to an exported MBean</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fist, a <strong>timer is exported</strong> and started.</p>
</li>
<li>
<p>Then an <strong>MBean is declared that will listen to the timer</strong> event and do something meaningful.</p>
</li>
<li>
<p>The <strong>"heartbeat:"</strong> name is arbitrary and has no correlation to the timer declared above.</p>
</li>
<li>
<p>The <strong>source</strong> of the event <strong>is specified using the "from:" attribute</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also specify an <strong>event type</strong> you are interested in receiving from a broadcaster (since a broadcaster can be emitting multiple events).</p>
</div>
<div class="sect5">
<h6 id="_listening_to_jmx_events"><a class="anchor" href="#_listening_to_jmx_events"></a>Listening to JMX Events</h6>
<div class="paragraph">
<p>In some cases, you will want to create stand-alone event listeners 
(not attached to exported MBeans). JmxBuilder provides the Listener() 
node to let you create JMX listeners that can listen to MBeanServer 
events. This is useful when creating JMX client applications to 
monitor/manage JMX agents on remote JMX MBeanServers.</p>
</div>
</div>
<div class="sect5">
<h6 id="_listener_node_syntax"><a class="anchor" href="#_listener_node_syntax"></a>Listener Node Syntax</h6>
<div class="listingblock">
<div class="content">
<pre>jmx.listener(
    event: "...",
    from: "object name" | ObjectName,
    call: { event-&gt; }
)</pre>
</div>
</div>
<div class="paragraph">
<p>Here is the description of the <strong>listener()</strong> node attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>event: An optional string that identifies the JMX event type to listen for.</p>
</li>
<li>
<p>from (required): The JMX ObjectName of the component to listen to. 
This can be specified as a string or an instance of ObjectName</p>
</li>
<li>
<p>call: The closure to execute when the event is captured. This can also be specified as a Groovy method pointer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of JmxBuilder’s listener node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">jmx</span><span class="pun">.</span><span class="pln">timer</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.builder:type=Timer"</span><span class="pun">,</span><span class="pln"> period</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1s"</span><span class="pun">).</span><span class="pln">start</span><span class="pun">()</span><span class="pln">

jmx</span><span class="pun">.</span><span class="pln">listener</span><span class="pun">(</span><span class="pln">
    </span><span class="kwd">from</span><span class="pun">:</span><span class="pln"> </span><span class="str">"jmx.builder:type=Timer"</span><span class="pun">,</span><span class="pln">
    call</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> e </span><span class="pun">-&gt;</span><span class="pln">
        println </span><span class="str">"beep..."</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows how you can use a stand alone listener (outside of an MBean export). Here, we <strong>export a timer with a 1 second</strong> resolution. Then, we specify a listener to that timer that will print "beep" every second.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_emitting_jmx_events"><a class="anchor" href="#_emitting_jmx_events"></a>Emitting JMX Events</h5>
<div class="paragraph">
<p>JmxBuilder provides the <strong>tools needed to broadcast your own events</strong> on the MBeanServer’s event bus. There are no restrictions on the event type you can broadcast. You simply <strong>declare your emitter</strong> and the event type that you want to send, then <strong>broadcast your event</strong> at any time. Any registered component in the MBeanServer can register themselves to listen to your events.</p>
</div>
<div class="sect5">
<h6 id="_emitter_syntax"><a class="anchor" href="#_emitter_syntax"></a>Emitter Syntax</h6>
<div class="listingblock">
<div class="content">
<pre>jmx.emitter(name:"Object:Name", event:"type")</pre>
</div>
</div>
<div class="paragraph">
<p>The attributes for the node Emitter() can be summarized as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>name: an optional JMX ObjectName used to register your emitter in the
 MBeanServer. Default is 
jmx.builder:type=Emitter,name=Emitter@OBJECT_HASH_VALUE</p>
</li>
<li>
<p>event: an option string value that describes the JMX event type. Default is <strong>"jmx.builder.event.emitter"</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_declare_the_emitter"><a class="anchor" href="#_declare_the_emitter"></a>Declare the Emitter</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> emitter </span><span class="pun">=</span><span class="pln"> jmx</span><span class="pun">.</span><span class="pln">emitter</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The snippet <strong>declares the emitter using implicit descriptor syntax</strong>. JmxBuilder will do the followings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create and register an emitter MBean with a default ObjectName.</p>
</li>
<li>
<p>Setup a <strong>default event type</strong> with value <strong>"jmx.builder.event.emitter"</strong>.</p>
</li>
<li>
<p>Return a GroovyMBean representing the emitter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As with other nodes in the builder, <strong>you can override all keys in the emitter() node</strong>. You can specify the <strong>ObjectName</strong> and the <strong>event type</strong>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_broadcast_event"><a class="anchor" href="#_broadcast_event"></a>Broadcast Event</h6>
<div class="paragraph">
<p>Once you have declared your emitter, you can broadcast your event.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">emitter</span><span class="pun">.</span><span class="pln">send</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above shows the <strong>emitter sending an event</strong>, once it has been declared. Any JMX component registered in the MBeanServer can register to receive message from this emitter.</p>
</div>
</div>
<div class="sect5">
<h6 id="_sending_event_objects"><a class="anchor" href="#_sending_event_objects"></a>Sending Event Objects</h6>
<div class="paragraph">
<p>You can optionally pass data to the receiver when you send the message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">emitter</span><span class="pun">.</span><span class="pln">send</span><span class="pun">(</span><span class="str">"Hello!"</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use an <strong>event listener closure (see above) that accepts a parameter</strong>, you can access that value.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_further_jmx_information"><a class="anchor" href="#_further_jmx_information"></a>3.16.9. Further JMX Information</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.ddj.com/dept/java/184406481?pgno=1">Monitoring the Java Virtual Machine</a></p>
</li>
<li>
<p><a href="http://buttso.blogspot.com/2006/05/using-groovy-for-system-management.html">Using Groovy for System Management</a></p>
</li>
<li>
<p><a href="https://blogs.oracle.com/sundararajan/entry/groovier_jconsole">Groovier jconsole!</a></p>
</li>
<li>
<p><a href="http://jmesnil.net/weblog/2007/05/23/jmx-scripts-with-eclipse-monkey">JMX Scripts with Eclipse Monkey</a></p>
</li>
<li>
<p><a href="http://activemq.apache.org/jmx.html">Using JMX to monitor Apache ActiveMQ</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_swing_uis"><a class="anchor" href="#_creating_swing_uis"></a>3.17. Creating Swing UIs</h3>
<div class="paragraph">
<p>Creating Swing UIs is made easy thanks to the use of <a href="#swingbuilder">SwingBuilder</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_security"><a class="anchor" href="#_security"></a>3.18. Security</h3>
<div class="paragraph">
<p>(TBD)</p>
</div>
</div>
<div class="sect2">
<h3 id="_design_patterns_in_groovy"><a class="anchor" href="#_design_patterns_in_groovy"></a>3.19. Design patterns in Groovy</h3>
<div class="paragraph">
<p>Using <a href="http://en.wikipedia.org/wiki/Design_pattern_%28computer_science%29">design patterns</a> with Java is a well-established topic. Design patterns also apply to Groovy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>some patterns carry over directly (and can make use of normal Groovy syntax improvements for greater readability)</p>
</li>
<li>
<p>some patterns are no longer required because they are built right 
into the language or because Groovy supports a better way of achieving 
the intent of the pattern</p>
</li>
<li>
<p>some patterns that have to be expressed at the design level in other 
languages can be implemented directly in Groovy (due to the way Groovy 
can blur the distinction between design and implementation)</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_patterns"><a class="anchor" href="#_patterns"></a>3.19.1. Patterns</h4>
<div class="sect4">
<h5 id="_abstract_factory_pattern"><a class="anchor" href="#_abstract_factory_pattern"></a>Abstract Factory Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">Abstract Factory Pattern</a>
 provides a way to encapsulate a group of individual factories that have
 a common theme. It embodies the intent of a normal factory, i.e. remove
 the need for code using an interface to know the concrete 
implementation behind the interface, but applies to a set of interfaces 
and selects an entire family of concrete classes which implement those 
interfaces.</p>
</div>
<div class="paragraph">
<p>As an example, I might have interfaces Button, TextField and 
Scrollbar. I might have WindowsButton, MacButton, FlashButton as 
concrete classes for Button. I might have WindowsScrollBar, MacScrollBar
 and FlashScrollBar as concrete implementations for ScrollBar. Using the
 Abstract Factory Pattern should allow me to select which windowing 
system (i.e. Windows, Mac, Flash) I want to use once and from then on 
should be able to write code that references the interfaces but is 
always using the appropriate concrete classes (all from the one 
windowing system) under the covers.</p>
</div>
<div class="sect5">
<h6 id="_example"><a class="anchor" href="#_example"></a>Example</h6>
<div class="paragraph">
<p>Suppose we want to write a game system. We might note that many games have very similar features and control.</p>
</div>
<div class="paragraph">
<p>We decide to try to split the common and game-specific code into separate classes.</p>
</div>
<div class="paragraph">
<p>First let’s look at the game-specific code for a <a href="http://en.wikipedia.org/wiki/Two-Up">Two-up</a> game:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">TwoupMessages</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> welcome </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Welcome to the twoup game, you start with $1000'</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Sorry, you have no money left, goodbye'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">TwoupInputConverter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> convert</span><span class="pun">(</span><span class="pln">input</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> input</span><span class="pun">.</span><span class="pln">toInteger</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">TwoupControl</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> money </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> random </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Random</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> tossWasHead</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">next</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> random</span><span class="pun">.</span><span class="pln">nextInt</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">next</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> moreTurns</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">money </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            println </span><span class="str">"You have $money, how much would you like to bet?"</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">false</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> play</span><span class="pun">(</span><span class="pln">amount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> coin1 </span><span class="pun">=</span><span class="pln"> tossWasHead</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> coin2 </span><span class="pun">=</span><span class="pln"> tossWasHead</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">coin1 </span><span class="pun">&amp;&amp;</span><span class="pln"> coin2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            money </span><span class="pun">+=</span><span class="pln"> amount
            println </span><span class="str">'You win'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">coin1 </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">!</span><span class="pln">coin2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            money </span><span class="pun">-=</span><span class="pln"> amount
            println </span><span class="str">'You lose'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            println </span><span class="str">'Draw'</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let’s look at the game-specific code for a number guessing game:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">GuessGameMessages</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> welcome </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Welcome to the guessing game, my secret number is between 1 and 100'</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Correct'</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GuessGameInputConverter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> convert</span><span class="pun">(</span><span class="pln">input</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> input</span><span class="pun">.</span><span class="pln">toInteger</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GuessGameControl</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> lower </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> upper </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> guess </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Random</span><span class="pun">().</span><span class="pln">nextInt</span><span class="pun">(</span><span class="pln">upper </span><span class="pun">-</span><span class="pln"> lower</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> lower
    </span><span class="kwd">def</span><span class="pln"> moreTurns</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">done</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">lower </span><span class="pun">==</span><span class="pln"> guess </span><span class="pun">||</span><span class="pln"> upper </span><span class="pun">==</span><span class="pln"> guess</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="kwd">done</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            println </span><span class="str">"Enter a number between $lower and $upper"</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        </span><span class="pun">!</span><span class="kwd">done</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> play</span><span class="pun">(</span><span class="pln">nextGuess</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nextGuess </span><span class="pun">&lt;=</span><span class="pln"> guess</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            lower </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">lower</span><span class="pun">,</span><span class="pln"> nextGuess</span><span class="pun">].</span><span class="pln">max</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nextGuess </span><span class="pun">&gt;=</span><span class="pln"> guess</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            upper </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">upper</span><span class="pun">,</span><span class="pln"> nextGuess</span><span class="pun">].</span><span class="pln">min</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let’s write our factory code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> guessFactory </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">messages</span><span class="pun">:</span><span class="pln"> </span><span class="typ">GuessGameMessages</span><span class="pun">,</span><span class="pln"> control</span><span class="pun">:</span><span class="pln"> </span><span class="typ">GuessGameControl</span><span class="pun">,</span><span class="pln"> converter</span><span class="pun">:</span><span class="pln"> </span><span class="typ">GuessGameInputConverter</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> twoupFactory </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">messages</span><span class="pun">:</span><span class="pln"> </span><span class="typ">TwoupMessages</span><span class="pun">,</span><span class="pln"> control</span><span class="pun">:</span><span class="pln"> </span><span class="typ">TwoupControl</span><span class="pun">,</span><span class="pln"> converter</span><span class="pun">:</span><span class="pln"> </span><span class="typ">TwoupInputConverter</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">GameFactory</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> factory
    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> getMessages</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> factory</span><span class="pun">.</span><span class="pln">messages</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> getControl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> factory</span><span class="pun">.</span><span class="pln">control</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> getConverter</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> factory</span><span class="pun">.</span><span class="pln">converter</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The important aspect of this factory is that it allows selection of an entire family of concrete classes.</p>
</div>
<div class="paragraph">
<p>Here is how we would use the factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">GameFactory</span><span class="pun">.</span><span class="pln">factory </span><span class="pun">=</span><span class="pln"> twoupFactory
</span><span class="kwd">def</span><span class="pln"> messages </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GameFactory</span><span class="pun">.</span><span class="pln">messages
</span><span class="kwd">def</span><span class="pln"> control </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GameFactory</span><span class="pun">.</span><span class="pln">control
</span><span class="kwd">def</span><span class="pln"> converter </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GameFactory</span><span class="pun">.</span><span class="pln">converter
println messages</span><span class="pun">.</span><span class="pln">welcome
</span><span class="kwd">def</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BufferedReader</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">InputStreamReader</span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="kwd">in</span><span class="pun">))</span><span class="pln">
</span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">control</span><span class="pun">.</span><span class="pln">moreTurns</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> input </span><span class="pun">=</span><span class="pln"> reader</span><span class="pun">.</span><span class="pln">readLine</span><span class="pun">().</span><span class="pln">trim</span><span class="pun">()</span><span class="pln">
    control</span><span class="pun">.</span><span class="pln">play</span><span class="pun">(</span><span class="pln">converter</span><span class="pun">.</span><span class="pln">convert</span><span class="pun">(</span><span class="pln">input</span><span class="pun">))</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
println messages</span><span class="pun">.</span><span class="kwd">done</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the first line configures which family of concrete game 
classes we will use. It’s not important that we selected which family to
 use by using the factory property as shown in the first line. Other 
ways would be equally valid examples of this pattern. For example, we 
may have asked the user which game they wanted to play or determined 
which game from an environment setting.</p>
</div>
<div class="paragraph">
<p>With the code as shown, the game might look like this when run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to the twoup game, you start with $1000
You have 1000, how much would you like to bet?
300
Draw
You have 1000, how much would you like to bet?
700
You win
You have 1700, how much would you like to bet?
1700
You lose
Sorry, you have no money left, goodbye</pre>
</div>
</div>
<div class="paragraph">
<p>If we change the first line of the script to GameFactory.factory = guessFactory, then the sample run might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Welcome to the guessing game, my secret number is between 1 and 100
Enter a number between 1 and 100
75
Enter a number between 1 and 75
35
Enter a number between 1 and 35
15
Enter a number between 1 and 15
5
Enter a number between 5 and 15
10
Correct</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_adapter_pattern"><a class="anchor" href="#_adapter_pattern"></a>Adapter Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Adapter_pattern">Adapter Pattern</a>
 (sometimes called the wrapper pattern) allows objects satisfying one 
interface to be used where another type of interface is expected. There 
are two typical flavours of the pattern: the <em>delegation</em> flavour and the <em>inheritance</em> flavour.</p>
</div>
<div class="sect5">
<h6 id="_delegation_example"><a class="anchor" href="#_delegation_example"></a>Delegation Example</h6>
<div class="paragraph">
<p>Suppose we have the following classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SquarePeg</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> width
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RoundPeg</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> radius
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RoundHole</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> radius
    </span><span class="kwd">def</span><span class="pln"> pegFits</span><span class="pun">(</span><span class="pln">peg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        peg</span><span class="pun">.</span><span class="pln">radius </span><span class="pun">&lt;=</span><span class="pln"> radius
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"RoundHole with radius $radius"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can ask the <code>RoundHole</code> class if a <code>RoundPeg</code> fits in it, but if we ask the same question for a <code>SquarePeg</code>, then it will fail because the <code>SquarePeg</code> class doesn’t have a <code>radius</code> property (i.e. doesn’t satisfy the required interface).</p>
</div>
<div class="paragraph">
<p>To get around this problem, we can create an adapter to make it appear to have the correct interface. It would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SquarePegAdapter</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> peg
    </span><span class="kwd">def</span><span class="pln"> getRadius</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sqrt</span><span class="pun">(((</span><span class="pln">peg</span><span class="pun">.</span><span class="pln">width </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"SquarePegAdapter with peg width $peg.width (and notional radius $radius)"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the adapter like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> hole </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RoundHole</span><span class="pun">(</span><span class="pln">radius</span><span class="pun">:</span><span class="pln"> </span><span class="lit">4.0</span><span class="pun">)</span><span class="pln">
</span><span class="pun">(</span><span class="lit">4.</span><span class="pun">.</span><span class="lit">7</span><span class="pun">).</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> w </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> peg </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SquarePegAdapter</span><span class="pun">(</span><span class="pln">peg</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SquarePeg</span><span class="pun">(</span><span class="pln">width</span><span class="pun">:</span><span class="pln"> w</span><span class="pun">))</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">hole</span><span class="pun">.</span><span class="pln">pegFits</span><span class="pun">(</span><span class="pln">peg</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"peg $peg fits in hole $hole"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"peg $peg does not fit in hole $hole"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which results in the following output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>peg SquarePegAdapter with peg width 4 (and notional radius 2.8284271247461903) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 5 (and notional radius 3.5355339059327378) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 6 (and notional radius 4.242640687119285) does not fit in hole RoundHole with radius 4.0
peg SquarePegAdapter with peg width 7 (and notional radius 4.949747468305833) does not fit in hole RoundHole with radius 4.0</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_inheritance_example"><a class="anchor" href="#_inheritance_example"></a>Inheritance Example</h6>
<div class="paragraph">
<p>Let’s consider the same example again using inheritance. First, here are the original classes (unchanged):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SquarePeg</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> width
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RoundPeg</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> radius
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">RoundHole</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> radius
    </span><span class="kwd">def</span><span class="pln"> pegFits</span><span class="pun">(</span><span class="pln">peg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        peg</span><span class="pun">.</span><span class="pln">radius </span><span class="pun">&lt;=</span><span class="pln"> radius
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">"RoundHole with radius $radius"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An adapter using inheritance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">SquarePegAdapter</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">SquarePeg</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> getRadius</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sqrt</span><span class="pun">(((</span><span class="pln">width </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"SquarePegAdapter with width $width (and notional radius $radius)"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the adapter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> hole </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RoundHole</span><span class="pun">(</span><span class="pln">radius</span><span class="pun">:</span><span class="pln"> </span><span class="lit">4.0</span><span class="pun">)</span><span class="pln">
</span><span class="pun">(</span><span class="lit">4.</span><span class="pun">.</span><span class="lit">7</span><span class="pun">).</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> w </span><span class="pun">-&gt;</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> peg </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SquarePegAdapter</span><span class="pun">(</span><span class="pln">width</span><span class="pun">:</span><span class="pln"> w</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">hole</span><span class="pun">.</span><span class="pln">pegFits</span><span class="pun">(</span><span class="pln">peg</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"peg $peg fits in hole $hole"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"peg $peg does not fit in hole $hole"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>peg SquarePegAdapter with width 4 (and notional radius 2.8284271247461903) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 5 (and notional radius 3.5355339059327378) fits in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 6 (and notional radius 4.242640687119285) does not fit in hole RoundHole with radius 4.0
peg SquarePegAdapter with width 7 (and notional radius 4.949747468305833) does not fit in hole RoundHole with radius 4.0</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_adapting_using_closures"><a class="anchor" href="#_adapting_using_closures"></a>Adapting using Closures</h6>
<div class="paragraph">
<p>As a variation of the previous examples, we could instead define the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">RoundThing</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> getRadius</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can then define an adapter as a closure as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> adapter </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    p </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">[</span><span class="pln">getRadius</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sqrt</span><span class="pun">(((</span><span class="pln">p</span><span class="pun">.</span><span class="pln">width </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">RoundThing</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> peg </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SquarePeg</span><span class="pun">(</span><span class="pln">width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">hole</span><span class="pun">.</span><span class="pln">pegFits</span><span class="pun">(</span><span class="pln">adapter</span><span class="pun">(</span><span class="pln">peg</span><span class="pun">)))</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// ... as before</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_adapting_using_the_expandometaclass"><a class="anchor" href="#_adapting_using_the_expandometaclass"></a>Adapting using the ExpandoMetaClass</h6>
<div class="paragraph">
<p>As of Groovy 1.1, there is a built-in MetaClass which can automatically add properties and methods dynamically.</p>
</div>
<div class="paragraph">
<p>Here is how the example would work using that feature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> peg </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">SquarePeg</span><span class="pun">(</span><span class="pln">width</span><span class="pun">:</span><span class="pln"> </span><span class="lit">4</span><span class="pun">)</span><span class="pln">
peg</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">radius </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sqrt</span><span class="pun">(((</span><span class="pln">peg</span><span class="pun">.</span><span class="pln">width </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">**</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After you create a peg object, you can simply add a property to it on
 the fly. No need to change the original class and no need for an 
adapter class.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_bouncer_pattern"><a class="anchor" href="#_bouncer_pattern"></a>Bouncer Pattern</h5>
<div class="paragraph">
<p>The <a href="http://www.c2.com/cgi/wiki?BouncerPattern">Bouncer Pattern</a>
 describes usage of a method whose sole purpose is to either throw an 
exception (when particular conditions hold) or do nothing. Such methods 
are often used to defensively guard pre-conditions of a method.</p>
</div>
<div class="paragraph">
<p>When writing utility methods, you should always guard against faulty 
input arguments. When writing internal methods, you may be able to 
ensure that certain pre-conditions always hold by having sufficient unit
 tests in place. Under such circumstances, you may reduce the 
desirability to have guards on your methods.</p>
</div>
<div class="paragraph">
<p>Groovy differs from other languages in that you frequently use the <code>assert</code> method within your methods rather than having a large number of utility checker methods or classes.</p>
</div>
<div class="sect5">
<h6 id="_null_checking_example"><a class="anchor" href="#_null_checking_example"></a>Null Checking Example</h6>
<div class="paragraph">
<p>We might have a utility method such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">NullChecker</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> check</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> arg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">arg </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalArgumentException</span><span class="pun">(</span><span class="pln">name </span><span class="pun">+</span><span class="pln"> </span><span class="str">' is null'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And we would use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> doStuff</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">NullChecker</span><span class="pun">.</span><span class="pln">check</span><span class="pun">(</span><span class="str">'name'</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">NullChecker</span><span class="pun">.</span><span class="pln">check</span><span class="pun">(</span><span class="str">'value'</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">)</span><span class="pln">
    </span><span class="com">// do stuff</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But a more Groovy way to do this would simply be like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">void</span><span class="pln"> doStuff</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> value</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> name </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="str">'name should not be null'</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> value </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="str">'value should not be null'</span><span class="pln">
    </span><span class="com">// do stuff</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_validation_example"><a class="anchor" href="#_validation_example"></a>Validation Example</h6>
<div class="paragraph">
<p>As an alternative example, we might have this utility method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">NumberChecker</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> NUMBER_PATTERN </span><span class="pun">=</span><span class="pln"> </span><span class="str">"\\\\d+(\\\\.\\\\d+(E-?\\\\d+)?)?"</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> isNumber</span><span class="pun">(</span><span class="pln">str</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">str </span><span class="pun">==~</span><span class="pln"> NUMBER_PATTERN</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalArgumentException</span><span class="pun">(</span><span class="str">"Argument '$str' must be a number"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> isNotZero</span><span class="pun">(</span><span class="pln">number</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">number </span><span class="pun">==</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">IllegalArgumentException</span><span class="pun">(</span><span class="str">'Argument must not be 0'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And we would use it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> stringDivide</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> dividendStr</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> divisorStr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">NumberChecker</span><span class="pun">.</span><span class="pln">isNumber</span><span class="pun">(</span><span class="pln">dividendStr</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">NumberChecker</span><span class="pun">.</span><span class="pln">isNumber</span><span class="pun">(</span><span class="pln">divisorStr</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> dividend </span><span class="pun">=</span><span class="pln"> dividendStr</span><span class="pun">.</span><span class="pln">toDouble</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> divisor </span><span class="pun">=</span><span class="pln"> divisorStr</span><span class="pun">.</span><span class="pln">toDouble</span><span class="pun">()</span><span class="pln">
    </span><span class="typ">NumberChecker</span><span class="pun">.</span><span class="pln">isNotZero</span><span class="pun">(</span><span class="pln">divisor</span><span class="pun">)</span><span class="pln">
    dividend </span><span class="pun">/</span><span class="pln"> divisor
</span><span class="pun">}</span><span class="pln">

println stringDivide</span><span class="pun">(</span><span class="str">'1.2E2'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'3.0'</span><span class="pun">)</span><span class="pln">
</span><span class="com">// =&gt; 40.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But with Groovy we could just as easily use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> stringDivide</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> dividendStr</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> divisorStr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> dividendStr </span><span class="pun">=~</span><span class="pln"> </span><span class="typ">NumberChecker</span><span class="pun">.</span><span class="pln">NUMBER_PATTERN
    </span><span class="kwd">assert</span><span class="pln"> divisorStr </span><span class="pun">=~</span><span class="pln"> </span><span class="typ">NumberChecker</span><span class="pun">.</span><span class="pln">NUMBER_PATTERN
    </span><span class="kwd">def</span><span class="pln"> dividend </span><span class="pun">=</span><span class="pln"> dividendStr</span><span class="pun">.</span><span class="pln">toDouble</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> divisor </span><span class="pun">=</span><span class="pln"> divisorStr</span><span class="pun">.</span><span class="pln">toDouble</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> divisor </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Divisor must not be 0'</span><span class="pln">
    dividend </span><span class="pun">/</span><span class="pln"> divisor
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_chain_of_responsibility_pattern"><a class="anchor" href="#_chain_of_responsibility_pattern"></a>Chain of Responsibility Pattern</h5>
<div class="paragraph">
<p>In the Chain of Responsibility Pattern, objects using and 
implementing an interface (one or more methods) are intentionally 
loosely coupled. A set of objects that <em>implement</em> the interface are organised in a list (or in rare cases a tree). Objects using the interface make requests from the first <em>implementor</em>
 object. It will decide whether to perform any action itself and whether
 to pass the request further down the line in the list (or tree). 
Sometimes a default implementation for some request is also coded into 
the pattern if none of the implementors respond to the request.</p>
</div>
<div class="sect5">
<h6 id="_example_2"><a class="anchor" href="#_example_2"></a>Example</h6>
<div class="paragraph">
<p>In this example, the script sends requests to the <code>lister</code> object. The <code>lister</code> points to a <code>UnixLister</code> object. If it can’t handle the request, it sends the request to the <code>WindowsLister</code>. If it can’t handle the request, it sends the request to the <code>DefaultLister</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">UnixLister</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> nextInLine
    </span><span class="typ">UnixLister</span><span class="pun">(</span><span class="kwd">next</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> nextInLine </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">next</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> listFiles</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="str">'os.name'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Linux'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            println </span><span class="str">"ls $dir"</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">().</span><span class="pln">text
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            nextInLine</span><span class="pun">.</span><span class="pln">listFiles</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">WindowsLister</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> nextInLine
    </span><span class="typ">WindowsLister</span><span class="pun">(</span><span class="kwd">next</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> nextInLine </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">next</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> listFiles</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="typ">System</span><span class="pun">.</span><span class="pln">getProperty</span><span class="pun">(</span><span class="str">'os.name'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="str">'Windows XP'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            println </span><span class="str">"cmd.exe /c dir $dir"</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">().</span><span class="pln">text
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            nextInLine</span><span class="pun">.</span><span class="pln">listFiles</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DefaultLister</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> listFiles</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="pln">dir</span><span class="pun">).</span><span class="pln">eachFile </span><span class="pun">{</span><span class="pln"> f </span><span class="pun">-&gt;</span><span class="pln"> println f </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> lister </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">UnixLister</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">WindowsLister</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DefaultLister</span><span class="pun">()))</span><span class="pln">

lister</span><span class="pun">.</span><span class="pln">listFiles</span><span class="pun">(</span><span class="str">'Downloads'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output will be a list of files (with slightly different format depending on the operating system).</p>
</div>
<div class="paragraph">
<p>Here is a UML representation:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Groovy-Language-Documentation_files/xChainOfResponsibilityClasses.png" alt="ChainOfResponsibilityClasses" data-pagespeed-url-hash="1998350708" onload="pagespeed.CriticalImages.checkImageForCriticality(this);">
</div>
</div>
<div class="paragraph">
<p>Variations to this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we could have an explicit interface, e.g. <code>Lister</code>, to statically type the implementations but because of <em>duck-typing</em> this is optional</p>
</li>
<li>
<p>we could use a chain tree instead of a list, e.g. <code>if (animal.hasBackbone())</code> delegate to <code>VertebrateHandler</code> else delegate to <code>InvertebrateHandler</code></p>
</li>
<li>
<p>we could always pass down the chain even if we processed a request</p>
</li>
<li>
<p>we could decide at some point to not respond and not pass down the chain</p>
</li>
<li>
<p>we could use Groovy’s meta-programming capabilities to pass unknown methods down the chain</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_composite_pattern"><a class="anchor" href="#_composite_pattern"></a>Composite Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Composite_pattern">Composite Pattern</a>
 allows you to treat single instances of an object the same way as a 
group of objects. The pattern is often used with hierarchies of objects.
 Typically, one or more methods should be callable in the same way for 
either <em>leaf</em> or <em>composite</em> nodes within the hierarchy. 
In such a case, composite nodes typically invoke the same named method 
for each of their children nodes.</p>
</div>
<div class="sect5">
<h6 id="_example_3"><a class="anchor" href="#_example_3"></a>Example</h6>
<div class="paragraph">
<p>Consider this usage of the composite pattern where we want to call <code>toString()</code> on either <code>Leaf</code> or <code>Composite</code> objects.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Groovy-Language-Documentation_files/xCompositeClasses.png" alt="CompositeClasses" data-pagespeed-url-hash="3211387835" onload="pagespeed.CriticalImages.checkImageForCriticality(this);">
</div>
</div>
<div class="paragraph">
<p>In Java, the <code>Component</code> class is essential as it provides
 the type used for both leaf and composite nodes. In Groovy, because of 
duck-typing, we don’t need it for that purpose, however, it can still 
server as a useful place to place common behaviour between the leaf and 
composite nodes.</p>
</div>
<div class="paragraph">
<p>For our purposes, we will assemble the following hierarchy of components.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZsAAAFSCAMAAAAToYK2AAADAFBMVEUAAACAAAAAgACAgAAAAICAAIAAgIDAwMDA3MCmyvBAIABgIACAIACgIADAIADgIAAAQAAgQABAQABgQACAQACgQADAQADgQAAAYAAgYABAYABgYACAYACgYADAYADgYAAAgAAggABAgABggACAgACggADAgADggAAAoAAgoABAoABgoACAoACgoADAoADgoAAAwAAgwABAwABgwACAwACgwADAwADgwAAA4AAg4ABA4ABg4ACA4ACg4ADA4ADg4AAAAEAgAEBAAEBgAECAAECgAEDAAEDgAEAAIEAgIEBAIEBgIECAIECgIEDAIEDgIEAAQEAgQEBAQEBgQECAQECgQEDAQEDgQEAAYEAgYEBAYEBgYECAYECgYEDAYEDgYEAAgEAggEBAgEBggECAgECggEDAgEDggEAAoEAgoEBAoEBgoECAoECgoEDAoEDgoEAAwEAgwEBAwEBgwECAwECgwEDAwEDgwEAA4EAg4EBA4EBg4ECA4ECg4EDA4EDg4EAAAIAgAIBAAIBgAICAAICgAIDAAIDgAIAAIIAgIIBAIIBgIICAIICgIIDAIIDgIIAAQIAgQIBAQIBgQICAQICgQIDAQIDgQIAAYIAgYIBAYIBgYICAYICgYIDAYIDgYIAAgIAggIBAgIBggICAgICggIDAgIDggIAAoIAgoIBAoIBgoICAoICgoIDAoIDgoIAAwIAgwIBAwIBgwICAwICgwIDAwIDgwIAA4IAg4IBA4IBg4ICA4ICg4IDA4IDg4IAAAMAgAMBAAMBgAMCAAMCgAMDAAMDgAMAAIMAgIMBAIMBgIMCAIMCgIMDAIMDgIMAAQMAgQMBAQMBgQMCAQMCgQMDAQMDgQMAAYMAgYMBAYMBgYMCAYMCgYMDAYMDgYMAAgMAggMBAgMBggMCAgMCggMDAgMDggMAAoMAgoMBAoMBgoMCAoMCgoMDAoMDgoMAAwMAgwMBAwMBgwMCAwMCgwMD/+/CgoKSAgID/AAAA/wD//wAAAP//AP8A//////9Y0jREAAAHb0lEQVR42u3dQW7iSBjF8YeEBMly1OxGnCXqI8wB+grcYU7Aci4yw5JrcAbWyFumbCfT6QkJCbjs91X9S2qSdBb1+H71Fbah3TozXIcoATYMbLBhFGSjbAObu+dpMg1ssMHmBpvFYoENNthggw022GCDDTbYYIMNNjfa/HjAxtRm94SNi81Omi/X0qFpuseVPoODzTg2p2YzX+5nx/6RvjGySRbrtmkO/SM2Xjb0ja9N8+r1Zv/I6w3nN9hgE9fmwuc0sKFvsMEGG2ywwQYbbLDBBhtssMEGG2ywwQYbbLDBBhtssMEGG2ywwQYbbLDBBhtssMEGG2ywwcbAJtvAZoCxyDawyWSj92uuj0kkbCazuYbz8ntsJghwNV3Jt1Kd3Eb3puN+nVPN/xkcYTPJ9Iqwvsq00TDxCm0dc5vP5hM240/+2Xwlto7M51aQHaAwm6Ff54trHXebLwUUNqPO/KWAZbWO3CdWmH2gPpsv4wib0eZVmOVWiI1yJiyldfxtbokobMaZ9ZaIRbSO/CdVpA2hMptbcYRN/jlvzRhdRwGmVKxdoSqbe3CEje8hsbDJe0R814TCJueECrY3xLSZ5GQlaOsoxHQKtz3Es9FkKSO2TgybIWIKG9+TyHCtoxhzKd5CrMZmKBxhk+EMMur5XIisJuePgVonis2AQYXNwBMNGDRK6yjKPAq5IuuwGRhH2Pie1wubAU/rh84kbAabRTGfu3k+1ysu5q2jOHMo6tI0Dmd9ucW5dQLZZMqqim3sL7bYto4CTaC4C7R4m4w4qtEmymUw1WejMGENWyeUTd60qstGsdKqIptwV8CEjTGOKrFRxIWtKmyCXpv0aZ1opwyKXROTHIGvTJq0TrRrVIq+ZAu2GQ1H5drEv2asUm1UQMmkIm0KuWAsbIxxVJxNQZeLpbJsdC7HJsBdmp2ezeg4KsemvAv5KsVGBVZKwsZ3GRcxp8qs0xSto4B1K2b7L9BmMhyFttG5YJswd2aaMvuEp4PCxhYnzE1mJss96f/gF/JZ6lyDTczdQedacMId8lT0rle0UwWdK7IZpXUUs1oFfwomvI0FTpQ3Q+p5N3K8EApaKpNPxQobW5wAnyjSuVabnK2jqHWShUuuEdvG4kityTRe22ReAG4LMpZN3kncnrS/zWKxwKZmm24StyeNDTbYYIMNNthggw022Fja7L8//PLjTMf2y6O6r9g42XQ/7h9P3Z+hbC4vgGb1x8HMZtdeMts62aylQ1swbZcrPaUybrbD7mkXF0Cz//Of+dLMJgXaz04+NpsUaHXqv+/Lts5g82YBpBWwnJ1Gt+ly9I+bp9/01yr1yS590y2TzubRyGbdNnJKqlSy3iZD37xdAM3q2KwOY9uk6qfG2LSPx83Tw06nZJEe+yi7vhRefdP1yn9ly/B683YBtMcburapDW7TL7t12zqH9MR3KU2ySTHWh+e+adeM1etNSpl2m2+nl5eCYY/TLi6A9m/aBTtB3xw3L4/PNm3fHO1sRjm/ubgA2k1kPztM+Xrzs29+74/Ouj3to17m3HPs47Td1ePFSWw+em8cmwr65t4FMOCT/tQHNtjTuGaDDTbYYIMNNthggw022GCDDTbYYIMNNthggw022GCDDTbYYIMNNthggw022GCDDTbYVGaTbWAzwFhkG/nvbXejjVmeKW0yT+L2pLEZwUa3/PYcZZRs886v49mEHKr62QUPL2x8wwsb3/DCxje8sPENL2x8wwsb3+zCxje7sPHNLmx8swsb3+zCxje7sPHNLmx8owsb3+jCxje6sPGNLmx8owsb3+jCxje6sPFNLmx8kwsb3+TCxje5sPFNLmx8kwsb3+DCxje4sPENLmx8gwsb3+DCxje4sPENLmx8cwsb39zCxje3sPHNLWywwaacGvDPhnyLgI1vFbDxLQM2vnXAxrcQ2PhWAhvfUvCvu31rgY1vMbDxrQY2vuXAxrce2PgWBBvfinATHt+SYONbE2x8i4KNb1Ww8S0LNr514X58voXBxrcy2PiWBhvf2mDjWxxsfKuDjW95uG2yb32w8S0QNr4Vwsa3RNj41ggb3yJh41sl/ncLJmUNY8NOWqFNPYcgnG5gc/ss2UbBNmO96dlkGthgg80NNovFIoiNw76Oje/egQ022Hy9Bthggw022GCDDTZfybX//vDLjzMdm2bXnlNtm2YlHbCxsel+3M2XSem0mS/TIzZT2qzb9kgdo+1ypaeHZ5vHU9dH2Expk9qjWZ3675/7pt3Tut1sVcOe9uG+/v/fjmuz7iU2Sj3zc09rVseU8thUaPN6X0/7x9PDtH3TNOvtq77pba7RlGTz3r6+//73lH3T5povUw9vv51e7WnzZddQpypsPtjXp9vTOL+5sq9j49A3F/f1KW2uv69XzevNxX2dvuH8BhtsotmMta9jQ99ggw022GCDDTbYYIMNNthggw022GCDDTbYYIMNNthggw022GCDDTbYYIMNNtiMZpNtYHOvTRqLbAMbbLAp18ZgX3cdBveEnHx9YoMNNtgwsKl5/Atzjc/njpyw6QAAAABJRU5ErkJggg==" alt="CompositeComponents" data-pagespeed-url-hash="2709219185" onload="pagespeed.CriticalImages.checkImageForCriticality(this);">
</div>
</div>
<div class="paragraph">
<p>Here is the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Component</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> name
    </span><span class="kwd">def</span><span class="pln"> toString</span><span class="pun">(</span><span class="pln">indent</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="pun">(</span><span class="str">"-"</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> indent</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> name
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Composite</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Component</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> children </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> toString</span><span class="pun">(</span><span class="pln">indent</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">(</span><span class="pln">indent</span><span class="pun">)</span><span class="pln">
        children</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> child </span><span class="pun">-&gt;</span><span class="pln">
            s </span><span class="pun">+=</span><span class="pln"> </span><span class="str">"\\n"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> child</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">(</span><span class="pln">indent </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        s
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> leftShift</span><span class="pun">(</span><span class="pln">component</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        children </span><span class="pun">&lt;&lt;</span><span class="pln"> component
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Leaf</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Component</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Composite</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"root"</span><span class="pun">)</span><span class="pln">
root </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Leaf</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"leaf A"</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> comp </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Composite</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"comp B"</span><span class="pun">)</span><span class="pln">
root </span><span class="pun">&lt;&lt;</span><span class="pln"> comp
root </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Leaf</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"leaf C"</span><span class="pun">)</span><span class="pln">
comp </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Leaf</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"leaf B1"</span><span class="pun">)</span><span class="pln">
comp </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Leaf</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"leaf B2"</span><span class="pun">)</span><span class="pln">
println root</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the resulting output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>root
-leaf A
-comp B
--leaf B1
--leaf B2
-leaf C</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_decorator_pattern"><a class="anchor" href="#_decorator_pattern"></a>Decorator Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Decorator_pattern">Decorator Pattern</a>
 provides a mechanism to embellish the behaviour of an object without 
changing its essential interface. A decorated object should be able to 
be substituted wherever the original (non-decorated) object was 
expected. Decoration typically does not involve modifying the source 
code of the original object and decorators should be able to be combined
 in flexible ways to produce objects with several embellishments.</p>
</div>
<div class="sect5">
<h6 id="_traditional_example"><a class="anchor" href="#_traditional_example"></a>Traditional Example</h6>
<div class="paragraph">
<p>Suppose we have the following <code>Logger</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> log</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println message
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There might be times when it is useful to timestamp a log message, or
 times when we might want to change the case of the message. We could 
try to build all of this functionality into our <code>Logger</code> class. If we did that, the <code>Logger</code>
 class would start to be very complex. Also, everyone would obtain all 
of features even when they might not want a small subset of the 
features. Finally, feature interaction would become quite difficult to 
control.</p>
</div>
<div class="paragraph">
<p>To overcome these drawbacks, we instead define two decorator classes. Uses of the <code>Logger</code>
 class are free to embellish their base logger with zero or more 
decorator classes in whatever order they desire. The classes look like 
this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">TimeStampingLogger</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> logger
    </span><span class="typ">TimeStampingLogger</span><span class="pun">(</span><span class="pln">logger</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">logger </span><span class="pun">=</span><span class="pln"> logger
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> log</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> now </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Calendar</span><span class="pun">.</span><span class="pln">instance
        logger</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"$now.time: $message"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">UpperLogger</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">Logger</span><span class="pln"> logger
    </span><span class="typ">UpperLogger</span><span class="pun">(</span><span class="pln">logger</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">logger </span><span class="pun">=</span><span class="pln"> logger
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> log</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        logger</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">message</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">())</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the decorators like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> logger </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">UpperLogger</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TimeStampingLogger</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Logger</span><span class="pun">()))</span><span class="pln">
logger</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"G'day Mate"</span><span class="pun">)</span><span class="pln">
</span><span class="com">// =&gt; Tue May 22 07:13:50 EST 2007: G'DAY MATE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that we embellish the logger behaviour with both 
decorators. Because of the order we chose to apply the decorators, our 
log message comes out capitalised and the timestamp is in normal case. 
If we swap the order around, let’s see what happens:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">logger </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TimeStampingLogger</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">UpperLogger</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Logger</span><span class="pun">()))</span><span class="pln">
logger</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Hi There'</span><span class="pun">)</span><span class="pln">
</span><span class="com">// =&gt; TUE MAY 22 07:13:50 EST 2007: HI THERE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the timestamp itself has also been changed to be uppercase.</p>
</div>
</div>
<div class="sect5">
<h6 id="_a_touch_of_dynamic_behaviour"><a class="anchor" href="#_a_touch_of_dynamic_behaviour"></a>A touch of dynamic behaviour</h6>
<div class="paragraph">
<p>Our previous decorators were specific to <code>Logger</code> objects.
 We can use Groovy’s Meta-Object Programming capabilities to create a 
decorator which is far more general purpose in nature. Consider this 
class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">GenericLowerDecorator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln">
    </span><span class="typ">GenericLowerDecorator</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> invokeMethod</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> newargs </span><span class="pun">=</span><span class="pln"> args</span><span class="pun">.</span><span class="pln">collect </span><span class="pun">{</span><span class="pln"> arg </span><span class="pun">-&gt;</span><span class="pln">
            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">arg </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">return</span><span class="pln"> arg</span><span class="pun">.</span><span class="pln">toLowerCase</span><span class="pun">()</span><span class="pln">
            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">return</span><span class="pln"> arg
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">delegate</span><span class="pun">.</span><span class="pln">invokeMethod</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> newargs</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It takes any class and decorates it so that any <code>String</code> method parameter will automatically be changed to lower case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">logger </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">GenericLowerDecorator</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TimeStampingLogger</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Logger</span><span class="pun">()))</span><span class="pln">
logger</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'IMPORTANT Message'</span><span class="pun">)</span><span class="pln">
</span><span class="com">// =&gt; Tue May 22 07:27:18 EST 2007: important message</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just be careful with ordering here. The original decorators were restricted to decorating <code>Logger</code> objects. This decorator works with any object type, so we can’t swap the ordering around, i.e. this won’t work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>// Can't mix and match Interface-Oriented and Generic decorators
// logger = new TimeStampingLogger(new GenericLowerDecorator(new Logger()))</pre>
</div>
</div>
<div class="paragraph">
<p>We could overcome this limitation be generating an appropriate Proxy type at runtime but we won’t complicate the example here.</p>
</div>
</div>
<div class="sect5">
<h6 id="_runtime_behaviour_embellishment"><a class="anchor" href="#_runtime_behaviour_embellishment"></a>Runtime behaviour embellishment</h6>
<div class="paragraph">
<p>You can also consider using the <code>ExpandoMetaClass</code> from 
Groovy 1.1 to dynamically embellish a class with behaviour. This isn’t 
the normal style of usage of the decorator pattern (it certainly isn’t 
nearly as flexible) but may help you to achieve similar results in some 
cases without creating a new class.</p>
</div>
<div class="paragraph">
<p>Here’s what the code looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="com">// current mechanism to enable ExpandoMetaClass</span><span class="pln">
</span><span class="typ">GroovySystem</span><span class="pun">.</span><span class="pln">metaClassRegistry</span><span class="pun">.</span><span class="pln">metaClassCreationHandle </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ExpandoMetaClassCreationHandle</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> logger </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Logger</span><span class="pun">()</span><span class="pln">
logger</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="pln">log </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> m </span><span class="pun">-&gt;</span><span class="pln"> println </span><span class="str">'message: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> m</span><span class="pun">.</span><span class="pln">toUpperCase</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
logger</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'x'</span><span class="pun">)</span><span class="pln">
</span><span class="com">// =&gt; message: X</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This achieves a similar result to applying a single decorator but we 
have no way to easily apply and remove embellishments on the fly.</p>
</div>
</div>
<div class="sect5">
<h6 id="_more_dynamic_decorating"><a class="anchor" href="#_more_dynamic_decorating"></a>More dynamic decorating</h6>
<div class="paragraph">
<p>Suppose we have a calculator class (Actually any class would do).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Calc</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a </span><span class="pun">+</span><span class="pln"> b </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We might be interested in observing usage of the class over time. If 
it is buried deep within our codebase, it might be hard to determine 
when it is being called and with what parameters. Also, it might be hard
 to know if it is performing well. We can easily make a generic tracing 
decorator that prints out tracing information whenever any method on the
 <code>Calc</code> class is called and also provide timing information 
about how long it took to execute. Here is the code for the tracing 
decorator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">TracingDecorator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln">
    </span><span class="typ">TracingDecorator</span><span class="pun">(</span><span class="kwd">delegate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> invokeMethod</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"Calling $name$args"</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> before </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="pln">currentTimeMillis</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">.</span><span class="pln">invokeMethod</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln">
        println </span><span class="str">"Got $result in ${System.currentTimeMillis()-before} ms"</span><span class="pln">
        result
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how to use the class in a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> tracedCalc </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TracingDecorator</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Calc</span><span class="pun">())</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">15</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> tracedCalc</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">12</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is what you would see after running this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Calling add{3, 12}
Got 15 in 31 ms</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_decorating_with_an_interceptor"><a class="anchor" href="#_decorating_with_an_interceptor"></a>Decorating with an Interceptor</h6>
<div class="paragraph">
<p>The above timing example hooks into the lifecycle of Groovy objects (via <code>invokeMethod</code>).
 This is such an important style performing meta-programming that Groovy
 has special support for this style of decorating using <em>interceptors</em>.</p>
</div>
<div class="paragraph">
<p>Groovy even comes with a built-in <code>TracingInterceptor</code>. We can extend the built-in class like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">TimingInterceptor</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">TracingInterceptor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> beforeTime
    </span><span class="kwd">def</span><span class="pln"> beforeInvoke</span><span class="pun">(</span><span class="kwd">object</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> methodName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> arguments</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">beforeInvoke</span><span class="pun">(</span><span class="kwd">object</span><span class="pun">,</span><span class="pln"> methodName</span><span class="pun">,</span><span class="pln"> arguments</span><span class="pun">)</span><span class="pln">
        beforeTime </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="pln">currentTimeMillis</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">Object</span><span class="pln"> afterInvoke</span><span class="pun">(</span><span class="typ">Object</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> methodName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> arguments</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> result</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">afterInvoke</span><span class="pun">(</span><span class="kwd">object</span><span class="pun">,</span><span class="pln"> methodName</span><span class="pun">,</span><span class="pln"> arguments</span><span class="pun">,</span><span class="pln"> result</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> duration </span><span class="pun">=</span><span class="pln"> </span><span class="typ">System</span><span class="pun">.</span><span class="pln">currentTimeMillis</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> beforeTime
        writer</span><span class="pun">.</span><span class="pln">write</span><span class="pun">(</span><span class="str">"Duration: $duration ms\\n"</span><span class="pun">)</span><span class="pln">
        writer</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">()</span><span class="pln">
        result
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of using this new class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> proxy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ProxyMetaClass</span><span class="pun">.</span><span class="pln">getInstance</span><span class="pun">(</span><span class="typ">Calc</span><span class="pun">)</span><span class="pln">
proxy</span><span class="pun">.</span><span class="pln">interceptor </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">TimingInterceptor</span><span class="pun">()</span><span class="pln">
proxy</span><span class="pun">.</span><span class="kwd">use</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">7</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Calc</span><span class="pun">().</span><span class="pln">add</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>before Calc.ctor()
after  Calc.ctor()
Duration: 0 ms
before Calc.add(java.lang.Integer, java.lang.Integer)
after  Calc.add(java.lang.Integer, java.lang.Integer)
Duration: 2 ms</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_decorating_with_java_lang_reflect_proxy"><a class="anchor" href="#_decorating_with_java_lang_reflect_proxy"></a>Decorating with java.lang.reflect.Proxy</h6>
<div class="paragraph">
<p>If you are trying to decorate an object (i.e. just a particular 
instance of the class, not the class generally), then you can use Java’s
 <code>java.lang.reflect.Proxy</code>. Groovy makes working with this easier than just Java. Below is a code sample taken out of a grails project that wraps a <code>java.sql.Connection</code> so that it’s close method is a no-op:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">protected</span><span class="pln"> </span><span class="typ">Sql</span><span class="pln"> getGroovySql</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">Connection</span><span class="pln"> con </span><span class="pun">=</span><span class="pln"> session</span><span class="pun">.</span><span class="pln">connection</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> invoker </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">object</span><span class="pun">,</span><span class="pln"> method</span><span class="pun">,</span><span class="pln"> args </span><span class="pun">-&gt;</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">method</span><span class="pun">.</span><span class="pln">name </span><span class="pun">==</span><span class="pln"> </span><span class="str">"close"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            log</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">(</span><span class="str">"ignoring call to Connection.close() for use by groovy.sql.Sql"</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            log</span><span class="pun">.</span><span class="pln">trace</span><span class="pun">(</span><span class="str">"delegating $method"</span><span class="pun">)</span><span class="pln">
            </span><span class="kwd">return</span><span class="pln"> con</span><span class="pun">.</span><span class="pln">invokeMethod</span><span class="pun">(</span><span class="pln">method</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">InvocationHandler</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> proxy </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Proxy</span><span class="pun">.</span><span class="pln">newProxyInstance</span><span class="pun">(</span><span class="pln"> getClass</span><span class="pun">().</span><span class="pln">getClassLoader</span><span class="pun">(),</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Connection</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Class</span><span class="pun">[],</span><span class="pln"> invoker </span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Sql</span><span class="pun">(</span><span class="pln">proxy</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If there were many methods to intercept, then this approach could be 
modified to look up closure in a map by method name and invoke it.</p>
</div>
</div>
<div class="sect5">
<h6 id="_decorating_with_spring"><a class="anchor" href="#_decorating_with_spring"></a>Decorating with Spring</h6>
<div class="paragraph">
<p>The <a href="http://www.springframework.org/">Spring Framework</a> allows decorators to be applied with <em>interceptors</em> (you may have heard the terms <em>advice</em> or <em>aspect</em>). You can leverage this mechanism from Groovy as well.</p>
</div>
<div class="paragraph">
<p>First define a class that you want to decorate (we’ll also use an interface as is normal Spring practice):</p>
</div>
<div class="paragraph">
<p>Here’s the interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Calc</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here’s the class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">CalcImpl</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Calc</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> a </span><span class="pun">+</span><span class="pln"> b </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we define our wiring in a file called <code>beans.xml</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-xml" data-lang="xml"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="tag">&lt;beans</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/beans"</span><span class="pln">
	</span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
	</span><span class="atn">xmlns:lang</span><span class="pun">=</span><span class="atv">"http://www.springframework.org/schema/lang"</span><span class="pln">
	</span><span class="atn">xsi:schemaLocation</span><span class="pun">=</span><span class="atv">"
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd"</span><span class="tag">&gt;</span><span class="pln">

    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"performanceInterceptor"</span><span class="pln"> </span><span class="atn">autowire</span><span class="pun">=</span><span class="atv">"no"</span><span class="pln">
          </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.springframework.aop.interceptor.PerformanceMonitorInterceptor"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"loggerName"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"performance"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">
    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"calc"</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"util.CalcImpl"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;bean</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"beanNames"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"calc"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;property</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"interceptorNames"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"performanceInterceptor"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/bean&gt;</span><span class="pln">
</span><span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, our script looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'org.springframework:spring-context:3.2.2.RELEASE'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">context</span><span class="pun">.</span><span class="pln">support</span><span class="pun">.</span><span class="typ">ClassPathXmlApplicationContext</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> ctx </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ClassPathXmlApplicationContext</span><span class="pun">(</span><span class="str">'beans.xml'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> calc </span><span class="pun">=</span><span class="pln"> ctx</span><span class="pun">.</span><span class="pln">getBean</span><span class="pun">(</span><span class="str">'calc'</span><span class="pun">)</span><span class="pln">
println calc</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">25</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And when we run it, we see the results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>21/05/2007 23:02:35 org.springframework.aop.interceptor.PerformanceMonitorInterceptor invokeUnderTrace
FINEST: StopWatch 'util.Calc.add': running time (millis) = 16</pre>
</div>
</div>
<div class="paragraph">
<p>You may have to adjust your <code>logging.properties</code> file for messages at log level <code>FINEST</code> to be displayed.</p>
</div>
</div>
<div class="sect5">
<h6 id="_asynchronous_decorators_using_gpars"><a class="anchor" href="#_asynchronous_decorators_using_gpars"></a>Asynchronous Decorators using GPars</h6>
<div class="paragraph">
<p>Using the example code in <a href="http://www.cs.iastate.edu/%7Edesign/projects/panini/docs/starting.shtml">Panini</a> for inspiration. Here is a Groovy version that avoids using an <code>@AddedBehavior</code>
 annotation at the expense of not having as general an algorithm for 
selecting the methods to decorate. This isn’t a limitation of the 
particular approach chosen but just a simplification for illustrative 
purposes (but don’t assume below is an exact equivalent).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'org.codehaus.gpars:gpars:0.10'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> groovyx</span><span class="pun">.</span><span class="pln">gpars</span><span class="pun">.</span><span class="typ">GParsPool</span><span class="pun">.</span><span class="pln">withPool

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Document</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">()</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> getText</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DocumentImpl</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Document</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> document
    </span><span class="kwd">void</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println document </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> getText</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> document </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> words</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> text</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    text</span><span class="pun">.</span><span class="pln">replaceAll</span><span class="pun">(</span><span class="str">'[^a-zA-Z]'</span><span class="pun">,</span><span class="pln"> </span><span class="str">' '</span><span class="pun">).</span><span class="pln">trim</span><span class="pun">().</span><span class="pln">split</span><span class="pun">(</span><span class="str">"\\\\s+"</span><span class="pun">)*.</span><span class="pln">toLowerCase</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> avgWordLength </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> words </span><span class="pun">=</span><span class="pln"> words</span><span class="pun">(</span><span class="pln">it</span><span class="pun">.</span><span class="pln">text</span><span class="pun">)</span><span class="pln">
    sprintf </span><span class="str">"Avg Word Length: %4.2f"</span><span class="pun">,</span><span class="pln"> words</span><span class="pun">*.</span><span class="pln">size</span><span class="pun">().</span><span class="pln">sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> words</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> modeWord </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> wordGroups </span><span class="pun">=</span><span class="pln"> words</span><span class="pun">(</span><span class="pln">it</span><span class="pun">.</span><span class="pln">text</span><span class="pun">).</span><span class="pln">groupBy </span><span class="pun">{</span><span class="pln">it</span><span class="pun">}.</span><span class="pln">collectEntries </span><span class="pun">{</span><span class="pln"> k</span><span class="pun">,</span><span class="pln"> v </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">[</span><span class="pln">k</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()]</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> maxSize </span><span class="pun">=</span><span class="pln"> wordGroups</span><span class="pun">*.</span><span class="pln">value</span><span class="pun">.</span><span class="pln">max</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> maxWords </span><span class="pun">=</span><span class="pln"> wordGroups</span><span class="pun">.</span><span class="pln">findAll </span><span class="pun">{</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">value </span><span class="pun">==</span><span class="pln"> maxSize </span><span class="pun">}</span><span class="pln">
    </span><span class="str">"Mode Word(s): ${maxWords*.key.join(', ')} ($maxSize occurrences)"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> wordCount </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> d </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="str">"Word Count: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> words</span><span class="pun">(</span><span class="pln">d</span><span class="pun">.</span><span class="pln">text</span><span class="pun">).</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> asyncDecorator</span><span class="pun">(</span><span class="typ">Document</span><span class="pln"> d</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">ProxyGenerator</span><span class="pun">.</span><span class="pln">INSTANCE</span><span class="pun">.</span><span class="pln">instantiateDelegate</span><span class="pun">([</span><span class="kwd">print</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        withPool </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> c</span><span class="pun">.</span><span class="pln">callAsync</span><span class="pun">(</span><span class="pln">d</span><span class="pun">)</span><span class="pln">
            d</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">()</span><span class="pln">
            println result</span><span class="pun">.</span><span class="kwd">get</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}],</span><span class="pln"> </span><span class="pun">[</span><span class="typ">Document</span><span class="pun">],</span><span class="pln"> d</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Document</span><span class="pln"> d </span><span class="pun">=</span><span class="pln"> asyncDecorator</span><span class="pun">(</span><span class="pln">asyncDecorator</span><span class="pun">(</span><span class="pln">asyncDecorator</span><span class="pun">(</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DocumentImpl</span><span class="pun">(</span><span class="pln">document</span><span class="pun">:</span><span class="str">"This is the file with the words in it\\n\\t\\nDo you see the words?\\n"</span><span class="pun">),</span><span class="pln">
</span><span class="com">//        new DocumentImpl(document: new File('AsyncDecorator.groovy').text),</span><span class="pln">
        wordCount</span><span class="pun">),</span><span class="pln"> modeWord</span><span class="pun">),</span><span class="pln"> avgWordLength</span><span class="pun">)</span><span class="pln">
d</span><span class="pun">.</span><span class="kwd">print</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_delegation_pattern"><a class="anchor" href="#_delegation_pattern"></a>Delegation Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Delegation_pattern">Delegation Pattern</a>
 is a technique where an object’s behavior (public methods) is 
implemented by delegating responsibility to one or more associated 
objects.</p>
</div>
<div class="paragraph">
<p>Groovy allows the traditional style of applying the delegation pattern, e.g. see <a href="#_replace_inheritance_with_delegation">Replace Inheritance with Delegation</a>.</p>
</div>
<div class="sect5">
<h6 id="_implement_delegation_pattern_using_expandometaclass"><a class="anchor" href="#_implement_delegation_pattern_using_expandometaclass"></a>Implement Delegation Pattern using ExpandoMetaClass</h6>
<div class="paragraph">
<p>The <a href="http://docs.groovy-lang.org/2.4.11/html/gapi/index.html?groovy/lang/ExpandoMetaClass.html">groovy.lang.ExpandoMetaClass</a>
 allows usage of this pattern to be encapsulated in a library. This 
allows Groovy to emulate similar libraries available for the Ruby 
language.</p>
</div>
<div class="paragraph">
<p>Consider the following library class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Delegator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> targetClass
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln">
    </span><span class="typ">Delegator</span><span class="pun">(</span><span class="pln">targetClass</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">targetClass </span><span class="pun">=</span><span class="pln"> targetClass
        </span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> methodName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">delegate</span><span class="pun">(</span><span class="pln">methodName</span><span class="pun">,</span><span class="pln"> methodName</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> methodName</span><span class="pun">,</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> asMethodName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        targetClass</span><span class="pun">.</span><span class="pln">metaClass</span><span class="pun">.</span><span class="str">"$asMethodName"</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">.&amp;</span><span class="str">"$methodName"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> delegateAll</span><span class="pun">(</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> names</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        names</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> delegateAll</span><span class="pun">(</span><span class="typ">Map</span><span class="pln"> names</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        names</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> k</span><span class="pun">,</span><span class="pln"> v </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">(</span><span class="pln">k</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> delegateAll</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">delegate</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">methods</span><span class="pun">*.</span><span class="pln">name</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">delegate</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this in your classpath, you can now apply the delegation pattern
 dynamically as shown in the following examples. First, consider we have
 the following classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> name
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MortgageLender</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> borrowAmount</span><span class="pun">(</span><span class="pln">amount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       </span><span class="str">"borrow \\$$amount"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> borrowFor</span><span class="pun">(</span><span class="pln">thing</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       </span><span class="str">"buy \\$thing"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> lender </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MortgageLender</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> delegator </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Delegator</span><span class="pun">(</span><span class="typ">Person</span><span class="pun">,</span><span class="pln"> lender</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now use the <em>delegator</em> to automatically borrow methods from the <em>lender</em> object to extend the <em>Person</em> class. We can borrow the methods as is or with a rename:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">delegator</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="str">'borrowFor'</span><span class="pln">
delegator</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="str">'borrowAmount'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'getMoney'</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">

println p</span><span class="pun">.</span><span class="pln">borrowFor</span><span class="pun">(</span><span class="str">'present'</span><span class="pun">)</span><span class="pln">   </span><span class="com">// =&gt; buy present</span><span class="pln">
println p</span><span class="pun">.</span><span class="pln">getMoney</span><span class="pun">(</span><span class="lit">50</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line above, adds the <em>borrowFor</em> method to the <em>Person</em> class by delegating to the <em>lender</em> object. The second line adds a <em>getMoney</em> method to the <em>Person</em> class by delegating to the <em>lender</em> object’s <em>borrowAmount</em> method.</p>
</div>
<div class="paragraph">
<p>Alternatively, we could borrow multiple methods like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">delegator</span><span class="pun">.</span><span class="pln">delegateAll </span><span class="str">'borrowFor'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'borrowAmount'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which adds these two methods to the <em>Person</em> class.</p>
</div>
<div class="paragraph">
<p>Or if we want all the methods, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">delegator</span><span class="pun">.</span><span class="pln">delegateAll</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Which will make all the methods in the delegate object available in the <em>Person</em> class.</p>
</div>
<div class="paragraph">
<p>Alternatively, we can use a map notation to rename multiple methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">delegator</span><span class="pun">.</span><span class="pln">delegateAll borrowAmount</span><span class="pun">:</span><span class="str">'getMoney'</span><span class="pun">,</span><span class="pln"> borrowFor</span><span class="pun">:</span><span class="str">'getThing'</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_implement_delegation_pattern_using_delegate_annotation"><a class="anchor" href="#_implement_delegation_pattern_using_delegate_annotation"></a>Implement Delegation Pattern using @Delegate annotation</h6>
<div class="paragraph">
<p>Since version 1.6 you can use the built-in delegation mechanism which is based on AST transformation.</p>
</div>
<div class="paragraph">
<p>This make delegation even easier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> name
    </span><span class="lit">@Delegate</span><span class="pln"> </span><span class="typ">MortgageLender</span><span class="pln"> mortgageLender </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MortgageLender</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MortgageLender</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> borrowAmount</span><span class="pun">(</span><span class="pln">amount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       </span><span class="str">"borrow \\$$amount"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> borrowFor</span><span class="pun">(</span><span class="pln">thing</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       </span><span class="str">"buy $thing"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> p </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"buy present"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">borrowFor</span><span class="pun">(</span><span class="str">'present'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="str">"borrow \\$50"</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">borrowAmount</span><span class="pun">(</span><span class="lit">50</span><span class="pun">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_flyweight_pattern"><a class="anchor" href="#_flyweight_pattern"></a>Flyweight Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Flyweight_pattern">Flyweight Pattern</a>
 is a pattern for greatly reducing memory requirements by not requiring 
that heavy-weight objects be created in large numbers when dealing with 
systems that contain many things that are mostly the same. If for 
instance, a document was modelled using a complex character class that 
knew about unicode, fonts, positioning, etc., then the memory 
requirements could be quite large for large documents if each physical 
character in the document required its own character class instance. 
Instead, characters themselves might be kept within Strings and we might
 have one character class (or a small number such as one character class
 for each font type) that knew the specifics of how to deal with 
characters.</p>
</div>
<div class="paragraph">
<p>In such circumstances, we call the state that is shared with many other things (e.g. the character type) <em>instrinsic</em>
 state. It is captured within the heavy-weight class. The state which 
distinguishes the physical character (maybe just its ASCII code or 
Unicode) is called its <em>extrinsic</em> state.</p>
</div>
<div class="sect5">
<h6 id="_example_4"><a class="anchor" href="#_example_4"></a>Example</h6>
<div class="paragraph">
<p>First we are going to model some complex aircraft (the first being a 
hoax competitor of the second - not that is relevant to the example).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Boeing797</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> wingspan </span><span class="pun">=</span><span class="pln"> </span><span class="str">'80.8 m'</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> capacity </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> speed </span><span class="pun">=</span><span class="pln"> </span><span class="str">'1046 km/h'</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> range </span><span class="pun">=</span><span class="pln"> </span><span class="str">'14400 km'</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Groovy-Language-Documentation_files/xb797-hoax.jpg" alt="b797 hoax" data-pagespeed-url-hash="3633084801" onload="pagespeed.CriticalImages.checkImageForCriticality(this);">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Airbus380</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> wingspan </span><span class="pun">=</span><span class="pln"> </span><span class="str">'79.8 m'</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> capacity </span><span class="pun">=</span><span class="pln"> </span><span class="lit">555</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> speed </span><span class="pun">=</span><span class="pln"> </span><span class="str">'912 km/h'</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> range </span><span class="pun">=</span><span class="pln"> </span><span class="str">'10370 km'</span><span class="pln">
    </span><span class="com">// ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Groovy-Language-Documentation_files/xa380.jpg" alt="a380" data-pagespeed-url-hash="2062695015" onload="pagespeed.CriticalImages.checkImageForCriticality(this);">
</div>
</div>
<div class="paragraph">
<p>If we want to model our fleet, our first attempt might involve using 
many instances of these heavy-weight objects. It turns out though that 
only a few small pieces of state (our extrinsic state) change for each 
aircraft, so we will have singletons for the heavy-weight objects and 
capture the extrinsic state (bought date and asset number in the code 
below) separately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">FlyweightFactory</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> instances </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">797</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Boeing797</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">380</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Airbus380</span><span class="pun">()]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Aircraft</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> type         </span><span class="com">// instrinsic state</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> assetNumber  </span><span class="com">// extrinsic state</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> bought       </span><span class="com">// extrinsic state</span><span class="pln">
    </span><span class="typ">Aircraft</span><span class="pun">(</span><span class="pln">typeCode</span><span class="pun">,</span><span class="pln"> assetNumber</span><span class="pun">,</span><span class="pln"> bought</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        type </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FlyweightFactory</span><span class="pun">.</span><span class="pln">instances</span><span class="pun">[</span><span class="pln">typeCode</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">assetNumber </span><span class="pun">=</span><span class="pln"> assetNumber
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">bought </span><span class="pun">=</span><span class="pln"> bought
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> describe</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"""
        Asset Number: $assetNumber
        Capacity: $type.capacity people
        Speed: $type.speed
        Range: $type.range
        Bought: $bought
        """</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> fleet </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Aircraft</span><span class="pun">(</span><span class="lit">380</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1001</span><span class="pun">,</span><span class="pln"> </span><span class="str">'10-May-2007'</span><span class="pun">),</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Aircraft</span><span class="pun">(</span><span class="lit">380</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1002</span><span class="pun">,</span><span class="pln"> </span><span class="str">'10-Nov-2007'</span><span class="pun">),</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Aircraft</span><span class="pun">(</span><span class="lit">797</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1003</span><span class="pun">,</span><span class="pln"> </span><span class="str">'10-May-2008'</span><span class="pun">),</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Aircraft</span><span class="pun">(</span><span class="lit">797</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1004</span><span class="pun">,</span><span class="pln"> </span><span class="str">'10-Nov-2008'</span><span class="pun">)</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

fleet</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> p </span><span class="pun">-&gt;</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">describe</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So here, even if our fleet contained hundreds of planes, we would only have one heavy-weight object for each type of aircraft.</p>
</div>
<div class="paragraph">
<p>As a further efficiency measure, we might use lazy creation of the 
flyweight objects rather than create the initial map up front as in the 
above example.</p>
</div>
<div class="paragraph">
<p>Running this script results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Asset Number: 1001
Capacity: 555 people
Speed: 912 km/h
Range: 10370 km
Bought: 10-May-2007

Asset Number: 1002
Capacity: 555 people
Speed: 912 km/h
Range: 10370 km
Bought: 10-Nov-2007

Asset Number: 1003
Capacity: 1000 people
Speed: 1046 km/h
Range: 14400 km
Bought: 10-May-2008

Asset Number: 1004
Capacity: 1000 people
Speed: 1046 km/h
Range: 14400 km
Bought: 10-Nov-2008</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_iterator_pattern"><a class="anchor" href="#_iterator_pattern"></a>Iterator Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Iterator_pattern">Iterator Pattern</a> allows sequential access to the elements of an aggregate object without exposing its underlying representation.</p>
</div>
<div class="paragraph">
<p>Groovy has the iterator pattern built right in to many of its closure operators, e.g. <code>each</code> and <code>eachWithIndex</code> as well as the <code>for .. in</code> loop.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> printAll</span><span class="pun">(</span><span class="pln">container</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">item </span><span class="kwd">in</span><span class="pln"> container</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println item </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> numbers </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pln"> </span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> months </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><span class="typ">Mar</span><span class="pun">:</span><span class="lit">31</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Apr</span><span class="pun">:</span><span class="lit">30</span><span class="pun">,</span><span class="pln"> </span><span class="typ">May</span><span class="pun">:</span><span class="lit">31</span><span class="pln"> </span><span class="pun">]</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> colors </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">awt</span><span class="pun">.</span><span class="typ">Color</span><span class="pun">.</span><span class="pln">BLACK</span><span class="pun">,</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">awt</span><span class="pun">.</span><span class="typ">Color</span><span class="pun">.</span><span class="pln">WHITE </span><span class="pun">]</span><span class="pln">
printAll numbers
printAll months
printAll colors</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>1
2
3
4
May=31
Mar=31
Apr=30
java.awt.Color[r=0,g=0,b=0]
java.awt.Color[r=255,g=255,b=255]</pre>
</div>
</div>
<div class="paragraph">
<p>Another example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">colors</span><span class="pun">.</span><span class="pln">eachWithIndex </span><span class="pun">{</span><span class="pln"> item</span><span class="pun">,</span><span class="pln"> pos </span><span class="pun">-&gt;</span><span class="pln">
    println </span><span class="str">"Position $pos contains '$item'"</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Position 0 contains 'java.awt.Color[r=0,g=0,b=0]'
Position 1 contains 'java.awt.Color[r=255,g=255,b=255]'</pre>
</div>
</div>
<div class="paragraph">
<p>The iterator pattern is also built in to other special operators such as the <code>eachByte</code>, <code>eachFile</code>, <code>eachDir</code>, <code>eachLine</code>, <code>eachObject</code>, <code>eachMatch</code> operators for working with streams, URLs, files, directories and regular expressions matches.</p>
</div>
</div>
<div class="sect4">
<h5 id="_loan_my_resource_pattern"><a class="anchor" href="#_loan_my_resource_pattern"></a>Loan my Resource Pattern</h5>
<div class="paragraph">
<p>The <a href="https://wiki.scala-lang.org/display/SYGN/Loan">Loan my Resource</a> pattern ensures that a resource is deterministically disposed of once it goes out of scope.</p>
</div>
<div class="paragraph">
<p>This pattern is built in to many Groovy helper methods. You should 
consider using it yourself if you need to work with resources in ways 
beyond what Groovy supports.</p>
</div>
<div class="sect5">
<h6 id="_example_5"><a class="anchor" href="#_example_5"></a>Example</h6>
<div class="paragraph">
<p>Consider the following code which works with a file. First we might write some line to the file and then print its size:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> f </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">File</span><span class="pun">(</span><span class="str">'junk.txt'</span><span class="pun">)</span><span class="pln">
f</span><span class="pun">.</span><span class="pln">withPrintWriter </span><span class="pun">{</span><span class="pln"> pw </span><span class="pun">-&gt;</span><span class="pln">
    pw</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">())</span><span class="pln">
    pw</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
println f</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
</span><span class="com">// =&gt; 42</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also read back the contents of the file a line at a time and print each line out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">f</span><span class="pun">.</span><span class="pln">eachLine </span><span class="pun">{</span><span class="pln"> line </span><span class="pun">-&gt;</span><span class="pln">
    println line
</span><span class="pun">}</span><span class="pln">
</span><span class="com">// =&gt;</span><span class="pln">
</span><span class="com">// Mon Jun 18 22:38:17 EST 2007</span><span class="pln">
</span><span class="com">// RunPattern</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that normal Java <code>Reader</code> and <code>PrintWriter</code>
 objects were used under the covers by Groovy but the code writer did 
not have to worry about explicitly creating or closing those resources. 
The built-in Groovy methods loan the respective reader or writer to the 
closure code and then tidy up after themselves. So, you are using this 
pattern without having to do any work.</p>
</div>
<div class="paragraph">
<p>Sometimes however, you wish to do things slightly differently to what
 you can get for free using Groovy’s built-in mechanisms. You should 
consider utilising this pattern within your own resource-handling 
operations.</p>
</div>
<div class="paragraph">
<p>Consider how you might process the list of words on each line within 
the file. We could actually do this one too using Groovy’s built-in 
functions, but bear with us and assume we have to do some resource 
handling ourselves. Here is how we might write the code without using 
this pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">newReader</span><span class="pun">()</span><span class="pln">
reader</span><span class="pun">.</span><span class="pln">splitEachLine</span><span class="pun">(</span><span class="str">' '</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> wordList </span><span class="pun">-&gt;</span><span class="pln">
    println wordList
</span><span class="pun">}</span><span class="pln">
reader</span><span class="pun">.</span><span class="pln">close</span><span class="pun">()</span><span class="pln">
</span><span class="com">// =&gt;</span><span class="pln">
</span><span class="com">// [ "Mon", "Jun", "18", "22:38:17", "EST", "2007" ]</span><span class="pln">
</span><span class="com">// [ "RunPattern" ]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we now have an explicit call to <code>close()</code> in our code. If we didn’t code it just right (here we didn’t surround the code in a <code>try …​ finally</code> block, we run the risk of leaving the file handle open.</p>
</div>
<div class="paragraph">
<p>Let’s now apply the loan pattern. First, we’ll write a helper method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> withListOfWordsForEachLine</span><span class="pun">(</span><span class="typ">File</span><span class="pln"> f</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Closure</span><span class="pln"> c</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> r </span><span class="pun">=</span><span class="pln"> f</span><span class="pun">.</span><span class="pln">newReader</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        r</span><span class="pun">.</span><span class="pln">splitEachLine</span><span class="pun">(</span><span class="str">' '</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">finally</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        r</span><span class="pun">?.</span><span class="pln">close</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can re-write our code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">withListOfWordsForEachLine</span><span class="pun">(</span><span class="pln">f</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> wordList </span><span class="pun">-&gt;</span><span class="pln">
    println wordList
</span><span class="pun">}</span><span class="pln">
</span><span class="com">// =&gt;</span><span class="pln">
</span><span class="com">// [ "Mon", "Jun", "18", "22:38:17", "EST", "2007" ]</span><span class="pln">
</span><span class="com">// [ "RunPattern" ]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is much simpler and has removed the explicit <code>close()</code>.
 This is now catered for in one spot so we can apply the appropriate 
level of testing or reviewing in just one spot to be sure we have no 
problems.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_null_object_pattern"><a class="anchor" href="#_null_object_pattern"></a>Null Object Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Null_Object_pattern">Null Object Pattern</a>
 involves using a special object place-marker object representing null. 
Typically, if you have a reference to null, you can’t invoke <code>reference.field</code> or <code>reference.method()</code> You receive the dreaded <code>NullPointerException</code>. The null object pattern uses a special object representing null, instead of using an actual <code>null</code>.
 This allows you to invoke field and method references on the null 
object. The result of using the null object should semantically be 
equivalent to <em>doing nothing</em>.</p>
</div>
<div class="sect5">
<h6 id="_simple_example"><a class="anchor" href="#_simple_example"></a>Simple Example</h6>
<div class="paragraph">
<p>Suppose we have the following system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Job</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> salary
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Person</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> name
    </span><span class="kwd">def</span><span class="pln"> </span><span class="typ">Job</span><span class="pln"> job
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> people </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Tom'</span><span class="pun">,</span><span class="pln"> job</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Job</span><span class="pun">(</span><span class="pln">salary</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1000</span><span class="pun">)),</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Dick'</span><span class="pun">,</span><span class="pln"> job</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Job</span><span class="pun">(</span><span class="pln">salary</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1200</span><span class="pun">)),</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> biggestSalary </span><span class="pun">=</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">collect </span><span class="pun">{</span><span class="pln"> p </span><span class="pun">-&gt;</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">job</span><span class="pun">.</span><span class="pln">salary </span><span class="pun">}.</span><span class="pln">max</span><span class="pun">()</span><span class="pln">
println biggestSalary</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When run, this prints out <code>1200</code>. Suppose now that we now invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">people </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Harry'</span><span class="pun">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we now try to calculate <code>biggestSalary</code> again, we receive a null pointer exception.</p>
</div>
<div class="paragraph">
<p>To overcome this problem, we can introduce a <code>NullJob</code> class and change the above statement to become:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">NullJob</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Job</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> salary </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

people </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="pln"> </span><span class="str">'Harry'</span><span class="pun">,</span><span class="pln"> job</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NullJob</span><span class="pun">())</span><span class="pln">
biggestSalary </span><span class="pun">=</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">collect </span><span class="pun">{</span><span class="pln"> p </span><span class="pun">-&gt;</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">job</span><span class="pun">.</span><span class="pln">salary </span><span class="pun">}.</span><span class="pln">max</span><span class="pun">()</span><span class="pln">
println biggestSalary</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This works as we require but it’s not always the best way to do this with Groovy. Groovy’s safe-dereference operator (<code>?.</code>)
 operator and null aware closures often allow Groovy to avoid the need 
to create a special null object or null class. This is illustrated by 
examining a groovier way to write the above example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">people </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Person</span><span class="pun">(</span><span class="pln">name</span><span class="pun">:</span><span class="str">'Harry'</span><span class="pun">)</span><span class="pln">
biggestSalary </span><span class="pun">=</span><span class="pln"> people</span><span class="pun">.</span><span class="pln">collect </span><span class="pun">{</span><span class="pln"> p </span><span class="pun">-&gt;</span><span class="pln"> p</span><span class="pun">.</span><span class="pln">job</span><span class="pun">?.</span><span class="pln">salary </span><span class="pun">}.</span><span class="pln">max</span><span class="pun">()</span><span class="pln">
println biggestSalary</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Two things are going on here to allow this to work. First of all, <code>max()</code> is <em>'null aware'</em> so that [300, null, 400].max() == 400. Secondly, with the <code>?.</code> operator, an expression like <code>p?.job?.salary</code> will be equal to null if <code>salary</code> is equal to null, or if <code>job</code> is equal ` null or if <code>p</code> is equal to null. You don’t need to code a complex nested if ... then ... else to avoid a <code>NullPointerException</code>.</p>
</div>
</div>
<div class="sect5">
<h6 id="_tree_example"><a class="anchor" href="#_tree_example"></a>Tree Example</h6>
<div class="paragraph">
<p>Consider the following example where we want to calculate size, 
cumulative sum and cumulative product of all the values in a tree 
structure.</p>
</div>
<div class="paragraph">
<p>Our first attempt has special logic within the calculation methods to handle null values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">NullHandlingTree</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> left</span><span class="pun">,</span><span class="pln"> right</span><span class="pun">,</span><span class="pln"> value

    </span><span class="kwd">def</span><span class="pln"> size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">left </span><span class="pun">?</span><span class="pln"> left</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">right </span><span class="pun">?</span><span class="pln"> right</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       value </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">left </span><span class="pun">?</span><span class="pln"> left</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln">right </span><span class="pun">?</span><span class="pln"> right</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> product</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       value </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">left </span><span class="pun">?</span><span class="pln"> left</span><span class="pun">.</span><span class="pln">product</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">right </span><span class="pun">?</span><span class="pln"> right</span><span class="pun">.</span><span class="pln">product</span><span class="pun">()</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NullHandlingTree</span><span class="pun">(</span><span class="pln">
    value</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln">
    left</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NullHandlingTree</span><span class="pun">(</span><span class="pln">
        value</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln">
        right</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NullHandlingTree</span><span class="pun">(</span><span class="pln">value</span><span class="pun">:</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln">
        left</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NullHandlingTree</span><span class="pun">(</span><span class="pln">value</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

println root</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
println root</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">()</span><span class="pln">
println root</span><span class="pun">.</span><span class="pln">product</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we introduce the null object pattern (here by defining the <code>NullTree</code> class), we can now simplify the logic in the <code>size()</code>, <code>sum()</code>
 and`product()` methods. These methods now much more clearly represent 
the logic for the normal (and now universal) case. Each of the methods 
within <code>NullTree</code> returns a value which represents doing nothing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Tree</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> left </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NullTree</span><span class="pun">(),</span><span class="pln"> right </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NullTree</span><span class="pun">(),</span><span class="pln"> value

    </span><span class="kwd">def</span><span class="pln"> size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="lit">1</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> left</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> right</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       value </span><span class="pun">+</span><span class="pln"> left</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> right</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> product</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
       value </span><span class="pun">*</span><span class="pln"> left</span><span class="pun">.</span><span class="pln">product</span><span class="pun">()</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> right</span><span class="pun">.</span><span class="pln">product</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NullTree</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> size</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> product</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Tree</span><span class="pun">(</span><span class="pln">
    value</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln">
    left</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Tree</span><span class="pun">(</span><span class="pln">
        value</span><span class="pun">:</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln">
        right</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Tree</span><span class="pun">(</span><span class="pln">value</span><span class="pun">:</span><span class="pln"> </span><span class="lit">4</span><span class="pun">),</span><span class="pln">
        left</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Tree</span><span class="pun">(</span><span class="pln">value</span><span class="pun">:</span><span class="pln"> </span><span class="lit">5</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

println root</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()</span><span class="pln">
println root</span><span class="pun">.</span><span class="pln">sum</span><span class="pun">()</span><span class="pln">
println root</span><span class="pun">.</span><span class="pln">product</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The result of running either of these examples is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>4
14
120</pre>
</div>
</div>
<div class="paragraph">
<p>Note: a slight variation with the null object pattern is to combine 
it with the singleton pattern. So, we wouldn’t write new NullTree() 
wherever we needed a null object as shown above. Instead we would have a
 single null object instance which we would place within our data 
structures as needed.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pimp_my_library_pattern"><a class="anchor" href="#_pimp_my_library_pattern"></a>Pimp my Library Pattern</h5>
<div class="paragraph">
<p>The <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=179766">Pimp my Library</a>
 Pattern suggests an approach for extending a library that nearly does 
everything that you need but just needs a little more. It assumes that 
you do not have source code for the library of interest.</p>
</div>
<div class="sect5">
<h6 id="_example_6"><a class="anchor" href="#_example_6"></a>Example</h6>
<div class="paragraph">
<p>Suppose we want to make use of the built-in Integer facilities in 
Groovy (which build upon the features already in Java). Those libraries 
have nearly all of the features we want but not quite everything. We may
 not have all of the source code to the Groovy and Java libraries so we 
can’t just change the library. Instead we augment the library. Groovy 
has a number of ways to do this. One way is to use a Category.</p>
</div>
<div class="paragraph">
<p>First, we’ll define a suitable category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">EnhancedInteger</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> greaterThanAll</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> others</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        greaterThanAll</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> others</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> greaterThanAll</span><span class="pun">(</span><span class="typ">Integer</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> others</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        others</span><span class="pun">.</span><span class="pln">every </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">self</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> it </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have added two methods which augment the Integer methods by providing the <code>greaterThanAll</code>
 method. Categories follow conventions where they are defined as static 
methods with a special first parameter representing the class we wish to
 extend. The greaterThanAll(Integer self, others) static method becomes 
the <code>greaterThanAll(other)</code> instance method.</p>
</div>
<div class="paragraph">
<p>We defined two versions of <code>greaterThanAll</code>. One which works for collections, ranges etc. The other which works with a variable number of <code>Integer</code> arguments.</p>
</div>
<div class="paragraph">
<p>Here is how you would use the category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">use</span><span class="pun">(</span><span class="typ">EnhancedInteger</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">4.greaterThanAll</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="lit">5.greaterThanAll</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">5.greaterThanAll</span><span class="pun">(-</span><span class="lit">4.</span><span class="pun">.</span><span class="lit">4</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">5.greaterThanAll</span><span class="pun">([])</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="lit">5.greaterThanAll</span><span class="pun">([</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">])</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, using this technique you can effectively enrich an 
original class without having access to its source code. Moreover, you 
can apply different enrichments in different parts of the system as well
 as work with un-enriched objects if we need to.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_proxy_pattern"><a class="anchor" href="#_proxy_pattern"></a>Proxy Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Proxy_pattern">Proxy Pattern</a>
 allows one object to act as a pretend replacement for some other 
object. In general, whoever is using the proxy, doesn’t realise that 
they are not using the real thing. The pattern is useful when the real 
object is hard to create or use: it may exist over a network connection,
 or be a large object in memory, or be a file, database or some other 
resource that is expensive or impossible to duplicate.</p>
</div>
<div class="sect5">
<h6 id="_example_7"><a class="anchor" href="#_example_7"></a>Example</h6>
<div class="paragraph">
<p>One common use of the proxy pattern is when talking to remote objects
 in a different JVM. Here is the client code for creating a proxy that 
talks via sockets to a server object as well as an example usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">AccumulatorProxy</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> accumulate</span><span class="pun">(</span><span class="pln">args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> result
        </span><span class="kwd">def</span><span class="pln"> s </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Socket</span><span class="pun">(</span><span class="str">"localhost"</span><span class="pun">,</span><span class="pln"> </span><span class="lit">54321</span><span class="pun">)</span><span class="pln">
        s</span><span class="pun">.</span><span class="pln">withObjectStreams </span><span class="pun">{</span><span class="pln"> ois</span><span class="pun">,</span><span class="pln"> oos </span><span class="pun">-&gt;</span><span class="pln">
            oos </span><span class="pun">&lt;&lt;</span><span class="pln"> args
            result </span><span class="pun">=</span><span class="pln"> ois</span><span class="pun">.</span><span class="pln">readObject</span><span class="pun">()</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        s</span><span class="pun">.</span><span class="pln">close</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> result
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

println </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AccumulatorProxy</span><span class="pun">().</span><span class="pln">accumulate</span><span class="pun">([</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">6</span><span class="pun">,</span><span class="pln"> </span><span class="lit">7</span><span class="pun">,</span><span class="pln"> </span><span class="lit">8</span><span class="pun">,</span><span class="pln"> </span><span class="lit">9</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">])</span><span class="pln">
</span><span class="com">// =&gt; 55</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is what your server code might look like (start this first):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Accumulator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> accumulate</span><span class="pun">(</span><span class="pln">args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        args</span><span class="pun">.</span><span class="pln">inject</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> total</span><span class="pun">,</span><span class="pln"> arg </span><span class="pun">-&gt;</span><span class="pln"> total </span><span class="pun">+=</span><span class="pln"> arg </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> port </span><span class="pun">=</span><span class="pln"> </span><span class="lit">54321</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> accumulator </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Accumulator</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> server </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ServerSocket</span><span class="pun">(</span><span class="pln">port</span><span class="pun">)</span><span class="pln">
println </span><span class="str">"Starting server on port $port"</span><span class="pln">
</span><span class="kwd">while</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    server</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> socket </span><span class="pun">-&gt;</span><span class="pln">
        socket</span><span class="pun">.</span><span class="pln">withObjectStreams </span><span class="pun">{</span><span class="pln"> ois</span><span class="pun">,</span><span class="pln"> oos </span><span class="pun">-&gt;</span><span class="pln">
            </span><span class="kwd">def</span><span class="pln"> args </span><span class="pun">=</span><span class="pln"> ois</span><span class="pun">.</span><span class="pln">readObject</span><span class="pun">()</span><span class="pln">
            oos </span><span class="pun">&lt;&lt;</span><span class="pln"> accumulator</span><span class="pun">.</span><span class="pln">accumulate</span><span class="pun">(</span><span class="pln">args</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_singleton_pattern"><a class="anchor" href="#_singleton_pattern"></a>Singleton Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Singleton_pattern">Singleton Pattern</a>
 is used to make sure only one object of a particular class is ever 
created. This can be useful when when exactly one object is needed to 
coordinate actions across a system; perhaps for efficiency where 
creating lots of identical objects would be wasteful, perhaps because a 
particular algorithm needing a single point of control is required or 
perhaps when an object is used to interact with a non-shareable 
resource.</p>
</div>
<div class="paragraph">
<p>Weaknesses of the Singleton pattern include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It can reduce reuse. For instance, there are issues if you want to use inheritance with Singletons. If <code>SingletonB</code> extends <code>SingletonA</code>,
 should there be exactly (at most) one instance of each or should the 
creation of an object from one of the classes prohibit creation from the
 other. Also, if you decide both classes can have an instance, how do 
you override the <code>getInstance()</code> method which is static?</p>
</li>
<li>
<p>It is also hard to test singletons in general because of the static methods but Groovy can support that if required.</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_example_the_classic_java_singleton"><a class="anchor" href="#_example_the_classic_java_singleton"></a>Example: The Classic Java Singleton</h6>
<div class="paragraph">
<p>Suppose we wish to create a class for collecting votes. Because 
getting the right number of votes may be very important, we decide to 
use the singleton pattern. There will only ever be one <code>VoteCollector</code> object, so it makes it easier for us to reason about that objects creation and use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">VoteCollector</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> votes </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> INSTANCE </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">VoteCollector</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> getInstance</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> INSTANCE </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">VoteCollector</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> display</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> println </span><span class="str">"Collector:${hashCode()}, Votes:$votes"</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Some points of interest about this code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it has a private constructor, so no <code>VoteCollector</code> objects can be created in our system (except for the <code>INSTANCE</code> we create)</p>
</li>
<li>
<p>the <code>INSTANCE</code> is also private, so it can’t be changed once set</p>
</li>
<li>
<p>we haven’t made the updating of votes thread-safe at this point (it doesn’t add to this example)</p>
</li>
<li>
<p>the vote collector instance is not lazily created (if we never 
reference the class, the instance won’t be created; however, as soon as 
we reference the class, the instance will be created even if not needed 
initially)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can use this singleton class in some script code as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> collector </span><span class="pun">=</span><span class="pln"> </span><span class="typ">VoteCollector</span><span class="pun">.</span><span class="pln">instance
collector</span><span class="pun">.</span><span class="pln">display</span><span class="pun">()</span><span class="pln">
collector</span><span class="pun">.</span><span class="pln">votes</span><span class="pun">++</span><span class="pln">
collector </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">

</span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">start</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> collector2 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">VoteCollector</span><span class="pun">.</span><span class="pln">instance
    collector2</span><span class="pun">.</span><span class="pln">display</span><span class="pun">()</span><span class="pln">
    collector2</span><span class="pun">.</span><span class="pln">votes</span><span class="pun">++</span><span class="pln">
    collector2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pln">
</span><span class="pun">}.</span><span class="pln">join</span><span class="pun">()</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> collector3 </span><span class="pun">=</span><span class="pln"> </span><span class="typ">VoteCollector</span><span class="pun">.</span><span class="pln">instance
collector3</span><span class="pun">.</span><span class="pln">display</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we used the instance 3 times. The second usage was even in a 
different thread (but don’t try this in a scenario with a new class 
loader).</p>
</div>
<div class="paragraph">
<p>Running this script yields (your hashcode value will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Collector:15959960, Votes:0
Collector:15959960, Votes:1
Collector:15959960, Votes:2</pre>
</div>
</div>
<div class="paragraph">
<p>Variations to this pattern:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To support lazy-loading and multi-threading, we could just use the <code>synchronized</code> keyword with the <code>getInstance()</code> method. This has a performance hit but will work.</p>
</li>
<li>
<p>We can consider variations involving double-checked locking and the <code>volatile</code> keyword, but see the limitations of this approach <a href="http://www.ibm.com/developerworks/java/library/j-dcl/index.html">here</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_example_singleton_via_metaprogramming"><a class="anchor" href="#_example_singleton_via_metaprogramming"></a>Example: Singleton via MetaProgramming</h6>
<div class="paragraph">
<p>Groovy’s meta-programming capabilities allow concepts like the 
singleton pattern to be enacted in a far more fundamental way. This 
example illustrates a simple way to use Groovy’s meta-programming 
capabilities to achieve the singleton pattern but not necessarily the 
most efficient way.</p>
</div>
<div class="paragraph">
<p>Suppose we want to keep track of the total number of calculations 
that a calculator performs. One way to do that is to use a singleton for
 the calculator class and keep a variable in the class with the count.</p>
</div>
<div class="paragraph">
<p>First we define some base classes. A <code>Calculator</code> class which performs calculations and records how many such calculations it performs and a <code>Client</code> class which acts as a facade to the calculator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> total </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> total</span><span class="pun">++;</span><span class="pln"> a </span><span class="pun">+</span><span class="pln"> b </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> getTotalCalculations</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Total Calculations: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> total </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Calc: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> calc </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> executeCalc</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> calc</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Client: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can define and register a <em>MetaClass</em> which intercepts all attempts to create a <code>Calculator</code> object and always provides a pre-created instance instead. We also register this MetaClass with the Groovy system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">CalculatorMetaClass</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">MetaClassImpl</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> INSTANCE </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pun">()</span><span class="pln">
    </span><span class="typ">CalculatorMetaClass</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">super</span><span class="pun">(</span><span class="typ">Calculator</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> invokeConstructor</span><span class="pun">(</span><span class="typ">Object</span><span class="pun">[]</span><span class="pln"> arguments</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> INSTANCE </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> registry </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GroovySystem</span><span class="pun">.</span><span class="pln">metaClassRegistry
registry</span><span class="pun">.</span><span class="pln">setMetaClass</span><span class="pun">(</span><span class="typ">Calculator</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CalculatorMetaClass</span><span class="pun">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we use instances of our <code>Client</code> class from within a 
script. The client class will attempt to create new instances of the 
calculator but will always get the singleton.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">executeCalc</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
println </span><span class="str">"$client, $client.calc, $client.calc.totalCalculations"</span><span class="pln">

client </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">executeCalc</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
println </span><span class="str">"$client, $client.calc, $client.calc.totalCalculations"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the result of running this script (your hashcode values may vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 7306473, Calc: 24230857, Total Calculations: 1
Client: 31436753, Calc: 24230857, Total Calculations: 2</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_guice_example"><a class="anchor" href="#_guice_example"></a>Guice Example</h6>
<div class="paragraph">
<p>We can also implement the Singleton Pattern using <a href="https://github.com/google/guice">Guice</a>.</p>
</div>
<div class="paragraph">
<p>Consider the Calculator example again.</p>
</div>
<div class="paragraph">
<p>Guice is a Java-oriented framework that supports Interface-Oriented design. Hence we create a <code>Calculator</code> interface first. We can then create our <code>CalculatorImpl</code> implementation and a <code>Client</code> object which our script will interact with. The <code>Client</code>
 class isn’t strictly needed for this example but allows us to show that
 non-singleton instances are the default. Here is the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grapes</span><span class="pun">([</span><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'aopalliance:aopalliance:1.0'</span><span class="pun">),</span><span class="pln"> </span><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'com.google.code.guice:guice:1.0'</span><span class="pun">)])</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">google</span><span class="pun">.</span><span class="pln">inject</span><span class="pun">.*</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CalculatorImpl</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> total </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> total</span><span class="pun">++;</span><span class="pln"> a </span><span class="pun">+</span><span class="pln"> b </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> getTotalCalculations</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Total Calculations: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> total </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Calc: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="lit">@Inject</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> calc
    </span><span class="kwd">def</span><span class="pln"> executeCalc</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> calc</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Client: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> injector </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Guice</span><span class="pun">.</span><span class="pln">createInjector </span><span class="pun">(</span><span class="pln">
    </span><span class="pun">[</span><span class="pln">configure</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> binding </span><span class="pun">-&gt;</span><span class="pln">
        binding</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="typ">Calculator</span><span class="pun">)</span><span class="pln">
               </span><span class="pun">.</span><span class="pln">to</span><span class="pun">(</span><span class="typ">CalculatorImpl</span><span class="pun">)</span><span class="pln">
               </span><span class="pun">.</span><span class="pln">asEagerSingleton</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln"> </span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Module</span><span class="pln">
</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> injector</span><span class="pun">.</span><span class="pln">getInstance</span><span class="pun">(</span><span class="typ">Client</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">executeCalc</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
println </span><span class="str">"$client, $client.calc, $client.calc.totalCalculations"</span><span class="pln">

client </span><span class="pun">=</span><span class="pln"> injector</span><span class="pun">.</span><span class="pln">getInstance</span><span class="pun">(</span><span class="typ">Client</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">executeCalc</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
println </span><span class="str">"$client, $client.calc, $client.calc.totalCalculations"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@Inject</code> annotation in the <code>Client</code> class. We can always tell right in the source code which fields will be injected.</p>
</div>
<div class="paragraph">
<p>In this example we chose to use an <em>explicit</em> binding. All of 
our dependencies (ok, only one in this example at the moment) are 
configured in the binding. The Guide injector knows about the binding 
and injects the dependencies as required when we create objects. For the
 singleton pattern to hold, you must always use Guice to create your 
instances. Nothing shown so far would stop you creating another instance
 of the calculator manually using new CalculatorImpl() which would of 
course violate the desired singleton behaviour.</p>
</div>
<div class="paragraph">
<p>In other scenarios (though probably not in large systems), we could 
choose to express dependencies using annotations, such as the following 
example shows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grapes</span><span class="pun">([</span><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'aopalliance:aopalliance:1.0'</span><span class="pun">),</span><span class="pln"> </span><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'com.google.code.guice:guice:1.0'</span><span class="pun">)])</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">google</span><span class="pun">.</span><span class="pln">inject</span><span class="pun">.*</span><span class="pln">

</span><span class="lit">@ImplementedBy</span><span class="pun">(</span><span class="typ">CalculatorImpl</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// as before ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="lit">@Singleton</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CalculatorImpl</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// as before ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// as before ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> injector </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Guice</span><span class="pun">.</span><span class="pln">createInjector</span><span class="pun">()</span><span class="pln">

</span><span class="com">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>@Singleton</code> annotation on the <code>CalculatorImpl</code> class and the <code>@ImplementedBy</code> annotation in the <code>Calculator</code> interface.</p>
</div>
<div class="paragraph">
<p>When run, the above example (using either approach) yields (your hashcode values will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 8897128, Calc: 17431955, Total Calculations: 1
Client: 21145613, Calc: 17431955, Total Calculations: 2</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that we obtained a new client object whenever we asked 
for an instance but it was injected with the same calculator object.</p>
</div>
</div>
<div class="sect5">
<h6 id="_spring_example_2"><a class="anchor" href="#_spring_example_2"></a>Spring Example</h6>
<div class="paragraph">
<p>We can do the Calculator example again using Spring as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="lit">@Grapes</span><span class="pun">([</span><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'org.springframework:spring-core:3.2.2.RELEASE'</span><span class="pun">),</span><span class="pln"> </span><span class="lit">@Grab</span><span class="pun">(</span><span class="str">'org.springframework:spring-beans:3.2.2.RELEASE'</span><span class="pun">)])</span><span class="pln">
</span><span class="kwd">import</span><span class="pln"> org</span><span class="pun">.</span><span class="pln">springframework</span><span class="pun">.</span><span class="pln">beans</span><span class="pun">.</span><span class="pln">factory</span><span class="pun">.</span><span class="pln">support</span><span class="pun">.*</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CalculatorImpl</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Calculator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> total </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> total</span><span class="pun">++;</span><span class="pln"> a </span><span class="pun">+</span><span class="pln"> b </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> getTotalCalculations</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Total Calculations: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> total </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Calc: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Client</span><span class="pun">(</span><span class="typ">Calculator</span><span class="pln"> calc</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">calc </span><span class="pun">=</span><span class="pln"> calc </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> calc
    </span><span class="kwd">def</span><span class="pln"> executeCalc</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> calc</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="str">'Client: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> hashCode</span><span class="pun">()</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// Here we 'wire' up our dependencies through the API. Alternatively,</span><span class="pln">
</span><span class="com">// we could use XML-based configuration or the Grails Bean Builder DSL.</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> factory </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DefaultListableBeanFactory</span><span class="pun">()</span><span class="pln">
factory</span><span class="pun">.</span><span class="pln">registerBeanDefinition</span><span class="pun">(</span><span class="str">'calc'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RootBeanDefinition</span><span class="pun">(</span><span class="typ">CalculatorImpl</span><span class="pun">))</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> beanDef </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RootBeanDefinition</span><span class="pun">(</span><span class="typ">Client</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">)</span><span class="pln">
beanDef</span><span class="pun">.</span><span class="pln">setAutowireMode</span><span class="pun">(</span><span class="typ">AbstractBeanDefinition</span><span class="pun">.</span><span class="pln">AUTOWIRE_AUTODETECT</span><span class="pun">)</span><span class="pln">
factory</span><span class="pun">.</span><span class="pln">registerBeanDefinition</span><span class="pun">(</span><span class="str">'client'</span><span class="pun">,</span><span class="pln"> beanDef</span><span class="pun">)</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> factory</span><span class="pun">.</span><span class="pln">getBean</span><span class="pun">(</span><span class="str">'client'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">3</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">executeCalc</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
println </span><span class="str">"$client, $client.calc, $client.calc.totalCalculations"</span><span class="pln">

client </span><span class="pun">=</span><span class="pln"> factory</span><span class="pun">.</span><span class="pln">getBean</span><span class="pun">(</span><span class="str">'client'</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">assert</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">executeCalc</span><span class="pun">(</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln">
println </span><span class="str">"$client, $client.calc, $client.calc.totalCalculations"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the result (your hashcode values will vary):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Client: 29418586, Calc: 10580099, Total Calculations: 1
Client: 14800362, Calc: 10580099, Total Calculations: 2</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_further_information"><a class="anchor" href="#_further_information"></a>Further information</h6>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.javaworld.com/javaworld/jw-04-2003/jw-0425-designpatterns.html?page=1">Simply Singleton</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/webservices/library/co-single/index.html">Use your singletons wisely</a></p>
</li>
<li>
<p><a href="http://www.ibm.com/developerworks/java/library/j-dcl/index.html">Double-checked locking and the Singleton pattern</a></p>
</li>
<li>
<p><a href="http://crazybob.org/2007/01/lazy-loading-singletons.html">Lazy Loading Singletons</a></p>
</li>
<li>
<p><a href="http://www.yoda.arachsys.com/csharp/singleton.html">Implementing the Singleton Pattern in C#</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_state_pattern"><a class="anchor" href="#_state_pattern"></a>State Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/State_pattern">State Pattern</a>
 provides a structured approach to partitioning the behaviour within 
complex systems. The overall behaviour of a system is partitioned into 
well-defined states. Typically, each state is implemented by a class. 
The overall system behaviour can be determined firstly by knowing the <em>current state</em>
 of the system; secondly, by understanding the behaviour possible while 
in that state (as embodied in the methods of the class corresponding to 
that state).</p>
</div>
<div class="sect5">
<h6 id="_example_8"><a class="anchor" href="#_example_8"></a>Example</h6>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> context </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Context</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> connect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        context</span><span class="pun">.</span><span class="pln">state</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> disconnect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        context</span><span class="pun">.</span><span class="pln">state</span><span class="pun">.</span><span class="pln">disconnect</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> send_message</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        context</span><span class="pun">.</span><span class="pln">state</span><span class="pun">.</span><span class="pln">send_message</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> receive_message</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        context</span><span class="pun">.</span><span class="pln">state</span><span class="pun">.</span><span class="pln">receive_message</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Context</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> state </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Offline</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">ClientState</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> context
    </span><span class="typ">ClientState</span><span class="pun">(</span><span class="pln">context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">context </span><span class="pun">=</span><span class="pln"> context
        inform</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Offline</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">ClientState</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Offline</span><span class="pun">(</span><span class="pln">context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">context</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> inform</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"offline"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> connect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        context</span><span class="pun">.</span><span class="pln">state </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Online</span><span class="pun">(</span><span class="pln">context</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> disconnect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"error: not connected"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> send_message</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"error: not connected"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> receive_message</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"error: not connected"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Online</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">ClientState</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Online</span><span class="pun">(</span><span class="pln">context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">context</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> inform</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"connected"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> connect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"error: already connected"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> disconnect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        context</span><span class="pun">.</span><span class="pln">state </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Offline</span><span class="pun">(</span><span class="pln">context</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> send_message</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"\"$message\" sent"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> receive_message</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"message received"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

client </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">()</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">send_message</span><span class="pun">(</span><span class="str">"Hello"</span><span class="pun">)</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">()</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">send_message</span><span class="pun">(</span><span class="str">"Hello"</span><span class="pun">)</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">()</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">receive_message</span><span class="pun">()</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">disconnect</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>offline
error: not connected
connected
"Hello" sent
error: already connected
message received
offline</pre>
</div>
</div>
<div class="paragraph">
<p>One of the great things about a dynamic language like Groovy though 
is that we can take this example and express it in many different ways 
depending on our particular needs. Some potential variations for this 
example are shown below.</p>
</div>
</div>
<div class="sect5">
<h6 id="_variation_1_leveraging_interface_oriented_design"><a class="anchor" href="#_variation_1_leveraging_interface_oriented_design"></a>Variation 1: Leveraging Interface-Oriented Design</h6>
<div class="paragraph">
<p>One approach we could take is to leverage <a href="http://www.pragmaticprogrammer.com/titles/kpiod/index.html">Interface-Oriented Design</a>. To do this, we could introduce the following interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> connect</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> disconnect</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> send_message</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> receive_message</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then our <code>Client</code>, <code>Online</code> and 'Offline` classes could be modified to implement that interface, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// ... as before ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Online</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// ... as before ...</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Offline</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="com">// ... as before ...</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You might ask: Haven’t we just introduced additional boilerplate 
code? Can’t we rely on duck-typing for this? The answer is 'yes' and 
'no'. We can get away with duck-typing but one of the key intentions of 
the state pattern is to partition complexity. If we know that the <em>client</em> class and each <em>state</em>
 class all satisfy one interface, then we have placed some key 
boundaries around the complexity. We can look at any state class in 
isolation and know the bounds of behaviour possible for that state.</p>
</div>
<div class="paragraph">
<p>We don’t have to use interfaces for this, but it helps express the 
intent of this particular style of partitioning and it helps reduce the 
size of our unit tests (we would have to have additional tests in place 
to express this intent in languages which have less support for 
interface-oriented design).</p>
</div>
</div>
<div class="sect5">
<h6 id="_variation_2_extract_state_pattern_logic"><a class="anchor" href="#_variation_2_extract_state_pattern_logic"></a>Variation 2: Extract State Pattern Logic</h6>
<div class="paragraph">
<p>Alternatively, or in combination with other variations, we might 
decide to extract some of our State Pattern logic into helper classes. 
For example, we could define the following classes in a state pattern 
package/jar/script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">InstanceProvider</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> registry </span><span class="pun">=</span><span class="pln"> </span><span class="typ">GroovySystem</span><span class="pun">.</span><span class="pln">metaClassRegistry
    </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> create</span><span class="pun">(</span><span class="pln">objectClass</span><span class="pun">,</span><span class="pln"> param</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        registry</span><span class="pun">.</span><span class="pln">getMetaClass</span><span class="pun">(</span><span class="pln">objectClass</span><span class="pun">).</span><span class="pln">invokeConstructor</span><span class="pun">([</span><span class="pln">param</span><span class="pun">]</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> </span><span class="typ">Object</span><span class="pun">[])</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Context</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> context
    </span><span class="kwd">protected</span><span class="pln"> setContext</span><span class="pun">(</span><span class="pln">context</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">context </span><span class="pun">=</span><span class="pln"> context
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> invokeMethod</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> name</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Object</span><span class="pln"> arg</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        context</span><span class="pun">.</span><span class="pln">invokeMethod</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> arg</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> startFrom</span><span class="pun">(</span><span class="pln">initialState</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        setContext</span><span class="pun">(</span><span class="typ">InstanceProvider</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="pln">initialState</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> client

    </span><span class="typ">State</span><span class="pun">(</span><span class="pln">client</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">client </span><span class="pun">=</span><span class="pln"> client </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> transitionTo</span><span class="pun">(</span><span class="pln">nextState</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        client</span><span class="pun">.</span><span class="pln">setContext</span><span class="pun">(</span><span class="typ">InstanceProvider</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="pln">nextState</span><span class="pun">,</span><span class="pln"> client</span><span class="pun">))</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all quite generic and can be used wherever we want to 
introduce the state pattern. Here is what our code would look like now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Client</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Context</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Client</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        startFrom</span><span class="pun">(</span><span class="typ">Offline</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Offline</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Offline</span><span class="pun">(</span><span class="pln">client</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">client</span><span class="pun">)</span><span class="pln">
        println </span><span class="str">"offline"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> connect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        transitionTo</span><span class="pun">(</span><span class="typ">Online</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> disconnect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"error: not connected"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> send_message</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"error: not connected"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> receive_message</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"error: not connected"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Online</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">State</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Online</span><span class="pun">(</span><span class="pln">client</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">(</span><span class="pln">client</span><span class="pun">)</span><span class="pln">
        println </span><span class="str">"connected"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> connect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"error: already connected"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> disconnect</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        transitionTo</span><span class="pun">(</span><span class="typ">Offline</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> send_message</span><span class="pun">(</span><span class="pln">message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"\"$message\" sent"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> receive_message</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println </span><span class="str">"message received"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

client </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Client</span><span class="pun">()</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">send_message</span><span class="pun">(</span><span class="str">"Hello"</span><span class="pun">)</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">()</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">send_message</span><span class="pun">(</span><span class="str">"Hello"</span><span class="pun">)</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">connect</span><span class="pun">()</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">receive_message</span><span class="pun">()</span><span class="pln">
client</span><span class="pun">.</span><span class="pln">disconnect</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see here the <code>startFrom</code> and <code>transitionTo</code> methods begin to give our example code a DSL feel.</p>
</div>
</div>
<div class="sect5">
<h6 id="_variation_3_bring_on_the_dsl"><a class="anchor" href="#_variation_3_bring_on_the_dsl"></a>Variation 3: Bring on the DSL</h6>
<div class="paragraph">
<p>Alternatively, or in combination with other variations, we might 
decide to fully embrace a Domain Specific Language (DSL) approach to 
this example.</p>
</div>
<div class="paragraph">
<p>We can define the following generic helper functions (first discussed <a href="http://www.bytemycode.com/snippets/snippet/640/">here</a>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Grammar</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> fsm

    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">event</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> fromState
    </span><span class="kwd">def</span><span class="pln"> toState

    </span><span class="typ">Grammar</span><span class="pun">(</span><span class="pln">a_fsm</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        fsm </span><span class="pun">=</span><span class="pln"> a_fsm
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> on</span><span class="pun">(</span><span class="pln">a_event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a_event
        </span><span class="kwd">this</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> on</span><span class="pun">(</span><span class="pln">a_event</span><span class="pun">,</span><span class="pln"> a_transitioner</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        on</span><span class="pun">(</span><span class="pln">a_event</span><span class="pun">)</span><span class="pln">
        a_transitioner</span><span class="pun">.</span><span class="kwd">delegate</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">
        a_transitioner</span><span class="pun">.</span><span class="pln">call</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">from</span><span class="pun">(</span><span class="pln">a_fromState</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        fromState </span><span class="pun">=</span><span class="pln"> a_fromState
        </span><span class="kwd">this</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> to</span><span class="pun">(</span><span class="pln">a_toState</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> a_toState</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Invalid toState: $a_toState"</span><span class="pln">
        toState </span><span class="pun">=</span><span class="pln"> a_toState
        fsm</span><span class="pun">.</span><span class="pln">registerTransition</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">this</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> isValid</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> fromState </span><span class="pun">&amp;&amp;</span><span class="pln"> toState
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> toString</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"$event: $fromState=&gt;$toState"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">FiniteStateMachine</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> transitions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> initialState
    </span><span class="kwd">def</span><span class="pln"> currentState

    </span><span class="typ">FiniteStateMachine</span><span class="pun">(</span><span class="pln">a_initialState</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> a_initialState</span><span class="pun">,</span><span class="pln"> </span><span class="str">"You need to provide an initial state"</span><span class="pln">
        initialState </span><span class="pun">=</span><span class="pln"> a_initialState
        currentState </span><span class="pun">=</span><span class="pln"> a_initialState
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> record</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="typ">Grammar</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> reset</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        currentState </span><span class="pun">=</span><span class="pln"> initialState
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> isState</span><span class="pun">(</span><span class="pln">a_state</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        currentState </span><span class="pun">==</span><span class="pln"> a_state
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> registerTransition</span><span class="pun">(</span><span class="pln">a_grammar</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> a_grammar</span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">(),</span><span class="pln"> </span><span class="str">"Invalid transition ($a_grammar)"</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> transition
        </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">event</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> a_grammar</span><span class="pun">.</span><span class="kwd">event</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> fromState </span><span class="pun">=</span><span class="pln"> a_grammar</span><span class="pun">.</span><span class="pln">fromState
        </span><span class="kwd">def</span><span class="pln"> toState </span><span class="pun">=</span><span class="pln"> a_grammar</span><span class="pun">.</span><span class="pln">toState

        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">transitions</span><span class="pun">[</span><span class="kwd">event</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            transitions</span><span class="pun">[</span><span class="kwd">event</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[:]</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

        transition </span><span class="pun">=</span><span class="pln"> transitions</span><span class="pun">[</span><span class="kwd">event</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> </span><span class="pun">!</span><span class="pln">transition</span><span class="pun">[</span><span class="pln">fromState</span><span class="pun">],</span><span class="pln"> </span><span class="str">"Duplicate fromState $fromState for transition $a_grammar"</span><span class="pln">
        transition</span><span class="pun">[</span><span class="pln">fromState</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> toState
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> fire</span><span class="pun">(</span><span class="pln">a_event</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> currentState</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Invalid current state '$currentState': passed into constructor"</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> transitions</span><span class="pun">.</span><span class="pln">containsKey</span><span class="pun">(</span><span class="pln">a_event</span><span class="pun">),</span><span class="pln"> </span><span class="str">"Invalid event '$a_event', should be one of ${transitions.keySet()}"</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> transition </span><span class="pun">=</span><span class="pln"> transitions</span><span class="pun">[</span><span class="pln">a_event</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> nextState </span><span class="pun">=</span><span class="pln"> transition</span><span class="pun">[</span><span class="pln">currentState</span><span class="pun">]</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> nextState</span><span class="pun">,</span><span class="pln"> </span><span class="str">"There is no transition from '$currentState' to any other state"</span><span class="pln">
        currentState </span><span class="pun">=</span><span class="pln"> nextState
        currentState
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can define and test our state machine like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">StatePatternDslTest</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">GroovyTestCase</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> fsm

    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setUp</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        fsm </span><span class="pun">=</span><span class="pln"> </span><span class="typ">FiniteStateMachine</span><span class="pun">.</span><span class="pln">newInstance</span><span class="pun">(</span><span class="str">'offline'</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> recorder </span><span class="pun">=</span><span class="pln"> fsm</span><span class="pun">.</span><span class="pln">record</span><span class="pun">()</span><span class="pln">
        recorder</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'connect'</span><span class="pun">).</span><span class="kwd">from</span><span class="pun">(</span><span class="str">'offline'</span><span class="pun">).</span><span class="pln">to</span><span class="pun">(</span><span class="str">'online'</span><span class="pun">)</span><span class="pln">
        recorder</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'disconnect'</span><span class="pun">).</span><span class="kwd">from</span><span class="pun">(</span><span class="str">'online'</span><span class="pun">).</span><span class="pln">to</span><span class="pun">(</span><span class="str">'offline'</span><span class="pun">)</span><span class="pln">
        recorder</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'send_message'</span><span class="pun">).</span><span class="kwd">from</span><span class="pun">(</span><span class="str">'online'</span><span class="pun">).</span><span class="pln">to</span><span class="pun">(</span><span class="str">'online'</span><span class="pun">)</span><span class="pln">
        recorder</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'receive_message'</span><span class="pun">).</span><span class="kwd">from</span><span class="pun">(</span><span class="str">'online'</span><span class="pun">).</span><span class="pln">to</span><span class="pun">(</span><span class="str">'online'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> testInitialState</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> fsm</span><span class="pun">.</span><span class="pln">isState</span><span class="pun">(</span><span class="str">'offline'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> testOfflineState</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        shouldFail</span><span class="pun">{</span><span class="pln">
            fsm</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'send_message'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        shouldFail</span><span class="pun">{</span><span class="pln">
            fsm</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'receive_message'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        shouldFail</span><span class="pun">{</span><span class="pln">
            fsm</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'disconnect'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> </span><span class="str">'online'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> fsm</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'connect'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">void</span><span class="pln"> testOnlineState</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        fsm</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'connect'</span><span class="pun">)</span><span class="pln">
        fsm</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'send_message'</span><span class="pun">)</span><span class="pln">
        fsm</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'receive_message'</span><span class="pun">)</span><span class="pln">
        shouldFail</span><span class="pun">{</span><span class="pln">
            fsm</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'connect'</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> </span><span class="str">'offline'</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> fsm</span><span class="pun">.</span><span class="pln">fire</span><span class="pun">(</span><span class="str">'disconnect'</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example isn’t an exact equivalent of the others. It doesn’t use predefined <code>Online</code> and <code>Offline</code> classes. Instead it defines the entire state machine on the fly as needed. See the <a href="http://www.bytemycode.com/snippets/snippet/640/">previous reference</a> for more elaborate examples of this style.</p>
</div>
<div class="paragraph">
<p>See also: <a href="#_model_based_testing_using_modeljunit">Model-based testing using ModelJUnit</a></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_strategy_pattern"><a class="anchor" href="#_strategy_pattern"></a>Strategy Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Strategy_pattern">Strategy Pattern</a>
 allows you to abstract away particular algorithms from their usage. 
This allows you to easily swap the algorithm being used without having 
to change the calling code. The general form of the pattern is:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Groovy-Language-Documentation_files/xStrategyClasses.png" alt="StrategyClasses" data-pagespeed-url-hash="2357138595" onload="pagespeed.CriticalImages.checkImageForCriticality(this);">
</div>
</div>
<div class="paragraph">
<p>In Groovy, because of its ability to treat code as a first class object using anonymous methods (which we loosely call <em>Closures</em>), the need for the strategy pattern is greatly reduced. You can simply place algorithms inside Closures.</p>
</div>
<div class="sect5">
<h6 id="_example_9"><a class="anchor" href="#_example_9"></a>Example</h6>
<div class="paragraph">
<p>First let’s look at the traditional way of encapsulating the Strategy Pattern.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Calc</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> execute</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CalcByMult</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Calc</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> execute</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> n </span><span class="pun">*</span><span class="pln"> m </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">CalcByManyAdds</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Calc</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> execute</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> m</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
        n</span><span class="pun">.</span><span class="pln">times</span><span class="pun">{</span><span class="pln">
            result </span><span class="pun">+=</span><span class="pln"> m
        </span><span class="pun">}</span><span class="pln">

        result
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> sampleData </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="pun">[</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">12</span><span class="pun">],</span><span class="pln">
    </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">25</span><span class="pun">]</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

</span><span class="typ">Calc</span><span class="pun">[]</span><span class="pln"> multiplicationStrategies </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CalcByMult</span><span class="pun">(),</span><span class="pln">
    </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">CalcByManyAdds</span><span class="pun">()</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

sampleData</span><span class="pun">.</span><span class="pln">each</span><span class="pun">{</span><span class="pln"> data </span><span class="pun">-&gt;</span><span class="pln">
    multiplicationStrategies</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> calc </span><span class="pun">-&gt;</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> data</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> calc</span><span class="pun">.</span><span class="pln">execute</span><span class="pun">(</span><span class="pln">data</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln"> data</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we have defined an interface <code>Calc</code> which our 
concrete strategy classes will implement (we could also have used an 
abstract class). We then defined two algorithms for doing simple 
multiplication: <code>CalcByMult</code> the normal way, and 
CalcByManyAdds using only addition (don’t try this one using negative 
numbers - yes we could fix this but it would just make the example 
longer). We then use normal <a href="http://en.wikipedia.org/wiki/Polymorphism_in_object-oriented_programming">polymorphism</a> to invoke the algorithms.</p>
</div>
<div class="paragraph">
<p>Here is the Groovier way to achieve the same thing using Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">def</span><span class="pln"> multiplicationStrategies </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="pun">{</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m </span><span class="pun">-&gt;</span><span class="pln"> n </span><span class="pun">*</span><span class="pln"> m </span><span class="pun">},</span><span class="pln">
    </span><span class="pun">{</span><span class="pln"> n</span><span class="pun">,</span><span class="pln"> m </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">def</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> n</span><span class="pun">.</span><span class="pln">times</span><span class="pun">{</span><span class="pln"> result </span><span class="pun">+=</span><span class="pln"> m </span><span class="pun">};</span><span class="pln"> result </span><span class="pun">}</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> sampleData </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
    </span><span class="pun">[</span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">12</span><span class="pun">],</span><span class="pln">
    </span><span class="pun">[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="pun">-</span><span class="lit">25</span><span class="pun">]</span><span class="pln">
</span><span class="pun">]</span><span class="pln">

sampleData</span><span class="pun">.</span><span class="pln">each</span><span class="pun">{</span><span class="pln"> data </span><span class="pun">-&gt;</span><span class="pln">
    multiplicationStrategies</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> calc </span><span class="pun">-&gt;</span><span class="pln">
        </span><span class="kwd">assert</span><span class="pln"> data</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> calc</span><span class="pun">(</span><span class="pln">data</span><span class="pun">[</span><span class="lit">0</span><span class="pun">],</span><span class="pln"> data</span><span class="pun">[</span><span class="lit">1</span><span class="pun">])</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_template_method_pattern"><a class="anchor" href="#_template_method_pattern"></a>Template Method Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Template_method_pattern">Template Method Pattern</a>
 abstracts away the details of several algorithms. The generic part of 
an algorithm is contained within a base class. Particular implementation
 details are captured within base classes. The generic pattern of 
classes involved looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="Groovy-Language-Documentation_files/xTemplateMethodClasses.png" alt="TemplateMethodClasses" data-pagespeed-url-hash="3557899207" onload="pagespeed.CriticalImages.checkImageForCriticality(this);">
</div>
</div>
<div class="sect5">
<h6 id="_example_10"><a class="anchor" href="#_example_10"></a>Example</h6>
<div class="paragraph">
<p>In this example, <code>Accumulator</code> captures the essence of the accumulation algorithm. The base classes <code>Sum</code> and <code>Product</code> provide particular customised ways to use the generic accumulation algorithm.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Accumulator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">protected</span><span class="pln"> initial
    </span><span class="kwd">abstract</span><span class="pln"> doAccumulate</span><span class="pun">(</span><span class="pln">total</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> accumulate</span><span class="pun">(</span><span class="pln">values</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> total </span><span class="pun">=</span><span class="pln"> initial
        values</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> v </span><span class="pun">-&gt;</span><span class="pln"> total </span><span class="pun">=</span><span class="pln"> doAccumulate</span><span class="pun">(</span><span class="pln">total</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
        total
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Sum</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Accumulator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="typ">Sum</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> initial </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> doAccumulate</span><span class="pun">(</span><span class="pln">total</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> total </span><span class="pun">+</span><span class="pln"> v </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Product</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Accumulator</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> initial </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> doAccumulate</span><span class="pun">(</span><span class="pln">total</span><span class="pun">,</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> total </span><span class="pun">*</span><span class="pln"> v </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

println </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Sum</span><span class="pun">().</span><span class="pln">accumulate</span><span class="pun">([</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">])</span><span class="pln">
println </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Product</span><span class="pun">().</span><span class="pln">accumulate</span><span class="pun">([</span><span class="lit">1</span><span class="pun">,</span><span class="lit">2</span><span class="pun">,</span><span class="lit">3</span><span class="pun">,</span><span class="lit">4</span><span class="pun">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting output is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>10
24</pre>
</div>
</div>
<div class="paragraph">
<p>In this particular case, you could use Groovy’s inject method to achieve a similar result using Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Closure</span><span class="pln"> addAll </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> total</span><span class="pun">,</span><span class="pln"> item </span><span class="pun">-&gt;</span><span class="pln"> total </span><span class="pun">+=</span><span class="pln"> item </span><span class="pun">}</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> accumulated </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">].</span><span class="pln">inject</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> addAll</span><span class="pun">)</span><span class="pln">
println accumulated    </span><span class="com">// =&gt; 10</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to duck-typing, this would also work with other objects which support an add (plus() in Groovy) method, e.g.:</p>
</div>
<div class="paragraph">
<p>In this particular case, you could use Groovy’s inject method to achieve a similar result using Closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="pln">accumulated </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> </span><span class="str">"1"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"2"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"3"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"4"</span><span class="pln"> </span><span class="pun">].</span><span class="pln">inject</span><span class="pun">(</span><span class="str">""</span><span class="pun">,</span><span class="pln"> addAll</span><span class="pun">)</span><span class="pln">
println accumulated    </span><span class="com">// =&gt; "1234"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could also do the multiplication case as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">Closure</span><span class="pln"> multAll </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> total</span><span class="pun">,</span><span class="pln"> item </span><span class="pun">-&gt;</span><span class="pln"> total </span><span class="pun">*=</span><span class="pln"> item </span><span class="pun">}</span><span class="pln">
accumulated </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">].</span><span class="pln">inject</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> multAll</span><span class="pun">)</span><span class="pln">
println accumulated    </span><span class="com">// =&gt; 24</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using closures this way looks more like the <a href="#_strategy_pattern">Strategy Pattern</a>
 but if we realise that the built-in inject method is the generic part 
of the algorithm for our template method, then the Closures become the 
customised parts of the template method pattern.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_visitor_pattern"><a class="anchor" href="#_visitor_pattern"></a>Visitor Pattern</h5>
<div class="paragraph">
<p>The <a href="http://en.wikipedia.org/wiki/Visitor_pattern">Visitor Pattern</a> is one of those well-known but not often used patterns. I think this is strange, as it is really a nice thing.</p>
</div>
<div class="paragraph">
<p>The goal of the pattern is to separate an algorithm from an object 
structure. A practical result of this separation is the ability to add 
new operations to existing object structures without modifying those 
structures.</p>
</div>
<div class="sect5">
<h6 id="_simple_example_2"><a class="anchor" href="#_simple_example_2"></a>Simple Example</h6>
<div class="paragraph">
<p>This example considers how to calculate the bounds of shapes (or 
collections of shapes). Our first attempt uses the traditional visitor 
pattern. We will see a more Groovy way to do this shortly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Shape</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Rectangle</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Shape</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height

    </span><span class="typ">Rectangle</span><span class="pun">(</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> height</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">x </span><span class="pun">=</span><span class="pln"> x</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> y</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">width </span><span class="pun">=</span><span class="pln"> width</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">height </span><span class="pun">=</span><span class="pln"> height
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">union</span><span class="pun">(</span><span class="pln">rect</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">rect</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> minx </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">rect</span><span class="pun">.</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">].</span><span class="pln">min</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> maxx </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">rect</span><span class="pun">.</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> width</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">+</span><span class="pln"> width</span><span class="pun">].</span><span class="pln">max</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> miny </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">rect</span><span class="pun">.</span><span class="pln">y</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">].</span><span class="pln">min</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> maxy </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">rect</span><span class="pun">.</span><span class="pln">y </span><span class="pun">+</span><span class="pln"> height</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">+</span><span class="pln"> height</span><span class="pun">].</span><span class="pln">max</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Rectangle</span><span class="pun">(</span><span class="pln">minx</span><span class="pun">,</span><span class="pln"> miny</span><span class="pun">,</span><span class="pln"> maxx </span><span class="pun">-</span><span class="pln"> minx</span><span class="pun">,</span><span class="pln"> maxy </span><span class="pun">-</span><span class="pln"> miny</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> accept</span><span class="pun">(</span><span class="pln">visitor</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        visitor</span><span class="pun">.</span><span class="pln">visit_rectangle</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Line</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Shape</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> x1</span><span class="pun">,</span><span class="pln"> y1</span><span class="pun">,</span><span class="pln"> x2</span><span class="pun">,</span><span class="pln"> y2

    </span><span class="typ">Line</span><span class="pun">(</span><span class="pln">x1</span><span class="pun">,</span><span class="pln"> y1</span><span class="pun">,</span><span class="pln"> x2</span><span class="pun">,</span><span class="pln"> y2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">x1 </span><span class="pun">=</span><span class="pln"> x1</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">y1 </span><span class="pun">=</span><span class="pln"> y1</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">x2 </span><span class="pun">=</span><span class="pln"> x2</span><span class="pun">;</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">y2 </span><span class="pun">=</span><span class="pln"> y2
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> accept</span><span class="pun">(</span><span class="pln">visitor</span><span class="pun">){</span><span class="pln">
        visitor</span><span class="pun">.</span><span class="pln">visit_line</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Group</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Shape</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> shapes </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> add</span><span class="pun">(</span><span class="pln">shape</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> shapes </span><span class="pun">+=</span><span class="pln"> shape </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> remove</span><span class="pun">(</span><span class="pln">shape</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> shapes </span><span class="pun">-=</span><span class="pln"> shape </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> accept</span><span class="pun">(</span><span class="pln">visitor</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        visitor</span><span class="pun">.</span><span class="pln">visit_group</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">BoundingRectangleVisitor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> bounds

    </span><span class="kwd">def</span><span class="pln"> visit_rectangle</span><span class="pun">(</span><span class="pln">rectangle</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bounds</span><span class="pun">)</span><span class="pln">
            bounds </span><span class="pun">=</span><span class="pln"> bounds</span><span class="pun">.</span><span class="kwd">union</span><span class="pun">(</span><span class="pln">rectangle</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
            bounds </span><span class="pun">=</span><span class="pln"> rectangle
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> visit_line</span><span class="pun">(</span><span class="pln">line</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> line_bounds </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Rectangle</span><span class="pun">(</span><span class="pln">line</span><span class="pun">.</span><span class="pln">x1</span><span class="pun">,</span><span class="pln"> line</span><span class="pun">.</span><span class="pln">y1</span><span class="pun">,</span><span class="pln"> line</span><span class="pun">.</span><span class="pln">x2</span><span class="pun">-</span><span class="pln">line</span><span class="pun">.</span><span class="pln">y1</span><span class="pun">,</span><span class="pln"> line</span><span class="pun">.</span><span class="pln">x2</span><span class="pun">-</span><span class="pln">line</span><span class="pun">.</span><span class="pln">y2</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">bounds</span><span class="pun">)</span><span class="pln">
            bounds </span><span class="pun">=</span><span class="pln"> bounds</span><span class="pun">.</span><span class="kwd">union</span><span class="pun">(</span><span class="pln">line_bounds</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">else</span><span class="pln">
            bounds </span><span class="pun">=</span><span class="pln"> line_bounds
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">def</span><span class="pln"> visit_group</span><span class="pun">(</span><span class="kwd">group</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">group</span><span class="pun">.</span><span class="pln">shapes</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> shape </span><span class="pun">-&gt;</span><span class="pln"> shape</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">group</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Group</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">group</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Rectangle</span><span class="pun">(</span><span class="lit">100</span><span class="pun">,</span><span class="pln"> </span><span class="lit">40</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">))</span><span class="pln">
</span><span class="kwd">group</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Rectangle</span><span class="pun">(</span><span class="lit">100</span><span class="pun">,</span><span class="pln"> </span><span class="lit">70</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">))</span><span class="pln">
</span><span class="kwd">group</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Line</span><span class="pun">(</span><span class="lit">90</span><span class="pun">,</span><span class="pln"> </span><span class="lit">30</span><span class="pun">,</span><span class="pln"> </span><span class="lit">60</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">))</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> visitor </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">BoundingRectangleVisitor</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">group</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">(</span><span class="pln">visitor</span><span class="pun">)</span><span class="pln">
bounding_box </span><span class="pun">=</span><span class="pln"> visitor</span><span class="pun">.</span><span class="pln">bounds
println bounding_box</span><span class="pun">.</span><span class="kwd">dump</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That took quite a bit of code.</p>
</div>
<div class="paragraph">
<p>We can improve the clarity of our code (and make it about half the size) by making use of Groovy Closures as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">abstract</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Shape</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> accept</span><span class="pun">(</span><span class="typ">Closure</span><span class="pln"> </span><span class="kwd">yield</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">yield</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Rectangle</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Shape</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> x</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">,</span><span class="pln"> w</span><span class="pun">,</span><span class="pln"> h
    </span><span class="kwd">def</span><span class="pln"> bounds</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">this</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">union</span><span class="pun">(</span><span class="pln">rect</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">rect</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> minx </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">x</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">].</span><span class="pln">min</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> maxx </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> w</span><span class="pun">,</span><span class="pln"> x </span><span class="pun">+</span><span class="pln"> w </span><span class="pun">].</span><span class="pln">max</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> miny </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">y</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">].</span><span class="pln">min</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">def</span><span class="pln"> maxy </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln"> rect</span><span class="pun">.</span><span class="pln">y </span><span class="pun">+</span><span class="pln"> h</span><span class="pun">,</span><span class="pln"> y </span><span class="pun">+</span><span class="pln"> h </span><span class="pun">].</span><span class="pln">max</span><span class="pun">()</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Rectangle</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="pln">minx</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln">miny</span><span class="pun">,</span><span class="pln"> w</span><span class="pun">:</span><span class="pln">maxx </span><span class="pun">-</span><span class="pln"> minx</span><span class="pun">,</span><span class="pln"> h</span><span class="pun">:</span><span class="pln">maxy </span><span class="pun">-</span><span class="pln"> miny</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Line</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Shape</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> x1</span><span class="pun">,</span><span class="pln"> y1</span><span class="pun">,</span><span class="pln"> x2</span><span class="pun">,</span><span class="pln"> y2
    </span><span class="kwd">def</span><span class="pln"> bounds</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Rectangle</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:[</span><span class="pln">x1</span><span class="pun">,</span><span class="pln"> x2</span><span class="pun">].</span><span class="pln">min</span><span class="pun">(),</span><span class="pln"> y</span><span class="pun">:[</span><span class="pln">y1</span><span class="pun">,</span><span class="pln"> y2</span><span class="pun">].</span><span class="pln">min</span><span class="pun">(),</span><span class="pln"> w</span><span class="pun">:(</span><span class="pln">x2 </span><span class="pun">-</span><span class="pln"> x1</span><span class="pun">).</span><span class="pln">abs</span><span class="pun">(),</span><span class="pln"> h</span><span class="pun">:(</span><span class="pln">y2 </span><span class="pun">-</span><span class="pln"> y1</span><span class="pun">).</span><span class="pln">abs</span><span class="pun">())</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Group</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> shapes </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> leftShift</span><span class="pun">(</span><span class="pln">shape</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> shapes </span><span class="pun">+=</span><span class="pln"> shape </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">def</span><span class="pln"> accept</span><span class="pun">(</span><span class="typ">Closure</span><span class="pln"> </span><span class="kwd">yield</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> shapes</span><span class="pun">.</span><span class="pln">each</span><span class="pun">{</span><span class="pln">it</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">(</span><span class="kwd">yield</span><span class="pun">)}</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">def</span><span class="pln"> </span><span class="kwd">group</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Group</span><span class="pun">()</span><span class="pln">
</span><span class="kwd">group</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Rectangle</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="lit">100</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="lit">40</span><span class="pun">,</span><span class="pln"> w</span><span class="pun">:</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> h</span><span class="pun">:</span><span class="lit">5</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">group</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Rectangle</span><span class="pun">(</span><span class="pln">x</span><span class="pun">:</span><span class="lit">100</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="lit">70</span><span class="pun">,</span><span class="pln"> w</span><span class="pun">:</span><span class="lit">10</span><span class="pun">,</span><span class="pln"> h</span><span class="pun">:</span><span class="lit">5</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">group</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Line</span><span class="pun">(</span><span class="pln">x1</span><span class="pun">:</span><span class="lit">90</span><span class="pun">,</span><span class="pln"> y1</span><span class="pun">:</span><span class="lit">30</span><span class="pun">,</span><span class="pln"> x2</span><span class="pun">:</span><span class="lit">60</span><span class="pun">,</span><span class="pln"> y2</span><span class="pun">:</span><span class="lit">5</span><span class="pun">)</span><span class="pln">
</span><span class="kwd">def</span><span class="pln"> bounds
</span><span class="kwd">group</span><span class="pun">.</span><span class="pln">accept</span><span class="pun">{</span><span class="pln"> bounds </span><span class="pun">=</span><span class="pln"> it</span><span class="pun">.</span><span class="pln">bounds</span><span class="pun">().</span><span class="kwd">union</span><span class="pun">(</span><span class="pln">bounds</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
println bounds</span><span class="pun">.</span><span class="kwd">dump</span><span class="pun">()</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_advanced_example"><a class="anchor" href="#_advanced_example"></a>Advanced Example</h6>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Visitor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType1</span><span class="pln"> n1</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType2</span><span class="pln"> n2</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> accept</span><span class="pun">(</span><span class="typ">Visitor</span><span class="pln"> visitor</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType1</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Visitable</span><span class="pun">[]</span><span class="pln"> children </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> accept</span><span class="pun">(</span><span class="typ">Visitor</span><span class="pln"> visitor</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        visitor</span><span class="pun">.</span><span class="pln">visit</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> children</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            children</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">accept</span><span class="pun">(</span><span class="pln">visitor</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType2</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Visitable</span><span class="pun">[]</span><span class="pln"> children </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> accept</span><span class="pun">(</span><span class="typ">Visitor</span><span class="pln"> visitor</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        visitor</span><span class="pun">.</span><span class="pln">visit</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> children</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            children</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">accept</span><span class="pun">(</span><span class="pln">visitor</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType1Counter</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Visitor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType1</span><span class="pln"> n1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        count</span><span class="pun">++</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType2</span><span class="pln"> n2</span><span class="pun">){}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we now use <code>NodeType1Counter</code> on a tree like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="typ">NodeType1</span><span class="pln"> root </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NodeType1</span><span class="pun">()</span><span class="pln">
root</span><span class="pun">.</span><span class="pln">children </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]</span><span class="pln">
root</span><span class="pun">.</span><span class="pln">children</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NodeType1</span><span class="pun">()</span><span class="pln">
root</span><span class="pun">.</span><span class="pln">children</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">NodeType2</span><span class="pun">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we have one <code>NodeType1</code> object as root and one of the children is also a <code>NodeType1</code> instance. The other child is a <code>NodeType2</code> instance. That means using <code>NodeType1Counter</code> here should count 2 <code>NodeType1</code> objects.</p>
</div>
<div class="sect6">
<h7 id="_why_to_use_this"><a class="anchor" href="#_why_to_use_this"></a>Why to use this</h7>
<div class="paragraph">
<p>As you can see here very good we have a visitor that has a state 
while the tree of objects is not changed. That’s pretty useful in 
different areas, for example you could have a visitor counting all node 
types, or how many different types are used, or you could use methods 
special to the node to gather information about the tree and much more.</p>
</div>
</div>
<div class="sect6">
<h7 id="_what_happens_if_we_add_a_new_type"><a class="anchor" href="#_what_happens_if_we_add_a_new_type"></a>What happens if we add a new type?</h7>
<div class="paragraph">
<p>In this case we have to do much work.. we have to change Visitor to 
accept the new type, we have to write the new type itself of course and 
we have to change every Visitor we have already implemented. After very 
few changes you will modify all your Visitors to extend a default 
implementation of the visitor, so you don’t need to change every Visitor
 each time you add a new type.</p>
</div>
</div>
<div class="sect6">
<h7 id="_what_if_we_want_to_have_different_iteration_patterns"><a class="anchor" href="#_what_if_we_want_to_have_different_iteration_patterns"></a>What if we want to have different iteration patterns?</h7>
<div class="paragraph">
<p>Then you have a problem. since the node describes how to iterate, you
 have no influence and stop iteration at a point or change the order. So
 maybe we should change this a little to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Visitor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType1</span><span class="pln"> n1</span><span class="pun">)</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType2</span><span class="pln"> n2</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">DefaultVisitor</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Visitor</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType1</span><span class="pln"> n1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n1</span><span class="pun">.</span><span class="pln">children</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            n1</span><span class="pun">.</span><span class="pln">children</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">accept</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType2</span><span class="pln"> n2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n2</span><span class="pun">.</span><span class="pln">children</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            n2</span><span class="pun">.</span><span class="pln">children</span><span class="pun">[</span><span class="pln">i</span><span class="pun">].</span><span class="pln">accept</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> accept</span><span class="pun">(</span><span class="typ">Visitor</span><span class="pln"> visitor</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType1</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Visitable</span><span class="pun">[]</span><span class="pln"> children </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> accept</span><span class="pun">(</span><span class="typ">Visitor</span><span class="pln"> visitor</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        visitor</span><span class="pun">.</span><span class="pln">visit</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType2</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Visitable</span><span class="pun">[]</span><span class="pln"> children </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> accept</span><span class="pun">(</span><span class="typ">Visitor</span><span class="pln"> visitor</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        visitor</span><span class="pun">.</span><span class="pln">visit</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType1Counter</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">DefaultVisitor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType1</span><span class="pln"> n1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        count</span><span class="pun">++</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">visit</span><span class="pun">(</span><span class="pln">n1</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Some small changes but with big effect…​ the visitor is now recursive
 and tells me how to iterate. The implementation in the Nodes is 
minimized to <code>visitor.visit(this)</code>, <code>DefaultVisitor</code>
 is now able to catch the new types, we can stop iteration by not 
delegating to super. Of course the big disadvantage now is that it is no
 longer iterative, but you can’t get all the benefits.</p>
</div>
</div>
<div class="sect6">
<h7 id="_make_it_groovy"><a class="anchor" href="#_make_it_groovy"></a>Make it Groovy</h7>
<div class="paragraph">
<p>The question now is how to make that a bit more Groovy. Didn’t you find this <code>visitor.visit(this)</code> strange? Why is it there? The answer is to simulate double dispatch. In Java the compile time type is used, so when I <code>visitor.visit(children[i])</code> then the compiler won’t be able to find the correct method, because <code>Visitor</code> does not contain a method <code>visit(Visitable)</code>. And even if it would, we would like to visit the more special methods with <code>NodeType1</code> or <code>NodeType2</code>.</p>
</div>
<div class="paragraph">
<p>Now Groovy is not using the static type, Groovy uses the runtime type. This means I could do <code>visitor.visit(children[i])</code>
 directly. Hmm.. since we minimized the accept method to just do the 
double dispatch part and since the runtime type system of Groovy will 
already cover that.. do we need the accept method? I think you can guess
 that I would answer no. But we can do more. We had the disadvantage of 
not knowing how to handle unknown tree elements. We had to extends the 
interface <code>Visitor</code> for that, resulting in changes to <code>DefaultVisitor</code>
 and then we have the task to provide a useful default like iterating 
the node or not doing anything at all. Now with Groovy we can catch that
 case by adding a <code>visit(Visitable)</code> method that does nothing. That would be the same in Java btw.</p>
</div>
<div class="paragraph">
<p>But don’t let us stop here…​ do we need the <code>Visitor</code> interface? If we don’t have the accept method, then we don’t need the <code>Visitor</code> interface at all. So the new code would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">DefaultVisitor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType1</span><span class="pln"> n1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        n1</span><span class="pun">.</span><span class="pln">children</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> visit</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType2</span><span class="pln"> n2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        n2</span><span class="pun">.</span><span class="pln">children</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln"> visit</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">Visitable</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType1</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Visitable</span><span class="pun">[]</span><span class="pln"> children </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType2</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Visitable</span><span class="pun">[]</span><span class="pln"> children </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType1Counter</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">DefaultVisitor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType1</span><span class="pln"> n1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        count</span><span class="pun">++</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">visit</span><span class="pun">(</span><span class="pln">n1</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Looks like we saved a few lines of code here. But we made more. The <code>Visitable</code> nodes now do not refer to any <code>Visitor</code>
 class or interface. For me this is the best level of separation you 
could get here. But do we really need to stop here? No. Let us change 
the <code>Visitable</code> interface a little and let it return the children we want to visit next. This allows us a general iteration method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight prettyprinted" style=""><code class="language-groovy" data-lang="groovy"><span class="kwd">class</span><span class="pln"> </span><span class="typ">DefaultVisitor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">Visitable</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        doIteraton</span><span class="pun">(</span><span class="pln">v</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> doIteraton</span><span class="pun">(</span><span class="typ">Visitable</span><span class="pln"> v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        v</span><span class="pun">.</span><span class="pln">children</span><span class="pun">.</span><span class="pln">each </span><span class="pun">{</span><span class="pln">
            visit</span><span class="pun">(</span><span class="pln">it</span><span class="pun">)</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Visitable</span><span class="pun">[]</span><span class="pln"> getChildren</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType1</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Visitable</span><span class="pun">[]</span><span class="pln"> children </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType2</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">Visitable</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Visitable</span><span class="pun">[]</span><span class="pln"> children </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">NodeType1Counter</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">DefaultVisitor</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> count </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
    </span><span class="kwd">void</span><span class="pln"> visit</span><span class="pun">(</span><span class="typ">NodeType1</span><span class="pln"> n1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        count</span><span class="pun">++</span><span class="pln">
        </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">visit</span><span class="pun">(</span><span class="pln">n1</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>DefaultVisitor</code> now looks a bit different. I added a <code>doIteration</code> method that will get the children it should iterate over and then call visit on each element. Per default this will call <code>visit(Visitable)</code> which then iterates over the children of this child. I changed <code>Visitable</code> to ensure that any node will be able to return children (even if empty). I didn’t have to change the <code>NodeType1</code> and <code>NodeType2</code>
 class, because the way the children filed was defined already made them
 a property, which means Groovy is so nice to generate a get method for 
us. No the really interesting part is <code>NodeType1Counter</code>, it is interesting because we have not changed it. <code>super.visit(n1)</code> will now call <code>visit(Visitable)</code> which will call <code>doIteration</code> which will start the next level of iteration. So no change. But <code>visit(it)</code> will call <code>visit(NodeType1)</code> if it is of type <code>NodeType1</code>. In fact we don’t need the <code>doIteration</code> method, we could do that in <code>visit(Visitable)</code> too, but I thought this variant is better, because it allows us to write a new <code>Visitor</code> that overwrites visit(<code>Visitable</code>) for error cases which of course means we must not do <code>super.visit(n1)</code> but <code>doIteration(n1)</code>.</p>
</div>
</div>
<div class="sect6">
<h7 id="_summary"><a class="anchor" href="#_summary"></a>Summary</h7>
<div class="paragraph">
<p>In the end we got ~40% less code, a robust and stable architecture 
and we completely removed the Visitor from the Visitable. I heard about 
visitor implementations based on Reflection to get a more generic 
version. Well, with this you see there is really no need to do such 
thing. If we add new types we don’t need to change anything. It is said 
that the visitor pattern doesn’t fit extreme programming techniques very
 well because you need to make changes to so many classes all the time. I
 think I proved that this is because of Java not because the pattern is 
bad or something.</p>
</div>
<div class="paragraph">
<p>There are variants of the Visitor pattern, like the acyclic visitor 
pattern, that tries to solve the problem of adding new node types with 
special visitors. I don’t like that very much, it works with casts, 
catches the <code>ClassCastException</code> and other nasty things. In the end it tries to solve something we don’t even get with the Groovy version.</p>
</div>
<div class="paragraph">
<p>One more thing. <code>NodeType1Counter</code> could be implemented in Java as well. Groovy will recognize the visit methods and call them as needed because <code>DefaultVisitor</code> is still Groovy and does all the magic.</p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_further_information_2"><a class="anchor" href="#_further_information_2"></a>Further Information</h6>
<div class="ulist">
<ul>
<li>
<p><a href="http://se.ethz.ch/%7Emeyer/publications/computer/visitor.pdf">Componentization: the Visitor example</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_references"><a class="anchor" href="#_references"></a>3.19.2. References</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Erich Gamma, Richard Helm, Ralph Johnson, John Vlissides (1995). <em>Design Patterns: Elements of Reusable Object-Oriented Software</em>. Addison-Wesley. ISBN 0-201-63361-2.</p>
<div class="ulist">
<ul>
<li>
<p><em>The canonical reference of design patterns.</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Martin Fowler (1999). <em>Refactoring: Improving the Design of Existing Code</em>. Addison-Wesley. ISBN 0-201-48567-2.</p>
</li>
<li>
<p>Joshua Kerievsky (2004). <em>Refactoring To Patterns</em>. Addison-Wesley. ISBN 0-321-21335-1.</p>
</li>
<li>
<p>Eric Freeman, Elisabeth Freeman, Kathy Sierra, Bert Bates (2004). <em>Head First Design Patterns</em>. O’Reilly. ISBN 0-596-00712-4.
*<em>A great book to read, informative as well as amusing.</em></p>
</li>
<li>
<p>Dierk Koenig with Andrew Glover, Paul King, Guillaume Laforge and Jon Skeet (2007). <em>Groovy in Action</em>. Manning. ISBN 1-932394-84-2.</p>
<div class="ulist">
<ul>
<li>
<p><em>Discusses Visitor, Builder and other Patterns.</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Brad Appleton (1999). <a href="http://www.bradapp.com/docs/pizza-inv.html">Pizza Inversion - a Pattern for Efficient Resource Consumption</a>.</p>
<div class="ulist">
<ul>
<li>
<p><em>One of the most frequently used patterns by many software engineers!</em></p>
</li>
</ul>
</div>
</li>
<li>
<p><em>Design Patterns in Dynamic Languages</em> by Neil Ford. Houston Java User’s Group. Examples in Groovy and Ruby. <a href="http://www.oracle.com/technetwork/server-storage/ts-4961-159222.pdf" class="bare">http://www.oracle.com/technetwork/server-storage/ts-4961-159222.pdf</a></p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>4. Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_contributors"><a class="anchor" href="#_contributors"></a>4.1. Contributors</h3>
<div class="paragraph">
<p>The Groovy team would like to thank the contributors of this documentation (by alphabetical order):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/mojavelinux">Dan Allen</a></p>
</li>
<li>
<p><a href="https://github.com/and-dmitry">Dmitry Andreychuk</a></p>
</li>
<li>
<p><a href="http://hamletdarcy.blogspot.fr/">Hamlet D’Arcy</a></p>
</li>
<li>
<p><a href="https://github.com/anshbansal">Aseem Bansal</a></p>
</li>
<li>
<p><a href="https://github.com/bura">Andrey Bloschetsov</a></p>
</li>
<li>
<p><a href="https://github.com/JBrownVisualSpection">J Brown</a></p>
</li>
<li>
<p><a href="https://github.com/jeffbrown">Jeff Scott Brown</a></p>
</li>
<li>
<p><a href="http://twitter.com/CedricChampeau">Cédric Champeau</a></p>
</li>
<li>
<p><a href="https://github.com/tobia">Tobia Conforto</a></p>
</li>
<li>
<p><a href="https://github.com/ddimtirov">Dimitar Dimitrov</a></p>
</li>
<li>
<p><a href="http://twitter.com/werdnagreb">Andrew Eisenberg</a></p>
</li>
<li>
<p><a href="https://github.com/christoph-frick">Christoph Frick</a></p>
</li>
<li>
<p><a href="http://twitter.com/marioggar">Mario García</a></p>
</li>
<li>
<p><a href="https://github.com/davidmichaelkarr">David Michael Karr</a></p>
</li>
<li>
<p><a href="http://twitter.com/paulk_asert">Paul King</a></p>
</li>
<li>
<p><a href="http://twitter.com/glaforge">Guillaume Laforge</a></p>
</li>
<li>
<p><a href="http://twitter.com/pledbrook">Peter Ledbrook</a></p>
</li>
<li>
<p><a href="http://grantmcconnaughey.github.io/">Grant McConnaughey</a></p>
</li>
<li>
<p><a href="https://github.com/dnahodil">David Nahodil</a></p>
</li>
<li>
<p><a href="https://github.com/jnorthr">James Northrop</a></p>
</li>
<li>
<p><a href="https://github.com/marcpa00">Marc Paquette</a></p>
</li>
<li>
<p><a href="https://github.com/michaelss">Michael Schuenck</a></p>
</li>
<li>
<p><a href="https://github.com/PascalSchumacher">Pascal Schumacher</a></p>
</li>
<li>
<p><a href="https://github.com/shils">Shil Sinha</a></p>
</li>
<li>
<p><a href="https://github.com/stavytskyi">Maksym Stavytskyi</a></p>
</li>
<li>
<p><a href="https://twitter.com/asteingr">André Steingreß</a></p>
</li>
<li>
<p><a href="https://github.com/keeganwitt">Keegan Witt</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_license"><a class="anchor" href="#_license"></a>4.2. License</h3>
<div class="paragraph">
<p>This work is licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.4.11<br>
Last updated 2017-04-27 00:32:41 +10:00
</div>
</div>

</body></html>